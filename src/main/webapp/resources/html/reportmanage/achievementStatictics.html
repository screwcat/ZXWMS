<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link href="../../css/zx-all.css" rel="stylesheet" type="text/css" />
<link href="../../css/app.css" rel="stylesheet" type="text/css" />
<script src="../../js/zx-all.js" type="text/javascript"></script>
<script src="../../js/exportxls.js?v=2"></script>
<script type="text/javascript" charset="utf-8"
	src="../../js/media/js/ZeroClipboard.js"></script>
<title>业绩统计表</title>
</head>
<body style="overflow-y: hidden;">
	<div class="l-panel-search clearfix centertoolbar-w">
		<div id="searchbar" class="l-searchbar clearfix">
			<!--查询条件-->
			<div class="l-panel-search-cond clearfix">
				<div class="float-l">
					<div class="l-panel-search-title">部门名称：</div>
					<div class="l-panel-search-item">
						<input type="text" id="dept_name"/>
					</div>
				</div>
				<div class="float-l">
					<div class="l-panel-search-title" style="margin-left: 16px">业务员/编号:</div>
					<div class="l-panel-search-item">
						<input type="text" id="personnel_info" />
					</div>
				</div>
				<div class="float-l">
					<div class="l-panel-search-title">员工状态:</div>
					<div class="l-panel-search-item">
						<select name="personnel_state" id="personnel_state" style="width: 135px;">
							<option selected="selected" value="">---请选择---</option> 
							<option value="2">兼职</option> 
							<option value="1">在职</option> 
						</select> 
					</div>
				</div>
			</div>	
			<div class="l-panel-search-cond clearfix">
				<div class="float-l">
					<div class="l-panel-search-title">个人当月新增业绩（全部-年化）：</div>
					<div class="l-panel-search-item">
						<input type="text" id="per_sum_add_deal_low" />-<input type="text" id="per_sum_add_deal_up" />
					</div>
				</div>
				<div class="float-l">
					<div class="l-panel-search-title">个人当月净增业绩：</div>
					<div class="l-panel-search-item">
						<input type="text" id="per_clear_add_low" />-<input type="text" id="per_clear_add_up" />
					</div>
				</div>
				<div class="float-l">
					<div class="l-panel-search-title">个人存量全部-非年化：</div>
					<div class="l-panel-search-item">
						<input type="text" id="per_stock_all_low" />-<input type="text" id="per_stock_all_up" />
					</div>
				</div>
				<div class="float-l">
					<div class="l-panel-search-title">个人存量新产品-年化：</div>
					<div class="l-panel-search-item">
						<input type="text" id="per_stock_new_deal_low" />-<input type="text" id="per_stock_new_deal_up" />
					</div>
				</div>
			</div>
			<div class="l-panel-search-cond clearfix">
				<div class="float-l">
					<div class="l-panel-search-title">当月部门净增业绩：</div>
					<div class="l-panel-search-item">
						<input type="text" id="team_clear_add_low" />-<input type="text" id="team_clear_add_up" />
					</div>
				</div>
				<div class="float-l">
					<div class="l-panel-search-title">部门存量全部-非年化：</div>
					<div class="l-panel-search-item">
						<input type="text" id="team_stock_all_low" />-<input type="text" id="team_stock_all_up" />
					</div>
				</div>
			</div>
			<div class="l-panel-search-cond clearfix">
				<div class="float-l">
					<div class="l-panel-search-title">佣金起始月份:</div>
					<div class="l-panel-search-item">
						<input id="start_date" class="Wdate" type="text"
							onclick="WdatePicker({dateFmt:'yyyy-MM',isShowClear:true})"
							style="width: 150px; vertical-align: top;" />
					</div>
				</div>
				<div class="float-l">
					<div class="l-panel-search-title">佣金结束月份:</div>
					<div class="l-panel-search-item">
						<input id="end_date" class="Wdate" type="text"
							onclick="WdatePicker({dateFmt:'yyyy-MM',isShowClear:true})"
							style="width: 150px; vertical-align: top;" />
					</div>
				</div>
				
				<div class="float-l commonstyle"  style="margin-top: 5px">
					<div style="margin-bottom: 6px;">
						<input id="cxbtn" onclick="search();" class="btn-search"
							type="button"
							style="margin-right: 7px;" id='search_btn'/>
					</div>
				</div>
				
				<div class="float-l commonstyle"  style="margin-top: 5px">
					<div style="margin-bottom: 6px;">
						<input id="cxbtn" onclick="clear_text();" class="btn-empty"
							type="button"
							style="margin-right: 7px;" id='search_btn'/>
					</div>
				</div>
				
				<div class="float-l commonstyle"  style="margin-top: 5px">
					<div style="margin-bottom: 6px;">
						<input id="dcbtn" onclick="exportExcel();" class="btn-export-gray"
							type="button"
							style="margin-right: 7px;" id='search_btn'/>
					</div>
				</div>	
				<div class="float-l commonstyle"  style="margin-top: 5px">
					<div style="margin-bottom: 6px;">
						(12页详细报表)<input id="dcbtn" onclick="exportDetailExcel();" class="btn-export-gray"
							type="button"
							style="margin-right: 7px;" id='search_btn'/>
					</div>
				</div>	
				
			</div>
		</div>
		
	</div>
	<div class="l-tab-links-sub">
	<ul style="left: 0px; ">
		<li id="gryj_li" class="l-selected-sub" onclick="changeTab('gryj');"><a>个人业绩</a>
		<div class="l-tab-links-item-left-sub"></div>
		<div class="l-tab-links-item-right-sub"></div>
		</li>
		<li id="tdyj_li" class="l-unselected-sub" onclick="changeTab('tdyj');"><a>团队业绩</a>
		<div class="l-tab-links-item-left-sub"></div>
		<div class="l-tab-links-item-right-sub"></div></li>
	</ul>
	</div>
	<!--  -->
	<div id="tdyj" style="height:300px"><div id="grid_td" style="height:300px"></div></div>
	<div id="gryj" style="display:none;height:300px"><div id="grid_gr" style="height:300px"></div></div>
	
	<div id="tdyj"><div id="grid_td"></div></div>
	<div id="gryj" style="display:none"><div id="grid_gr"></div></div>
	<form id="fileform" action="/WMS/fileExport.dos">
		<input id="out_file_name" name="out_file_name" type="hidden"/>
	</form>
	<!-- 工具条初始化 -->
	<script type="text/javascript">
        var grid_gr;
        var grid_td;
		var params;
		var columns_gr ;
		var columns_td ;
		var now_date;
        $(function() {
        	init_month();
        	search();
        	changeTab("gryj");
        });
        
        
        //设置佣金月份为前一月份
         function init_month(){
        	 var dt = new Date();
        	 var fdt ="";
        	 if(dt.getMonth()+1 == 1){
        		fdt = (dt.getFullYear()-1).toString() +"-12";
        		now_date = (dt.getFullYear()-1).toString() +"12";
			 }else{
        	 	fdt = dt.getFullYear().toString() +"-"+formatDate(dt.getMonth());
           	 	now_date = dt.getFullYear().toString()+formatDate(dt.getMonth());
        	 }
        	 $("#end_date").val(fdt);
        }
        //月、日补零
         function formatDate(v) {
        	 if (v < 10) return '0' + v;return v.toString();
         }
         
        
         function init_columns(){
         	params = globalUtil.getFormParam("searchbar");
         	params.personnel_state=$("select[name='personnel_state'] option:selected").val();
			
         	var data=globalUtil.syncGetJson('/reportmanage/getWmsinveAchievementAllColumns.do',params);
			columns_gr= eval(data.columns_gr);
			columns_td= eval(data.columns_td);
			
          }
         
        
        //表格初始化
        function initGrid() {
            grid_gr = $("#grid_gr").ligerGrid({
        		columns: columns_gr,
        		url: global_param.context_name + '/reportmanage/wmsInveAchievementPerStatisticswithpaginglist.do',
        		sortName: '', // 排序列名
				sortOrder: 'desc', // 排序方式
        		rownumbers: true,
        		allowUnSelectRow: true,
        		enabledSort: true, 
        		usePager: true,
        		width: '100%',
        		height: '90%',
        		heightDiff: -4,
        		parms: {
        			_filterParms: -1
        		}
            });
            
            grid_td = $("#grid_td").ligerGrid({
        		columns: columns_td,
        		url: global_param.context_name + '/reportmanage/wmsInveAchievementTeamStatisticswithpaginglist.do',
        		sortName: '', // 排序列名
				sortOrder: 'desc', // 排序方式
        		rownumbers: true,
        		allowUnSelectRow: true,
        		enabledSort: true, 
        		usePager: true,
        		width: '100%',
        		height: '88%',
        		heightDiff: -8,
        		parms: {
        			_filterParms: -1
        		}
            });
        	
        }  
      
        
        //查询
       	function search() {
       		params = globalUtil.getFormParam("searchbar");
        	params.personnel_state=$("select[name='personnel_state'] option:selected").val();
       		if(""==params.end_date){
        		globalUtil.warnMsg("请输入查询截止时间！");
        		return;
        	}
       		init_columns();
        	initGrid();
        	
        	$("body").startLoading();
    		$.ajax({
                type: "POST",
                url: global_param.context_name + "/export/achievementStaticticsCheckDateToStatic.do",
                data: params,
                timeout : 0,
                dataType: 'json',
                success: function(json) {
                	global_ligerui_extend.search(grid_gr, params);
                    global_ligerui_extend.search(grid_td, params);
                    $("body").stopLoading();
                }
            }); 
            
        }
    	
    	function exportExcel(){
    		params = globalUtil.getFormParam("searchbar");
    		params.personnel_state=$("select[name='personnel_state'] option:selected").val();
    		if(""==params.end_date){
        		globalUtil.warnMsg("请输入查询截止时间！");
        		return;
        	}
    		$("body").startLoading();
    		$.ajax({
                type: "POST",
                url: global_param.context_name + "/export/achievementStaticticsExportPoi.do",
                data: params,
                timeout : 0,
                dataType: 'json',
                success: function(json) {
                	$("body").stopLoading();
                	var out_file_name=json.out_file_name;
                	doDownloadFile(out_file_name);
                }
            });   
    	}
    	function changeTab(id){
    		var gryj = document.getElementById("gryj"); //客户基本信息
    		var tdyj = document.getElementById("tdyj"); //客户资料
    		if("gryj"==id){
    			$("#gryj_li").removeClass().addClass("l-selected-sub");
    			$("#tdyj_li").removeClass().addClass("l-unselect ed-sub");
    			gryj.style.display = '';
    			tdyj.style.display = 'none';
    			global_ligerui_extend.search(grid_gr, params);
    		}else{
    			$("#tdyj_li").removeClass().addClass("l-selected-sub");
    			$("#gryj_li").removeClass().addClass("l-unselected-sub");
    			gryj.style.display = 'none';
    			tdyj.style.display = '';
                global_ligerui_extend.search(grid_td, params);
    		}
    	}
    	function exportDetailExcel(){
    		var export_end_month_day=$('#end_date').val();
    		if(""==export_end_month_day){
        		globalUtil.warnMsg("请输入查询截止时间！");
        		return;
        	}
    		$("body").startLoading();
    		$.ajax({
                type: "POST",
                url: global_param.context_name + "/export/achievementDayStaStaticticsExportPoi.do",
                data: "export_end_month_day=" + export_end_month_day,
                timeout : 0,
                dataType: 'json',
                success: function(json) {
                	$("body").stopLoading();
                	var out_file_name=json.out_file_name;
                	doDownloadFile(out_file_name);
                }
            });
    		
    	}
    	function doDownloadFile(out_file_name){
    		out_file_name = encodeURIComponent(out_file_name,"utf-8");
    		$("#out_file_name").val(out_file_name);
    		$("#fileform").submit();
    	}
    	//獲取部門信息
    	function searchPersonnel(obj){
    		var url = globalUtil.getHtml("searchDept.html");
    		spfcDialog = $.ligerDialog.open({
    	        url: url,
    	        title: '选择部门',
    	        width: 600,
    	        height: globalUtil.setDialogHeight(650),
    	        isResize: false
    		});
    	}
    	
    	function clear_text(){
    		$('#dept_name').val("");
    		$('#personnel_info').val("");
    		$('#personnel_state').val("");
    		$('#per_sum_add_deal_low').val("");
    		$('#per_sum_add_deal_up').val("");
    		$('#per_clear_add_low').val("");
    		$('#per_clear_add_up').val("");
    		$('#per_stock_all_low').val("");
    		$('#per_stock_all_up').val("");
    		$('#per_stock_new_deal_low').val("");
    		$('#per_stock_new_deal_up').val("");
    		$('#team_clear_add_low').val("");
    		$('#team_clear_add_up').val("");
    		$('#team_stock_all_low').val("");
    		$('#team_stock_all_up').val("");
    		$('#start_date').val("");
    		$('#end_date').val("");
    	}
    	
        </script>
</body>
</html>