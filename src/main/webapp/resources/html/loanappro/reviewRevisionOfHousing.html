<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>复议申请详细</title>
<link href="../../css/zx-all.css" rel="stylesheet" type="text/css" />
<script src="../../js/zx-all.js" type="text/javascript"></script>
<style type="text/css">
.float-l {
    height: 40px;
}

input {
    width: 150px;
}

.readonly {
    background-color: rgb(235, 235, 228);
    width: 150px;
}
</style>
</head>
<body>
	<div class="pop-center overflow-au" style="margin: 5px; margin-top: 5px;">
	    <div class="center-content clearboth" style="min-width: 700px;" id="data">
	        <div class="center-title" style="margin-top: 0px;">客户信息</div>
		    <div class="center-content2 clearboth" style="min-width: 500px;" id="customerInfo">
		        <div class="l-panel-search-cond clearfix" style="padding-top: 10px;">
			        <div class="float-l" style="margin-left: 80px">
		                <div class="l-panel-search-title">客户姓名：</div>
		                <div class="l-panel-search-item">
		                    <input type="text" id="customer_name" maxlength="50" readonly="readonly" class="readonly" />
		                </div>
		            </div>
		            <div class="float-l">
		                <div class="l-panel-search-title">手机号码：</div>
		                <div class="l-panel-search-item">
		                    <input type="text" id="mobile_telephone1" maxlength="50" readonly="readonly" class="readonly" />
		                </div>
		            </div>
		            <div class="float-l">
		                <div class="l-panel-search-title">身份证号：</div>
		                <div class="l-panel-search-item">
		                    <input type="text" id="id_card" maxlength="50" readonly="readonly" class="readonly" />
		                </div>
		            </div>
		            <div class="float-l clearboth" style="margin-left: 80px">
		                <div class="l-panel-search-title">房屋地址：</div>
		                <div class="l-panel-search-item">
		                    <input type="text" id="house_address" maxlength="50" style="width: 394px;" readonly="readonly" class="readonly" />
		                </div>
		            </div>
		            <div class="float-l">
		                <div class="l-panel-search-title">房屋类型：</div>
		                <div class="l-panel-search-item">
		                    <input type="text" id="house_type" maxlength="50" readonly="readonly" class="readonly" />
		                </div>
		            </div>
		            <div class="float-l clearboth" style="margin-left: 80px">
		                <div class="l-panel-search-title">建筑面积：</div>
		                <div class="l-panel-search-item">
		                    <input type="text" id="house_building_area" maxlength="50" readonly="readonly" class="readonly" style="width: 114px;" />平方米
		                </div>
		            </div>
		            <div class="float-l">
		                <div class="l-panel-search-title">购买时间：</div>
		                <div class="l-panel-search-item">
		                    <input type="text" id="house_buy_date" maxlength="50" readonly="readonly" class="readonly" />
		                </div>
		            </div>
		            <div class="float-l">
		                <div class="l-panel-search-title">是否复式：</div>
		                <div class="l-panel-search-item">
		                    <input type="text" id="is_compound" maxlength="50" readonly="readonly" class="readonly" />
		                </div>
		            </div>
			    </div>
		    </div>
	        <div class="center-title" style="margin-top: 0px;">贷款信息</div>
	        <div class="center-content2 clearboth" style="min-width: 500px;">
			    <div class="l-panel-search-cond clearfix" style="padding-top: 10px;">
			        <div class="float-l" style="margin-left: 80px">
			            <div class="l-panel-search-title">贷款产品：</div>
		                <div class="l-panel-search-item">
		                    <select id="cre_loan_type" style="width: 152px;">
		                    </select>
		                    <input type="hidden" id="cre_loan_type_old" />
		                </div>
		            </div>
		            <div class="float-l">
		                <div class="l-panel-search-title">还款期数：</div>
		                <div class="l-panel-search-item">
		                    <input type="text" id="max_repayment_time_limit" maxlength="50" style="width: 139px;" />月
		                    <input type="hidden" id="max_repayment_time_limit_old" />
		                </div>
		            </div>
		            <div class="float-l">
		                <div class="l-panel-search-title">贷款金额：</div>
		                <div class="l-panel-search-item">
		                    <input type="text" id="credit_limit" maxlength="50" style="width: 125px;" />万元
		                    <input type="hidden" id="credit_limit_old" />
		                </div>
		            </div>
		            <div class="float-l clearboth" style="margin-left: 80px">
		                <div class="l-panel-search-title">贷款利率：</div>
		                <div class="l-panel-search-item">
		                    <input type="text" id="loan_interest_rate" maxlength="50" style="width: 141px;" />%
		                    <input type="hidden" id="loan_interest_rate_old" />
		                </div>
		            </div>
		            <div class="float-l">
		                <div class="l-panel-search-title">终审额度：</div>
		                <div class="l-panel-search-item">
		                    <input type="text" id="appro_limit" maxlength="50" readonly="readonly" class="readonly" style="width: 125px;" />万元
		                </div>
		            </div>
		            <div class="float-l" style="margin-left: 14px;">
		                <div class="l-panel-search-title">业务员：</div>
	                    <div class="l-panel-search-item">
	                        <input type="text" id="salesman_name_all" style="width: 125px" readonly="readonly" />
	                        <input type="hidden" id="salesman_name_all_old" />
	                        <a href="#" id="searchPersonnelId">选择</a>
	                            <input id="salesman_id" type="hidden" />
	                            <input id="salesman_name" type="hidden" />
	                            <input id="salesman_code" type="hidden" />
	                            <input id="salesman_city_code" type="hidden" />
	                            <input id="salesman_dept_id" type="hidden" />
	                            <input id="salesman_shortcode" type="hidden" />
	                            
	                            <input id="salesman_id_old" type="hidden" />
	                            <input id="salesman_name_old" type="hidden" />
	                            <input id="salesman_code_old" type="hidden" />
	                            <input id="salesman_city_code_old" type="hidden" />
	                            <input id="salesman_dept_id_old" type="hidden" />
	                            <input id="salesman_shortcode_old" type="hidden" />
	                        </div>
	                    </div>
		            </div>
			    </div>
		    </div>
		    <div class="center-title" style="margin-top: 0px;">申请信息</div>
	        <div class="center-content2 clearboth" style="min-width: 500px;">
	            <div class="l-panel-search-cond clearfix" style="padding-top: 10px; height: 180px;">
	                <div class="float-l" style="margin-left: 56px">
	                    <div class="l-panel-search-title"><span class="redstar">*</span>申请复议原因：</div>
		                <div class="l-panel-search-item">
		                    <select id="again_appl_reason" style="width: 152px;">
		                    	<option value="-1">请选择</option>
		                    </select>
		                </div>
	                </div>
	                <div class="float-l" style="margin-left: 80px">
	                	<div class="l-panel-search-title">备注信息：</div>
	                    <div class="l-panel-search-item">
	                        <textarea id="again_appl_remark" style="width: 638px; height: 100px;"></textarea>
	                    </div>
	                </div>
	            </div>
	        </div>
		</div>
	</div>
    <!-- 提交功能按钮区 -->
    <div class="pop-footer5 clearboth" style="bottom: 1px; height: 35px" id="tb_btn">
        <!-- 提交 -->
        <input id="save" class="btn-saveT"
            onmouseover="this.className='btn-saveT-over'"
            onmouseout="this.className='btn-saveT'"
            onmousedown="this.className='btn-saveT-down'" type="button"
            style="margin-right: 7px;" />
        <input id="save" class="btn-saveT"
            onmouseover="this.className='btn-saveT-over'"
            onmouseout="this.className='btn-saveT'"
            onmousedown="this.className='btn-saveT-down'" type="button"
            style="margin-right: 7px;display: none;" />     
        <input id="cancel"
            class="btn-cancel" onmouseover="this.className='btn-cancel-over'"
            onmouseout="this.className='btn-cancel'"
            onmousedown="this.className='btn-cancel-down'" type="button" />
    </div>
<script type="text/javascript">

var spfcDialog;

jQuery(function($){ 
    
	//业务员选择
	$('#searchPersonnelId').click(function() {
		var url = globalUtil.getHtml("../creditManage/searchPersonnelForCredit.html");
		spfcDialog = $.ligerDialog.open({
	        url: url,
	        title: '选择业务员',
	        width: 1000,
	        height: globalUtil.setDialogHeight(600),
	        isResize: false
	    });
	});
	
	//贷款产品、贷款额度、还款期限变化则变更利率
    $('#cre_loan_type,#max_repayment_time_limit,#credit_limit').change(function() {
    	$.ajax({ 
            type: "POST", 
            url: global_param.context_name + "/loanappro/getprotocolProperty.do",
            async: false,
            dataType: "json",
            data: {
    	        	cre_loan_type: $("#cre_loan_type").val(),
    	        	borrow_deadline: $("#max_repayment_time_limit").val(),
    	        	credit_limit: $("#credit_limit").val(),
    	        	wms_cre_credit_head_id: wms_cre_credit_head_id
    	    }, 
            success: function(data) {
                if(data.newFD != null && ('borrow_interest' in data.newFD) && data.newFD.borrow_interest != null) {
                	$('#loan_interest_rate').val(data.newFD.borrow_interest);
                }
            }
        });
    });
	
	//初始化数据
	var wms_cre_credit_head_id = $.query.get('wms_cre_credit_head_id');
	
	//初始化贷款产品下拉列表
	$(globalUtil.getSysDictData(102)).each(function(i, o) {
		$('#cre_loan_type').append('<option value="' + o.value_code + '">' + o.value_meaning + '</option>');
	});
	
	//初始化复议原因下拉列表
	$(globalUtil.getSysDictData(103)).each(function(i, o) {
		$('#again_appl_reason').append('<option value="' + o.value_code + '">' + o.value_meaning + '</option>');
	});
	
	$.ajax({
        url: global_param.context_name + '/cremanage/reviewRevisionOfHousingDisp.do',
        type: 'POST',
        data: {
        	wms_cre_credit_head_id : wms_cre_credit_head_id
        },
        async: false,
        success: function(data) {
            if(data != null) {
            	$('#data input,select').each(function() {
            		if($(this).attr('id') in data) {
            			$(this).val(data[$(this).attr('id')]);
            		}
            	});
            }
        }
    });
	
	//保存
	$('#save').click(function() {
		
		if($('#again_appl_reason').val() == -1) {
			globalUtil.warnMsg(globalErrorMsg['1600001']);
			return;
		}
		
		var reqMap = {};
		$('#data input,select,textarea').each(function() {
			reqMap[$(this).attr('id')] = $(this).val();
		});
		reqMap.wms_cre_credit_head_id = wms_cre_credit_head_id;
		$.ajax({
	        url: global_param.context_name + '/cremanage/reviewRevisionOfHousingSave.do',
	        type: 'POST',
	        data: reqMap,
	        async: false,
	        success: function(data) {
	        	if(data == "success") {
	        		globalUtil.successMsg(globalErrorMsg['100002'], function() {  
	        			window.parent.dialog.hide();
	        			window.parent.search();
	                });
	        	} else {
	        		globalUtil.warnMsg(globalErrorMsg['100012']);
	        	}
	        }
	    });
	});
	
	//取消
	$('#cancel').click(function() {
        window.parent.dialog.hide();
	});
	
});

//选择业务员回调赋值
function getCheckedPersonnelAll(data) {
    $("#salesman_name_all").val(data.personnel_name + '/' + data.personnel_shortcode);
    $("#salesman_id").val(data.personnel_id);
    $("#salesman_name").val(data.personnel_name);
    $("#salesman_code").val(data.personnel_code);
    $("#salesman_city_code").val(data.personnel_regionnumber);
    $("#salesman_dept_id").val(data.personnel_deptid);
    $("#salesman_shortcode").val(data.personnel_shortcode);
}

function closePage() {
    try {
        window.parent.dialog.hide();
    } catch(e) {
        globalUtil.closeCurrentTab();
    }
 }

//关闭本页并刷新查询页面
function refreshAndClosePage() {     
    window.parent.search();
    closePage();    
}

</script>
</body>
</html>
