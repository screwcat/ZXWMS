<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>房贷放款申请</title>
<link href="../../css/app.css" type="text/css" rel="stylesheet" />
<link href="../../css/zx-all.css" rel="stylesheet" type="text/css" />
<script language="Javascript" src="../../js/zx-all.js"> </script>

<style type="text/css">
.textright {
	text-align: right;
}

.textleft {
	text-align: left;
}

/*input_tb css*/
.input_tb_new {
	/*border:1px solid #dfdfdf;*/
	width: 100%;
	margin-bottom: 10px;
}

.input_tb_new a {
	color: #056aff;
	text-decoration: none;
	font-weight: normal;
}

.input_tb_new td {
	height: 35px;
	line-height: 25px;
	/*border-bottom:1px dashed #d5d5d5;*/
	padding-top: 3px;
}

.input_tb_new .tr_title td {
	background-color: #f5f8ff;
	padding-left: 16px;
	font-weight: bold;
	height: 30px;
	line-height: 30px;
	/*border-bottom:1px solid #dfdfdf;*/
}

.input_tb_new .tr_last td {
	border-bottom: 0;
}

.input_tb_new .title {
	text-align: right;
}

.input_tb_new .subtitle {
	text-align: left;
	background-color: #d2e1fd;
	border-top: 1px solid #fff;
	/*border-left:1px solid #fff;*/
}

.input_tb_new .tr_btn_input td {
	background-color: #fbfbfb;
	/*border-top:1px solid #dbdbdb;*/
	/*height:40px;*/
}

.title_tb {
	background-color: #f5f8ff;
	padding-left: 16px;
	font-weight: bold;
	height: 30px;
	line-height: 30px;
	height: 35px;
	line-height: 25px;
	padding-top: 3px;
}

.data_tb td {
	height: 30px;
	line-height: 24px;
	padding-left: 10px;
	border-bottom: 1px dashed #e3e4e6;
	text-align: left;
}

.td_title {
	background: none repeat scroll 0 0 #EAF0FB;
}

.tb_input TD {
	background: none repeat scroll 0 0 #FFFFFF;
	padding: 3px 1px 1px 4px;
}

table td {
	border-color: #BFBFBF;
}
</style>
</head>
<body>
	<div class="tab_titleT">
		<!--查询条件  begin-->
		<table width="100%" border="0" cellspacing="0" cellpadding="0">
			<tr valign="bottom" id='trtab1'>
				<td class="tabbody1" id="tabbody1" tabname='mytab'>
					<div align="center">转账单</div>
				</td>
			</tr>
		</table>
	</div>
	<div class="center-content clearboth" style="margin-top: 30px;">
		<div class="center-title">基本信息</div>
		<div id="transfer" class="center-txt" style="height: 220px;">
			<div class="float-l clearboth">
				<div class="pop-form-title">客户姓名:</div>
				<div class="pop-form-item">
					<input type="text" id="debtor_name" style="width: 150px;"
						disabled="disabled" />
				</div>
			</div>
			<div class="float-l">
				<div class="pop-form-title">身份证号:</div>
				<div class="pop-form-item">
					<input type="text" id="debtor_identity_id" style="width: 150px;"
						disabled="disabled" />
				</div>
			</div>
			<div class="float-l">
				<div class="pop-form-title">抵押房面积:</div>
				<div class="pop-form-item">
					<input type="text" id="house_area" style="width: 134px;"
						isRequired="1" isFloat="1" minVal="0" maxVal="10000" scope="a" />&nbsp;㎡
				</div>
			</div>
			<div class="float-l clearboth">
				<div class="pop-form-title">签单日期:</div>
				<div class="pop-form-item">
					<input type="text" id="borrow_begin_date" style="width: 150px;"
						readonly="readonly" />
				</div>
			</div>
			<div class="float-l">
				<div class="pop-form-title">合同金额:</div>
				<div class="pop-form-item">
					<input type="text" id="principal_lower" style="width: 134px;"
						disabled="disabled" />&nbsp;元
				</div>
			</div>
			<div class="float-l">
				<div class="pop-form-title">合同金额大写:</div>
				<div class="pop-form-item">
					<input type="text" id="principal_caps" style="width: 150px;"
						disabled="disabled" />
				</div>
			</div>
			<div class="float-l clearboth">
				<div class="pop-form-title">合同编号:</div>
				<div class="pop-form-item">
					<input type="text" id="protocol_id_year_num" style="width: 150px;"
						disabled="disabled" />
				</div>
			</div>
			<div class="float-l">
				<div class="pop-form-title">转款余额:</div>
				<div class="pop-form-item">
					<input type="text" id="loan_amount" style="width: 134px;"
						readonly="readonly" />&nbsp;元
				</div>
			</div>
			<div class="float-l">
				<div class="pop-form-title">转款余额大写:</div>
				<div class="pop-form-item">
					<input type="text" id="loan_amount_caps" style="width: 150px;"
						readonly="readonly" />
				</div>
			</div>
			<div class="float-l clearboth">
				<div class="pop-form-title">还款方式:</div>
				<div class="pop-form-item">
					<input type="text" id="protocol_type_name" style="width: 150px;"
						disabled="disabled" />
				</div>
			</div>
			<div class="float-l">
				<div class="pop-form-title">贷款期数:</div>
				<div class="pop-form-item">
					<input type="text" id="borrow_deadline" style="width: 150px;"
						disabled="disabled" />
				</div>
			</div>
			<div class="float-l " style="margin-left: 0px;">
				<div class="pop-form-title">房产核查费:</div>
				<div class="pop-form-item">
					<input type="text" id="check_pay" style="width: 134px;"
						disabled="disabled" />&nbsp;元
				</div>
			</div>
			<div class="float-l clearboth">
				<div class="pop-form-title">还款金额:</div>
				<div class="pop-form-item">
					<input type="text" id="refund_limit_month" style="width: 134px;"
						disabled="disabled" />&nbsp;元
				</div>
			</div>
			<div class="float-l">
				<div class="pop-form-title">其中利息:</div>
				<div class="pop-form-item">
					<input type="text" id="org_repay_interest" style="width: 134px;"
						disabled="disabled" />&nbsp;元
				</div>
			</div>
			<div class="float-l">
				<div class="pop-form-title">本金:</div>
				<div class="pop-form-item">
					<input type="text" id="org_repay_principal" style="width: 134px;"
						disabled="disabled" />&nbsp;元
				</div>
			</div>
			<div class="float-l clearboth">
				<div class="pop-form-title">他项费:</div>
				<div class="pop-form-item">
					<input type="text" id="it_cost_fee" style="width: 134px;" readonly="readonly" />&nbsp;元
				</div>
			</div>
			<div class="float-l">
				<div class="pop-form-title">加急费:</div>
				<div class="pop-form-item">
					<input type="text" id="expedited_fee" style="width: 134px;" readonly="readonly" />&nbsp;元
				</div>
			</div>
			<div class="float-l">
				<div class="pop-form-title">平台服务费:</div>
				<div class="pop-form-item">
					<input type="text" id="platform_fee" style="width: 134px;" readonly="readonly" />&nbsp;元
				</div>
			</div>
			<!-- <div class="float-l clearboth">
				<div class="pop-form-title">扣除利息：</div>
				<div class="pop-form-item">
					<input type="text" id="deduction_of_interest" style="width: 134px;" readonly="readonly" />&nbsp;元
				</div>
			</div>
			<div class="float-l">
				<div class="pop-form-title">平台服务费明细：</div>
				<div class="pop-form-item">
					<input type="text" id="fees_detail" style="width: 150px;" isRequired="1" />
				</div>
			</div> -->
			<div class="float-l clearboth">
				<div class="pop-form-title">银行:</div>
				<div class="pop-form-item">
					<input type="text" id="receive_bank" style="width: 410px; margin-left: -1px;" isRequired="1" />
				</div>
			</div>
			<div class="float-l" style="margin-left: 16px;">
				<div class="pop-form-title">卡号:</div>
				<div class="pop-form-item">
					<input type="text" id="card_no" style="width: 150px;" isRequired="1" />
				</div>
			</div>
			<!-- <div class="float-l">
				<div class="pop-form-title">开户行：</div>
				<div class="pop-form-item">
					<input type="text" id="bank_of_deposit" style="width: 150px;" isRequired="1" />
				</div>
			</div> -->
			<!-- <div class="float-l clearboth">
				<div class="pop-form-title" style="height: 93px">备注：</div>
				<div class="pop-form-item">
					<textarea id="remark" name="remark" rows="35" cols="110"style="width: 698px; height: 80px;" maxLen="250"></textarea>
				</div>
			</div> -->
			<div style="display: none;">
				<!-- 添加的虚线 -->
				<div class="line clearboth"></div>
				<div style="margin-top: 7px">
					<div style="float: left; width: 70px; margin-left: 23px; margin-right: 10px">身份证附件:</div>
					<div style="float: left">
						<div id="showIdImage"></div>
						<div id="upload_id"></div>
					</div>
				</div>
				<!-- 添加的虚线 -->
				<div class="line clearboth"></div>
				<div style="margin-top: 7px">
					<div
						style="float: left; width: 70px; margin-left: 23px; margin-right: 10px">
						银行卡附件:</div>
					<div style="float: left">
						<div id="showAmountImage"></div>
						<div id="upload_amount"></div>
					</div>
				</div>
				<!-- 添加的虚线 -->
	            <div class="line clearboth"></div>
	            <div style="margin-top: 7px">
	                <div style="float: left; width: 70px; margin-left: 23px; margin-right: 10px">转账单附件:</div>
	                <div style="float: left">
	                    <div id="showTransferOrderImage"></div>
	                    <div id="upload_transferorder"></div>
	                </div>
	            </div>
	            <!-- 添加的虚线 -->
	            <div class="line clearboth"></div>
	            <div style="margin-top: 7px">
	                <div style="float: left; width: 70px; margin-left: 23px; margin-right: 10px">合同附件:</div>
	                <div style="float: left">
	                    <div id="showContractImage"></div>
	                    <div id="upload_contract"></div>
	                </div>
	            </div>
	            <!-- 添加的虚线 -->
	            <div class="line clearboth"></div>
	        </div>
		</div>
		<!-- //*********************************************转账单结束********************************** -->
	</div>
	<div class="center-content clearboth" style="margin-top: -10px;">
		<div id="grid_idea">
			<table align="center" border="1" cellpadding="0" cellspacing="2" style="border-color: #BFBFBF" width="100%"
				style="font-size: 10.5pt;">
				<tr>
					<td class="td_title" width="14%" rowspan="2" align="center">审批意见</td>
					<td>
						<div style="float: left; font-size: 14px;">
							<input type="radio" id="transition_pass" name="pass" class="radio5" value="true" checked="checked" />通过
							<input type="radio" id="transition_reject" name="pass" class="radio5" value="false" />退件
							<input type="radio" id="transition_nullify" name="pass" class="radio5" value="nullify" />作废
						</div>
					</td>
				</tr>
				<tr>
					<td>
						<textarea id="advice" name="advice" rows="100" style="width: 100%; height: 150px; resize: none;"></textarea>
					</td>
				</tr>
			</table>
		</div>
	</div>
	<!-- 提交功能按钮区 -->
	<div class="pop-footer5 clearboth" style="bottom: 1px;" id="tb_btn">
		<input id="tjbtn" onclick="save()" class="btn-saveT"
			onmouseover="this.className='btn-saveT-over'"
			onmouseout="this.className='btn-saveT'"
			onmousedown="this.className='btn-saveT-down'" type="button"
			style="align: right" /> <input id="cancelBtnId" class="btn-cancel"
			onmouseover="this.className='btn-cancel-over'"
			onmouseout="this.className='btn-cancel'"
			onmousedown="this.className='btn-cancel-down'" type="button"
			onclick="closePage();" />
	</div>

	<script type="text/javascript">
	var wms_cre_credit_head_id = $.query.get("wms_cre_credit_head_id");
	var taskId = $.query.get("taskId");
	var edition_num = $.query.get('edition_num');//流程版本号
	var version_number = $.query.get('version_number');//数据来源
	
	$(function() {
		lookpage();//使页面只读
		initForm();	//初始化表单数据	
	});
	
	//使页面只读
	function lookpage() {
		$("input[type=text]").attr({"disabled" : "disabled"});
// 		$("textarea").attr({"disabled":"disabled"});
	}	
	
	//初始化表单数据
	function initForm() {
		$.getJSON(globalUtil.getTimestampUrl('/loanappro/wmssyspropertyobjforhouse.do'),////初始化数据
				{
					"wms_cre_credit_head_id"  : wms_cre_credit_head_id
				},
				function(json) {	
					$.getJSON(globalUtil.getTimestampUrl('/loanappro/getwmsfinacreloanappbyentity.do'),////初始化数据
					{
						"wms_cre_credit_head_id"  : wms_cre_credit_head_id
					},
					function(json2) {	
						if(JSON.stringify(json2).split(",").length != 1) {
							for(var item in json2) {
								json[item] = json2[item];
							}
							
							doFloat(json);
							globalUtil.setFormVal("transfer", json);//初始化提前还款申请信息
							initFormOtherVal(json.todayDate);
							
							$("#upload_id").html('');
							$("#uploan_amount").html('');
							var fjList = globalUtil.syncGetJson('/loanfina/wmsfinacreloanappattwithoutpaginglist.do',{
							"wms_fina_cre_loan_app_id": json.wms_fina_cre_loan_app,//期还款台账id
					        },'POST');
							var idHtml='';
							var amountHtml='';
							var showTransferOrderImageHtml = '';
                            var showContractImageHtml = '';
							for (var i = 0; i < fjList.Rows.length; i++) {
								if(fjList.Rows[i].data_type==1){
									idHtml +='<div style="margin-bottom:8px;" id="delUploadDivId'+fjList.Rows[i].attachment_new_name+'">';
									idHtml += '<a  target="_blank"  href="'+global_param.upload_file_url+fjList.Rows[i].attachment_address+'">'+'<img style="width:700px;height:auto;" src="'+global_param.upload_file_url+fjList.Rows[i].attachment_address+'" /></a>';
									idHtml += '</div>';
								}else if(fjList.Rows[i].data_type==2){
									amountHtml +='<div style="margin-bottom:8px;" id="delUploadDivId'+fjList.Rows[i].attachment_new_name+'">';
									amountHtml +='<a  target="_blank"  href="'+global_param.upload_file_url+fjList.Rows[i].attachment_address+'">'+'<img style="width:700px;height:auto;" src="'+global_param.upload_file_url+fjList.Rows[i].attachment_address+'" /></a>';
									amountHtml += '</div>';
								}else if(fjList.Rows[i].data_type==3){
									showTransferOrderImageHtml +='<div style="margin-bottom:8px;" id="delUploadDivId'+fjList.Rows[i].attachment_new_name+'">';
									showTransferOrderImageHtml +='<a  target="_blank"  href="'+global_param.upload_file_url+fjList.Rows[i].attachment_address+'">'+'<img style="width:700px;height:auto;" src="'+global_param.upload_file_url+fjList.Rows[i].attachment_address+'" /></a>';
									showTransferOrderImageHtml += '</div>';
                                }else if(fjList.Rows[i].data_type==4){
                                	showContractImageHtml +='<div style="margin-bottom:8px;" id="delUploadDivId'+fjList.Rows[i].attachment_new_name+'">';
                                	showContractImageHtml +='<a  target="_blank"  href="'+global_param.upload_file_url+fjList.Rows[i].attachment_address+'">'+'<img style="width:700px;height:auto;" src="'+global_param.upload_file_url+fjList.Rows[i].attachment_address+'" /></a>';
                                	showContractImageHtml += '</div>';
                                }
							}
							$("#showIdImage").html(idHtml);	
							$("#showAmountImage").html(amountHtml);
							$("#showTransferOrderImage").html(showTransferOrderImageHtml);
                            $("#showContractImage").html(showContractImageHtml);
						}
					});
			});
	}
	
	//初始化其他字段的值
	function initFormOtherVal(todayDate) {
		var principal_lower = $('#principal_lower').val();//合同金额
		$('#create_date').val(todayDate);//申请日期	
		$('#deduction_of_interest').val('0');//扣除利息
	}
	
	//将小数四舍五入，如果长度过长保留两位小数
	function doFloat(json){
		//var bridge_amount_val = json.bridge_amount;//过桥金额
		//var fees_val = json.fees;//手续费
		var house_area_val = json.house_area;//抵押房面积
		//json.bridge_amount = bridge_amount_val.toFixed(2);
		//json.fees = fees_val.toFixed(2);
		if((house_area_val).toString().indexOf('.') > 0) {
			json.house_area = house_area_val.toFixed(2);
		}
	}			
	
	var checkedCreditIDs=[];
	function onCheckCB(id){
		if($("#cb"+id).is(':checked')){
			addCheckedCredit(id)
		}else{
			removeCheckedCredit(id)
		}
	}
	
	 // 向checkedCredit中添加id的方法
    function addCheckedCredit(id) {
    	if (findCheckedCredit(id) == -1) {
    		checkedCreditIDs.push(id);
    	}
    };
    // 从checkedCredit中移除id的方法
    function removeCheckedCredit(id) {
    	var i  = findCheckedCredit(id);
    	if (i == -1) {
    		return;
    	}
    	checkedCreditIDs.splice(i, 1);
    };
    
    // 在checkedCredit中查找是否已存在id的方法
    function findCheckedCredit(id) {
    	for(var i = 0; i < checkedCreditIDs.length; i++) {
    		if(checkedCreditIDs[i] == id) {
    			return i;
    		}
    	}
    	return -1;
    };
  	//弹出审批页面
	function sp(){
		var url = globalUtil.getHtml("houseSpApproval.html?wms_cre_credit_head_id="+wms_cre_credit_head_id);
		dialog=$.ligerDialog.open({
			url:url,
			title: '审批',
	        width: 870,
	        height: globalUtil.setDialogHeight(600),
	        onHiddenOrClose: function(){
	    	},
	        isResize: false
		});  
	}
  	
  	//保存
    function save() {
    	if($("input[name='pass']:checked").val() != "true") {
			if(document.getElementById("advice").value == "") {							
				globalUtil.errorMsg("请填写审批意见！"); //提示x
				return;
			}
    	}

  		var params = {};
  		params.pass = $("input[name='pass']:checked").val();
  		params.advice = $('#advice').val();
		//结果
		if(params.advice==""){
			params.advice="同意";
		}
		$('body').startLoading("正在处理中.....");
		$.post(globalUtil.getTimestampUrl("/loanappro/makeloanapprovalsaveforfd.do?wms_cre_credit_head_id=" + wms_cre_credit_head_id),params,
		function(data) {
			$('body').stopLoading();
			 if (data === 'success') {
            	globalUtil.successMsg(globalErrorMsg['100002'], function() {            	
      				window.parent.search();	 		
      		 		closePage();
	            });//保存成功            	 
            } else if(data === 'change') {
                globalUtil.errorMsg(globalErrorMsg['100048'], function() {
                	window.parent.search();         
                    closePage();
                }); //单据状态已改变，请重新操作！(并发校验)
            }else if(data == 'listNull'||data == "exceptionError") {
                globalUtil.errorMsg(globalErrorMsg['500701']); //同步数据失败！)
            } else {
                globalUtil.errorMsg(globalErrorMsg['100012']); //保存失败
            }
        });
    }
  
 	//关闭本页并刷新查询页面
    function refreshAndClosePage(){   
    	window.parent.location.reload();
    	closePage();
    }
 	//关闭页面
    function closePage(){
    	window.parent.dialog.hide();
    }
	</script>
</body>
</html>
