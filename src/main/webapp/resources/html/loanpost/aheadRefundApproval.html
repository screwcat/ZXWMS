<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>财富管理系统</title>
<link href="../../css/zx-all.css" rel="stylesheet" type="text/css" />
<script src="../../js/zx-all.js" type="text/javascript"></script>
<style type="text/css">
/*input_tb css*/
.input_tb {
	border: 1px solid #dfdfdf;
	width: 100%;
	margin-bottom: 10px;
}

.input_tb a {
	color: #056aff;
	text-decoration: none;
	font-weight: normal;
}

.input_tb td {
	height: 35px;
	line-height: 25px;
	border-bottom: 1px dashed #d5d5d5;
	padding-top: 3px;
}

.input_tb .tr_title td {
	background-color: #f5f8ff;
	padding-left: 16px;
	font-weight: bold;
	height: 30px;
	line-height: 30px;
	border-bottom: 1px solid #dfdfdf;
}

.input_tb .tr_last td {
	border-bottom: 0;
}

.input_tb .title {
	text-align: right;
}

.input_tb .subtitle {
	text-align: left;
	background-color: #d2e1fd;
	border-top: 1px solid #fff;
	border-left: 1px solid #fff;
}

.input_tb .tr_btn_input td {
	background-color: #fbfbfb;
	/*border-top:1px solid #dbdbdb;*/
	height: 40px;
}
</style>
</head>
<body>
	<div class="tab_titleT">
		<table width="100%" border="0" cellspacing="0" cellpadding="0">
			<tr valign="bottom" id='trtab1'>
				<td class="tabbody1" id="tabbody1" style="width: 34%"
					onclick="changeTab('tqhkjsqdinfo');"><div align="center">提前还款结算清单</div></td>
				<td class="tabbody2" id="tabbody2" style="width: 33%"
					onclick="changeTab('hklsinfo');"><div align="center">还款历史</div></td>
				<td class="tabbody3" id="tabbody3" style="width: 33%"
					onclick="changeTab('lclcinfo');"><div align="center">流程历程</div></td>
			</tr>
		</table>
	</div>
	<div class="pop-center overflow-au" style="top: 30px;">
		<div id="tqhkjsqdinfo" class="pop-formDiv clearfix"
			style="margin: 5px; margin-top: 25px;">
			<div class="float-l">
				<div class="pop-form-title">客户名称：</div>
				<div class="pop-form-item">
					<input type="text" id="debtor_name" />
				</div>
			</div>
			<div class="float-l">
				<div class="pop-form-title">合同编号：</div>
				<div class="pop-form-item">
					<input type="text" id="protocol_code" />
				</div>
			</div>
			<div class="float-l">
				<div class="pop-form-title">合同日期：</div>
				<div class="pop-form-item">
					<input type="text" id="protocol_creat_date" />
				</div>
			</div>
			<div class="float-l clearboth">
				<div class="pop-form-title">合同金额：</div>
				<div class="pop-form-item">
					<input type="text" id="protocol_amount" style="width: 121px" />元
				</div>
			</div>
			<div class="float-l">
				<div class="pop-form-title">月还款金额：</div>
				<div class="pop-form-item">
					<input type="text" id="refund_limit_month" style="width: 121px" />元
				</div>
			</div>
			<div class="float-l">
				<div class="pop-form-title">已还期数：</div>
				<div class="pop-form-item">
					<input type="text" id="repay_period" />
				</div>
			</div>
			<div class="float-l">
				<div class="pop-form-title">已还本金：</div>
				<div class="pop-form-item">
					<input type="text" id="repay_principal" style="width: 121px" />元
				</div>
			</div>
			<div class="float-l">
				<div class="pop-form-title">已还利息：</div>
				<div class="pop-form-item">
					<input type="text" id="repay_interest" style="width: 121px" />元
				</div>
			</div>
			<div class="float-l">
				<div class="pop-form-title">申请还款日期：</div>
				<div class="pop-form-item">
					<input type="text" id="app_date" />
				</div>
			</div>
			<div class="float-l">
				<div class="pop-form-title">未还期数：</div>
				<div class="pop-form-item">
					<input type="text" id="un_pay_period" />
				</div>
			</div>

			<div class="float-l">
				<div class="pop-form-title">剩余本金：</div>
				<div class="pop-form-item">
					<input type="text" id="un_pay_principal" style="width: 121px" />元
				</div>
			</div>
			<div class="float-l">
				<div class="pop-form-title">返利期数：</div>
				<div class="pop-form-item">
					<input type="text" id="back_interest_period" />
				</div>
			</div>

			<div class="float-l">
				<div class="pop-form-title">返利金额：</div>
				<div class="pop-form-item">
					<input type="text" id="back_ammont" style="width: 121px" />元
				</div>
			</div>
			<div class="float-l">
				<div class="pop-form-title">剩余利息：</div>
				<div class="pop-form-item">
					<input type="text" id="un_pay_interest" style="width: 121px" />元
				</div>
			</div>

			<div class="float-l">
				<div class="pop-form-title">逾期天数：</div>
				<div class="pop-form-item">
					<input type="text" id="cur_overdue_day" style="width: 121px" />天
				</div>
			</div>
			<div class="float-l">
				<div class="pop-form-title">滞纳金额：</div>
				<div class="pop-form-item">
					<input type="text" id="cur_late_fee" style="width: 121px" />元
				</div>
			</div>
			<div class="float-l">
				<div class="pop-form-title">减免额：</div>
				<div class="pop-form-item">
					<input type="text" id="derate" style="width: 121px" />元
				</div>
			</div>
			<div class="float-l">
				<div class="pop-form-title">应还款总额：</div>
				<div class="pop-form-item">
					<input type="text" id="total_ammont" style="width: 121px" />元
				</div>
			</div>
			<div class="float-l" style="height: 73px;">
				<div class="pop-form-title">备注：</div>
				<div class="pop-form-item">
					<textarea id="remark" style="width: 647px; height: 60px"></textarea>
				</div>
			</div>

			<div class="line clearboth"></div>
			<div class="float-l">
				<div class="pop-form-title">返利账户名：</div>
				<div class="pop-form-item">
					<input type="text" id="refund_name" />
				</div>
			</div>
			<div class="float-l">
				<div class="pop-form-title">账户号码：</div>
				<div class="pop-form-item">
					<input type="text" id="refund_number" style="width: 390px" />
				</div>
			</div>
		</div>
		<!-- 提前还款结算清单信息结束 -->
		<div id="hklsinfo" class="pop-formDiv clearfix"
			style="margin: 5px; margin-top: 25px; display: none">

			<div class="float-l">
				<div class="pop-form-title">贷款类型：</div>
				<div class="pop-form-item">
					<input type="text" id="cre_type_name" />
				</div>
			</div>
			<div class="float-l">
				<div class="pop-form-title">业务员：</div>
				<div class="pop-form-item">
					<input type="text" id="salesman_name" />
				</div>
			</div>
			<div class="float-l">
				<div class="pop-form-title">客户专员：</div>
				<div class="pop-form-item">
					<input type="text" id="customer_officer_name" />
				</div>
			</div>
			<div class="float-l">
				<div class="pop-form-title">合同签约日期：</div>
				<div class="pop-form-item">
					<input type="text" id="protocol_creat_date" />
				</div>
			</div>
			<div class="float-l">
				<div class="pop-form-title">放款日：</div>
				<div class="pop-form-item">
					<input type="text" id="loan_date" />
				</div>
			</div>
			<div class="float-l">
				<div class="pop-form-title">还款日：</div>
				<div class="pop-form-item">
					<input type="text" id="refund_day" />
				</div>
			</div>
			<div class="float-l">
				<div class="pop-form-title">合同金额：</div>
				<div class="pop-form-item">
					<input type="text" id="protocol_amount" style="width: 121px" />元
				</div>
			</div>
			<div class="float-l">
				<div class="pop-form-title">贷款利率：</div>
				<div class="pop-form-item">
					<input type="text" id="borrow_interest" style="width: 121px" />％
				</div>
			</div>
			<div class="float-l">
				<div class="pop-form-title">贷款期数：</div>
				<div class="pop-form-item">
					<input type="text" id="borrow_deadline" />
				</div>
			</div>
			<div class="float-l">
				<div class="pop-form-title">月还款金额：</div>
				<div class="pop-form-item">
					<input type="text" id="refund_limit_month" style="width: 121px" />元
				</div>
			</div>
			<div class="float-l">
				<div class="pop-form-title">已还期数：</div>
				<div class="pop-form-item">
					<input type="text" id="repay_period" />
				</div>
			</div>
			<div class="float-l">
				<div class="pop-form-title">剩余本金：</div>
				<div class="pop-form-item">
					<input type="text" id="un_pay_principal" style="width: 121px" />元
				</div>
			</div>
			<div class="float-l">
				<div class="pop-form-title">还款状态：</div>
				<div class="pop-form-item">
					<input type="text" id="repay_status_name" />
				</div>
			</div>
			<div class="float-l">
				<div class="pop-form-title">逾期天数：</div>
				<div class="pop-form-item">
					<input type="text" id="cur_overdue_day" style="width: 121px" />天
				</div>
			</div>
			<div class="float-l clearboth" style="height: 10px;"></div>
			<div class="pop-formDiv clearboth" style="margin: 5px">
				<div class="center-title">还款历史</div>
				<div class="center-txt" style="margin-bottom: 10px;">
					<div id="car-toolbar-top" class="minwidth400"></div>
					<div id="grid"></div>
				</div>
			</div>
			<!-- 还款历史信息结束 -->
		</div>
		<div id="lclcinfo" class="pop-formDiv clearfix"
			style="margin: 5px; display: none">
			<div class="pop-formDiv clearboth" style="margin: 5px">
				<div class="center-title">流程历程</div>
				<div class="center-txt" style="margin-bottom: 10px;">
					<div id="car-toolbar-top" class="minwidth400"></div>
					<div id="grid2"></div>
				</div>
			</div>
		</div>
	</div>
	<div class="pop-footer5 clearboth" style="bottom: 1px;">
		<input id="zcbtn" class="btn-saveT"
			onmouseover="this.className='btn-saveT-over'"
			onmouseout="this.className='btn-saveT'"
			onmousedown="this.className='btn-saveT-down'" type="button"
			style="margin-right: 7px;" onclick="sh()" /> <input id="cancelBtnId"
			class="btn-cancel" onmouseover="this.className='btn-cancel-over'"
			onmouseout="this.className='btn-cancel'"
			onmousedown="this.className='btn-cancel-down'" type="button"
			onclick="closeDialog();" />
	</div>
	<script type="text/javascript">
	var grid;//还款历史表格
	var grid2;//流程历程表格
	var columns;//还款历史表格列
	var columns2;//流程历程表格列
	var dialog;
	var taskId;
	$(function() {
		taskId=$.query.get("taskId");
		wms_cre_credit_head_id = $.query.get('wms_cre_credit_head_id');
		wms_fina_cre_pay_id = $.query.get('wms_fina_cre_pay_id');
		initForm();//初始化表单中的数据
		initGrid();//初始化还款历史表格		
		initGrid2();//初始化流程历程表格
		search();
		$('#tqhkjsqdinfo :input,textarea').attr('disabled','disabled');//使提前还款结算清单中的文本域只读
		$('#hklsinfo :input').attr('disabled','disabled');//使还款历史中的文本框只读
	});
	//关闭窗口
	function closeDialog() {
		window.parent.dialog.hide();
	}
	//初始化表单中的数据
	function initForm(){
		$.getJSON(globalUtil.getTimestampUrl('/loanpost/wmsfinacrerepayinfobypk.do'),
				{
					"wms_fina_cre_pay_id" : wms_fina_cre_pay_id
				},
				function(json) {
					globalUtil.setFormVal("hklsinfo", json);//初始化还款历史表单	
					$.getJSON(globalUtil.getTimestampUrl('/loanpost/wmsfinacreprerepayinfobyentity.do'),
							{
								"wms_cre_credit_head_id" : wms_cre_credit_head_id
							},
							function(json2) {
								for(var item in json2){
									json[item]=json2[item];
								}
								globalUtil.setFormVal("tqhkjsqdinfo", json);//初始化提前还款申请信息之提前还款申请信息表中的数据			
					});							
		});
	}

	//弹出审核页面
	function sh(){
		var url = globalUtil.getHtml("hkglApprove.html?taskId="+taskId+"&wms_cre_credit_head_id="+wms_cre_credit_head_id);
		dialog=$.ligerDialog.open({
			url:url,
			title: '审核',
	        width: 800,
	        height: globalUtil.setDialogHeight(300),
	        onHiddenOrClose: function(){
	    	},
	        isResize: false
		});  
	}
	/**
	 * 切换Tab页
	 */
	 function changeTab(id) {
			var tqhkjsqdinfo = document.getElementById("tqhkjsqdinfo"); //提前还款结算清单tab
			var hklsinfo = document.getElementById("hklsinfo"); //还款历史tab
			var lclcinfo = document.getElementById("lclcinfo"); //流程历程tab
			if (id == 'tqhkjsqdinfo') {
				tqhkjsqdinfo.style.display = '';
				hklsinfo.style.display = 'none';
				lclcinfo.style.display = 'none';
				document.getElementById("tabbody1").className = "tabbody1";
				document.getElementById("tabbody2").className = "tabbody2";
				document.getElementById("tabbody3").className = "tabbody2";
			} else if (id == 'hklsinfo') {
				tqhkjsqdinfo.style.display = 'none';
				hklsinfo.style.display = '';
				document.getElementById("tabbody1").className = "tabbody2";
				document.getElementById("tabbody2").className = "tabbody1";
				document.getElementById("tabbody3").className = "tabbody2";
				lclcinfo.style.display = 'none';
			} else if (id == 'lclcinfo') {
				document.getElementById("tabbody1").className = "tabbody2";
				document.getElementById("tabbody2").className = "tabbody2";
				document.getElementById("tabbody3").className = "tabbody1";
				tqhkjsqdinfo.style.display = 'none';
				hklsinfo.style.display = 'none';
				lclcinfo.style.display = '';
			}
		}
	//表格还款历史初始化color: #056AFF;    
    function initGrid() {
    	columns = [{
            display: '还款期数',
            name: 'repay_no',
            width: 50,
            minWidth: 50
        },{
            display: '还款日期',
            name: 'repay_date',
            width: 120,
            minWidth: 120         
        },{
            display: '还款总额（元）',
            name: 'repay_total',
            width: 120,
            minWidth: 120
        },{
            display: '其中，本金（元）',
            name: 'repay_principal',
            width: 120,
            minWidth: 120
        },{
            display: '利息（元）',
            name: 'repay_interest',
            width: 100,
            minWidth: 100
        },{
            display: '滞纳金（元）',
            name: 'cur_late_fee',
            width: 100,
            minWidth: 100	
        },{
            display: '减免额（元）',
            name: 'derate',
            width: 100,
            minWidth: 100
        }];
    	
        grid = $("#grid").ligerGrid({
    		columns: columns,
    		url: global_param.context_name + '/loanpost/wmsfinacreperiodrepaywithoutpaginglist.do?wms_cre_credit_head_id='+wms_cre_credit_head_id,
    		sortName: 'create_timestamp', // 排序列名
			sortOrder: 'desc', // 排序方式
    		rownumbers: true,
    		allowUnSelectRow: true,
    		usePager: false,
    		width: '100%',
    		height: 300,
    		heightDiff: -4
        });
    }        
	//表格流程历程初始化color: #056AFF;    
    function initGrid2() {
    	columns2 = [{
            display: '节点名称',
            name: 'taskName',
            width: 140,
            minWidth: 140,            
        },{
            display: '审批人',
            name: 'approvers',
            width: 80,
            minWidth: 80,
        }, {
            display: '审批人部门',
            name: 'personnel_deptName',
            width: 120,
            minWidth: 120
        },{
            display: '职务',
            name: 'personnel_postName',
            width: 100,
            minWidth: 100
        },{
            display: '审批结果',
            name: 'approveResult',
            width: 80,
            minWidth: 80
        },{
            display: '审批意见',
            name: 'approveAdvice',
            width: 130,
            minWidth: 130	
        },{
            display: '审批时间',
            name: 'approveTime',
            width: 180,
            minWidth: 180
        }];
    	
        grid2 = $("#grid2").ligerGrid({
    		columns: columns2,
    		url: global_param.context_name + '/loanpost/approvalProcessView.do?wms_cre_credit_head_id='+wms_cre_credit_head_id,
    		sortName: 'customer_code', // 排序列名
			sortOrder: 'asc', // 排序方式
    		rownumbers: true,
    		allowUnSelectRow: true,
    		usePager: false,
    		width: '100%',
    		height: 349,
    		heightDiff: -4,
    		parms: {
    			_filterParms: -1
    		}
        });
    }  
  	//查询
	function search() {
		global_ligerui_extend.search(grid2);
	}
</script>
</body>
</html>
