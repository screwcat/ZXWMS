<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>理财提成一般规则</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link href="../../css/app.css" type="text/css" rel="stylesheet" />
<link href="../../css/zx-all.css" rel="stylesheet" type="text/css" />
<link href="../../css/button.css" rel="stylesheet" type="text/css" />
<link href="../../css/icon.css" rel="stylesheet" type="text/css" />
<script src="../../js/zx-all.js" type="text/javascript"></script>
<style type="text/css">
#lcsqxxtable td {
	padding: 7px;
}
</style>
</head>
<body>
	<div style="margin-bottom: 1px">
		<div class="tab_titleT">
			<table width="100%" border="0" cellspacing="0" cellpadding="0">
				<tr valign="bottom">
					<td class="tabbody1" id="tabbody1" onclick="changeTab('khjl');"><div
							align="center" id="khtabdiv" class="tab_step tab_step101">客户经理佣金规则</div></td>
					<td  class="tabbody2" id="tabbody2"
						onclick="changeTab('tdjl');"><div align="center"
							id="tdtabdiv" class="tab_step tab_step202">团队经理佣金规则</div></td>
					<td  class="tabbody2" id="tabbody3"
						onclick="changeTab('jxjl');"><div align="center"
							id="jxtabdiv" class="tab_step tab_step302">见习团队经理佣金规则</div></td>
				</tr>
			</table>
		</div>
		<div class="pop-center overflow-au" style="top: 30px">
			<div id="khjl" class="center-content"
				style="min-width: 550px; height: auto">
				<div>
					<div id="lcsqxxdiv" class="center-txt clearfix" style="margin-bottom: 5px; padding: 5px; border: 1px solid #BFBFBF; height:600px; overflow: auto;">
						<div style="float: left; margin-left:60px;"><a href="#" onclick="addNewkh()" class="btn" >新增</a></div>
						<div class="float-l commonstyle clearboth">
							<table id="lcsqxxtablekh" border="1" bordercolor="#BFBFBF"
								style="text-align: center; margin-left: 55px; margin-bottom: 5px; margin-top: 3px">
								<tr id="lcsqxxtrkh" style="background-color: #676b73; color: white" id="headtr">
									<td width="120px" height="35px"class="title"></td>
									<td width="150px"  height="35px"class="title">职务</td>
									<td width="150px" height="35px" class="title">员工状态</td>
									<td width="320px" height="35px"class="title">产品</td>
									<td width="150px" height="35px"class="title">规则状态</td>
									<td width="130px" height="35px"class="title">创建时间</td>
									<td width="130px" height="35px"class="title">启用时间</td>
									<td width="130px" height="35px"class="title">禁用时间</td>
									<td width="106px" height="35px"class="title">操作</td>
								</tr>
							</table>
						</div>
					</div>
				</div>
				<!-- 分页 -->
				<div class="pageDiv right">
				  <span id="page">1/共1页</span>
				  <a href="javascript:void(0)"  class="btnPage" onclick="getInfo(params,'firstPage')">首页</a>
				  <a href="javascript:void(0)" id="frontPage" class="btnPage" style="width:20px;" onclick="getInfo(params,'frontPage')"><i class="icon arrowL-ico3"></i></a>
	              <a href="javascript:void(0)" id="nextPage" class="btnPage" style="width:20px;" onclick="getInfo(params,'nextPage')"><i class="icon arrowR-ico3"></i></a>
				  <a href="javascript:void(0)"  class="btnPage" onclick="getInfo(params,'lastPage')">尾页</a>
				</div>
			</div>
			
			<div id="tdjl" class="center-content"
				style="display: none;min-width: 550px; height: auto">

					<div id="lcsqxxdiv" class="center-txt clearfix" style="margin-bottom: 5px; padding: 5px; border: 1px solid #BFBFBF; height:600px; overflow: auto;">
						<div style="float: left; margin-left:60px;"><a href="#" onclick="addNewtd()" class="btn" >新增</a></div>
						<div class="float-l commonstyle clearboth">
							<table id="lcsqxxtabletd" border="1" bordercolor="#BFBFBF"
								style="text-align: center; margin-left: 55px; margin-bottom: 5px; margin-top: 3px">
								<tr id="lcsqxxtrtd" style="background-color: #676b73; color: white" id="headtr">
									<td width="120px" height="35px"class="title"></td>
									<td width="150px" height="35px"class="title">职务</td>
									<td width="320px" height="35px"class="title">产品</td>
									<td width="150px" height="35px"class="title">规则状态</td>
									<td width="130px" height="35px"class="title">创建时间</td>
									<td width="130px" height="35px"class="title">启用时间</td>
									<td width="130px" height="35px"class="title">禁用时间</td>
									<td width="106px" height="35px"class="title">操作</td>
								</tr>
							</table>
						</div>
					</div>
				<!-- 分页 -->
				<div class="pageDiv right">
				  <span id="pagetd">1/共1页</span>
				  <a href="javascript:void(0)"  class="btnPage" onclick="getInfo(paramstd,'firstPage')">首页</a>
				  <a href="javascript:void(0)" id="frontPagetd" class="btnPage" style="width:20px;" onclick="getInfo(paramstd,'frontPage')"><i class="icon arrowL-ico3"></i></a>
	              <a href="javascript:void(0)" id="nextPagetd" class="btnPage" style="width:20px;" onclick="getInfo(paramstd,'nextPage')"><i class="icon arrowR-ico3"></i></a>
				  <a href="javascript:void(0)"  class="btnPage" onclick="getInfo(paramstd,'lastPage')">尾页</a>
				</div>
			</div>
			<div id="jxjl" class="center-content"
				style="display: none;min-width: 550px; height: auto">
				<div>
					
					<div id="lcsqxxdiv" class="center-txt clearfix" style="margin-bottom: 5px; padding: 5px; border: 1px solid #BFBFBF; height:600px; overflow: auto;">
						<div style="float: left; margin-left:60px;"><a href="#" onclick="addNewjx()" class="btn" >新增</a></div>
						<div class="float-l commonstyle clearboth">
							<table id="lcsqxxtablejx" border="1" bordercolor="#BFBFBF"
								style="text-align: center; margin-left: 55px; margin-bottom: 5px; margin-top: 3px">
								<tr id="lcsqxxtrjx" style="background-color: #676b73; color: white" id="headtr">
									<td width="120px" height="35px"class="title"></td>
									<td width="150px" height="35px"class="title">职务</td>
									<td width="320px" height="35px"class="title">产品</td>
									<td width="150px" height="35px"class="title">规则状态</td>
									<td width="130px" height="35px"class="title">创建时间</td>
									<td width="130px" height="35px"class="title">启用时间</td>
									<td width="130px" height="35px"class="title">禁用时间</td>
									<td width="106px" height="35px"class="title">操作</td>
								</tr>
							</table>
						</div>
					</div>
					</div>
					<!-- 分页 -->
				<div class="pageDiv right">
				  <span id="pagejx">1/共1页</span>
				  <a href="javascript:void(0)"  class="btnPage" onclick="getInfo(paramsjx,'firstPage')">首页</a>
				  <a href="javascript:void(0)" id="frontPagejx" class="btnPage" style="width:20px;" onclick="getInfo(paramsjx,'frontPage')"><i class="icon arrowL-ico3"></i></a>
	              <a href="javascript:void(0)" id="nextPagejx" class="btnPage" style="width:20px;" onclick="getInfo(paramsjx,'nextPage')"><i class="icon arrowR-ico3"></i></a>
				  <a href="javascript:void(0)"  class="btnPage" onclick="getInfo(paramsjx,'lastPage')">尾页</a>
				</div>
				</div>
			</div>	
		<table id="cloneModeltd" border="1" style="text-align: center; margin-left: 55px; margin-bottom: 5px; margin-top: 3px">
							<tr class="noshow" style="height:35px">
								<td ><a href="#" onclick="showOrhide(this);">详情</a></td>
								<td ><input type="hidden"  name="wms_inve_commission_general_rules_id" value=""/><input type="hidden"  name="job_code" value=""/><span  name="job_code_str"></span></td>
								<td>
									<input type="hidden" name="wms_inve_pruduct_category_id" />
									<span class="category_name"></span>
									<span style="float: right"><a href="#" onclick="showProducts(this)" class="selectObj">选择</a></span>
									<input type="hidden"  name="employee_state" value="1"/>
								</td>
								<td><input type="hidden"  name="state_old_val" /><select name="page_rule_state"  onchange="changeState(this)"><option selected="selected" value="-1">请选择</option><option  value="0">启用</option><option  value="1">禁用</option></select></td>
								<td><span  name="create_datetime"></span></td>
								<td><span  name="start_date"></span></td>
								<td><span  name="stop_date"></span></td>
								<td><a href="#"onclick="save(this)">保存</a><a href="#" onclick="update(this)">修改</a></td>
							</tr>
							<tr  style="background-color: #666666; color: white;height: 10px; display : none" ><!-- #E5FFE5 -->
							</tr>
							<tr   class="stopseach" style="background-color: #666666; color: white ; height: 35px; display : none" >
								<td  ></td>
								<td  ></td>
								<td  >存量限制</td>
								<td >基础提成系数(%)</td>
								<td >转正(%)</td>
							</tr>
							<tr  style="background-color: #E5FFE5; height: 35px; display: none">
								<td width="120px" rowspan=2>佣金系数</td>
								<td >一次性付佣金</td>
								<td ></td>
								<td ><input type="text" name="base_commission_disposable" style="width: 108px;" onblur="tranceNaN(this,'910001')" maxlength='8'/></td>
								<td >+<input type="text" name="positive_commission_disposable" style="width: 108px;"  onblur="tranceNaN(this,'910002')" maxlength='8'/></td>
							</tr>
							<!--<tr  style="background-color: #E5FFE5;height: 35px; display: none">
								<td >月付佣金</td>
								<td >个人总存量<100万</td>
								<td ><input type="text" name="base_commission_monthly1" style="width: 108px;"  onblur="tranceNaN(this,'910003')" maxlength='8'/></td>
								<td >+<input type="text" name="positive_commission_monthly1" style="width: 108px;"  onblur="tranceNaN(this,'910004')" maxlength='8'/></td>
							</tr>
							<tr  class="lcsqxxtr" style="background-color: #E5FFE5;height: 35px; display: none">
								<td ></td>
								<td >个人总存量>=100万</td>
								<td ><input type="text" name="base_commission_monthly2" style="width: 108px;"  onblur="tranceNaN(this,'910005')" maxlength='8'/></td>
								<td >+<input type="text" name="positive_commission_monthly2" style="width: 108px;"  onblur="tranceNaN(this,'910006')" maxlength='8'/></td>
							</tr>-->
							<tr class="lcsqxxtr" style="background-color: #E5FFE5; height: 35px; display: none">
								<td >月付佣金</td>
								<td ><input  type="text" name="stock_begin" style="width: 80px;" onblur="tranceNaN(this,'910031')" maxlength='8'/>到<input type="text" name="stock_end" style="width: 80px;" onblur="tranceNaN(this,'910031')"maxlength='8'/>万(包含)</td>
								<td ><input type="text" name="base_commission" style="width: 108px;" onblur="tranceNaN(this,'910003')" maxlength='8'/></td>
								<td >+<input type="text" name="positive_commission" style="width: 90px;" onblur="tranceNaN(this,'910004')" maxlength='8'/><a href="#" onclick="addRowCLTD(this);">新增</a></td>
							</tr>
							<tr style="background-color: #E5FFE5; height: 35px; display: none" >
								<td ></td>
								<td ></td>
								<td ></td>
								<td >一次性付佣金</td>
								<td >月付佣金</td>
							</tr>
							<tr class="tdfloat" style="background-color: #E5FFE5; height: 35px; display: none" >
								<td >浮动佣金系数</td>
								<td ><select name="commission_type" onchange="changeAll(this)"><option selected="selected" value="-1">请选择</option><option value="0">团队存量</option><option  value="1">团队本月新增</option><option  value="2">团队本月净增</option></select></td>
								<td ><input  type="text" name="cumulate_begin" style="width: 80px;"  onblur="tranceNaN(this,'910007')" maxlength='8'/>万到<input type="text" name="cumulate_end" style="width: 80px;"  onblur="tranceNaN(this,'910008')" maxlength='8'/>万(包含)</td>
								<td >+<input type="text" name="floating_commission_disposable" style="width: 108px;" onblur="tranceNaN(this,'910009')" maxlength='8'/></td>
								<td >+<input type="text" name="floating_commission_monthly" style="width: 80px;" onblur="tranceNaN(this,'910010')" maxlength='8'/><a href="#" onclick="addRow(this);">新增</a></td>
							</tr>
							<tr style="background-color: #E5FFE5; height:10px;display:none" >
							</tr>
					</table>	
		<table id="cloneModelkh" border="1" style="text-align: center; margin-left: 55px; margin-bottom: 5px; margin-top: 3px">
							<tr class="noshow" style="height:35px">
								<td ><a href="#" onclick="showOrhide(this);">详情</a></td>
								<td ><input type="hidden"  name="wms_inve_commission_general_rules_id" value=""/><input type="hidden"  name="job_code" value=""/><span  name="job_code_str"></span></td>
								<td><div style="text-align:left;margin-left:3px"></div><select name="employee_state" ><option selected="selected" value="0">试用</option><!-- <option  value="1">正式</option> --><option  value="7">兼职</option></select></td>	
								<td>
									<input type="hidden" name="wms_inve_commission_special_rules_id" />
									<input type="hidden" name="wms_inve_pruduct_category_id" />
									<span class="category_name"></span>
									<span style="float: right"><a href="#" onclick="showProducts(this)" class="selectObj" >选择</a></span>
								</td>
								<td><input type="hidden"  name="state_old_val" /><select name="page_rule_state" onchange="changeState(this)"><option selected="selected" value="-1">请选择</option><option  value="0">启用</option><option  value="1">禁用</option></select></td>
								<td><span  name="create_datetime"></span></td>
								<td><span  name="start_date"></span></td>
								<td><span  name="stop_date"></span></td>
								<td><a href="#"onclick="save(this)">保存</a><a href="#"  onclick="update(this)">修改</a></td>
							</tr>
							<tr  style="background-color: #666666; color: white;height: 10px; display: none" >
							</tr>
							<tr  class="stopseach" style="background-color: #666666; color: white;height: 35px; display: none" >
								<td ></td>
								<td ></td>
								<td >存量限制</td>
								<td >基础提成系数(%)</td>
								<td >转正(%)</td>
							</tr>
							<tr style="background-color: #E5FFE5; height: 35px; display: none">
								<td width="120px" rowspan=2>佣金系数</td>
								<td >一次性付佣金</td>
								<td ></td>
								<td ><input type="text" name="base_commission_disposable" style="width: 108px;" onblur="tranceNaN(this,'910001')" maxlength='8'/></td>
								<td >+<input type="text" name="positive_commission_disposable" style="width: 108px;" onblur="tranceNaN(this,'910002')" maxlength='8'/></td>
							</tr>
							<tr class="lcsqxxtr" style="background-color: #E5FFE5; height: 35px; display: none">
								<td >月付佣金</td>
								<td ><input  type="text" name="stock_begin" style="width: 50px;" onblur="tranceNaN(this,'910031')" maxlength='8'/>到<input type="text" name="stock_end" style="width: 50px;" onblur="tranceNaN(this,'910031')"maxlength='8'/>万(含)</td>
								<td ><input type="text" name="base_commission" style="width: 108px;" onblur="tranceNaN(this,'910003')" maxlength='8'/></td>
								<td >+<input type="text" name="positive_commission" style="width: 108px;" onblur="tranceNaN(this,'910004')" maxlength='8'/><a href="#" onclick="addRowCL(this);">新增</a></td>
							</tr>
							<tr style="background-color: #E5FFE5; height: 10px; display: none" >
							</tr>
					</table>	
		<!--浮动佣金-->
		<table id="cloneModeltdfloat" border="1" style="text-align: center; margin-left: 55px; margin-bottom: 5px; margin-top: 3px">		
				<tr class="onlynone" style="background-color: #E5FFE5; height: 35px;" >
						<td >浮动佣金系数</td>
						<td ><select name="commission_type" disabled="disabled"><option selected="selected" value="-1"  >请选择</option><option value="0">团队存量</option><option  value="1">团队本月新增</option><option  value="2">团队本月净增</option></select></td>
						<td ><input  type="text" name="cumulate_begin" style="width: 80px;" onblur="tranceNaN(this,'910007')" maxlength='8'/>万到<input type="text" name="cumulate_end" style="width: 80px;" onblur="tranceNaN(this,'910008')"maxlength='8'/>万(包含)</td>
						<td >+<input type="text" name="floating_commission_disposable" style="width: 108px;" onblur="tranceNaN(this,'910009')" maxlength='8'/></td>
						<td >+<input type="text" name="floating_commission_monthly" style="width: 80px;" onblur="tranceNaN(this,'910010')" maxlength='8'/><a href="#" onclick="deleteRowOne(this);">删除</a></td>
				</tr> 
		</table>
		<!--存量 -->
		<table id="cloneModeltdCL" border="1" style="text-align: center; margin-left: 55px; margin-bottom: 5px; margin-top: 3px">		
				<tr  class="lcsqxxtr" style="background-color: #E5FFE5; height: 35px;">
						<td ></td>
						<td ><input  type="text" name="stock_begin" style="width: 50px;" onblur="tranceNaN(this,'910031')" maxlength='8'/>到<input type="text" name="stock_end" style="width: 50px;" onblur="tranceNaN(this,'910031')"maxlength='8'/>万(含)</td>
						<td ><input type="text" name="base_commission" style="width: 108px;" onblur="tranceNaN(this,'910005')" maxlength='8'/></td>
						<td >+<input type="text" name="positive_commission" style="width: 108px;" onblur="tranceNaN(this,'910006')" maxlength='8'/><a href="#" onclick="deleteRowCL(this);">删除</a></td>
				</tr>
		</table>	
		<!--存量团队 -->
		<table id="cloneModeltdCLTD" border="1" style="text-align: center; margin-left: 55px; margin-bottom: 5px; margin-top: 3px">		
				<tr  class="lcsqxxtr" style="background-color: #E5FFE5; height: 35px;">
						<td ></td>
						<td ><input  type="text" name="stock_begin" style="width: 80px;" onblur="tranceNaN(this,'910031')" maxlength='8'/>到<input type="text" name="stock_end" style="width: 80px;" onblur="tranceNaN(this,'910031')"maxlength='8'/>万(包含)</td>
						<td ><input type="text" name="base_commission" style="width: 108px;" onblur="tranceNaN(this,'910005')" maxlength='8'/></td>
						<td >+<input type="text" name="positive_commission" style="width: 90px;" onblur="tranceNaN(this,'910006')" maxlength='8'/><a href="#" onclick="deleteRowCL(this);">删除</a></td>
				</tr>
		</table>
		<!-- 提交功能按钮区 -->
		<div class="pop-footer5 clearboth" style="bottom: 1px;">
		<!-- <input
			id="cancelBtnId" class="btn-cancel"
			onmouseover="this.className='btn-cancel-over'"
			onmouseout="this.className='btn-cancel'"
			onmousedown="this.className='btn-cancel-down'" type="button"
			onclick="closeTab();"/> -->
	</div>
	</div>				
	<script type="text/javascript">

var params={};//分页参数--客户经理
var paramsId={};//上一页下一页的a标签--客户经理

var paramstd={};//分页参数--团队经理
var paramsIdtd={};//上一页下一页的a标签--团队经理

var paramsjx={};//分页参数--见习经理
var paramsIdjx={};//上一页下一页的a标签--见习经理
var job_code_kh="100"//客户经理
var job_code_td="101"//团队经理
var job_code_jx="102"//见习经理
$(function() {
	//数据开始初始化并获取
	initbase("all");
});
//初始化基础参数
function initbase(val){
	if(val==job_code_kh||val=="all"){//客户经理
		//分页-***客户经理*****
		params.page="1";//当前页码
		params.pagesize="15";//每页显示最大条数
		paramsId.frontPage='frontPage';
		paramsId.nextPage='nextPage';
		paramsId.page='page';
		params.job_code=job_code_kh;
		//*******客户经理*****
		getInfo(params,'firstPage');//分页-***客户经理*****
	}
	if(val==job_code_td||val=="all"){//团队经理
		//分页-***团队经理*****
		paramstd.page="1";//当前页码
		paramstd.job_code=job_code_td;//团队经理
		paramstd.pagesize="15";//每页显示最大条数
		paramsIdtd.frontPage='frontPagetd';
		paramsIdtd.nextPage='nextPagetd';
		paramsIdtd.page='pagetd';
		//*******团队经理*****
		getInfo(paramstd,'firstPage');//分页-***团队经理*****
	}
	if(val==job_code_jx||val=="all"){//见习经理
		//分页-***见习经理*****
		paramsjx.page="1";//当前页码
		paramsjx.job_code=job_code_jx;//见习经理
		paramsjx.pagesize="15";//每页显示最大条数
		paramsIdjx.frontPage='frontPagejx';
		paramsIdjx.nextPage='nextPagejx';
		paramsIdjx.page='pagejx';
		//*******见习经理*****
		getInfo(paramsjx,'firstPage');//分页-***见习经理*****
	}
}
//新增理财规则--客户
function addNewkh(){
	$("#lcsqxxtrkh").after($("#cloneModelkh tr").clone(true));
	$("#lcsqxxtablekh").find(".noshow").first().find('[name=job_code]').val(job_code_kh);
	$("#lcsqxxtablekh").find(".noshow").first().find('[name=job_code_str]').text("客户经理");
	$("#lcsqxxtablekh").find(".noshow").first().find("td a").last().css("display","none");
}
//新增理财规则--团队
function addNewtd(){
	$("#lcsqxxtrtd").after($("#cloneModeltd tr").clone(true));
	$("#lcsqxxtabletd").find(".noshow").first().find('[name=job_code]').val(job_code_td);
	$("#lcsqxxtabletd").find(".noshow").first().find('[name=job_code_str]').text("团队经理");
	$("#lcsqxxtabletd").find(".noshow").first().find("td a").last().css("display","none");
}
//新增理财规则--见习
function addNewjx(){
	$("#lcsqxxtrjx").after($("#cloneModeltd tr").clone(true));
	$("#lcsqxxtablejx").find(".noshow").first().find('[name=job_code]').val(job_code_jx);
	$("#lcsqxxtablejx").find(".noshow").first().find('[name=job_code_str]').text("见习经理");
	$("#lcsqxxtablejx").find(".noshow").first().find("td a").last().css("display","none");
}
//显示隐藏详细信息
function showOrhide(obj){
	$(obj).closest("tr").nextUntil(".noshow").toggle("500");
}
//新增浮动工资
function addRow(obj){
	$(obj).closest("tr").after($("#cloneModeltdfloat tr").clone(true));
	var val=$(obj).closest("tr").find("[name=commission_type]").val();//当前用户选择的浮动佣金情况
	$(obj).closest("tr").nextUntil(".noshow").find("[name=commission_type]").val(val);
}
//新增月付佣金存量
function addRowCL(obj,val){
	var number=$(obj).closest("tr").prev().find("td").first().attr("rowSpan");
	$(obj).closest("tr").prev().find("td").first().attr("rowSpan",parseInt(number)+1);	
	$(obj).closest("tr").after($("#cloneModeltdCL tr").clone(true));
	if(val=="1"){//如果为1隐藏当前添加的元素
		$(obj).closest("tr").next().css("display","none");
	}else if(val=="0"){
		$(obj).closest("tr").next().css("display","");
	}
}
//新增月付佣金存量TD团队
function addRowCLTD(obj,val){
	var number=$(obj).closest("tr").prev().find("td").first().attr("rowSpan");
	$(obj).closest("tr").prev().find("td").first().attr("rowSpan",parseInt(number)+1);	
	$(obj).closest("tr").after($("#cloneModeltdCLTD tr").clone(true));
	if(val=="1"){//如果为1隐藏当前添加的元素
		$(obj).closest("tr").next().css("display","none");
	}else if(val=="0"){
		$(obj).closest("tr").next().css("display","");
	}
}
//新增月付佣金存量
function deleteRowCL(obj){
	var number=$(obj).closest("tr").prevUntil(".stopseach").last().find("td").first().attr("rowSpan");
	$(obj).closest("tr").prevUntil(".stopseach").last().find("td").first().attr("rowSpan",parseInt(number)-1);	
	$(obj).closest("tr").remove();
}
//删除浮动工资
function deleteRowOne(obj){
	$(obj).closest("tr").remove();
}
//获取到修改前的状态--暂时废弃
function  getOldVal(obj){
	$(obj).closest("td").find("[name=state_old_val]").val($(obj).val());
}
//产品修改状态
function  changeState(obj){
	var state_old_val=$(obj).closest("td").find("[name=state_old_val]").val();
	if(state_old_val=="0"&&$(obj).val()=="-1"){//规则状态0为启用 1为禁用
		$(obj).val("0");
		globalUtil.errorMsg(globalErrorMsg['910000']);//已启用产品只能修改为禁用
	}
}
//产品浮动工资 限定修改
function changeAll(obj){
	var val=$(obj).val();//当前用户选择的浮动佣金情况
	$(obj).closest("tr").nextUntil(".noshow").find("[name=commission_type]").val(val);
	//console.log($(obj).closest("tr").nextUntil(".noshow"));
}

//分页-***客户经理*****
function getInfo(param,operate){
	//改变页码 operate为操作 是上一页  还是下一页 params为查询参数
	if(wms_page.changePage(param,operate)){
		return;	
	}
	//查询客户经理列表
	list(param);
}
	//查询列表
	function list(param){
		$.get(globalUtil.getTimestampUrl("/inve/wmsinvecommissiongeneralrulesinfo.do"), param, 
			function(json) {
				if (json != null) {
					if (json.Rows.length > 0) {
						deleteRow(param,json);//删除原来的内容 新增行
						initRow(param,json);//根据单据条数新增行
						//查询后返回总条数和当前页码
						if(param.job_code==job_code_kh){//客户经理
							wms_page.getPage(param,json,paramsId);
						}else if(param.job_code==job_code_td){//团队经理
							wms_page.getPage(param,json,paramsIdtd);
						}else if(param.job_code==job_code_jx){//见习经理
							wms_page.getPage(param,json,paramsIdjx);
						}
						initInfo(param,json);//初始化数据
					}
				}
		}); 
	}
	//根据后台单据初始化新增行数
	function initRow(param,json){
		for(var i=0;i<json.Rows.length;i++){
			if(param.job_code==job_code_kh){//客户经理
				addNewkh();	
				$("#lcsqxxtablekh").find(".noshow").first().find("td a").last().css("display","");
			}else if(param.job_code==job_code_td){//团队经理
				addNewtd();
				$("#lcsqxxtabletd").find(".noshow").first().find("td a").last().css("display","");
			}else if(param.job_code==job_code_jx){//见习经理
				addNewjx();
				$("#lcsqxxtablejx").find(".noshow").first().find("td a").last().css("display","");
			}
		}
	}
	//每次点击分页按钮必须删除增加的行
	function deleteRow(param,json){
		for(var i=0;i<json.Rows.length;i++){
			if(param.job_code==job_code_kh){//客户经理
				$("#lcsqxxtablekh").find(".noshow").each(function(i){//客户经理初始化信息
					$(this).nextUntil(".noshow").each(function (j){
						$(this).remove();
					});
					$(this).remove();
				});	
			}else if(param.job_code==job_code_td){//团队经理
				$("#lcsqxxtabletd").find(".noshow").each(function(i){//团队经理初始化信息
					var lengthval=$(this).nextUntil(".tdfloat").last().nextUntil(".noshow").length;
					$(this).nextUntil(".tdfloat").last().nextUntil(".noshow").each(function (m){//浮动工资
						if(m<lengthval-1){
							$(this).remove();
						}
					});
				});	
				$("#lcsqxxtabletd").find(".noshow").each(function(i){//团队经理初始化信息
					$(this).nextUntil(".tdfloat").each(function (j){//tdfloat
						$(this).remove();
					});
					$(this).remove();
				});	
			}else if(param.job_code==job_code_jx){//见习经理
				$("#lcsqxxtablejx").find(".noshow").each(function(i){//见习经理初始化信息
					var lengthval=$(this).nextUntil(".tdfloat").last().nextUntil(".noshow").length;
					$(this).nextUntil(".tdfloat").last().nextUntil(".noshow").each(function (m){//浮动工资
						if(m<lengthval-1){
							$(this).remove();
						}
					});
				});	
				$("#lcsqxxtablejx").find(".noshow").each(function(i){//见习经理初始化信息
					$(this).nextUntil(".tdfloat").each(function (j){//tdfloat
						$(this).remove();
					});
					$(this).remove();
				});	
			}
		}
	}
	//初始化经理规则
	function initInfo(param,json){
		if(param.job_code==job_code_kh){//客户经理
			$("#lcsqxxtablekh").find(".noshow").each(function(i){//客户经理初始化信息
				if(json.Rows[i].parammonthly!=null){//月付佣金
					for(var h=0;h<json.Rows[i].parammonthly.length-1;h++){//新增月付佣金
						addRowCL($(this).nextUntil(".lcsqxxtr").last().next(),"1");
					}
				}
				if(json.Rows[i].wms_inve_commission_general_rules_id){
					$(this).find('[name=wms_inve_commission_general_rules_id]').val(json.Rows[i].wms_inve_commission_general_rules_id);//主表主键	
				}
	            //详情鼠标移上去显示主表id
	            $(this).find('a:first').attr('href', 'javascript:' + json.Rows[i].wms_inve_commission_general_rules_id); 
				$(this).find('[name=job_code]').val(json.Rows[i].job_code);//职务编号
				$(this).find('[name=job_code_str]').val(json.Rows[i].job_code_str);//职务名称
				$(this).find('[name=employee_state]').val(json.Rows[i].employee_state);//员工状态
				$(this).find('[name=page_rule_state]').val(json.Rows[i].page_rule_state);//规则状态
				$(this).find('[name=state_old_val]').val(json.Rows[i].page_rule_state);//规则状态--保存初始值
				$(this).find('[name=create_datetime]').text(json.Rows[i].create_datetime_str);//创建时间
				$(this).find('[name=start_date]').text(json.Rows[i].start_date_str);//启用时间
				$(this).find('[name=stop_date]').text(json.Rows[i].stop_date_str);//禁用时间
				$(this).find("input[name='wms_inve_pruduct_category_id']").val(json.Rows[i].ids);//ids
				$(this).find("span.category_name").html(json.Rows[i].names);	//names
				isDisabledCegain(json.Rows[i],$(this));//根据值来处理
				var num=0;
				$(this).nextUntil(".noshow").each(function (j){
					$(this).find('[name=base_commission_disposable]').val(json.Rows[i].base_commission_disposable);
					$(this).find('[name=positive_commission_disposable]').val(json.Rows[i].positive_commission_disposable);
					/*$(this).find('[name=base_commission_monthly1]').val(json.Rows[i].base_commission_monthly1);
					$(this).find('[name=positive_commission_monthly1]').val(json.Rows[i].positive_commission_monthly1);
					$(this).find('[name=base_commission_monthly2]').val(json.Rows[i].base_commission_monthly2);
					$(this).find('[name=positive_commission_monthly2]').val(json.Rows[i].positive_commission_monthly2);*/
					if(json.Rows[i].parammonthly!=null){
						if($(this).attr("class")=="lcsqxxtr"&&json.Rows[i].parammonthly.length>0){
							$(this).find('[name=stock_begin]').val(json.Rows[i].parammonthly[num].stock_begin);//月付佣金[存量限制](单位:万)起始
							$(this).find('[name=stock_end]').val(json.Rows[i].parammonthly[num].stock_end);//月付佣金[存量限制](单位:万包含)截止
							$(this).find('[name=base_commission]').val(json.Rows[i].parammonthly[num].base_commission);//基础提成系数
							$(this).find('[name=positive_commission]').val(json.Rows[i].parammonthly[num].positive_commission);//转正提成系数
							num+=1;
						}
					}
					isDisabled(json.Rows[i],$(this));//根据值来处理
				});
			});	
		}else if(param.job_code==job_code_td){//团队经理
			$("#lcsqxxtabletd").find(".noshow").each(function(i){//初始化信息
				if(json.Rows[i].parammonthly!=null){//月付佣金
					for(var h=0;h<json.Rows[i].parammonthly.length-1;h++){//新增月付佣金
						addRowCLTD($(this).nextUntil(".lcsqxxtr").last().next(),"1");
					}
				}
				if(json.Rows[i].wms_inve_commission_general_rules_id){
					$(this).find('[name=wms_inve_commission_general_rules_id]').val(json.Rows[i].wms_inve_commission_general_rules_id);//主表主键	
				}
				 //详情鼠标移上去显示主表id
	            $(this).find('a:first').attr('href', 'javascript:' + json.Rows[i].wms_inve_commission_general_rules_id); 
				$(this).find('[name=job_code]').val(json.Rows[i].job_code);//职务编号
				$(this).find('[name=job_code_str]').val(json.Rows[i].job_code_str);//职务名称
				$(this).find('[name=page_rule_state]').val(json.Rows[i].page_rule_state);//规则状态
				$(this).find('[name=state_old_val]').val(json.Rows[i].page_rule_state);//规则状态--保存初始值
				$(this).find('[name=create_datetime]').text(json.Rows[i].create_datetime_str);//创建时间
				$(this).find('[name=start_date]').text(json.Rows[i].start_date_str);//启用时间
				$(this).find('[name=stop_date]').text(json.Rows[i].stop_date_str);//禁用时间
				$(this).find("input[name='wms_inve_pruduct_category_id']").val(json.Rows[i].ids);//ids
				$(this).find("span.category_name").html(json.Rows[i].names);//names
				isDisabledCegain(json.Rows[i],$(this));//根据值来处理
				var num=0;
				//console.log($(this).nextUntil(".tdfloat"));
				$(this).nextUntil(".tdfloat").each(function (j){//tdfloat
					$(this).find('[name=base_commission_disposable]').val(json.Rows[i].base_commission_disposable);
					$(this).find('[name=positive_commission_disposable]').val(json.Rows[i].positive_commission_disposable);
					/*$(this).find('[name=base_commission_monthly1]').val(json.Rows[i].base_commission_monthly1);
					$(this).find('[name=positive_commission_monthly1]').val(json.Rows[i].positive_commission_monthly1);
					$(this).find('[name=base_commission_monthly2]').val(json.Rows[i].base_commission_monthly2);
					$(this).find('[name=positive_commission_monthly2]').val(json.Rows[i].positive_commission_monthly2);*/
					//2015-11-2需求变更 月付佣金可以增加删除
					//获取月付佣金
					if(json.Rows[i].parammonthly!=null){
						if($(this).attr("class")=="lcsqxxtr"&&json.Rows[i].parammonthly.length>0){
							$(this).find('[name=stock_begin]').val(json.Rows[i].parammonthly[num].stock_begin);//月付佣金[存量限制](单位:万)起始
							$(this).find('[name=stock_end]').val(json.Rows[i].parammonthly[num].stock_end);//月付佣金[存量限制](单位:万包含)截止
							$(this).find('[name=base_commission]').val(json.Rows[i].parammonthly[num].base_commission);//基础提成系数
							$(this).find('[name=positive_commission]').val(json.Rows[i].parammonthly[num].positive_commission);//转正提成系数
							num+=1;
						}
					}
					isDisabled(json.Rows[i],$(this));//根据值来处理
				});
				if(json.Rows[i].commissionfloating!=null){
					$("#cloneModeltdfloat").find(".onlynone").css("display","none");//更改隐藏或者显示
					for(var h=0;h<json.Rows[i].commissionfloating.length-1;h++){//新增浮动工资行
						addRow($(this).nextUntil(".tdfloat").last().next());
					}
					$("#cloneModeltdfloat").find(".onlynone").css("display","");
					var lengthval=$(this).nextUntil(".tdfloat").last().nextUntil(".noshow").length;
					$(this).nextUntil(".tdfloat").last().nextUntil(".noshow").each(function (m){//浮动工资
						if(m<lengthval-1){
							if(json.Rows[i].commissionfloating[m]!=null){
								$(this).find('[name=commission_type]').val(json.Rows[i].commissionfloating[m].commission_type);//佣金计算方式
								$(this).find('[name=cumulate_begin]').val(json.Rows[i].commissionfloating[m].cumulate_begin);//累计开始金额
								$(this).find('[name=cumulate_end]').val(json.Rows[i].commissionfloating[m].cumulate_end);//累计结算金额
								$(this).find('[name=floating_commission_disposable]').val(json.Rows[i].commissionfloating[m].floating_commission_disposable);//浮动佣金系数一次性支付佣金系数
								$(this).find('[name=floating_commission_monthly]').val(json.Rows[i].commissionfloating[m].floating_commission_monthly);//浮动佣金系数月付佣金系数
								isDisabledEnd(json.Rows[i],$(this));//来处理数据
							}
						}	
					});
					if(json.Rows[i].commissionfloating.length==0){
						var $tdfloat=$(this).nextUntil(".tdfloat").last().next();
						//console.log($(this).nextUntil(".tdfloat").last().next().css("display","none"));
						//$(this).nextUntil(".tdfloat").last().next().css("display","none");//隐藏
						$tdfloat.find('[name=commission_type]').attr("disabled","disabled");//佣金计算方式
						$tdfloat.find('[name=cumulate_begin]').attr("disabled","disabled");//累计开始金额
						$tdfloat.find('[name=cumulate_end]').attr("disabled","disabled");//累计结算金额
						$tdfloat.find('[name=floating_commission_disposable]').attr("disabled","disabled");//浮动佣金系数一次性支付佣金系数
						$tdfloat.find('[name=floating_commission_monthly]').attr("disabled","disabled");//浮动佣金系数月付佣金系数
						$tdfloat.find("a").first().css("display","none");//隐藏新增按钮
					}
				}
			});	
		}else if(param.job_code==job_code_jx){//见习经理
			$("#lcsqxxtablejx").find(".noshow").each(function(i){//初始化信息
				if(json.Rows[i].parammonthly!=null){//月付佣金
					for(var h=0;h<json.Rows[i].parammonthly.length-1;h++){//新增月付佣金
						addRowCLTD($(this).nextUntil(".lcsqxxtr").last().next(),"1");
					}
				}
				if(json.Rows[i].wms_inve_commission_general_rules_id){
					$(this).find('[name=wms_inve_commission_general_rules_id]').val(json.Rows[i].wms_inve_commission_general_rules_id);//主表主键	
				}
				 //详情鼠标移上去显示主表id
	            $(this).find('a:first').attr('href', 'javascript:' + json.Rows[i].wms_inve_commission_general_rules_id); 
				$(this).find('[name=job_code]').val(json.Rows[i].job_code);//职务编号
				$(this).find('[name=job_code_str]').val(json.Rows[i].job_code_str);//职务名称
				$(this).find('[name=page_rule_state]').val(json.Rows[i].page_rule_state);//规则状态
				$(this).find('[name=state_old_val]').val(json.Rows[i].page_rule_state);//规则状态--保存初始值
				$(this).find('[name=create_datetime]').text(json.Rows[i].create_datetime_str);//创建时间
				$(this).find('[name=start_date]').text(json.Rows[i].start_date_str);//启用时间
				$(this).find('[name=stop_date]').text(json.Rows[i].stop_date_str);//禁用时间
				$(this).find("input[name='wms_inve_pruduct_category_id']").val(json.Rows[i].ids);//ids
				$(this).find("span.category_name").html(json.Rows[i].names);	//names
				isDisabledCegain(json.Rows[i],$(this));//根据值来处理
				var num=0;
				$(this).nextUntil(".tdfloat").each(function (j){//tdfloat
					$(this).find('[name=base_commission_disposable]').val(json.Rows[i].base_commission_disposable);
					$(this).find('[name=positive_commission_disposable]').val(json.Rows[i].positive_commission_disposable);
					/*$(this).find('[name=base_commission_monthly1]').val(json.Rows[i].base_commission_monthly1);
					$(this).find('[name=positive_commission_monthly1]').val(json.Rows[i].positive_commission_monthly1);
					$(this).find('[name=base_commission_monthly2]').val(json.Rows[i].base_commission_monthly2);
					$(this).find('[name=positive_commission_monthly2]').val(json.Rows[i].positive_commission_monthly2);*/
					//2015-11-2需求变更 月付佣金可以增加删除
					//获取月付佣金
					if(json.Rows[i].parammonthly!=null){
						if($(this).attr("class")=="lcsqxxtr"&&json.Rows[i].parammonthly.length>0){
							$(this).find('[name=stock_begin]').val(json.Rows[i].parammonthly[num].stock_begin);//月付佣金[存量限制](单位:万)起始
							$(this).find('[name=stock_end]').val(json.Rows[i].parammonthly[num].stock_end);//月付佣金[存量限制](单位:万包含)截止
							$(this).find('[name=base_commission]').val(json.Rows[i].parammonthly[num].base_commission);//基础提成系数
							$(this).find('[name=positive_commission]').val(json.Rows[i].parammonthly[num].positive_commission);//转正提成系数
							num+=1;
						}
					}
					isDisabled(json.Rows[i],$(this));//根据值来处理
				});
				if(json.Rows[i].commissionfloating!=null){
					$("#cloneModeltdfloat").find(".onlynone").css("display","none");//更改隐藏或者显示
					for(var h=0;h<json.Rows[i].commissionfloating.length-1;h++){//新增浮动工资行
						addRow($(this).nextUntil(".tdfloat").last().next());
					}
					$("#cloneModeltdfloat").find(".onlynone").css("display","");
					var lengthval=$(this).nextUntil(".tdfloat").last().nextUntil(".noshow").length;
					$(this).nextUntil(".tdfloat").last().nextUntil(".noshow").each(function (m){//浮动工资
						if(m<lengthval-1){
							if(json.Rows[i].commissionfloating[m]!=null){
								$(this).find('[name=commission_type]').val(json.Rows[i].commissionfloating[m].commission_type);//佣金计算方式
								$(this).find('[name=cumulate_begin]').val(json.Rows[i].commissionfloating[m].cumulate_begin);//累计开始金额
								$(this).find('[name=cumulate_end]').val(json.Rows[i].commissionfloating[m].cumulate_end);//累计结算金额
								$(this).find('[name=floating_commission_disposable]').val(json.Rows[i].commissionfloating[m].floating_commission_disposable);//浮动佣金系数一次性支付佣金系数
								$(this).find('[name=floating_commission_monthly]').val(json.Rows[i].commissionfloating[m].floating_commission_monthly);//浮动佣金系数月付佣金系数
								isDisabledEnd(json.Rows[i],$(this));//来处理数据
							}
						}
					});
					if(json.Rows[i].commissionfloating.length==0){
						var $tdfloat=$(this).nextUntil(".tdfloat").last().next();
						//console.log($(this).nextUntil(".tdfloat").last().next().css("display","none"));
						//$(this).nextUntil(".tdfloat").last().next().css("display","none");//隐藏
						$tdfloat.find('[name=commission_type]').attr("disabled","disabled");//佣金计算方式
						$tdfloat.find('[name=cumulate_begin]').attr("disabled","disabled");//累计开始金额
						$tdfloat.find('[name=cumulate_end]').attr("disabled","disabled");//累计结算金额
						$tdfloat.find('[name=floating_commission_disposable]').attr("disabled","disabled");//浮动佣金系数一次性支付佣金系数
						$tdfloat.find('[name=floating_commission_monthly]').attr("disabled","disabled");//浮动佣金系数月付佣金系数
						$tdfloat.find("a").first().css("display","none");//隐藏新增按钮
					}
				}
			});	
		}		
	}
	//根据数据状态设置显示并处理是否可以修改
	function isDisabledCegain(jsonVal,obj){
		//if(jsonVal.page_rule_state=="0"||jsonVal.page_rule_state=="1"){//规则状态 0启用 1禁用
			obj.find('[name=employee_state]').attr("disabled","disabled");//员工状态
			obj.find('[name=page_rule_state]').attr("disabled","disabled");//规则状态
			obj.find('.selectObj').css("display","none")//选择按钮		
		//}
		if(jsonVal.page_rule_state=="1"){
			obj.find("td").last().find("a").css("display","none");
		}else if(jsonVal.page_rule_state=="0"){
			obj.find("td").last().find("a").first().css("display","none");
		}else if(jsonVal.page_rule_state=="-1"){
			obj.find("td").last().find("a").first().css("display","none");
		}
	}
	//根据数据状态设置显示并处理是否可以修改
	function isDisabled(jsonVal,obj){
		//if(jsonVal.page_rule_state=="0"||jsonVal.page_rule_state=="1"){//规则状态 0启用 1禁用
			obj.find('[name=base_commission_disposable]').attr("disabled","disabled");
			obj.find('[name=positive_commission_disposable]').attr("disabled","disabled");
			/*obj.find('[name=base_commission_monthly1]').attr("disabled","disabled");
			obj.find('[name=positive_commission_monthly1]').attr("disabled","disabled");
			obj.find('[name=base_commission_monthly2]').attr("disabled","disabled");
			obj.find('[name=positive_commission_monthly2]').attr("disabled","disabled");*/
			obj.find('[name=stock_begin]').attr("disabled","disabled");//月付佣金[存量限制](单位:万)起始
			obj.find('[name=stock_end]').attr("disabled","disabled");//月付佣金[存量限制](单位:万包含)截止
			obj.find('[name=base_commission]').attr("disabled","disabled");//基础提成系数
			obj.find('[name=positive_commission]').attr("disabled","disabled");//转正提成系数
			obj.find("td").last().find("a").css("display","none");
		//}
	}
	//根据数据状态设置显示并处理是否可以修改
	function isDisabledEnd(jsonVal,obj){
		//if(jsonVal.page_rule_state=="0"||jsonVal.page_rule_state=="1"){//规则状态 0启用 1禁用
			obj.find('[name=commission_type]').attr("disabled","disabled");//佣金计算方式
			obj.find('[name=cumulate_begin]').attr("disabled","disabled");//累计开始金额
			obj.find('[name=cumulate_end]').attr("disabled","disabled");//累计结算金额
			obj.find('[name=floating_commission_disposable]').attr("disabled","disabled");//浮动佣金系数一次性支付佣金系数
			obj.find('[name=floating_commission_monthly]').attr("disabled","disabled");//浮动佣金系数月付佣金系数
			obj.find("td").last().find("a").css("display","none");
		//}
	}
//非数字的值置空
function tranceNaN(obj,msg) {
	var val=$(obj).val();
	if(isNaN(val)) {
		$(obj).val("");
		globalUtil.warnMsg(globalErrorMsg[msg],function (){
			$(obj).focus();	
		});
	}
}
//修改按钮
function update(obj){//规则状态 0启用 1禁用
	$(obj).css("display","none");//修改按钮
	$(obj).prev().css("display","");//保存按钮
	var page_rule_state=$(obj).closest("tr").find("[name=page_rule_state]").val();//获取当前规则状态
	if(page_rule_state=="-1"){
		$(obj).closest("tr").find(".selectObj").css("display","");
		$(obj).closest("tr").find("input,select").removeAttr("disabled");//移除不可编辑
		$(obj).closest("tr").nextUntil(".noshow").find("input,select").removeAttr("disabled");//移除不可编辑
		//$(obj).closest("tr").nextUntil(".tdfloat").last().next().find("a").css("display","");
		$(obj).closest("tr").nextUntil(".noshow").find("a").css("display","");
	}else if(page_rule_state=="0"){
		$(obj).closest("tr").find("[name=page_rule_state]").removeAttr("disabled");//移除不可编辑
	}
}
//保存
function save(obj){
	var param={};
	var	commission_floating=[];//浮动佣金系数配置
		//基础数据
		var ele=$(obj).closest("tr");
		param.wms_inve_commission_general_rules_id	=ele.find('[name=wms_inve_commission_general_rules_id]').val();//客户经理
		param.job_code	=ele.find('[name=job_code]').val();//客户经理
		param.employee_state =ele.find('[name=employee_state]').val();//员工状态
		//产品
		param.page_rule_state =ele.find('[name=page_rule_state]').val();//规则状态
	var	paramRules=[];//月付佣金
	$(obj).closest("tr").nextUntil(".noshow").each(function (i){
		if($(this).find('[name=base_commission_disposable]').val()!=null){
			param.base_commission_disposable =$(this).find('[name=base_commission_disposable]').val();//基础佣金系数(一次性支付系数)
		}
		if($(this).find('[name=positive_commission_disposable]').val()!=null){
			param.positive_commission_disposable =$(this).find('[name=positive_commission_disposable]').val();//转正佣金系数(一次性支付系数)
		}
		//2015-11-2需求变更 月付佣金可以增加删除
		//获取月付佣金
		if($(this).attr("class")=="lcsqxxtr"){
			var param_val={};	
			param_val.stock_begin=$(this).find('[name=stock_begin]').val();//月付佣金[存量限制](单位:万)起始
			param_val.stock_end=$(this).find('[name=stock_end]').val();//月付佣金[存量限制](单位:万包含)截止
			param_val.base_commission=$(this).find('[name=base_commission]').val();//基础提成系数
			param_val.positive_commission=$(this).find('[name=positive_commission]').val();//转正提成系数
			paramRules.push(param_val);
		}
		/*if($(this).find('[name=base_commission_monthly1]').val()!=null){
			param.base_commission_monthly1 =$(this).find('[name=base_commission_monthly1]').val();//基础佣金系数(月付支付系数)1
		}
		if($(this).find('[name=positive_commission_monthly1]').val()!=null){
			param.positive_commission_monthly1 =$(this).find('[name=positive_commission_monthly1]').val();//转正佣金系数(月付支付系数)1
		}
		if($(this).find('[name=base_commission_monthly2]').val()!=null){
			param.base_commission_monthly2 =$(this).find('[name=base_commission_monthly2]').val();//基础佣金系数(月付支付系数)2
		}
		if($(this).find('[name=positive_commission_monthly2]').val()!=null){
			param.positive_commission_monthly2 =$(this).find('[name=positive_commission_monthly2]').val();//转正佣金系数(月付支付系数)2
		}*/
		if(i>4&&(param.job_code==job_code_td||param.job_code==job_code_jx)){//第7行为浮动规则
			var param_floating={};//	
			param_floating.commission_type =$(this).find('[name=commission_type]').val();//佣金计算方式
			param_floating.cumulate_begin =$(this).find('[name=cumulate_begin]').val();//累计开始金额
			param_floating.cumulate_end  =$(this).find('[name=cumulate_end]').val();//累计结算金额
			param_floating.floating_commission_disposable  =$(this).find('[name=floating_commission_disposable]').val();//浮动佣金系数一次性支付佣金系数
			param_floating.floating_commission_monthly  =$(this).find('[name=floating_commission_monthly]').val();//浮动佣金系数月付佣金系数
			commission_floating.push(param_floating);
		}
	});
	if(param.job_code==job_code_td||param.job_code==job_code_jx){
		param.commission_floating=JSON.stringify(getGridData(commission_floating));//浮动工资
		if(valiRequiredFloating(param,getGridData(commission_floating))){
			return;
		}
	}
	param.parammonthly=JSON.stringify(paramRules);//月付佣金
	param.category_ids	=ele.find('[name=wms_inve_pruduct_category_id]').val();//产品idl ist
	param.category_names =ele.find('.category_name').text();//产品名称list
	//return;
	//必填校验--浮动佣金
	if(valiRequired(param,commission_floating)){
		return;
	}
	//必填校验--月付佣金
	if(valiRequiredCL(param,paramRules)){
		return;
	}
	//保存
	$.post(globalUtil.getTimestampUrl("/inve/saveKHInfo.do"), param,
	   		function(data) {
	    	if (data === 'success') {
	        	 globalUtil.successMsg(globalErrorMsg['100002'], function(){  
	        		 initbase(param.job_code);//重新加载列表0
	        	 });
	         } else if(data === 'errorid'){//产品存在规则
	             globalUtil.errorMsg(globalErrorMsg['910022']);//选择的产品中已有存在其他规则
	         } else{
	             globalUtil.errorMsg(globalErrorMsg['100012']);//保存失败
	         }
    	});
}
//验证提交时必填项
function valiRequired(param,commission_floating){
	if(param.category_ids==null||param.category_ids==""){//产品
		globalUtil.warnMsg(globalErrorMsg['910023']);//请选择规则对应的产品
		return true;
	}
	if(param.base_commission_disposable==null||param.base_commission_disposable==""){//基础佣金系数(一次性支付系数)
		globalUtil.warnMsg(globalErrorMsg['910011']);
		return true;
	}
	if(param.positive_commission_disposable==null||param.positive_commission_disposable==""){//转正佣金系数(一次性支付系数)
		globalUtil.warnMsg(globalErrorMsg['910012']);
		return true;
	}
}
//验证提交时必填项--月付佣金
function valiRequiredCL(param,paramRules){
	for(var i=0;i<paramRules.length;i++){
		if(paramRules[i].stock_begin==null||paramRules[i].stock_begin==""){//月付佣金[存量限制](单位:万)起始
			globalUtil.warnMsg(globalErrorMsg['910015']);
			return true;
		}
		if(paramRules[i].stock_end==null||paramRules[i].stock_end==""){//月付佣金[存量限制](单位:万包含)截止
			globalUtil.warnMsg(globalErrorMsg['910016']);
			return true;
		}
		if(paramRules[i].base_commission==null||paramRules[i].base_commission==""){//基础提成系数
			globalUtil.warnMsg(globalErrorMsg['910013']);
			return true;
		}
		if(paramRules[i].positive_commission==null||paramRules[i].positive_commission==""){//转正提成系数
			globalUtil.warnMsg(globalErrorMsg['910014']);
			return true;
		}	
		//判断存量开始值是否大于截止值
		if(!(parseInt(paramRules[i].stock_begin)<parseInt(paramRules[i].stock_end))){
			globalUtil.warnMsg(globalErrorMsg['910026']);
			return true;
		}
		//判断存量是否重复
		for(var j=0;j<paramRules.length;j++){
			if((i!=j)&&isInclude(paramRules[i].stock_begin,paramRules[j].stock_begin ,paramRules[j].stock_end,"begin")){
				globalUtil.warnMsg(globalErrorMsg['910025']);
				return true;
			}
			if((i!=j)&&isInclude(paramRules[i].stock_end,paramRules[j].stock_begin ,paramRules[j].stock_end,"end")){
				globalUtil.warnMsg(globalErrorMsg['910025']);
				return true;
			}
		}
	}
}
//判断值是否包括在内val的值是否在  valbegin和 valend范围内 
function isInclude(val,valbegin,valend,opt){
	if((parseInt(val)>parseInt(valbegin))&&(parseInt(val)<parseInt(valend))&&opt=="begin"){
		return true;
	}
	if((parseInt(val)>parseInt(valbegin))&&(parseInt(val)<=parseInt(valend))&&opt=="end"){
		return true;
	}
	return false;
}
//验证提交时必填项--浮动工资
function valiRequiredFloating(param,commission_floating){	
	for(var i=0;i<commission_floating.length;i++){
		if(parseInt(commission_floating[i].cumulate_begin) >= parseInt(commission_floating[i].cumulate_end)){
			globalUtil.warnMsg(globalErrorMsg['910027']);
			return true;
		}
		for(var j=0;j<commission_floating.length;j++){
			if((i!=j)&&isInclude(commission_floating[i].cumulate_begin,commission_floating[j].cumulate_begin ,commission_floating[j].cumulate_end,"begin")){
				globalUtil.warnMsg(globalErrorMsg['910024']);
				return true;
			}
			if((i!=j)&&isInclude(commission_floating[i].cumulate_end,commission_floating[j].cumulate_begin ,commission_floating[j].cumulate_end,"end")){
				globalUtil.warnMsg(globalErrorMsg['910024']);
				return true;
			}
		}
	}
	//console.log(commission_floating.length);
	for(var i=0;i<commission_floating.length;i++){
		if(commission_floating[i].commission_type==null||commission_floating[i].commission_type=="-1"){//佣金计算方式
			globalUtil.warnMsg(globalErrorMsg['910021']);
			return true;
		}
		if(commission_floating[i].cumulate_begin==null||commission_floating[i].cumulate_begin==""){//累计开始金额
			globalUtil.warnMsg(globalErrorMsg['910017']);
			return true;
		}
		if(commission_floating[i].cumulate_end==null||commission_floating[i].cumulate_end==""){//累计结算金额
			globalUtil.warnMsg(globalErrorMsg['910018']);
			return true;
		}
		if(commission_floating[i].floating_commission_disposable==null||commission_floating[i].floating_commission_disposable==""){//浮动佣金系数一次性支付佣金系数
			globalUtil.warnMsg(globalErrorMsg['910019']);
			return true;
		}
		if(commission_floating[i].floating_commission_monthly==null||commission_floating[i].floating_commission_monthly==""){//浮动佣金系数月付佣金系数
			globalUtil.warnMsg(globalErrorMsg['910020']);
			return true;
		}
	}
}

//显示所有产品
function showProducts(obj) {
	var index = $(obj).closest("tr").index();
	var vals = $(obj).closest("tr").find("input[name='wms_inve_pruduct_category_id']").val();
	var job_code_val = $(obj).closest("tr").find("input[name='job_code']").val();//职务编码
	
	var url = globalUtil.getHtml("financingProduct.html?sigleSign=1&vals=" + vals + "&index=" + index + "&sigleSign=2" +"&job_code_val=" + job_code_val);
	dialog = $.ligerDialog.open({
        url: url,
        title: '理财产品',
        width: 700,
        height: globalUtil.setDialogHeight(500),
        onHiddenOrClose: function(){
    	},
        isResize: false
	});
}

//产品选择返回给产品赋值
function setCategory(index, vals, names,job_code_val) {
	if(job_code_val==job_code_kh){//客户经理
		$("#lcsqxxtablekh").find("tr:eq("+index+")").find("input[name='wms_inve_pruduct_category_id']").val(vals);
		$("#lcsqxxtablekh").find("tr:eq("+index+")").find("span.category_name").html(names);	
	}else if(job_code_val==job_code_td){//团队经理
		$("#lcsqxxtabletd").find("tr:eq("+index+")").find("input[name='wms_inve_pruduct_category_id']").val(vals);
		$("#lcsqxxtabletd").find("tr:eq("+index+")").find("span.category_name").html(names);
	}else if(job_code_val==job_code_jx){//见习经理
		$("#lcsqxxtablejx").find("tr:eq("+index+")").find("input[name='wms_inve_pruduct_category_id']").val(vals);
		$("#lcsqxxtablejx").find("tr:eq("+index+")").find("span.category_name").html(names);
	}
	
}
//Tab页切换
function changeTab(id) {
		var khinfo = document.getElementById("khjl"); //开户信息
		var tdinfo = document.getElementById("tdjl"); //团队经理
		var jxinfo = document.getElementById("jxjl"); //见习经理
		
		if(id == 'khjl') {
			document.getElementById("tabbody1").className = "tabbody1";
			document.getElementById("tabbody2").className = "tabbody2";		
			document.getElementById("tabbody3").className = "tabbody2";		
			document.getElementById("khtabdiv").className = "tab_step tab_step101";
			document.getElementById("tdtabdiv").className = "tab_step tab_step202";	
			document.getElementById("jxtabdiv").className = "tab_step tab_step302";				
			khinfo.style.display = '';
			tdinfo.style.display = 'none';
			jxinfo.style.display = 'none';
		}else if (id == 'tdjl') {
			document.getElementById("tabbody1").className = "tabbody2";
			document.getElementById("tabbody2").className = "tabbody1";	
			document.getElementById("tabbody3").className = "tabbody2";		
			document.getElementById("khtabdiv").className = "tab_step tab_step102";
			document.getElementById("tdtabdiv").className = "tab_step tab_step201";	
			document.getElementById("jxtabdiv").className = "tab_step tab_step302";	
			khinfo.style.display = 'none';
			tdinfo.style.display = '';
			jxinfo.style.display = 'none';
			
		}
		else if (id == 'jxjl') {
			document.getElementById("tabbody1").className = "tabbody2";
			document.getElementById("tabbody2").className = "tabbody2";	
			document.getElementById("tabbody3").className = "tabbody1";		
			document.getElementById("khtabdiv").className = "tab_step tab_step102";
			document.getElementById("tdtabdiv").className = "tab_step tab_step202";	
			document.getElementById("jxtabdiv").className = "tab_step tab_step301";	
			khinfo.style.display = 'none';
			tdinfo.style.display = 'none';
			jxinfo.style.display = '';
		}	
}
//关闭本页
function closeTab(){
	globalUtil.closeCurrentTab();//关闭当前TAB页面	
}

/*
获取表格数据，去除全部为空的记录
*/
function getGridData(data_all){
 var griddata = [];
for(var i=0;i<data_all.length;i++){
	var data = data_all[i];
	var isEmpty = true;
 		if(data){
			for(var key in data){
				if($.trim(key) == '' || $.trim(key) == '__status'){continue;}
				if(!globalUtil.isEmpty(data[key])&&data[key]!="-1"){
					if(data[key] instanceof Date){
						data[key]= data[key].format('yyyy-MM-dd');//格式化日期类型数据
					}
					isEmpty = false;
				}
			}
		}
		if(!isEmpty){
			griddata.push(data);
		}
	}
return griddata;
}
</script>
</body>
</html>