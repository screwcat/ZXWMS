<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- namespace必须指向Dao接口 -->
<mapper namespace="com.zx.emanage.cremanage.persist.WmsCreCreditHeadDao">
	<insert id="saveByPk" parameterType="WmsCreCreditHead" useGeneratedKeys="true" keyProperty="wms_cre_credit_head_id">

		insert into
		wms_cre_credit_head
		(
		wms_cre_credit_head_id,
		bill_code,
		credit_purpose,
		max_repayment_limit_per_month,
		credit_limit,
		appro_limit,
		max_repayment_time_limit,
		enter_file_way,
		payroll_payment_way,
		data_type,
		is_complete,
		reference_type,
		is_other_corporation_done,
		is_to_public_stream,
		is_house_certificate_original,
		is_check,
		person_condition,
		salesman_id,
		salesman_code,
		salesman_name,
		city,
		bill_status,
		cre_type,
		create_user_id,
		create_user_name,
		create_timestamp,
		last_update_user_id,
		last_update_timestamp,
		enable_flag,
		is_link_repeat,
		profession_type,
		is_verify,
		cre_loan_type,
		loan_interest_rate,
		create_user_dept_id,
		salesman_city_code,
		salesman_dept_id,
		create_user_city_code,
		salesman_shortcode,
		max_repayment_time_limit_backup,
		cre_loan_type_backup,
		is_cycles,
		documentary_opinion,
		lending_rates_execution_cycles,
		final_eval,
		face_trial_eval,
		is_xudai,
		commission_rate,
		commission_fee,
		credit_limit_backup,
		is_vehicle,
		assessment_id,
		assessment_datetime,
		assessment_result,
		assessment_advice,
		assessment_result_page,
		version_number,
		is_workflow,
		wms_cre_credit_group_id,
		bill_type,
		is_group_flag,
		mort_flag 
		)
		values(
		#{wms_cre_credit_head_id},
		#{bill_code},
		#{credit_purpose},
		#{max_repayment_limit_per_month},
		#{credit_limit},
		#{appro_limit},
		#{max_repayment_time_limit},
		#{enter_file_way},
		#{payroll_payment_way},
		#{data_type},
		#{is_complete},
		#{reference_type},
		#{is_other_corporation_done},
		#{is_to_public_stream},
		#{is_house_certificate_original},
		#{is_check},
		#{person_condition},
		#{salesman_id},
		#{salesman_code},
		#{salesman_name},
		#{city},
		#{bill_status},
		#{cre_type},
		#{create_user_id},
		#{create_user_name},
		#{create_timestamp},
		#{last_update_user_id},
		#{last_update_timestamp},
		#{enable_flag},
		#{is_link_repeat},
		#{profession_type},
		#{is_verify},
		#{cre_loan_type},
		#{loan_interest_rate},
		#{create_user_dept_id},
		#{salesman_city_code},
		#{salesman_dept_id},
		#{create_user_city_code},
		#{salesman_shortcode},
		#{max_repayment_time_limit_backup},
		#{cre_loan_type_backup},
		#{is_cycles},
		#{documentary_opinion},
		#{lending_rates_execution_cycles},
		#{final_eval},
		#{face_trial_eval},
		#{is_xudai},
		#{commission_rate},
		#{commission_fee},
		#{credit_limit_backup},
		#{is_vehicle},
		#{assessment_id},
		#{assessment_datetime},
		#{assessment_result},
		#{assessment_advice},
		#{assessment_result_page},
		#{version_number},
		#{is_workflow},
		#{wms_cre_credit_group_id},
		#{bill_type},
		#{is_group_flag},
		#{mort_flag} 
		)
	</insert>
	<!-- save -->
	<insert id="save" parameterType="WmsCreCreditHead" useGeneratedKeys="true" keyProperty="wms_cre_credit_head_id">
		INSERT INTO wms_cre_credit_head
		(
		wms_cre_credit_head_id,

		bill_code,

		credit_purpose,

		max_repayment_limit_per_month,

		credit_limit,

		max_repayment_time_limit,

		enter_file_way,

		payroll_payment_way,

		data_type,

		is_complete,

		reference_type,

		is_other_corporation_done,

		is_to_public_stream,

		is_house_certificate_original,

		is_check,

		person_condition,

		salesman_id,

		salesman_code,

		salesman_name,

		city,

		cre_type,

		bill_status,

		water_appro_user_id,

		water_appro_user_name,

		water_appro_timestamp,

		water_appro_result,

		info_appro_user_id,

		info_appro_user_name,

		info_appro_timestamp,

		info_appro_result,

		phone_appro_user_id,

		phone_appro_user_name,

		phone_appro_timestamp,

		phone_appro_result,

		certificate_appro_user_id,

		certificate_appro_user_name,

		certificate_appro_timestamp,

		certificate_appro_result,

		create_user_id,

		create_user_name,

		create_timestamp,

		last_update_user_id,

		last_update_timestamp,

		enable_flag,

		protocol_amount,

		is_link_repeat,

		profession_type,

		is_verify,

		is_guarantee,

		house_appro_user_id,

		house_appro_user_name,

		house_appro_timestamp,

		house_appro_result,

		cre_loan_type,

		loan_interest_rate,

		is_review_back,

		check_back_remark,

		water_appro_advice,

		info_appro_advice,

		phone_appro_advice,

		certificate_appro_advice,

		house_appro_advice,

		phone_appro_eval,

		water_appro_eval,

		visa_limit,

		appro_limit,

		water_appro_result_page,

		info_appro_result_page,

		phone_appro_result_page,

		certificate_appro_result_page,

		house_appro_result_page,

		model_one_amount,

		model_two_amount,

		model_three_amount,

		model_four_amount,

		inspection_appro_user_id,

		inspection_appro_user_name,

		inspection_appro_timestamp,

		inspection_appro_result,

		inspection_appro_advice,

		inspection_appro_result_page,

		salesman_city_code,

		create_user_dept_id,

		create_user_city_code,

		salesman_dept_id,

		salesman_shortcode,

		max_repayment_time_limit_backup,

		cre_loan_type_backup,

		review_the_reasons,

		review_of_time,

		is_cycles,

		lending_rates_execution_cycles,

		trial_interview_uid,

		trial_interview_uname,

		trial_interview_timestamp,

		trial_interview_result,

		trial_interview_advice,

		nullify_type,

		nullify_user_name,

		nullify_user_id,

		nullify_timestamp,

		nullify_reason,

		documentary_opinion,

		final_eval,

		face_trial_eval,

		credit_limit_backup,

		is_xudai,

		commission_rate,

		commission_fee,

		is_vehicle,

		assessment_id,

		assessment_datetime,

		assessment_result,

		assessment_advice,

		assessment_result_page,

		version_number,

		is_workflow,

		wms_cre_credit_group_id,

		bill_type,

		is_achievement,

		is_stock,
		
		is_group_flag ,
		
		mort_flag
		)
		VALUES
		(
		#{wms_cre_credit_head_id},
		#{bill_code},
		#{credit_purpose},
		#{max_repayment_limit_per_month},
		#{credit_limit},
		#{max_repayment_time_limit},
		#{enter_file_way},
		#{payroll_payment_way},
		#{data_type},
		#{is_complete},
		#{reference_type},
		#{is_other_corporation_done},
		#{is_to_public_stream},
		#{is_house_certificate_original},
		#{is_check},
		#{person_condition},
		#{salesman_id},
		#{salesman_code},
		#{salesman_name},
		#{city},
		#{cre_type},
		#{bill_status},
		#{water_appro_user_id},
		#{water_appro_user_name},
		#{water_appro_timestamp},
		#{water_appro_result},
		#{info_appro_user_id},
		#{info_appro_user_name},
		#{info_appro_timestamp},
		#{info_appro_result},
		#{phone_appro_user_id},
		#{phone_appro_user_name},
		#{phone_appro_timestamp},
		#{phone_appro_result},
		#{certificate_appro_user_id},
		#{certificate_appro_user_name},
		#{certificate_appro_timestamp},
		#{certificate_appro_result},
		#{create_user_id},
		#{create_user_name},
		#{create_timestamp},
		#{last_update_user_id},
		#{last_update_timestamp},
		#{enable_flag},
		#{protocol_amount},
		#{is_link_repeat},
		#{profession_type},
		#{is_verify},
		#{is_guarantee},
		#{house_appro_user_id},
		#{house_appro_user_name},
		#{house_appro_timestamp},
		#{house_appro_result},
		#{cre_loan_type},
		#{loan_interest_rate},
		#{is_review_back},
		#{check_back_remark},
		#{water_appro_advice},
		#{info_appro_advice},
		#{phone_appro_advice},
		#{certificate_appro_advice},
		#{house_appro_advice},
		#{phone_appro_eval},
		#{water_appro_eval},
		#{visa_limit},
		#{appro_limit},
		#{water_appro_result_page},
		#{info_appro_result_page},
		#{phone_appro_result_page},
		#{certificate_appro_result_page},
		#{house_appro_result_page},
		#{model_one_amount},
		#{model_two_amount},
		#{model_three_amount},
		#{model_four_amount},
		#{inspection_appro_user_id},
		#{inspection_appro_user_name},
		#{inspection_appro_timestamp},
		#{inspection_appro_result},
		#{inspection_appro_advice},
		#{inspection_appro_result_page},
		#{salesman_city_code},
		#{create_user_dept_id},
		#{create_user_city_code},
		#{salesman_dept_id},
		#{salesman_shortcode},
		#{max_repayment_time_limit_backup},
		#{cre_loan_type_backup},
		#{review_the_reasons},
		#{review_of_time},
		#{is_cycles},
		#{lending_rates_execution_cycles},
		#{trial_interview_uid},
		#{trial_interview_uname},
		#{trial_interview_timestamp},
		#{trial_interview_result},
		#{trial_interview_advice},
		#{nullify_type},
		#{nullify_user_name},
		#{nullify_user_id},
		#{nullify_timestamp},
		#{nullify_reason},
		#{documentary_opinion},
		#{final_eval},
		#{face_trial_eval},
		#{credit_limit_backup},
		#{is_xudai},
		#{commission_rate},
		#{commission_fee},
		#{is_vehicle},
		#{assessment_id},
		#{assessment_datetime},
		#{assessment_result},
		#{assessment_advice},
		#{assessment_result_page},
		#{version_number},
		#{is_workflow},
		#{wms_cre_credit_group_id},
		#{bill_type},
		#{is_achievement},
		#{is_stock},
		#{is_group_flag},
		#{mort_flag}
		);
	</insert>
	<!-- 查询数据条数，直接返回int类型条数 -->
	<select id="findCount" parameterType="map" resultType="int">
		select
		count(t1.wms_cre_credit_head_id) as count
		from
		wms_cre_credit_head t1 left join wms_cre_credit_line_customer_change_head t2
		on t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id and
		t2.is_major='1'
		left join wms_cre_credit_group t3
		on t1.wms_cre_credit_group_id = t3.wms_cre_credit_group_id
		<where>
			1=1
			AND (case t1.cre_type when '2' then t1.version_number = 3 else 1 = 1 end)
			<!--<if test="create_user_city_code !=null"> and t1.create_user_city_code =#{create_user_city_code} </if> -->
			<!-- 权限控制 -->
			<if test="childrendept != null">
				and ((FIND_IN_SET(t1.salesman_dept_id, #{childrendept}) > 0) or t1.create_user_city_code =#{create_user_city_code})
			</if>
			<if test="customer_name != null">
				and t2.customer_name like #{customer_name}
			</if>
			<if test="mobile_telephone != null">
				and (t2.mobile_telephone1 like #{mobile_telephone} or
				t2.mobile_telephone2 like #{mobile_telephone})
			</if>
			<if test="id_card != null">
				and t2.id_card = #{id_card}
			</if>
			<if test="idList !=null">
				and t1.wms_cre_credit_head_id in
				<foreach collection="idList" item="wms_cre_credit_head_id" index="index" open="(" separator="," close=")">
					#{wms_cre_credit_head_id}
				</foreach>
			</if>
			and t1.enable_flag='1'
			<if test="bill_code != null">
				and (t1.bill_code like #{bill_code} or t3.bill_code_group like #{bill_code})
			</if>
			<if test="bill_status!= null">
				and t1.bill_status=#{bill_status}
			</if>
			<if test="salesman_name != null or salesman_shortcode!=null">
				and (t1.salesman_name like #{salesman_name} or
				t1.salesman_shortcode like #{salesman_shortcode})
			</if>
			<if test="create_timestamp != null and create_timestamp1!=null">
				and t1.create_timestamp between #{create_timestamp} and
				#{create_timestamp1}
			</if>
			<if test="create_user_id != null">
				and t1.create_user_id != #{create_user_id}
			</if>
			<if test="cre_type !=null">
				and t1.cre_type = #{cre_type}
			</if>
			<if test="city !=null">
				and t1.city like #{city}
			</if>
			<if test="dept_city_sel !=null">
				and t1.salesman_city_code in (select value_meaning from wms_sys_dict_data where value_code=#{dept_city_sel} and wms_sys_dict_id=71)
			</if>
			<if test="dept_name_sel !=null">
				and t1.salesman_dept_id in (select dept_id from sys_dept where dept_pid = #{dept_name_sel})
			</if>
			<if test="mort_flag != null">
				and (case cre_type when 1 then 100 when 2 then t1.mort_flag when 3 then 101 end)  = #{mort_flag}
			</if>
		</where>
	</select>
	<!-- 查询WmsCreCreditHead ，返回List<Map>对象 -->
	<select id="search" parameterType="map" resultType="java.util.HashMap">
		select
		t1.wms_cre_credit_head_id,
		t1.bill_code,
		t1.credit_purpose,
		t1.max_repayment_limit_per_month,
		(case t1.cre_type when '3' then (CAST(t1.credit_limit*0.0001 AS DECIMAL(8,4) )) else t1.credit_limit end) as credit_limit,
		t1.max_repayment_time_limit,
		t1.enter_file_way,
		t1.payroll_payment_way,
		t1.data_type,
		t1.is_complete,
		t1.reference_type,
		t1.is_other_corporation_done,
		t1.is_to_public_stream,
		t1.is_house_certificate_original,
		t1.is_check,
		t1.person_condition,
		t1.salesman_id,
		t1.salesman_code,
		t1.salesman_name,
		t1.city,
		t1.cre_type,
		(case t1.cre_type when '1' then '信贷产品' when '2' then '房贷产品' when '3' then '车贷产品' end) as
		cre_type_name,
		(case t1.cre_type when '1' then ((select value_meaning from wms_sys_dict_data where wms_sys_dict_data_id =t1.cre_loan_type
		and wms_sys_dict_id =26)) when '2' then ((select value_meaning from wms_sys_dict_data where wms_sys_dict_data_id = t1.cre_loan_type
		and wms_sys_dict_id =27)) when '3' then ((select value_meaning from wms_sys_dict_data where
		wms_sys_dict_data_id = t1.cre_loan_type
		and wms_sys_dict_id =75)) end)as cre_loan_type_name,
		t1.bill_status,

		(case t1.cre_type when '1' then ((select value_meaning from wms_sys_dict_data where value_code = bill_status
		and wms_sys_dict_id =24)) when '2' then ((select value_meaning from wms_sys_dict_data where value_code = bill_status
		and wms_sys_dict_id =131)) when '3' then ((select value_meaning from wms_sys_dict_data where value_code = bill_status
		and wms_sys_dict_id =24)) end)as bill_status_name,

		t1.water_appro_user_id,
		t1.water_appro_user_name,
		date_format(t1.water_appro_timestamp,'%Y-%m-%d %H:%i:%s') as water_appro_timestamp,
		t1.water_appro_result,
		t1.info_appro_user_id,
		t1.info_appro_user_name,
		date_format(t1.info_appro_timestamp,'%Y-%m-%d %H:%i:%s') as info_appro_timestamp,
		t1.info_appro_result,
		t1.phone_appro_user_id,
		t1.phone_appro_user_name,
		date_format(t1.phone_appro_timestamp,'%Y-%m-%d %H:%i:%s')as phone_appro_timestamp,
		t1.phone_appro_result,
		t1.certificate_appro_user_id,
		t1.certificate_appro_user_name,
		date_format(t1.certificate_appro_timestamp,'%Y-%m-%d %H:%i:%s') as certificate_appro_timestamp,
		t1.certificate_appro_result,
		t1.create_user_id,
		t1.create_user_name,
		date_format(t1.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t1.last_update_user_id,
		date_format(t1.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
		t1.enable_flag,
		t1.is_link_repeat,
		t1.profession_type,
		t1.is_verify,
		t1.house_appro_result,
		t1.cre_loan_type,
		t1.loan_interest_rate,
		t2.wms_cre_credit_line_customer_change_head_id,
		t2.wms_cre_credit_head_id,
		t2.wms_cus_customer_head_id,
		t2.customer_code,
		t2.customer_name,
		t2.customer_ever_name,
		t2.customer_category,
		t2.gender,
		t2.max_degree,
		date_format(t2.birthday,'%Y-%m-%d') as birthday,
		t2.id_card,
		t2.province,
		t2.city,
		t2.district,
		t2.address_more,
		t2.has_children,
		t2.children_name,
		t2.children_address,
		t2.children_telephone,
		t2.has_married,
		t2.has_house,
		t2.current_address_province,
		t2.current_address_city,
		t2.current_address_district,
		t2.current_address_more,
		t2.post_code,
		t2.fixed_telephone,
		t2.mobile_telephone1,
		t2.service_password1,
		t2.mobile_telephone2,
		t2.service_password2,
		t2.personal_year_income,
		t2.customer_email,
		t2.credit_card_limit,
		t2.common_occupants,
		t2.status,
		t2.create_user_id,
		t2.create_user_name,
		date_format(t2.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t2.last_update_user_id,
		date_format(t2.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
		t2.enable_flag,
		t1.is_review_back,
		t1.water_appro_result_page,
		t1.info_appro_result_page,
		t1.phone_appro_result_page,
		t1.certificate_appro_result_page,
		t1.inspection_appro_user_id,
		t1.inspection_appro_user_name,
		t1.inspection_appro_timestamp,
		t1.inspection_appro_result,
		t1.inspection_appro_advice,
		t1.inspection_appro_result_page,
		t1.salesman_shortcode,
		t1.salesman_city_code,
		t1.create_user_city_code,
		CONCAT(t1.salesman_name,"/",t1.salesman_shortcode) as salesman_name_str,
		t1.trial_interview_uid,
		t1.trial_interview_uname,
		t1.trial_interview_timestamp,
		t1.trial_interview_result,
		t1.trial_interview_advice,
		t1.bill_type,
		<!--房贷流程版本号 1为老流程 2为新流程 -->
		(case when t1.create_timestamp &lt; #{hprocess_time} then '1' else '2' end) as edition_num,
		(
		<include refid="deptCity" />
		) as dept_city,
		(
		<include refid="deptName" />
		) as dept_name,
		t1.documentary_opinion,
		t1.version_number,
		(case cre_type when 1 then 100 when 2 then t1.mort_flag when 3 then 101 end) as mort_flag ,
		(SELECT  value_meaning from wms_sys_dict_data  where wms_sys_dict_id=146 AND value_code=(case cre_type when 1 then 100 when 2 then t1.mort_flag when 3 then 101 end)) as mort_flag_name,
		ifnull(t3.bill_code_group, '') as bill_code_group
		from wms_cre_credit_head t1 LEFT JOIN
		wms_cre_credit_line_customer_change_head t2
		on t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id and
		t2.is_major='1'
		left join wms_cre_credit_group t3
		on t1.wms_cre_credit_group_id = t3.wms_cre_credit_group_id
		<where>
			1=1
			AND (case t1.cre_type when '2' then t1.version_number = 3 else 1 = 1 end)
			<!-- <if test="create_user_city_code !=null"> and t1.create_user_city_code =#{create_user_city_code} </if> -->
			<!-- 权限控制 -->
			<if test="childrendept != null">
				and ((FIND_IN_SET(t1.salesman_dept_id, #{childrendept}) > 0) or t1.create_user_city_code =#{create_user_city_code})
			</if>
			<if test="customer_name != null">
				and t2.customer_name like #{customer_name}
			</if>
			<if test="mobile_telephone != null">
				and (t2.mobile_telephone1 like #{mobile_telephone} or
				t2.mobile_telephone2 like #{mobile_telephone})
			</if>
			<if test="id_card != null">
				and t2.id_card = #{id_card}
			</if>
			<if test="idList !=null">
				and t1.wms_cre_credit_head_id in
				<foreach collection="idList" item="wms_cre_credit_head_id" index="index" open="(" separator="," close=")">
					#{wms_cre_credit_head_id}
				</foreach>
			</if>
			and t1.enable_flag='1'
			<if test="bill_code != null">
				and (t1.bill_code like #{bill_code} or t3.bill_code_group like #{bill_code})
			</if>
			<if test="bill_status!= null">
				and t1.bill_status=#{bill_status}
			</if>
			<if test="salesman_name != null or salesman_shortcode!=null">
				and (t1.salesman_name like #{salesman_name} or
				t1.salesman_shortcode like #{salesman_shortcode})
			</if>
			<if test="create_timestamp != null and create_timestamp1!=null">
				and t1.create_timestamp between #{create_timestamp} and
				#{create_timestamp1}
			</if>
			<if test="create_user_id != null">
				and t1.create_user_id != #{create_user_id}
			</if>
			<if test="cre_type !=null">
				and t1.cre_type = #{cre_type}
			</if>
			<if test="city !=null">
				and t1.city like #{city}
			</if>
			<if test="dept_city_sel !=null">
				and t1.salesman_city_code in (select value_meaning from wms_sys_dict_data where value_code=#{dept_city_sel} and wms_sys_dict_id=71)
			</if>
			<if test="dept_name_sel !=null">
				and t1.salesman_dept_id in (select dept_id from sys_dept where dept_pid = #{dept_name_sel})
			</if>
			<if test="mort_flag != null">
				and (case cre_type when 1 then 100 when 2 then t1.mort_flag when 3 then 101 end)  = #{mort_flag}
			</if>
		</where>
		<if test="sortname != null and sortorder !=null">
			ORDER BY ${sortname} ${sortorder}
		</if>
		<if test="offset != null and pagesize !=null">
			LIMIT ${offset} , ${pagesize}
		</if>
	</select>

	<sql id="deptCity">
		select value_meaning from wms_sys_dict_data where value_code=t1.salesman_city_code and wms_sys_dict_id=25
	</sql>

	<sql id="deptName">
		select dept_name
		<include refid="dept"></include>
	</sql>

	<sql id="deptId">
		select dept_id
		<include refid="dept"></include>
	</sql>

	<sql id="dept">
		<!--from sys_dept where dept_id = (case (select dept_pid from sys_dept where dept_id = t1.salesman_dept_id) when '89' then (t1.salesman_dept_id) when '90' then (t1.salesman_dept_id) else ((select dept_pid from sys_dept where dept_id = t1.salesman_dept_id)) end) -->

		from sys_dept where dept_id =
		(case (select dept_level from sys_dept where dept_id = t1.salesman_dept_id)
		when '5' then (t1.salesman_dept_id)
		when '6' then (select dept_pid from sys_dept where dept_id = t1.salesman_dept_id)
		else (t1.salesman_dept_id)
		end)
	</sql>

	<sql id="deptCityId">
		select dept_pid
		<include refid="dept"></include>
	</sql>

	<!-- 查询数据条数，直接返回int类型条数 -->
	<select id="findCountForFd" parameterType="map" resultType="int">
		select count(t1.wms_cre_credit_head_id) as count
		from
		wms_cre_credit_head t1,wms_cre_credit_line_customer_change_head t2
		<where>
			t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id and
			t2.is_major='1' and t1.cre_type='2' and t1.bill_status='C'
			<if test="id_card != null">
				and t2.id_card = #{id_card}
			</if>
			and t1.enable_flag='1'
			<if test="bill_code != null">
				and t1.bill_code like '${bill_code}'
			</if>
			<if test="customer_name != null">
				and t2.customer_name like '${customer_name}'
			</if>
			<if test="mobile_telephone != null">
				and (t2.mobile_telephone1 like '${mobile_telephone}' or
				t2.mobile_telephone2 like '${mobile_telephone}')
			</if>
			<if test="create_timestamp != null and create_timestamp1!=null">
				and t1.create_timestamp between #{create_timestamp} and
				#{create_timestamp1}
			</if>
		</where>
	</select>
	<!-- 查询房贷贷前跟踪 ，返回List<Map>对象 -->
	<select id="searchForFd" parameterType="map" resultType="java.util.HashMap">
		select
		t1.wms_cre_credit_head_id,
		t1.bill_code,
		t1.credit_purpose,
		t1.max_repayment_limit_per_month,
		t1.credit_limit,
		t1.max_repayment_time_limit,
		t1.enter_file_way,
		t1.payroll_payment_way,
		t1.data_type,
		t1.is_complete,
		t1.reference_type,
		t1.is_other_corporation_done,
		t1.is_to_public_stream,
		t1.is_house_certificate_original,
		t1.is_check,
		t1.person_condition,
		t1.salesman_id,
		t1.salesman_code,
		t1.salesman_name,
		t1.city,
		t1.cre_type,
		t1.bill_status,
		(select value_meaning from wms_sys_dict_data where value_code =
		bill_status
		and wms_sys_dict_id = 24)as bill_status_name,
		t1.water_appro_user_id,
		t1.water_appro_user_name,
		date_format(t1.water_appro_timestamp,'%Y-%m-%d %H:%i:%s') as water_appro_timestamp,
		t1.water_appro_result,
		t1.water_appro_result_page,
		t1.info_appro_user_id,
		t1.info_appro_user_name,
		date_format(t1.info_appro_timestamp,'%Y-%m-%d %H:%i:%s') as info_appro_timestamp,
		t1.info_appro_result,
		t1.info_appro_result_page,
		t1.phone_appro_user_id,
		t1.phone_appro_user_name,
		date_format(t1.phone_appro_timestamp,'%Y-%m-%d %H:%i:%s')as phone_appro_timestamp,
		t1.phone_appro_result,
		t1.phone_appro_result_page,
		t1.certificate_appro_user_id,
		t1.certificate_appro_user_name,

		date_format(t1.certificate_appro_timestamp,'%Y-%m-%d %H:%i:%s') as certificate_appro_timestamp,
		t1.certificate_appro_result,
		t1.certificate_appro_result_page,

		t1.create_user_id,
		t1.create_user_name,
		date_format(t1.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t1.last_update_user_id,
		date_format(t1.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
		t1.enable_flag,
		t1.is_link_repeat,
		t1.profession_type,
		t1.is_verify,
		t1.house_appro_result,
		t1.house_appro_result_page,
		t1.cre_loan_type,
		t1.bill_type,
		t1.loan_interest_rate,
		t2.wms_cre_credit_line_customer_change_head_id,
		t2.wms_cre_credit_head_id,
		t2.wms_cus_customer_head_id,
		t2.customer_code,
		t2.customer_name,
		t2.customer_ever_name,
		t2.customer_category,
		t2.gender,
		t2.max_degree,
		date_format(t2.birthday,'%Y-%m-%d') as
		birthday,
		t2.id_card,
		t2.province,
		t2.city,
		t2.district,
		t2.address_more,
		t2.has_children,
		t2.children_name,
		t2.children_address,
		t2.children_telephone,
		t2.has_married,
		t2.has_house,
		t2.current_address_province,
		t2.current_address_city,
		t2.current_address_district,
		t2.current_address_more,
		t2.post_code,
		t2.fixed_telephone,
		t2.mobile_telephone1,
		t2.service_password1,
		t2.mobile_telephone2,
		t2.service_password2,
		t2.personal_year_income,
		t2.customer_email,
		t2.credit_card_limit,
		t2.common_occupants,
		t2.status,
		t2.create_user_id,
		t2.create_user_name,
		date_format(t2.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t2.last_update_user_id,
		date_format(t2.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
		t2.enable_flag,
		t1.salesman_shortcode,
		CONCAT(t1.salesman_name,"/",t1.salesman_shortcode) as salesman_name_str,
		t1.documentary_opinion,
		t1.version_number
		from wms_cre_credit_head t1,wms_cre_credit_line_customer_change_head t2
		<where>
			t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id and
			t2.is_major='1' and t1.cre_type='2' and t1.bill_status='C'
			<if test="id_card != null">
				and t2.id_card = #{id_card}
			</if>
			and t1.enable_flag='1'
			<if test="bill_code != null">
				and t1.bill_code like '${bill_code}'
			</if>
			<if test="customer_name != null">
				and t2.customer_name like '${customer_name}'
			</if>
			<if test="mobile_telephone != null">
				and (t2.mobile_telephone1 like '${mobile_telephone}' or
				t2.mobile_telephone2 like '${mobile_telephone}')
			</if>
			<if test="create_timestamp != null and create_timestamp1!=null">
				and t1.create_timestamp between #{create_timestamp} and
				#{create_timestamp1}
			</if>
		</where>
		<if test="sortname != null and sortorder !=null">
			ORDER BY ${sortname} ${sortorder}
		</if>
		<if test="offset != null and pagesize !=null">
			LIMIT ${offset} , ${pagesize}
		</if>

	</select>
	<!-- 查询数据条数，直接返回int类型条数 -->
	<select id="findCountForFdForAdd" parameterType="map" resultType="int">
		select count(t1.wms_cre_credit_head_id) as count
		from
		wms_cre_credit_head t1,wms_cre_credit_line_customer_change_head t2
		<where>
			t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id and
			t2.is_major='1' and t1.cre_type='2'
			<if test="id_card != null">
				and t2.id_card = #{id_card}
			</if>
			<if test="idList !=null">
				and t1.wms_cre_credit_head_id in
				<foreach collection="idList" item="wms_cre_credit_head_id" index="index" open="(" separator="," close=")">
					#{wms_cre_credit_head_id}
				</foreach>
			</if>
			and t1.enable_flag='1'
			<if test="bill_code != null">
				and t1.bill_code like '${bill_code}'
			</if>
			<if test="customer_name != null">
				and t2.customer_name like '${customer_name}'
			</if>
			<if test="create_user_id != null">
				and t1.create_user_id != #{create_user_id}
			</if>
			<if test="mobile_telephone != null">
				and (t2.mobile_telephone1 like '${mobile_telephone}' or
				t2.mobile_telephone2 like '${mobile_telephone}')
			</if>
			<if test="dept_city_sel !=null">
				and t1.salesman_city_code in (select value_meaning from wms_sys_dict_data where value_code=#{dept_city_sel} and wms_sys_dict_id=71)
			</if>
			<if test="dept_name_sel !=null">
				and t1.salesman_dept_id in (select dept_id from sys_dept where dept_pid = #{dept_name_sel})
			</if>
		</where>
	</select>
	<!-- 查询房贷流水以及办件审核列表 ，返回List<Map>对象 -->
	<select id="searchForFdForAdd" parameterType="map" resultType="java.util.HashMap">
		select
		t1.wms_cre_credit_head_id,
		t1.bill_code,
		t1.credit_purpose,
		t1.max_repayment_limit_per_month,
		t1.credit_limit,
		t1.max_repayment_time_limit,
		t1.enter_file_way,
		t1.payroll_payment_way,
		t1.data_type,
		t1.is_complete,
		t1.reference_type,
		t1.is_other_corporation_done,
		t1.is_to_public_stream,
		t1.is_house_certificate_original,
		t1.is_check,
		t1.person_condition,
		t1.salesman_id,
		t1.salesman_code,
		t1.salesman_name,
		t1.city,
		t1.cre_type,
		t1.bill_status,
		(select value_meaning from wms_sys_dict_data where value_code =
		bill_status
		and wms_sys_dict_id = 24)as bill_status_name,
		t1.water_appro_user_id,
		t1.water_appro_user_name,
		date_format(t1.water_appro_timestamp,'%Y-%m-%d %H:%i:%s') as water_appro_timestamp,
		t1.water_appro_result,
		t1.info_appro_user_id,
		t1.info_appro_user_name,
		date_format(t1.info_appro_timestamp,'%Y-%m-%d %H:%i:%s') as info_appro_timestamp,
		t1.info_appro_result,
		t1.phone_appro_user_id,
		t1.phone_appro_user_name,
		date_format(t1.phone_appro_timestamp,'%Y-%m-%d %H:%i:%s')as phone_appro_timestamp,
		t1.phone_appro_result,
		t1.certificate_appro_user_id,
		t1.certificate_appro_user_name,

		date_format(t1.certificate_appro_timestamp,'%Y-%m-%d %H:%i:%s') as certificate_appro_timestamp,
		t1.certificate_appro_result,

		t1.create_user_id,
		t1.create_user_name,
		date_format(t1.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t1.last_update_user_id,
		date_format(t1.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
		t1.enable_flag,
		t1.is_link_repeat,
		t1.profession_type,
		t1.is_verify,
		t1.house_appro_result,
		t1.cre_loan_type,
		t1.loan_interest_rate,
		t1.bill_type,
		t2.wms_cre_credit_line_customer_change_head_id,
		t2.wms_cre_credit_head_id,
		t2.wms_cus_customer_head_id,
		t2.customer_code,
		t2.customer_name,
		t2.customer_ever_name,
		t2.customer_category,
		t2.gender,
		t2.max_degree,
		date_format(t2.birthday,'%Y-%m-%d') as birthday,
		t2.id_card,
		t2.province,
		t2.city,
		t2.district,
		t2.address_more,
		t2.has_children,
		t2.children_name,
		t2.children_address,
		t2.children_telephone,
		t2.has_married,
		t2.has_house,
		t2.current_address_province,
		t2.current_address_city,
		t2.current_address_district,
		t2.current_address_more,
		t2.post_code,
		t2.fixed_telephone,
		t2.mobile_telephone1,
		t2.service_password1,
		t2.mobile_telephone2,
		t2.service_password2,
		t2.personal_year_income,
		t2.customer_email,
		t2.credit_card_limit,
		t2.common_occupants,
		t2.status,
		t2.create_user_id,
		t2.create_user_name,
		date_format(t2.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t2.last_update_user_id,
		date_format(t2.last_update_timestamp,'%Y-%m-%d
		%H:%i:%s') as last_update_timestamp,
		t2.enable_flag,
		t1.is_review_back,
		t1.water_appro_result_page,
		t1.info_appro_result_page,
		t1.phone_appro_result_page,
		t1.certificate_appro_result_page,
		t1.house_appro_result_page,
		t1.salesman_shortcode,
		t1.create_user_city_code,
		CONCAT(t1.salesman_name,"/",t1.salesman_shortcode) as salesman_name_str,
		t1.documentary_opinion
		from wms_cre_credit_head t1,wms_cre_credit_line_customer_change_head t2
		<where>
			t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id and
			t2.is_major='1' and t1.cre_type='2'
			<if test="id_card != null">
				and t2.id_card = #{id_card}
			</if>
			<if test="idList !=null">
				and t1.wms_cre_credit_head_id in
				<foreach collection="idList" item="wms_cre_credit_head_id" index="index" open="(" separator="," close=")">
					#{wms_cre_credit_head_id}
				</foreach>
			</if>
			and t1.enable_flag='1'
			<if test="bill_code != null">
				and t1.bill_code like '${bill_code}'
			</if>
			<if test="customer_name != null">
				and t2.customer_name like '${customer_name}'
			</if>
			<if test="create_user_id != null">
				and t1.create_user_id != #{create_user_id}
			</if>
			<if test="mobile_telephone != null">
				and (t2.mobile_telephone1 like '${mobile_telephone}' or
				t2.mobile_telephone2 like '${mobile_telephone}')
			</if>
		</where>
		<if test="sortname != null and sortorder !=null">
			ORDER BY ${sortname} ${sortorder}
		</if>
		<if test="offset != null and pagesize !=null">
			LIMIT ${offset} , ${pagesize}
		</if>

	</select>
	<!--流水、信息、电审 征信 验点数据导出 -->
	<select id="getTeamListWithoutPaging" parameterType="map" resultType="java.util.HashMap">
		select
		t1.wms_cre_credit_head_id,
		t1.bill_code,
		t1.credit_purpose,
		t1.max_repayment_limit_per_month,
		t1.credit_limit,
		t1.max_repayment_time_limit,
		t1.enter_file_way,
		t1.payroll_payment_way,
		t1.data_type,
		t1.is_complete,
		t1.reference_type,
		t1.is_other_corporation_done,
		t1.is_to_public_stream,
		t1.is_house_certificate_original,
		t1.is_check,
		t1.person_condition,
		t1.salesman_id,
		t1.salesman_code,
		t1.salesman_name,
		t1.city,
		t1.cre_type,
		t1.bill_status,
		t1.bill_type,
		(select value_meaning from wms_sys_dict_data where
		value_code = bill_status
		and wms_sys_dict_id = 24)as bill_status_name,
		t1.water_appro_user_id,
		t1.water_appro_user_name,
		date_format(t1.water_appro_timestamp,'%Y-%m-%d %H:%i:%s') as water_appro_timestamp,
		t1.water_appro_result,
		(case t1.water_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略' else
		'待审批' end)as water_appro_result_name,
		t1.info_appro_user_id,
		t1.info_appro_user_name,
		date_format(t1.info_appro_timestamp,'%Y-%m-%d %H:%i:%s') as info_appro_timestamp,
		t1.info_appro_result,
		(case t1.info_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略' else
		'待审批' end)as info_appro_result_name,
		t1.phone_appro_user_id,
		t1.phone_appro_user_name,
		date_format(t1.phone_appro_timestamp,'%Y-%m-%d %H:%i:%s')as phone_appro_timestamp,
		t1.phone_appro_result,
		(case t1.phone_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略' else
		'待审批' end)as phone_appro_result_name,
		t1.certificate_appro_user_id,
		t1.certificate_appro_user_name,
		date_format(t1.certificate_appro_timestamp,'%Y-%m-%d %H:%i:%s') as certificate_appro_timestamp,
		t1.certificate_appro_result,
		(case t1.certificate_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略'
		else '待审批' end)as certificate_appro_result_name,
		t1.create_user_id,
		t1.create_user_name,
		date_format(t1.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t1.last_update_user_id,
		date_format(t1.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
		t1.enable_flag,
		t1.cre_loan_type,
		t1.loan_interest_rate,
		t2.wms_cre_credit_line_customer_change_head_id,
		t2.wms_cre_credit_head_id,
		t2.wms_cus_customer_head_id,
		t2.customer_code,
		t2.customer_name,
		t2.customer_ever_name,
		t2.customer_category,
		t2.gender,
		t2.max_degree,
		date_format(t2.birthday,'%Y-%m-%d') as birthday,
		t2.id_card,
		t2.province,
		t2.city,
		t2.district,
		t2.address_more,
		t2.has_children,
		t2.children_name,
		t2.children_address,
		t2.children_telephone,
		t2.has_married,
		t2.has_house,
		t2.current_address_province,
		t2.current_address_city,
		t2.current_address_district,
		t2.current_address_more,
		t2.post_code,
		t2.fixed_telephone,
		t2.mobile_telephone1,
		t2.service_password1,
		t2.mobile_telephone2,
		t2.service_password2,
		t2.personal_year_income,
		t2.customer_email,
		t2.credit_card_limit,
		t2.common_occupants,
		t2.status,
		t2.create_user_id,
		t2.create_user_name,
		date_format(t2.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t2.last_update_user_id,
		date_format(t2.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as
		last_update_timestamp,
		t2.enable_flag,
		t1.salesman_shortcode,
		CONCAT(t1.salesman_name,"/",t1.salesman_shortcode) as salesman_name_str,
		t1.documentary_opinion
		from wms_cre_credit_head t1,wms_cre_credit_line_customer_change_head t2
		<where>
			t1.wms_cre_credit_head_id = t2.wms_cre_credit_head_id and
			t2.is_major='1'
			<if test="create_user_city_code !=null">
				and t1.create_user_city_code =#{create_user_city_code}
			</if>
			<if test="idList !=null">
				and t1.wms_cre_credit_head_id in
				<foreach collection="idList" item="wms_cre_credit_head_id" index="index" open="(" separator="," close=")">
					#{wms_cre_credit_head_id}
				</foreach>
			</if>
			<if test="id_card != null">
				and t2.id_card = #{id_card}
			</if>
			and t1.enable_flag=1
			<if test="bill_code != null">
				and t1.bill_code like '${bill_code}'
			</if>
			<if test="customer_name != null">
				and t2.customer_name like '${customer_name}'
			</if>
			<if test="mobile_telephone != null">
				and (t2.mobile_telephone1 like '${mobile_telephone}' or
				t2.mobile_telephone2 like '${mobile_telephone}')
			</if>
			<if test="create_user_id != null">
				and t1.create_user_id != #{create_user_id}
			</if>
			<if test="salesman_name != null or salesman_shortcode !=null">
				and (t1.salesman_name like '${salesman_name}' or
				t1.salesman_shortcode like '${salesman_shortcode}')
			</if>
			<if test="create_timestamp != null and create_timestamp1!=null">
				and t1.create_timestamp between #{create_timestamp} and
				#{create_timestamp1}
			</if>
			<!-- 验点需要根据配置来判断 -->
			<if test="childrendept !=null">
				and (FIND_IN_SET(t1.salesman_dept_id,#{childrendept})>0)
			</if>
		</where>
		<if test="sortname != null and sortorder !=null">
			ORDER BY ${sortname} ${sortorder}
		</if>
	</select>
	<!--流水、信息、电审 征信数据导出 -->
	<select id="getTeamListWithoutPagingForFd" parameterType="map" resultType="java.util.HashMap">
		select
		t1.wms_cre_credit_head_id,
		t1.bill_code,
		t1.credit_purpose,
		t1.max_repayment_limit_per_month,
		t1.credit_limit,
		t1.max_repayment_time_limit,
		t1.enter_file_way,
		t1.payroll_payment_way,
		t1.data_type,
		t1.is_complete,
		t1.reference_type,
		t1.is_other_corporation_done,
		t1.is_to_public_stream,
		t1.is_house_certificate_original,
		t1.is_check,
		t1.person_condition,
		t1.salesman_id,
		t1.salesman_code,
		t1.salesman_name,
		t1.city,
		t1.cre_type,
		t1.bill_type,
		t1.bill_status,
		(select value_meaning from wms_sys_dict_data where
		value_code = bill_status
		and wms_sys_dict_id = 24)as bill_status_name,
		t1.water_appro_user_id,
		t1.water_appro_user_name,
		date_format(t1.water_appro_timestamp,'%Y-%m-%d %H:%i:%s') as water_appro_timestamp,
		t1.water_appro_result,
		(case t1.water_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略' else
		'待审批' end)as water_appro_result_name,
		t1.info_appro_user_id,
		t1.info_appro_user_name,
		date_format(t1.info_appro_timestamp,'%Y-%m-%d %H:%i:%s') as info_appro_timestamp,
		t1.info_appro_result,
		(case t1.info_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略' else
		'待审批' end)as info_appro_result_name,
		t1.phone_appro_user_id,
		t1.phone_appro_user_name,
		date_format(t1.phone_appro_timestamp,'%Y-%m-%d %H:%i:%s')as phone_appro_timestamp,
		t1.phone_appro_result,
		(case t1.phone_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略' else
		'待审批' end)as phone_appro_result_name,
		t1.certificate_appro_user_id,
		t1.certificate_appro_user_name,
		date_format(t1.certificate_appro_timestamp,'%Y-%m-%d %H:%i:%s') as certificate_appro_timestamp,
		t1.certificate_appro_result,
		(case t1.certificate_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略'
		else '待审批' end)as certificate_appro_result_name,
		t1.create_user_id,
		t1.create_user_name,
		date_format(t1.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t1.last_update_user_id,
		date_format(t1.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
		t1.enable_flag,
		t1.cre_loan_type,
		t1.loan_interest_rate,
		t2.wms_cre_credit_line_customer_change_head_id,
		t2.wms_cre_credit_head_id,
		t2.wms_cus_customer_head_id,
		t2.customer_code,
		t2.customer_name,
		t2.customer_ever_name,
		t2.customer_category,
		t2.gender,
		t2.max_degree,
		date_format(t2.birthday,'%Y-%m-%d') as birthday,
		t2.id_card,
		t2.province,
		t2.city,
		t2.district,
		t2.address_more,
		t2.has_children,
		t2.children_name,
		t2.children_address,
		t2.children_telephone,
		t2.has_married,
		t2.has_house,
		t2.current_address_province,
		t2.current_address_city,
		t2.current_address_district,
		t2.current_address_more,
		t2.post_code,
		t2.fixed_telephone,
		t2.mobile_telephone1,
		t2.service_password1,
		t2.mobile_telephone2,
		t2.service_password2,
		t2.personal_year_income,
		t2.customer_email,
		t2.credit_card_limit,
		t2.common_occupants,
		t2.status,
		t2.create_user_id,
		t2.create_user_name,
		date_format(t2.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t2.last_update_user_id,
		date_format(t2.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as
		last_update_timestamp,
		t2.enable_flag,
		t1.salesman_shortcode,
		t1.create_user_city_code,
		CONCAT(t1.salesman_name,"/",t1.salesman_shortcode) as salesman_name_str,
		t1.documentary_opinion
		from wms_cre_credit_head t1,wms_cre_credit_line_customer_change_head t2
		<where>
			t1.wms_cre_credit_head_id = t2.wms_cre_credit_head_id and
			t2.is_major='1'and t1.cre_type='2'
			<if test="bill_code != null">
				and t1.bill_code like '${bill_code}'
			</if>
			<if test="idList !=null">
				and t1.wms_cre_credit_head_id in
				<foreach collection="idList" item="wms_cre_credit_head_id" index="index" open="(" separator="," close=")">
					#{wms_cre_credit_head_id}
				</foreach>
			</if>
			<if test="customer_name != null">
				and t2.customer_name like '${customer_name}'
			</if>
			<if test="create_user_id != null">
				and t1.create_user_id != #{create_user_id}
			</if>
			<if test="id_card != null">
				and t2.id_card = #{id_card}
			</if>
			<if test="mobile_telephone != null">
				and (t2.mobile_telephone1 like '${mobile_telephone}' or
				t2.mobile_telephone2 like '${mobile_telephone}')
			</if>
		</where>
		<if test="sortname != null and sortorder !=null">
			ORDER BY ${sortname} ${sortorder}
		</if>
	</select>
	<!-- 获取WmsCreCreditHead -->
	<select id="get" parameterType="Integer" resultType="WmsCreCreditHead">
		select *
		from wms_cre_credit_head
		where
		wms_cre_credit_head_id=#{wms_cre_credit_head_id}
		and enable_flag=1
	</select>


	<!-- 获取WmsCreCreditHead -->
	<select id="getApproLimitGroup" parameterType="Integer" resultType="java.util.HashMap">
		select
		t1.*,
		t2.appro_limit_group
		from wms_cre_credit_head as t1 left join wms_cre_credit_group as t2
		on t1.wms_cre_credit_group_id = t2.wms_cre_credit_group_id and t2.enable_flag=1
		where
		wms_cre_credit_head_id=#{wms_cre_credit_head_id}
		and t1.enable_flag=1
	</select>

	<select id="getInfo" parameterType="map" resultType="WmsCreCreditHead">
		select
		t1.wms_cre_credit_head_id,
		t1.bill_code,
		t1.credit_purpose,
		t1.max_repayment_limit_per_month,
		t1.credit_limit,
		t1.max_repayment_time_limit,
		t1.enter_file_way,
		t1.payroll_payment_way,
		t1.data_type,
		t1.is_complete,
		t1.reference_type,
		t1.is_other_corporation_done,
		t1.is_to_public_stream,
		t1.is_house_certificate_original,
		t1.is_check,
		t1.person_condition,
		t1.salesman_id,
		t1.salesman_code,
		t1.salesman_city_code,
		t1.salesman_name,
		t1.salesman_dept_id,
		t1.city,
		t1.cre_type,
		t1.bill_type,
		t1.bill_status,
		(select
		value_meaning from wms_sys_dict_data where value_code = bill_status
		and wms_sys_dict_id = 24)as bill_status_name,
		t1.water_appro_user_id,
		t1.water_appro_user_name,
		date_format(t1.water_appro_timestamp,'%Y-%m-%d %H:%i:%s') as water_appro_timestamp,
		t1.water_appro_result,
		t1.info_appro_user_id,
		t1.info_appro_user_name,
		date_format(t1.info_appro_timestamp,'%Y-%m-%d %H:%i:%s') as info_appro_timestamp,
		t1.info_appro_result,
		t1.phone_appro_user_id,
		t1.phone_appro_user_name,
		date_format(t1.phone_appro_timestamp,'%Y-%m-%d %H:%i:%s')as phone_appro_timestamp,
		t1.phone_appro_result,
		t1.certificate_appro_user_id,
		t1.certificate_appro_user_name,
		date_format(t1.certificate_appro_timestamp,'%Y-%m-%d %H:%i:%s') as certificate_appro_timestamp,
		t1.certificate_appro_result,
		t1.create_user_id,
		t1.create_user_name,
		date_format(t1.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t1.last_update_user_id,
		date_format(t1.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as
		last_update_timestamp,
		<!-- 根据时间来判断新老流程 因返回的是类 没办法添加新字段 所以借用enable_flag -->
		(case when t1.create_timestamp &lt; #{hprocess_time} then '1' else '2' end) as enable_flag,
		t1.is_link_repeat,
		t1.profession_type,
		t1.is_verify,
		t1.house_appro_result,
		t1.cre_loan_type,
		t1.loan_interest_rate,
		t1.water_appro_advice,
		t1.info_appro_advice,
		t1.phone_appro_advice,
		t1.certificate_appro_advice,
		t1.house_appro_advice,
		t1.water_appro_eval,
		t1.phone_appro_eval,
		t1.water_appro_result_page,
		t1.info_appro_result_page,
		t1.phone_appro_result_page,
		t1.certificate_appro_result_page,
		t1.house_appro_result_page,
		t1.inspection_appro_user_id,
		t1.inspection_appro_user_name,
		t1.inspection_appro_timestamp,
		t1.inspection_appro_result,
		t1.inspection_appro_advice,
		t1.inspection_appro_result_page,
		t1.salesman_shortcode,
		CONCAT(t1.salesman_name,"/",t1.salesman_shortcode) as salesman_name_str,
		t1.is_cycles,
		t1.lending_rates_execution_cycles,
		t1.trial_interview_uid,
		t1.trial_interview_uname,
		t1.trial_interview_timestamp,
		t1.trial_interview_result,
		t1.trial_interview_advice,
		t1.documentary_opinion,
		t1.is_xudai,
		t1.commission_rate,
		t1.commission_fee,
		t1.is_vehicle,
		t1.assessment_id,
		t1.assessment_datetime,
		t1.assessment_result,
		t1.assessment_advice,
		t1.assessment_result_page,
		t1.version_number,
		t1.is_workflow,
		t1.wms_cre_credit_group_id
		from wms_cre_credit_head t1
		<where>
			enable_flag=1
			<if test="wms_cre_credit_head_id !=null">
				and t1.wms_cre_credit_head_id = #{wms_cre_credit_head_id}
			</if>
			<if test="bill_code !=null">
				and t1.bill_code like #{bill_code}
			</if>
			<if test="salesman_name !=null or salesman_shortcode !=null">
				and (t1.salesman_name like #{salesman_name} or t1.salesman_shortcode
				like '${salesman_shortcode}')
			</if>
			<if test="create_timestamp !=null">
				and create_timestamp like #{create_timestamp}
			</if>
			<if test="id_card !=null">
				and exists (select 1 from wms_cre_credit_line_customer_change_head t2
				where t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id and
				t2.id_card =#{id_card} )
			</if>
		</where>
		<if test="sortname != null and sortorder !=null">
			ORDER BY ${sortname} ${sortorder}
		</if>
	</select>

	<select id="getFinalAuditAmount" parameterType="map" resultType="java.util.HashMap">
		SELECT b.customer_name,
		a.house_address_more,
		a.house_building_area,
		d.appro_limit,
		d.last_update_timestamp,
		a.wms_cre_customer_change_line_houseinfo_id,
		a.wms_cre_credit_line_customer_change_head_id,
		c.wms_cre_credit_head_id
		FROM wms_cre_customer_change_line_houseinfo a
		LEFT JOIN wms_cre_credit_line_customer_change_head b ON a.wms_cre_credit_line_customer_change_head_id = b.wms_cre_credit_line_customer_change_head_id
		LEFT JOIN wms_cre_housing_customer_house c ON
		a.wms_cre_customer_change_line_houseinfo_id = c.wms_cre_customer_change_line_houseinfo_id
		RIGHT OUTER JOIN wms_cre_credit_head d ON c.wms_cre_credit_head_id = d.wms_cre_credit_head_id
		<where>
			b.is_major = 1
			AND appro_limit IS NOT NULL
			AND customer_name=#{customer_name}
			AND house_address_more=#{house_address}
			AND house_building_area=#{house_building_area}
			ORDER BY last_update_timestamp DESC
		</where>
	</select>

	<!-- 实现数据导出功能 -->
	<select id="getListWithoutPaging" parameterType="map" resultType="java.util.HashMap">
		select
		t1.wms_cre_credit_head_id,
		t1.bill_code,
		t1.credit_purpose,
		t1.max_repayment_limit_per_month,
		(case t1.cre_type when '3' then (CAST(t1.credit_limit*0.0001 AS DECIMAL(8,4) )) else t1.credit_limit end) as credit_limit,
		t1.max_repayment_time_limit,
		t1.enter_file_way,
		t1.payroll_payment_way,
		t1.data_type,
		t1.is_complete,
		t1.reference_type,
		t1.is_other_corporation_done,
		t1.is_to_public_stream,
		t1.is_house_certificate_original,
		t1.is_check,
		t1.person_condition,
		t1.salesman_id,
		t1.salesman_code,
		t1.salesman_name,
		t1.city,
		t1.cre_type,
		(case t1.cre_type when '1' then '信贷产品' when '2' then '房贷产品' end) as
		cre_type_name,
		(select value_meaning from wms_sys_dict_data where wms_sys_dict_data_id = t1.cre_loan_type
		and wms_sys_dict_id = 27) as cre_loan_type_name,
		t1.bill_status,
		(case t1.cre_type when '1' then ((select value_meaning from wms_sys_dict_data where value_code = bill_status
		and wms_sys_dict_id =24)) when '2' then ((select value_meaning from wms_sys_dict_data where value_code = bill_status
		and wms_sys_dict_id =131)) when '3' then ((select value_meaning from wms_sys_dict_data where value_code = bill_status
		and wms_sys_dict_id =24)) end)as bill_status_name,
		t1.water_appro_user_id,
		t1.water_appro_user_name,
		date_format(t1.water_appro_timestamp,'%Y-%m-%d %H:%i:%s') as water_appro_timestamp,
		t1.water_appro_result,
		t1.info_appro_user_id,
		t1.info_appro_user_name,
		date_format(t1.info_appro_timestamp,'%Y-%m-%d %H:%i:%s') as info_appro_timestamp,
		t1.info_appro_result,
		t1.phone_appro_user_id,
		t1.phone_appro_user_name,
		date_format(t1.phone_appro_timestamp,'%Y-%m-%d %H:%i:%s')as phone_appro_timestamp,
		t1.phone_appro_result,
		t1.certificate_appro_user_id,
		t1.certificate_appro_user_name,
		date_format(t1.certificate_appro_timestamp,'%Y-%m-%d %H:%i:%s') as certificate_appro_timestamp,
		t1.certificate_appro_result,
		t1.create_user_id,
		t1.create_user_name,
		date_format(t1.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t1.last_update_user_id,
		date_format(t1.last_update_timestamp,'%Y-%m-%d
		%H:%i:%s') as last_update_timestamp,
		t1.enable_flag,
		t1.is_link_repeat,
		t1.profession_type,
		t1.is_verify,
		t1.cre_loan_type,
		t1.loan_interest_rate,
		t2.wms_cre_credit_line_customer_change_head_id,
		t2.wms_cre_credit_head_id,
		t2.wms_cus_customer_head_id,
		t2.customer_code,
		t2.customer_name,
		t2.customer_ever_name,
		t2.customer_category,
		t2.gender,
		t2.max_degree,
		date_format(t2.birthday,'%Y-%m-%d') as birthday,
		t2.id_card,
		t2.province,
		t2.city,
		t2.district,
		t2.address_more,
		t2.has_children,
		t2.children_name,
		t2.children_address,
		t2.children_telephone,
		t2.has_married,
		t2.has_house,
		t2.current_address_province,
		t2.current_address_city,
		t2.current_address_district,
		t2.current_address_more,
		t2.post_code,
		t2.fixed_telephone,
		t2.mobile_telephone1,
		t2.service_password1,
		t2.mobile_telephone2,
		t2.service_password2,
		t2.personal_year_income,
		t2.customer_email,
		t2.credit_card_limit,
		t2.common_occupants,
		t2.status,
		t2.create_user_id,
		t2.create_user_name,
		date_format(t2.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t2.last_update_user_id,
		date_format(t2.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
		t2.enable_flag,
		t1.salesman_shortcode,
		CONCAT(t1.salesman_name,"/",t1.salesman_shortcode) as salesman_name_str,
		(
		<include refid="deptCity" />
		) as dept_city,
		(
		<include refid="deptName" />
		) as dept_name,
		t1.documentary_opinion,
		(case cre_type when 1 then 100 when 2 then t1.mort_flag when 3 then 101 end) as mort_flag ,
		(SELECT  value_meaning from wms_sys_dict_data  where wms_sys_dict_id=146 AND value_code=(case cre_type when 1 then 100 when 2 then t1.mort_flag when 3 then 101 end)) as mort_flag_name,	
		(select ifnull(a.bill_code_group, '') from wms_cre_credit_group a where t1.wms_cre_credit_group_id = a.wms_cre_credit_group_id) as bill_code_group
		from wms_cre_credit_head t1,wms_cre_credit_line_customer_change_head t2
		<where>
			t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id and
			t2.is_major='1'
			AND (case t1.cre_type when '2' then t1.version_number = 3 else 1 = 1 end)
			<!--<if test="create_user_city_code !=null"> and t1.create_user_city_code =#{create_user_city_code} </if> -->
			<!-- 权限控制 -->
			<if test="childrendept != null">
				and ((FIND_IN_SET(t1.salesman_dept_id, #{childrendept}) > 0) or t1.create_user_city_code =#{create_user_city_code})
			</if>
			<if test="customer_name !=null">
				and t2.customer_name like #{customer_name}
			</if>
			<if test="id_card != null">
				and t2.id_card =#{id_card}
			</if>
			<if test="idList !=null">
				and t1.wms_cre_credit_head_id in
				<foreach collection="idList" item="wms_cre_credit_head_id" index="index" open="(" separator="," close=")">
					#{wms_cre_credit_head_id}
				</foreach>
			</if>
			and t1.enable_flag=1
			<if test="bill_code != null">
				and (t1.bill_code like #{bill_code} or (select ifnull(bill_code_group, '') from wms_cre_credit_group where t1.wms_cre_credit_group_id = wms_cre_credit_group_id) like #{bill_code})
			</if>
			<if test="salesman_name != null or salesman_shortcode !=null">
				and (t1.salesman_name like '${salesman_name}' or
				t1.salesman_shortcode like '${salesman_shortcode}')
			</if>
			<if test="create_timestamp!=null and create_timestamp1!=null">
				and t1.create_timestamp between #{create_timestamp} and
				#{create_timestamp1}
			</if>
			<if test="create_user_id != null">
				and t1.create_user_id != #{create_user_id}
			</if>
			<if test="cre_type !=null">
				and t1.cre_type = #{cre_type}
			</if>
			<if test="city !=null">
				and t1.city like #{city}
			</if>
			<if test="bill_status !=null">
				and t1.bill_status =#{bill_status}
			</if>
			<if test="dept_city_sel !=null">
				and t1.salesman_city_code in (select value_meaning from wms_sys_dict_data where value_code=#{dept_city_sel} and wms_sys_dict_id=71)
			</if>
			<if test="dept_name_sel !=null">
				and t1.salesman_dept_id in (select dept_id from sys_dept where dept_pid = #{dept_name_sel})
			</if>
			<if test="mort_flag != null">
				and (case cre_type when 1 then 100 when 2 then t1.mort_flag when 3 then 101 end)  = #{mort_flag}
			</if>
		</where>
		<if test="sortname != null and sortorder !=null">
			ORDER BY ${sortname} ${sortorder}
		</if>
	</select>
	<!-- 审批查询数据导出 -->
	<select id="getCreditCheckListWithoutPaging" parameterType="map" resultType="java.util.HashMap">
		select
		t1.wms_cre_credit_head_id,
		t1.bill_code,
		t1.credit_purpose,
		t1.max_repayment_limit_per_month,
		(case t1.cre_type when '3' then (CAST(t1.credit_limit*0.0001 AS DECIMAL(8,4) )) else t1.credit_limit end) as credit_limit,
		t1.max_repayment_time_limit,
		t1.enter_file_way,
		t1.payroll_payment_way,
		t1.data_type,
		t1.is_complete,
		t1.reference_type,
		t1.is_other_corporation_done,
		t1.is_to_public_stream,
		t1.is_house_certificate_original,
		t1.is_check,
		t1.person_condition,
		t1.salesman_id,
		t1.salesman_code,
		t1.salesman_name,
		t1.city as salesman_city,
		t1.bill_status,
		t1.bill_type,
		t1.cre_type,
		(case when t1.cre_type='3' then '' when t1.water_appro_result ='0' then '未通过' when t1.water_appro_result ='1' then '通过' when t1.water_appro_result ='3' then '已忽略' else
		'待审批' end)as water_appro_result_name,
		(case when t1.cre_type='3' then '' when t1.info_appro_result='0' then '未通过' when t1.info_appro_result='1' then '通过' when t1.info_appro_result='3' then '已忽略' else
		'待审批' end) as info_appro_result_name,
		(case when
		t1.cre_type='3' then ''when t1.phone_appro_result='0' then '未通过' when t1.phone_appro_result='1' then '通过' when t1.phone_appro_result='3' then '已忽略' else
		(case (SELECT credit_confirm_result from wms_cre_housing_credit_confirm where wms_cre_credit_head_id=t1.wms_cre_credit_head_id and enable_flag=1) when '0' then "待审批" WHEN t1.version_number='2' then "----" else "待审批" end) end)as phone_appro_result_name,
		(case when t1.cre_type='3' then '' when t1.certificate_appro_result='0' then '未通过' when
		t1.certificate_appro_result='1' then '通过' when t1.certificate_appro_result='3' then '已忽略' else
		(case (SELECT credit_confirm_result from wms_cre_housing_credit_confirm where wms_cre_credit_head_id=t1.wms_cre_credit_head_id and enable_flag=1) when '0' then "待审批" WHEN t1.version_number='2' then "----" else "待审批" end) end)as certificate_appro_result_name,
		(case
		when t1.house_appro_result='0' then '未通过'
		when t1.house_appro_result='1' then '通过'
		when t1.cre_type='2' and ISNULL(t1.house_appro_result) then '待审批'
		when t1.cre_type='3' and ISNULL(t1.house_appro_result) then '待审批' END) as
		house_appro_result_name,
		(case
		when t1.trial_interview_result=1 and
		t1.cre_loan_type=283 and t1.inspection_appro_result='0' then '未通过'
		when t1.trial_interview_result=1 and
		t1.cre_loan_type=283 and t1.inspection_appro_result='1' then '通过'
		when t1.trial_interview_result=1 and
		t1.cre_loan_type=283 and ISNULL(t1.inspection_appro_result) then '待审批'
		when t1.trial_interview_result=1 and t1.cre_loan_type=113 and
		t1.inspection_appro_result='0' then '未通过'
		when t1.trial_interview_result=1 and t1.cre_loan_type=113
		and
		t1.inspection_appro_result='1' then '通过'
		when t1.trial_interview_result=1 and t1.cre_loan_type=113 and
		ISNULL(t1.inspection_appro_result) then '待审批'
		END) as inspection_appro_result_name,

		(case when t1.assessment_result ='0' and t1.cre_type='3' then '未通过' when t1.assessment_result ='1' and t1.cre_type='3' then '通过' when t1.assessment_result ='3' and t1.cre_type='3' then '已忽略'
		when t1.cre_type='3' then '待审批' end)as assessment_result_name,

		(case t1.cre_type when '1' then '信贷产品' when '2' then '房贷产品' when '3' then '车贷产品' end)as
		cre_type_name,
		(select value_meaning from wms_sys_dict_data where value_code = bill_status
		and wms_sys_dict_id = 24)as bill_status_name,
		t1.create_user_id,
		t1.create_user_name,
		date_format(t1.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t1.last_update_user_id,
		date_format(t1.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
		t1.enable_flag,
		t2.wms_cre_credit_line_customer_change_head_id,
		t2.wms_cre_credit_head_id,
		t2.wms_cus_customer_head_id,
		t2.customer_code,
		t2.customer_name,
		t2.customer_ever_name,
		t2.customer_category,
		t2.gender,
		t2.max_degree,
		date_format(t2.birthday,'%Y-%m-%d') as birthday,
		t2.id_card,
		t2.province,
		t2.city as costomer_city,
		t2.district,
		t2.address_more,
		t2.has_children,
		t2.children_name,
		t2.children_address,
		t2.children_telephone,
		t2.has_married,
		t2.has_house,
		t2.current_address_province,
		t2.current_address_city,
		t2.current_address_district,
		t2.current_address_more,
		t2.post_code,
		t2.fixed_telephone,
		t2.mobile_telephone1,
		t2.service_password1,
		t2.mobile_telephone2,
		t2.service_password2,
		t2.personal_year_income,
		t2.customer_email,
		t2.credit_card_limit,
		t2.common_occupants,
		t2.status,
		t2.create_user_id,
		t2.create_user_name,
		date_format(t2.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t2.last_update_user_id,
		date_format(t2.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
		t2.enable_flag,
		t1.salesman_shortcode,
		CONCAT(t1.salesman_name,"/",t1.salesman_shortcode) as salesman_name_str,
		t1.trial_interview_uid,
		t1.trial_interview_uname,
		t1.trial_interview_timestamp,
		t1.trial_interview_result,
		t1.trial_interview_advice,
		(
		<include refid="deptCity" />
		) as dept_city,
		(
		<include refid="deptName" />
		) as dept_name,
		t1.documentary_opinion,
		(select ifnull(a.bill_code_group, '') from wms_cre_credit_group a where t1.wms_cre_credit_group_id = a.wms_cre_credit_group_id) as bill_code_group
		from
		wms_cre_credit_head t1,wms_cre_credit_line_customer_change_head t2
		<where>
			t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id and
			t1.enable_flag=1 and t2.is_major='1'
			<if test="bill_code!=null">
				and t1.bill_code like #{bill_code}
			</if>
			<if test="customer_name !=null">
				and t2.customer_name like #{customer_name}
			</if>
			<if test="salesman_name!=null or salesman_shortcode !=null">
				and (t1.salesman_name like #{salesman_name} or
				t1.salesman_shortcode like '${salesman_shortcode}')
			</if>
			<if test="create_timestamp!=null and create_timestamp1!=null">
				and t1.create_timestamp between #{create_timestamp} and
				#{create_timestamp1}
			</if>
			<if test="id_card!=null">
				and t2.id_card =#{id_card}
			</if>
			<if test="cre_type!=null">
				and t1.cre_type =#{cre_type}
			</if>
			<if test="city !=null">
				and t1.city like #{city}
			</if>
			<if test="bill_status !=null">
				and t1.bill_status =#{bill_status}
			</if>
			<if test="dept_city_sel !=null">
				and t1.salesman_city_code in (select value_meaning from wms_sys_dict_data where value_code=#{dept_city_sel} and wms_sys_dict_id=71)
			</if>
			<if test="dept_name_sel !=null">
				and t1.salesman_dept_id in (select dept_id from sys_dept where dept_pid = #{dept_name_sel})
			</if>
		</where>
		<if test="sortname!=null and sortorder!=null">
			order by ${sortname} ${sortorder}
		</if>
	</select>
	<!-- 审批查询带分页列表 -->
	<select id="getCreditCheckListWithPaging" parameterType="map" resultType="java.util.HashMap">
		select
		t1.wms_cre_credit_head_id,
		t1.bill_code,
		t1.credit_purpose,
		t1.max_repayment_limit_per_month,
		<!--t1.credit_limit, -->
		(case t1.cre_type when '3' then (CAST(t1.credit_limit*0.0001 AS DECIMAL(8,4) )) else t1.credit_limit end) as credit_limit,
		t1.max_repayment_time_limit,
		t1.enter_file_way,
		t1.payroll_payment_way,
		t1.data_type,
		t1.is_complete,
		t1.reference_type,
		t1.is_other_corporation_done,
		t1.is_to_public_stream,
		t1.is_house_certificate_original,
		t1.is_check,
		t1.person_condition,
		t1.salesman_id,
		t1.salesman_code,
		t1.salesman_name,
		t1.city as salesman_city,
		t1.bill_status,
		t1.cre_type,
		t1.water_appro_result_page,
		t1.info_appro_result_page,
		t1.phone_appro_result_page,
		t1.certificate_appro_result_page,
		t1.house_appro_result_page,
		t1.inspection_appro_result_page,
		t1.assessment_result,
		t1.assessment_result_page,
		t1.cre_loan_type,
		(case t1.cre_type when '1' then '信贷产品' when '2' then '房贷产品' when '3' then '车贷产品' end)as
		cre_type_name,
		(select value_meaning from wms_sys_dict_data where value_code = bill_status
		and wms_sys_dict_id = 131)as bill_status_name,
		t1.create_user_id,
		t1.create_user_name,
		date_format(t1.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t1.last_update_user_id,
		date_format(t1.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
		t1.enable_flag,
		t2.wms_cre_credit_line_customer_change_head_id,
		t2.wms_cre_credit_head_id,
		t2.wms_cus_customer_head_id,
		t2.customer_code,
		t2.customer_name,
		t2.customer_ever_name,
		t2.customer_category,
		t2.gender,
		t2.max_degree,
		date_format(t2.birthday,'%Y-%m-%d') as birthday,
		t2.id_card,
		t2.province,
		t2.city as customer_city,
		t2.district,
		t2.address_more,
		t2.has_children,
		t2.children_name,
		t2.children_address,
		t2.children_telephone,
		t2.has_married,
		t2.has_house,
		t2.current_address_province,
		t2.current_address_city,
		t2.current_address_district,
		t2.current_address_more,
		t2.post_code,
		t2.fixed_telephone,
		t2.mobile_telephone1,
		t2.service_password1,
		t2.mobile_telephone2,
		t2.service_password2,
		t2.personal_year_income,
		t2.customer_email,
		t2.credit_card_limit,
		t2.common_occupants,
		t2.status,
		t2.create_user_id,
		t2.create_user_name,
		date_format(t2.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t2.last_update_user_id,
		date_format(t2.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
		t2.enable_flag,
		t1.salesman_shortcode,
		CONCAT(t1.salesman_name,"/",t1.salesman_shortcode) as salesman_name_str,
		t1.trial_interview_uid,
		t1.trial_interview_uname,
		t1.trial_interview_timestamp,
		t1.trial_interview_result,
		t1.trial_interview_advice,
		<!--房贷流程版本号 1为老流程 2为新流程 -->
		(case when t1.create_timestamp &lt; #{hprocess_time} then '1' else '2' end) as edition_num,
		(
		<include refid="deptCity" />
		) as dept_city,
		(
		<include refid="deptName" />
		) as dept_name,
		t1.documentary_opinion,
		t1.version_number,
		ifnull(t3.bill_code_group, '') as bill_code_group,
		t4.credit_confirm_result
		from wms_cre_credit_head t1 left join
		wms_cre_credit_line_customer_change_head t2
		on
		t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id and t2.is_major='1'
		left join wms_cre_credit_group t3
		on t1.wms_cre_credit_group_id = t3.wms_cre_credit_group_id
		left join wms_cre_housing_credit_confirm t4
		on t1.wms_cre_credit_head_id = t4.wms_cre_credit_head_id and t4.enable_flag=1
		<where>
			t1.enable_flag=1
			<if test="id_card!=null">
				and t2.id_card =#{id_card}
			</if>
			<if test="customer_name !=null">
				and t2.customer_name like #{customer_name}
			</if>
			<if test="bill_code!=null">
				and bill_code like '${bill_code}'
			</if>
			<if test="salesman_name!=null or salesman_shortcode !=null">
				and (t1.salesman_name like #{salesman_name} or
				t1.salesman_shortcode like '${salesman_shortcode}')
			</if>
			<if test="create_timestamp!=null and create_timestamp1!=null">
				and t1.create_timestamp between #{create_timestamp} and
				#{create_timestamp1}
			</if>
			<if test="create_user_id != null">
				and t1.create_user_id != #{create_user_id}
			</if>
			<if test="cre_type!=null">
				and t1.cre_type like#{cre_type}
			</if>
			<if test="city !=null">
				and t1.city like#{city}
			</if>
			<if test="bill_status !=null">
				and t1.bill_status = #{bill_status}
			</if>
			<if test="dept_city_sel !=null">
				and t1.salesman_city_code in (select value_meaning from wms_sys_dict_data where value_code=#{dept_city_sel} and wms_sys_dict_id=71)
			</if>
			<if test="dept_name_sel !=null">
				and t1.salesman_dept_id in (select dept_id from sys_dept where dept_pid = #{dept_name_sel})
			</if>
			<if test="salesman_city_code != null">
				and t1.salesman_city_code = ${salesman_city_code}
			</if>
		</where>
		<if test="sortname!=null and sortorder!=null">
			order by ${sortname} ${sortorder}
		</if>
		<if test="offset!=null and pagesize!=null">
			limit ${offset},${pagesize}
		</if>
	</select>
	<!-- 审批查询总页数 -->
	<select id="findCreditCheckCount" parameterType="map" resultType="int">
		select count(t1.wms_cre_credit_head_id) as count
		from
		wms_cre_credit_head t1 left join
		wms_cre_credit_line_customer_change_head t2
		on
		t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id and t2.is_major='1'

		<where>
			t1.enable_flag=1
			<if test="id_card != null">
				and t2.id_card =#{id_card}
			</if>
			<if test="customer_name !=null">
				and t2.customer_name like #{customer_name}
			</if>
			<if test="bill_code != null">
				and bill_code like '${bill_code}'
			</if>
			<if test="salesman_name!=null or salesman_shortcode !=null">
				and (t1.salesman_name like #{salesman_name} or
				t1.salesman_shortcode like '${salesman_shortcode}')
			</if>
			<if test="create_timestamp != null and create_timestamp1!=null">
				and t1.create_timestamp between #{create_timestamp} and
				#{create_timestamp1}
			</if>
			<if test="create_user_id != null">
				and t1.create_user_id != #{create_user_id}
			</if>
			<if test="cre_type!=null">
				and t1.cre_type like #{cre_type}
			</if>
			<if test="city !=null">
				and t1.city like #{city}
			</if>
			<if test="bill_status !=null">
				and t1.bill_status =#{bill_status}
			</if>
			<if test="dept_city_sel !=null">
				and t1.salesman_city_code in (select value_meaning from wms_sys_dict_data where value_code=#{dept_city_sel} and wms_sys_dict_id=71)
			</if>
			<if test="dept_name_sel !=null">
				and t1.salesman_dept_id in (select dept_id from sys_dept where dept_pid = #{dept_name_sel})
			</if>
			<if test="salesman_city_code != null">
				and t1.salesman_city_code = ${salesman_city_code}
			</if>
		</where>
	</select>


	<!--查看四种审批的结果 -->
	<select id="findcheckcreditbillstaus" parameterType="int" resultType="WmsCreCreditHead">
		select
		wms_cre_credit_head_id,
		water_appro_result,
		info_appro_result,
		phone_appro_result,
		certificate_appro_result,
		house_appro_result
		from wms_cre_credit_head
		<where>
			enable_flag=1
			and wms_cre_credit_head_id=#{wms_cre_credit_head_id}
		</where>
	</select>

	<!-- 更新 -->
	<update id="updateRecord" parameterType="map">
		update wms_cre_credit_head
		<set>
			<if test="water_appro_user_id != null">
				water_appro_user_id=#{water_appro_user_id},
			</if>
			<if test="water_appro_user_name != null">
				water_appro_user_name=#{water_appro_user_name},
			</if>
			<if test="water_appro_timestamp != null">
				water_appro_timestamp=#{water_appro_timestamp},
			</if>
			<if test="water_appro_result != null">
				water_appro_result=#{water_appro_result},
				water_appro_result_page=#{water_appro_result},
			</if>
			<if test="info_appro_user_id != null">
				info_appro_user_id=#{info_appro_user_id},
			</if>
			<if test="info_appro_user_name != null">
				info_appro_user_name=#{info_appro_user_name},
			</if>
			<if test="info_appro_timestamp != null">
				info_appro_timestamp=#{info_appro_timestamp},
			</if>
			<if test="info_appro_result != null">
				info_appro_result=#{info_appro_result},
				info_appro_result_page=#{info_appro_result},
			</if>
			<if test="info_appro_advice != null">
				info_appro_advice=#{info_appro_advice},
			</if>
			<if test="phone_appro_user_id != null">
				phone_appro_user_id=#{phone_appro_user_id},
			</if>
			<if test="phone_appro_user_name != null">
				phone_appro_user_name=#{phone_appro_user_name},
			</if>
			<if test="phone_appro_timestamp != null">
				phone_appro_timestamp=#{phone_appro_timestamp},
			</if>
			<if test="phone_appro_result != null">
				phone_appro_result=#{phone_appro_result},
				phone_appro_result_page=#{phone_appro_result},
			</if>
			<if test="phone_appro_advice != null">
				phone_appro_advice=#{phone_appro_advice},
			</if>
			<if test="certificate_appro_user_id != null">
				certificate_appro_user_id=#{certificate_appro_user_id},
			</if>
			<if test="certificate_appro_user_name != null">
				certificate_appro_user_name=#{certificate_appro_user_name},
			</if>
			<if test="certificate_appro_timestamp != null">
				certificate_appro_timestamp=#{certificate_appro_timestamp},
			</if>
			<if test="certificate_appro_result != null">
				certificate_appro_result=#{certificate_appro_result},
				certificate_appro_result_page=#{certificate_appro_result},
			</if>
			<if test="certificate_appro_advice != null">
				certificate_appro_advice = #{certificate_appro_advice},
			</if>
			<if test="bill_status != null">
				bill_status = #{bill_status},
			</if>
			<if test="is_link_repeat != null">
				is_link_repeat = #{is_link_repeat},
			</if>
			<if test="protocol_amount != null">
				protocol_amount = #{protocol_amount},
			</if>
			<if test="house_appro_user_id != null">
				house_appro_user_id=#{house_appro_user_id},
			</if>
			<if test="house_appro_user_name != null">
				house_appro_user_name = #{house_appro_user_name},
			</if>
			<if test="house_appro_timestamp != null">
				house_appro_timestamp = #{house_appro_timestamp},
			</if>
			<if test="house_appro_result != null">
				house_appro_result = #{house_appro_result},
				house_appro_result_page = #{house_appro_result},
			</if>
			<if test="house_appro_advice != null">
				house_appro_advice = #{house_appro_advice},
			</if>
			<!-- 新验点 -->
			<if test="inspection_appro_user_id != null">
				inspection_appro_user_id=#{inspection_appro_user_id},
			</if>
			<if test="inspection_appro_user_name != null">
				inspection_appro_user_name =
				#{inspection_appro_user_name},
			</if>
			<if test="inspection_appro_timestamp != null">
				inspection_appro_timestamp =
				#{inspection_appro_timestamp},
			</if>
			<if test="inspection_appro_result != null">
				inspection_appro_result = #{inspection_appro_result},
				inspection_appro_result_page = #{inspection_appro_result},
			</if>
			<if test="inspection_appro_advice != null">
				inspection_appro_advice = #{inspection_appro_advice},
			</if>
			<!-- 新评估 -->
			<if test="assessment_id != null">
				assessment_id=#{assessment_id},
			</if>

			<if test="assessment_datetime != null">
				assessment_datetime =
				#{assessment_datetime},
			</if>
			<if test="assessment_result != null">
				assessment_result = #{assessment_result},
				assessment_result_page = #{assessment_result},
			</if>
			<if test="assessment_advice != null">
				assessment_advice = #{assessment_advice},
			</if>

			<if test="water_appro_eval != null">
				water_appro_eval = #{water_appro_eval},
			</if>
			<if test="phone_appro_eval != null">
				phone_appro_eval = #{phone_appro_eval},
			</if>
			<if test="is_review_back != null">
				is_review_back = #{is_review_back},
			</if>
			<if test="water_appro_advice != null">
				water_appro_advice = #{water_appro_advice},
			</if>
			<if test="phone_appro_advice != null">
				phone_appro_advice = #{phone_appro_advice},
			</if>
			<if test="check_back_remark !=null">
				check_back_remark=#{check_back_remark},
			</if>
			<if test="set_cre_null_status !=null">
				water_appro_result_page=null,
				info_appro_result_page=null,
				phone_appro_result_page=null,
				certificate_appro_result_page = null,
				house_appro_result_page = null,
				inspection_appro_result_page=null,
				trial_interview_result=null,
			</if>
			<if test="review_the_reasons !=null">
				review_the_reasons=#{review_the_reasons},
			</if>
			<if test="review_of_time !=null">
				review_of_time =#{review_of_time},
			</if>
			<if test="trial_interview_uid !=null">
				trial_interview_uid=#{trial_interview_uid},
			</if>
			<if test="trial_interview_uname !=null">
				trial_interview_uname=#{trial_interview_uname},
			</if>
			<if test="trial_interview_timestamp !=null">
				trial_interview_timestamp=#{trial_interview_timestamp},
			</if>
			<if test="trial_interview_result !=null">
				trial_interview_result =#{trial_interview_result},
			</if>
			<if test="trial_interview_advice !=null">
				trial_interview_advice =#{trial_interview_advice},
			</if>
			<if test="nullify_type !=null">
				nullify_type =#{nullify_type},
			</if>
			<if test="nullify_user_name !=null">
				nullify_user_name =#{nullify_user_name},
			</if>
			<if test="nullify_user_id !=null">
				nullify_user_id =#{nullify_user_id},
			</if>
			<if test="nullify_timestamp !=null">
				nullify_timestamp =#{nullify_timestamp},
			</if>
			<if test="nullify_reason !=null">
				nullify_reason =#{nullify_reason},
			</if>
			<if test="documentary_opinion !=null">
				documentary_opinion =#{documentary_opinion},
			</if>
		</set>
		where wms_cre_credit_head_id = #{wms_cre_credit_head_id}
	</update>

	<!-- 更新审批结果展示 -->
	<update id="updateApproResult" parameterType="map">
		update wms_cre_credit_head
		<set>
			<if test="water_appro_result !=null">
				water_appro_result =#{water_appro_result},
			</if>
			<if test="info_appro_result !=null">
				info_appro_result =#{info_appro_result},
			</if>
			<if test="phone_appro_result !=null">
				phone_appro_result =#{phone_appro_result},
			</if>
			<if test="water_appro_result_page !=null">
				water_appro_result_page =#{water_appro_result_page},
			</if>
			<if test="info_appro_result_page !=null">
				info_appro_result_page =#{info_appro_result_page},
			</if>
			<if test="phone_appro_result_page !=null">
				phone_appro_result_page =#{phone_appro_result_page},
			</if>
		</set>
		where wms_cre_credit_head_id = #{wms_cre_credit_head_id}
	</update>

	<!-- 更新 -->
	<update id="updateMCCHWhenUpdateOrReSub" parameterType="map">
		update wms_cre_credit_head
		<set>
			<if test="create_user_id != null">
				create_user_id=#{create_user_id},
			</if>
			<if test="create_user_name != null">
				create_user_name=#{create_user_name},
			</if>
			<if test="create_timestamp != null">
				create_timestamp=#{create_timestamp},
			</if>

			<if test="create_user_city_code != null">
				create_user_city_code=#{create_user_city_code},
			</if>
			<if test="create_user_dept_id != null">
				create_user_dept_id=#{create_user_dept_id},
			</if>
			<if test="credit_purpose != null">
				credit_purpose=#{credit_purpose},
			</if>
			<if test="cre_loan_type != null">
				cre_loan_type=#{cre_loan_type},
			</if>
			<if test="credit_limit != null">
				credit_limit=#{credit_limit},
			</if>
			<if test="max_repayment_limit_per_month != null">
				max_repayment_limit_per_month=#{max_repayment_limit_per_month},
			</if>
			<if test="max_repayment_time_limit != null">
				max_repayment_time_limit=#{max_repayment_time_limit},
			</if>
			<if test="enter_file_way != null">
				enter_file_way=#{enter_file_way},
			</if>
			<if test="payroll_payment_way != null">
				payroll_payment_way=#{payroll_payment_way},
			</if>
			<if test="profession_type != null">
				profession_type=#{profession_type},
			</if>
			<if test="is_complete != null">
				is_complete=#{is_complete},
			</if>
			<if test="reference_type != null">
				reference_type=#{reference_type},
			</if>
			<if test="is_other_corporation_done != null">
				is_other_corporation_done=#{is_other_corporation_done},
			</if>
			<if test="is_to_public_stream != null">
				is_to_public_stream=#{is_to_public_stream},
			</if>
			<if test="is_house_certificate_original != null">
				is_house_certificate_original=#{is_house_certificate_original},
			</if>
			<if test="is_check != null">
				is_check=#{is_check},
			</if>
			<if test="is_verify != null">
				is_verify=#{is_verify},
			</if>
			<if test="person_condition != null">
				person_condition=#{person_condition},
			</if>
			<if test="salesman_name != null">
				salesman_name=#{salesman_name},
			</if>
			<if test="salesman_id != null">
				salesman_id=#{salesman_id},
			</if>
			<if test="salesman_code != null">
				salesman_code=#{salesman_code},
			</if>
			<if test="city != null">
				city=#{city},
			</if>
			<if test="last_update_user_id != null">
				last_update_user_id=#{last_update_user_id},
			</if>
			<if test="last_update_timestamp != null">
				last_update_timestamp=#{last_update_timestamp},
			</if>
			<if test="loan_interest_rate != null">
				loan_interest_rate=#{loan_interest_rate},
			</if>
			<if test="salesman_city_code != null">
				salesman_city_code=#{salesman_city_code},
			</if>
			<if test="salesman_dept_id != null">
				salesman_dept_id=#{salesman_dept_id},
			</if>
			<if test="salesman_shortcode != null">
				salesman_shortcode=#{salesman_shortcode},
			</if>
			<if test="cre_loan_type_backup != null">
				cre_loan_type_backup=#{cre_loan_type_backup},
			</if>
			<if test="max_repayment_time_limit_backup != null">
				max_repayment_time_limit_backup=#{max_repayment_time_limit_backup},
			</if>
			<if test="documentary_opinion != null">
				documentary_opinion=#{documentary_opinion},
			</if>
			<if test="is_cycles !=null and is_cycles==0">
				is_cycles =#{is_cycles},
				lending_rates_execution_cycles
				=NULL
			</if>
			<if test="is_cycles !=null and is_cycles==1">
				is_cycles =#{is_cycles},
				lending_rates_execution_cycles
				=#{lending_rates_execution_cycles}
			</if>
		</set>
		where wms_cre_credit_head_id = #{wms_cre_credit_head_id}
	</update>

	<!-- 更新 -->
	<update id="updateLimit" parameterType="map">
		update wms_cre_credit_head
		<set>
			<if test="appro_limit != null">
				appro_limit=#{appro_limit},
			</if>
			<if test="visa_limit != null">
				visa_limit=#{visa_limit},
			</if>
			<if test="create_user_id != null">
				create_user_id=#{create_user_id},
			</if>
			<if test="create_user_name != null">
				create_user_name=#{create_user_name},
			</if>
			<if test="create_timestamp != null">
				create_timestamp=#{create_timestamp},
			</if>
			<if test="last_update_user_id != null">
				last_update_user_id=#{last_update_user_id},
			</if>
			<if test="last_update_timestamp != null">
				last_update_timestamp=#{last_update_timestamp},
			</if>
			<if test="cre_loan_type != null">
				cre_loan_type=#{cre_loan_type},
			</if>
			<if test="cre_loan_type_backup != null">
				cre_loan_type_backup=#{cre_loan_type_backup},
			</if>
			<if test="max_repayment_time_limit != null">
				max_repayment_time_limit=#{max_repayment_time_limit},
			</if>
			<if test="max_repayment_time_limit_backup != null">
				max_repayment_time_limit_backup=#{max_repayment_time_limit_backup},
			</if>
			<if test="nullify_type !=null">
				nullify_type =#{nullify_type},
			</if>
			<if test="nullify_user_name !=null">
				nullify_user_name =#{nullify_user_name},
			</if>
			<if test="nullify_user_id !=null">
				nullify_user_id =#{nullify_user_id},
			</if>
			<if test="nullify_timestamp !=null">
				nullify_timestamp =#{nullify_timestamp},
			</if>
			<if test="nullify_reason !=null">
				nullify_reason =#{nullify_reason},
			</if>
			<if test="final_eval !=null">
				final_eval =#{final_eval},
			</if>
			<if test="face_trial_eval !=null">
				face_trial_eval =#{face_trial_eval},
			</if>
			<if test="credit_limit !=null">
				credit_limit =#{credit_limit},
			</if>
			<if test="credit_limit_backup !=null">
				credit_limit_backup =#{credit_limit_backup},
			</if>
			<if test="loan_interest_rate !=null">
				loan_interest_rate =#{loan_interest_rate},
			</if>
			<if test="wms_cre_credit_group_id !=null">
				wms_cre_credit_group_id =#{wms_cre_credit_group_id},
			</if>
			<if test="is_guarantee !=null">
				is_guarantee =#{is_guarantee},
			</if>
		</set>
		where wms_cre_credit_head_id = #{wms_cre_credit_head_id}
	</update>
	<!-- 更新 -->
	<update id="updateLimitAll" parameterType="map">
		update wms_cre_credit_head
		set appro_limit=#{appro_limit}
		where wms_cre_credit_head_id = #{wms_cre_credit_head_id}
	</update>
	<!-- 贷前跟踪数据导出 -->
	<select id="getFollowCheckListWithoutPaging" parameterType="map" resultType="java.util.HashMap">
		select
		t1.wms_cre_credit_head_id,
		t1.bill_code,
		t1.credit_purpose,
		t1.max_repayment_limit_per_month,
		t1.credit_limit,
		t1.max_repayment_time_limit,
		t1.enter_file_way,
		t1.payroll_payment_way,
		t1.data_type,
		t1.is_complete,
		t1.reference_type,
		t1.is_other_corporation_done,
		t1.is_to_public_stream,
		t1.is_house_certificate_original,
		t1.is_check,
		t1.person_condition,
		t1.salesman_id,
		t1.salesman_code,
		t1.salesman_name,
		t1.city,
		t1.cre_type,
		t1.cre_loan_type,
		t1.bill_status,
		(select value_meaning from wms_sys_dict_data where
		value_code = bill_status
		and wms_sys_dict_id = 24)as bill_status_name,
		t1.water_appro_user_id,
		t1.water_appro_user_name,
		date_format(t1.water_appro_timestamp,'%Y-%m-%d %H:%i:%s') as water_appro_timestamp,
		t1.water_appro_result,
		(case t1.water_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略' else
		'待审批' end)as water_appro_result_name,
		t1.info_appro_user_id,
		t1.info_appro_user_name,
		date_format(t1.info_appro_timestamp,'%Y-%m-%d %H:%i:%s') as info_appro_timestamp,
		t1.info_appro_result,
		(case t1.info_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略' else
		'待审批' end) as info_appro_result_name,
		t1.phone_appro_user_id,
		t1.phone_appro_user_name,
		date_format(t1.phone_appro_timestamp,'%Y-%m-%d %H:%i:%s')as phone_appro_timestamp,
		t1.phone_appro_result,
		(case t1.phone_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略' else
		'待审批' end)as phone_appro_result_name,
		t1.certificate_appro_user_id,
		t1.certificate_appro_user_name,
		date_format(t1.certificate_appro_timestamp,'%Y-%m-%d %H:%i:%s') as certificate_appro_timestamp,
		t1.certificate_appro_result,
		(case t1.certificate_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略'
		else '待审批' end)as certificate_appro_result_name,
		t1.create_user_id,
		t1.create_user_name,
		date_format(t1.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t1.last_update_user_id,
		date_format(t1.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
		t1.enable_flag,
		t2.wms_cre_credit_line_customer_change_head_id,
		t2.wms_cre_credit_head_id,
		t2.wms_cus_customer_head_id,
		t2.customer_code,
		t2.customer_name,
		t2.customer_ever_name,
		t2.customer_category,
		t2.gender,
		t2.max_degree,
		date_format(t2.birthday,'%Y-%m-%d') as birthday,
		t2.id_card,
		t2.province,
		t2.city,
		t2.district,
		t2.address_more,
		t2.has_children,
		t2.children_name,
		t2.children_address,
		t2.children_telephone,
		t2.has_married,
		t2.has_house,
		t2.current_address_province,
		t2.current_address_city,
		t2.current_address_district,
		t2.current_address_more,
		t2.post_code,
		t2.fixed_telephone,
		t2.mobile_telephone1,
		t2.service_password1,
		t2.mobile_telephone2,
		t2.service_password2,
		t2.personal_year_income,
		t2.customer_email,
		t2.credit_card_limit,
		t2.common_occupants,
		t2.status,
		t2.create_user_id,
		t2.create_user_name,
		date_format(t2.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t2.last_update_user_id,
		date_format(t2.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
		t2.enable_flag,
		t1.inspection_appro_user_id,
		t1.inspection_appro_user_name,
		t1.inspection_appro_timestamp,
		t1.inspection_appro_result,
		(case
		when t1.trial_interview_result=1 and
		t1.cre_loan_type=283 and t1.inspection_appro_result='0' then '未通过'
		when t1.trial_interview_result=1 and
		t1.cre_loan_type=283 and t1.inspection_appro_result='1' then '通过'
		when t1.trial_interview_result=1 and
		t1.cre_loan_type=283 and ISNULL(t1.inspection_appro_result) then '待审批'
		when t1.trial_interview_result=1 and t1.cre_loan_type=113 and
		t1.inspection_appro_result='0' then
		'未通过'
		when t1.trial_interview_result=1 and t1.cre_loan_type=113 and
		t1.inspection_appro_result='1' then '通过'
		when t1.trial_interview_result=1 and t1.cre_loan_type=113 and
		ISNULL(t1.inspection_appro_result) then '待审批'
		END) as inspection_appro_result_name,
		t1.inspection_appro_advice,
		t1.inspection_appro_result_page,
		t1.salesman_shortcode,
		CONCAT(t1.salesman_name,"/",t1.salesman_shortcode) as salesman_name_str,
		t1.documentary_opinion
		from
		wms_cre_credit_head t1,wms_cre_credit_line_customer_change_head t2
		<where>
			t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id and
			t1.enable_flag=1 and t1.bill_status=2 and t2.is_major='1'
			<if test="bill_code!=null">
				and t1.bill_code like '${bill_code}'
			</if>
			<if test="customer_name!=null">
				and t2.customer_name like '${customer_name}'
			</if>
			<if test="id_card!=null">
				and t2.id_card =#{id_card}
			</if>
			<if test="mobile_telephone!=null">
				and (t2.mobile_telephone1 like '${mobile_telephone}' or
				t2.mobile_telephone2 like '${mobile_telephone}')
			</if>
			<if test="create_timestamp != null and create_timestamp1!=null">
				and t1.create_timestamp between #{create_timestamp} and
				#{create_timestamp1}
			</if>
		</where>
		<if test="sortname!=null and sortorder!=null">
			order by ${sortname} ${sortorder}
		</if>
	</select>
	<!-- 房贷贷前跟踪数据导出 -->
	<select id="getFollowCheckListWithoutPagingForFd" parameterType="map" resultType="java.util.HashMap">
		select
		t1.wms_cre_credit_head_id,
		t1.bill_code,
		t1.credit_purpose,
		t1.max_repayment_limit_per_month,
		t1.credit_limit,
		t1.max_repayment_time_limit,
		t1.enter_file_way,
		t1.payroll_payment_way,
		t1.data_type,
		t1.is_complete,
		t1.reference_type,
		t1.is_other_corporation_done,
		t1.is_to_public_stream,
		t1.is_house_certificate_original,
		t1.is_check,
		t1.person_condition,
		t1.salesman_id,
		t1.salesman_code,
		t1.salesman_name,
		t1.city,
		t1.cre_type,
		t1.bill_status,
		(select value_meaning from wms_sys_dict_data where value_code =
		bill_status
		and wms_sys_dict_id = 24)as bill_status_name,
		t1.water_appro_user_id,
		t1.water_appro_user_name,
		date_format(t1.water_appro_timestamp,'%Y-%m-%d %H:%i:%s') as water_appro_timestamp,
		t1.water_appro_result,
		(case t1.water_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略' else
		'待审批' end)as water_appro_result_name,
		t1.info_appro_user_id,
		t1.info_appro_user_name,
		date_format(t1.info_appro_timestamp,'%Y-%m-%d %H:%i:%s') as info_appro_timestamp,
		t1.info_appro_result,
		(case
		t1.info_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略' else
		'待审批' end) as info_appro_result_name,
		t1.phone_appro_user_id,
		t1.phone_appro_user_name,
		date_format(t1.phone_appro_timestamp,'%Y-%m-%d %H:%i:%s')as phone_appro_timestamp,
		t1.phone_appro_result,
		(case t1.phone_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略' else
		'待审批' end)as phone_appro_result_name,
		t1.certificate_appro_user_id,
		t1.certificate_appro_user_name,
		date_format(t1.certificate_appro_timestamp,'%Y-%m-%d %H:%i:%s') as certificate_appro_timestamp,
		t1.certificate_appro_result,
		(case t1.certificate_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略'
		else '待审批' end)as certificate_appro_result_name,
		t1.create_user_id,
		t1.create_user_name,
		date_format(t1.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t1.last_update_user_id,
		date_format(t1.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
		t1.enable_flag,
		t1.house_appro_result,
		(case t1.house_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略' else
		'待审批' end)as house_appro_result_name,
		t2.wms_cre_credit_line_customer_change_head_id,
		t2.wms_cre_credit_head_id,
		t2.wms_cus_customer_head_id,
		t2.customer_code,
		t2.customer_name,
		t2.customer_ever_name,
		t2.customer_category,
		t2.gender,
		t2.max_degree,
		date_format(t2.birthday,'%Y-%m-%d') as birthday,
		t2.id_card,
		t2.province,
		t2.city,
		t2.district,
		t2.address_more,
		t2.has_children,
		t2.children_name,
		t2.children_address,
		t2.children_telephone,
		t2.has_married,
		t2.has_house,
		t2.current_address_province,
		t2.current_address_city,
		t2.current_address_district,
		t2.current_address_more,
		t2.post_code,
		t2.fixed_telephone,
		t2.mobile_telephone1,
		t2.service_password1,
		t2.mobile_telephone2,
		t2.service_password2,
		t2.personal_year_income,
		t2.customer_email,
		t2.credit_card_limit,
		t2.common_occupants,
		t2.status,
		t2.create_user_id,
		t2.create_user_name,
		date_format(t2.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t2.last_update_user_id,
		date_format(t2.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
		t2.enable_flag,
		t1.salesman_shortcode,
		CONCAT(t1.salesman_name,"/",t1.salesman_shortcode) as salesman_name_str
		from wms_cre_credit_head
		t1,wms_cre_credit_line_customer_change_head t2
		<where>
			t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id and
			t1.enable_flag=1 and t1.cre_type=2 and t2.is_major='1' and
			t1.bill_status='C'
			<if test="bill_code!=null">
				and t1.bill_code like '${bill_code}'
			</if>
			<if test="customer_name!=null">
				and t2.customer_name like '${customer_name}'
			</if>
			<if test="id_card!=null">
				and t2.id_card = #{id_card}
			</if>
			<if test="mobile_telephone!=null">
				and (t2.mobile_telephone1 like '${mobile_telephone}' or
				t2.mobile_telephone2 like '${mobile_telephone}')
			</if>
			<if test="create_timestamp != null and create_timestamp1!=null">
				and t1.create_timestamp between #{create_timestamp} and
				#{create_timestamp1}
			</if>
		</where>
		<if test="sortname!=null and sortorder!=null">
			order by ${sortname} ${sortorder}
		</if>
	</select>
	<!-- 贷前跟踪查询列表分页 -->
	<select id="getFollowCheckListWithPaging" parameterType="map" resultType="java.util.HashMap">
		select
		t1.wms_cre_credit_head_id,
		t1.bill_code,
		t1.credit_purpose,
		t1.max_repayment_limit_per_month,
		t1.credit_limit,
		t1.max_repayment_time_limit,
		t1.enter_file_way,
		t1.payroll_payment_way,
		t1.data_type,
		t1.is_complete,
		t1.reference_type,
		t1.is_other_corporation_done,
		t1.is_to_public_stream,
		t1.is_house_certificate_original,
		t1.is_check,
		t1.person_condition,
		t1.salesman_id,
		t1.salesman_code,
		t1.salesman_name,
		t1.city,
		t1.cre_type,
		t1.bill_status,
		(select value_meaning from wms_sys_dict_data where value_code =
		bill_status
		and wms_sys_dict_id = 24)as bill_status_name,
		t1.water_appro_user_id,
		t1.water_appro_user_name,
		date_format(t1.water_appro_timestamp,'%Y-%m-%d %H:%i:%s') as water_appro_timestamp,
		t1.water_appro_result,
		t1.water_appro_result_page,
		t1.info_appro_user_id,
		t1.info_appro_user_name,
		date_format(t1.info_appro_timestamp,'%Y-%m-%d %H:%i:%s') as info_appro_timestamp,
		t1.info_appro_result,
		t1.info_appro_result_page,
		t1.phone_appro_user_id,
		t1.phone_appro_user_name,
		date_format(t1.phone_appro_timestamp,'%Y-%m-%d %H:%i:%s')as phone_appro_timestamp,
		t1.phone_appro_result,
		t1.phone_appro_result_page,
		t1.certificate_appro_user_id,
		t1.certificate_appro_user_name,
		date_format(t1.certificate_appro_timestamp,'%Y-%m-%d %H:%i:%s') as certificate_appro_timestamp,
		t1.certificate_appro_result,
		t1.certificate_appro_result_page,
		t1.create_user_id,
		t1.create_user_name,
		date_format(t1.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t1.last_update_user_id,
		date_format(t1.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
		t1.enable_flag,
		t2.wms_cre_credit_line_customer_change_head_id,
		t2.wms_cre_credit_head_id,
		t2.wms_cus_customer_head_id,
		t2.customer_code,
		t2.customer_name,
		t2.customer_ever_name,
		t2.customer_category,
		t2.gender,
		t2.max_degree,
		date_format(t2.birthday,'%Y-%m-%d') as birthday,
		t2.id_card,
		t2.province,
		t2.city,
		t2.district,
		t2.address_more,
		t2.has_children,
		t2.children_name,
		t2.children_address,
		t2.children_telephone,
		t2.has_married,
		t2.has_house,
		t2.current_address_province,
		t2.current_address_city,
		t2.current_address_district,
		t2.current_address_more,
		t2.post_code,
		t2.fixed_telephone,
		t2.mobile_telephone1,
		t2.service_password1,
		t2.mobile_telephone2,
		t2.service_password2,
		t2.personal_year_income,
		t2.customer_email,
		t2.credit_card_limit,
		t2.common_occupants,
		t2.status,
		t2.create_user_id,
		t2.create_user_name,
		date_format(t2.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t2.last_update_user_id,
		date_format(t2.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
		t2.enable_flag,
		t1.inspection_appro_user_id,
		t1.inspection_appro_user_name,
		t1.inspection_appro_timestamp,
		t1.inspection_appro_result,
		t1.inspection_appro_advice,
		t1.inspection_appro_result_page,
		t1.cre_loan_type,
		t1.salesman_shortcode,
		CONCAT(t1.salesman_name,"/",t1.salesman_shortcode) as salesman_name_str,
		t1.trial_interview_uid,
		t1.trial_interview_uname,
		t1.trial_interview_timestamp,
		t1.trial_interview_result,
		t1.trial_interview_advice
		from
		wms_cre_credit_head t1,wms_cre_credit_line_customer_change_head t2
		<where>
			t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id and
			t1.enable_flag=1 and t1.bill_status=2 and t2.is_major='1'
			<if test="bill_code!=null">
				and t1.bill_code like '${bill_code}'
			</if>
			<if test="customer_name!=null">
				and t2.customer_name like '${customer_name}'
			</if>
			<if test="id_card!=null">
				and t2.id_card =#{id_card}
			</if>
			<if test="mobile_telephone!=null">
				and (t2.mobile_telephone1 like '${mobile_telephone}' or
				t2.mobile_telephone2 like '${mobile_telephone}')
			</if>
			<if test="create_timestamp != null and create_timestamp1!=null">
				and t1.create_timestamp between #{create_timestamp} and
				#{create_timestamp1}
			</if>
		</where>
		<if test="sortname!=null and sortorder!=null">
			order by ${sortname} ${sortorder}
		</if>
		<if test="offset!=null and pagesize!=null">
			limit ${offset},${pagesize}
		</if>
	</select>
	<!-- 贷前跟踪总页数 -->
	<select id="findFollowCheckCount" parameterType="map" resultType="int">
		select

		count(t1.wms_cre_credit_head_id) as count

		from

		wms_cre_credit_head t1 ,wms_cre_credit_line_customer_change_head t2
		<where>
			t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id and
			t1.enable_flag=1 and t1.bill_status=2 and t2.is_major='1'
			<if test="id_card != null">
				and t2.id_card =#{id_card}
			</if>
			<if test="bill_code != null">
				and t1.bill_code like '${bill_code}'
			</if>
			<if test="customer_name != null">
				and t2.customer_name like '${customer_name}'
			</if>
			<if test="mobile_telephone != null">
				and (t2.mobile_telephone1 like '${mobile_telephone}' or
				t2.mobile_telephone2 like '${mobile_telephone}')
			</if>
			<if test="create_user_id != null">
				and t1.create_user_id != #{create_user_id}
			</if>
			<if test="create_timestamp != null and create_timestamp1!=null">
				and t1.create_timestamp between #{create_timestamp} and
				#{create_timestamp1}
			</if>
		</where>
	</select>
	<!-- 贷前查询数据导出 -->
	<select id="getLoanCheckListWithoutPaging" parameterType="map" resultType="java.util.HashMap">
		select
		wms_cre_credit_head_id,
		customer_name,
		id_card,
		isLender,
		isLinkMan,
		bill_code,
		bill_status,
		cre_type,
		(select value_meaning from wms_sys_dict_data where value_code = bill_status
		and wms_sys_dict_id = 24)as bill_status_name,
		date_format(create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		mobile_telephone,
		salesman_name,
		salesman_shortcode,
		CONCAT(salesman_name,"/",salesman_shortcode) as salesman_name_str
		from v_loan_check_search
		<where>
			<if test="customer_name!=null">
				and customer_name like '${customer_name}'
			</if>
			<if test="id_card!=null">
				and id_card =#{id_card}
			</if>
			<if test="mobile_telephone!=null">
				and mobile_telephone like '${mobile_telephone}'
			</if>
		</where>
		<if test="sortname!=null and sortorder!=null">
			order by ${sortname} ${sortorder}
		</if>
	</select>
	<select id="getLoanCheckListWithPaging" parameterType="map" resultType="java.util.HashMap">
		select
		wms_cre_credit_head_id,
		customer_name,
		id_card,
		isLender,
		isLinkMan,
		bill_code,
		bill_status,
		cre_type,
		(select value_meaning from wms_sys_dict_data where value_code = bill_status
		and wms_sys_dict_id = 24)as bill_status_name,
		date_format(create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		mobile_telephone,
		salesman_name,
		salesman_shortcode,
		CONCAT(salesman_name,"/",salesman_shortcode) as salesman_name_str
		from v_loan_check_search
		<where>
			<if test="customer_name!=null">
				and customer_name like '${customer_name}'
			</if>
			<if test="id_card!=null">
				and id_card =#{id_card}
			</if>
			<if test="mobile_telephone!=null">
				and mobile_telephone like '${mobile_telephone}'
			</if>
		</where>
		<if test="sortname!=null and sortorder!=null">
			order by ${sortname} ${sortorder}
		</if>
		<if test="offset!=null and pagesize!=null">
			limit ${offset},${pagesize}
		</if>
	</select>
	<select id="findLoanCheckCount" parameterType="map" resultType="int">
		select count(customer_name) as count from v_loan_check_search
		<where>
			<if test="customer_name!=null">
				and customer_name like '${customer_name}'
			</if>
			<if test="id_card!=null">
				and id_card =#{id_card}
			</if>
			<if test="mobile_telephone!=null">
				and mobile_telephone like '${mobile_telephone}'
			</if>
		</where>
	</select>


	<!-- 查询WmsCreCreditHead ，返回List<Map>对象 -->
	<select id="searchforborrow" parameterType="int" resultType="java.util.HashMap">
		select
		t1.wms_cre_credit_head_id,
		t1.bill_code,
		t1.credit_purpose,
		t1.max_repayment_limit_per_month,
		t1.credit_limit,
		t1.max_repayment_time_limit,
		t1.enter_file_way,
		t1.payroll_payment_way,
		t1.data_type,
		t1.is_complete,
		t1.reference_type,
		t1.is_other_corporation_done,
		t1.is_to_public_stream,
		t1.is_house_certificate_original,
		t1.is_check,
		t1.person_condition,
		t1.salesman_id,
		t1.salesman_code,
		t1.salesman_name,
		t1.city,
		t1.cre_type,
		t1.bill_status,
		(select value_meaning from wms_sys_dict_data where value_code =
		bill_status
		and wms_sys_dict_id = 24)as bill_status_name,
		t1.water_appro_user_id,
		t1.water_appro_user_name,
		date_format(t1.water_appro_timestamp,'%Y-%m-%d %H:%i:%s') as water_appro_timestamp,
		t1.water_appro_result,
		t1.info_appro_user_id,
		t1.info_appro_user_name,
		date_format(t1.info_appro_timestamp,'%Y-%m-%d %H:%i:%s') as info_appro_timestamp,
		t1.info_appro_result,
		t1.phone_appro_user_id,
		t1.phone_appro_user_name,
		date_format(t1.phone_appro_timestamp,'%Y-%m-%d %H:%i:%s')as phone_appro_timestamp,
		t1.phone_appro_result,
		t1.certificate_appro_user_id,
		t1.certificate_appro_user_name,

		date_format(t1.certificate_appro_timestamp,'%Y-%m-%d %H:%i:%s') as certificate_appro_timestamp,
		t1.certificate_appro_result,

		t1.create_user_id,
		t1.create_user_name,
		date_format(t1.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t1.last_update_user_id,
		date_format(t1.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
		t1.enable_flag,
		t1.is_link_repeat,
		t1.profession_type,
		t1.is_verify,
		t1.house_appro_result,
		t1.cre_loan_type,
		t1.loan_interest_rate,
		t1.visa_limit,
		t1.appro_limit,
		t2.wms_cre_credit_line_customer_change_head_id,
		t2.wms_cre_credit_head_id,
		t2.wms_cus_customer_head_id,
		t2.customer_code,
		t2.customer_name,
		t2.customer_ever_name,
		t2.customer_category,
		t2.gender,
		t2.max_degree,
		date_format(t2.birthday,'%Y-%m-%d') as birthday,
		t2.id_card,
		t2.province,
		t2.city,
		t2.district,
		t2.address_more,
		t2.has_children,
		t2.children_name,
		t2.children_address,
		t2.children_telephone,
		t2.has_married,
		t2.has_house,
		t2.current_address_province,
		t2.current_address_city,
		t2.current_address_district,
		t2.current_address_more,
		t2.post_code,
		t2.fixed_telephone,
		t2.mobile_telephone1,
		t2.service_password1,
		t2.mobile_telephone2,
		t2.service_password2,
		t2.personal_year_income,
		t2.customer_email,
		t2.credit_card_limit,
		t2.common_occupants,
		t2.status,
		t2.create_user_id,
		t2.create_user_name,
		date_format(t2.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t2.last_update_user_id,
		date_format(t2.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
		t2.enable_flag,
		t1.salesman_shortcode,
		CONCAT(t1.salesman_name,"/",t1.salesman_shortcode) as salesman_name_str,
		t1.documentary_opinion
		from wms_cre_credit_head t1,wms_cre_credit_line_customer_change_head t2
		<where>
			t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id and t2.is_major='1'
			and t1.wms_cre_credit_head_id=#{wms_cre_credit_head_id}
		</where>
	</select>
	<!-- 贷款复核退回查询列表分页 -->
	<select id="getRecheckListWithPaging" parameterType="map" resultType="java.util.HashMap">
		select
		t1.wms_cre_credit_head_id,
		t1.bill_code,
		t1.credit_purpose,
		t1.max_repayment_limit_per_month,
		t1.credit_limit,
		t1.max_repayment_time_limit,
		t1.enter_file_way,
		t1.payroll_payment_way,
		t1.data_type,
		t1.is_complete,
		t1.reference_type,
		t1.is_other_corporation_done,
		t1.is_to_public_stream,
		t1.is_house_certificate_original,
		t1.is_check,
		t1.person_condition,
		t1.salesman_id,
		t1.salesman_code,
		t1.salesman_name,
		t1.city,
		t1.cre_type,
		(case t1.cre_type when '1' then '信贷产品' when '2' then '房贷产品' end) as
		cre_type_name,
		t1.bill_status,
		(select value_meaning from wms_sys_dict_data where value_code = bill_status
		and wms_sys_dict_id = 24)as bill_status_name,
		t1.water_appro_user_id,
		t1.water_appro_user_name,
		date_format(t1.water_appro_timestamp,'%Y-%m-%d %H:%i:%s') as water_appro_timestamp,
		t1.water_appro_result,
		t1.info_appro_user_id,
		t1.info_appro_user_name,
		date_format(t1.info_appro_timestamp,'%Y-%m-%d %H:%i:%s') as info_appro_timestamp,
		t1.info_appro_result,
		t1.phone_appro_user_id,
		t1.phone_appro_user_name,
		date_format(t1.phone_appro_timestamp,'%Y-%m-%d %H:%i:%s')as phone_appro_timestamp,
		t1.phone_appro_result,
		t1.certificate_appro_user_id,
		t1.certificate_appro_user_name,

		date_format(t1.certificate_appro_timestamp,'%Y-%m-%d %H:%i:%s') as certificate_appro_timestamp,
		t1.certificate_appro_result,

		t1.create_user_id,
		t1.create_user_name,
		date_format(t1.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t1.last_update_user_id,
		date_format(t1.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as
		last_update_timestamp,
		t1.enable_flag,
		t1.is_link_repeat,
		t1.profession_type,
		t1.is_verify,
		t1.house_appro_result,
		t1.cre_loan_type,
		t1.loan_interest_rate,
		t1.check_back_remark,
		t2.wms_cre_credit_line_customer_change_head_id,
		t2.wms_cre_credit_head_id,
		t2.wms_cus_customer_head_id,
		t2.customer_code,
		t2.customer_name,
		t2.customer_ever_name,
		t2.customer_category,
		t2.gender,
		t2.max_degree,
		date_format(t2.birthday,'%Y-%m-%d') as birthday,
		t2.id_card,
		t2.province,
		t2.city,
		t2.district,
		t2.address_more,
		t2.has_children,
		t2.children_name,
		t2.children_address,
		t2.children_telephone,
		t2.has_married,
		t2.has_house,
		t2.current_address_province,
		t2.current_address_city,
		t2.current_address_district,
		t2.current_address_more,
		t2.post_code,
		t2.fixed_telephone,
		t2.mobile_telephone1,
		t2.service_password1,
		t2.mobile_telephone2,
		t2.service_password2,
		t2.personal_year_income,
		t2.customer_email,
		t2.credit_card_limit,
		t2.common_occupants,
		t2.status,
		t2.create_user_id,
		t2.create_user_name,
		date_format(t2.create_timestamp,'%Y-%m-%d %H:%i:%s') as
		create_timestamp,
		t2.last_update_user_id,
		date_format(t2.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
		t2.enable_flag,
		t1.salesman_shortcode,
		(case when t1.create_timestamp &lt; #{hprocess_time} then '1' else '2' end) as edition_num,
		CONCAT(t1.salesman_name,"/",t1.salesman_shortcode) as salesman_name_str
		from wms_cre_credit_head t1,wms_cre_credit_line_customer_change_head t2
		<where>
			t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id and
			t2.is_major='1'
			and t1.create_user_city_code =#{create_user_city_code}
			<if test="id_card != null">
				and t2.id_card = #{id_card}
			</if>
			<if test="idList !=null">
				and t1.wms_cre_credit_head_id in
				<foreach collection="idList" item="wms_cre_credit_head_id" index="index" open="(" separator="," close=")">
					#{wms_cre_credit_head_id}
				</foreach>
			</if>
			and t1.enable_flag='1'
			<if test="bill_code != null">
				and t1.bill_code like '${bill_code}'
			</if>
			<if test="bill_status!= null">
				and t1.bill_status=#{bill_status}
			</if>
			<if test="salesman_name!=null or salesman_shortcode !=null">
				and (t1.salesman_name like #{salesman_name} or
				t1.salesman_shortcode like '${salesman_shortcode}')
			</if>
			<if test="customer_name != null">
				and t2.customer_name like '${customer_name}'
			</if>
			<if test="mobile_telephone != null">
				and (t2.mobile_telephone1 like '${mobile_telephone}' or
				t2.mobile_telephone2 like '${mobile_telephone}')
			</if>
			<if test="create_timestamp != null and create_timestamp1!=null">
				and t1.create_timestamp between #{create_timestamp} and
				#{create_timestamp1}
			</if>
			<if test="create_user_id != null">
				and t1.create_user_id = #{create_user_id}
			</if>
			<if test="cre_type !=null">
				and t1.cre_type = #{cre_type}
			</if>
		</where>
		<if test="sortname != null and sortorder !=null">
			ORDER BY ${sortname} ${sortorder}
		</if>
		<if test="offset != null and pagesize !=null">
			LIMIT ${offset} , ${pagesize}
		</if>
	</select>
	<!-- 查询贷款复核数据条数，直接返回int类型条数 -->
	<select id="findCountForRecheck" parameterType="map" resultType="int">
		select count(t1.wms_cre_credit_head_id) as count
		from
		wms_cre_credit_head t1,wms_cre_credit_line_customer_change_head t2
		<where>
			t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id and
			t2.is_major='1'
			and t1.create_user_city_code =#{create_user_city_code}
			<if test="id_card != null">
				and t2.id_card = #{id_card}
			</if>
			<if test="idList !=null">
				and t1.wms_cre_credit_head_id in
				<foreach collection="idList" item="wms_cre_credit_head_id" index="index" open="(" separator="," close=")">
					#{wms_cre_credit_head_id}
				</foreach>
			</if>
			and t1.enable_flag='1'
			<if test="bill_code != null">
				and t1.bill_code like '${bill_code}'
			</if>
			<if test="bill_status!= null">
				and t1.bill_status=#{bill_status}
			</if>
			<if test="salesman_name!=null or salesman_shortcode !=null">
				and (t1.salesman_name like #{salesman_name} or
				t1.salesman_shortcode like '${salesman_shortcode}')
			</if>
			<if test="create_timestamp != null and create_timestamp1!=null">
				and t1.create_timestamp between #{create_timestamp} and
				#{create_timestamp1}
			</if>
			<if test="create_user_id != null">
				and t1.create_user_id = #{create_user_id}
			</if>
			<if test="cre_type !=null">
				and t1.cre_type = #{cre_type}
			</if>
		</where>
	</select>
	<!-- 贷款复核数据导出 -->
	<select id="getRecheckListWithoutPaging" parameterType="map" resultType="java.util.HashMap">
		select
		t1.wms_cre_credit_head_id,
		t1.bill_code,
		t1.credit_purpose,
		t1.max_repayment_limit_per_month,
		t1.credit_limit,
		t1.max_repayment_time_limit,
		t1.enter_file_way,
		t1.payroll_payment_way,
		t1.data_type,
		t1.is_complete,
		t1.reference_type,
		t1.is_other_corporation_done,
		t1.is_to_public_stream,
		t1.is_house_certificate_original,
		t1.is_check,
		t1.person_condition,
		t1.salesman_id,
		t1.salesman_code,
		t1.salesman_name,
		t1.city,
		t1.cre_type,
		t1.bill_status,
		(select value_meaning from wms_sys_dict_data where value_code =
		bill_status
		and wms_sys_dict_id = 24)as bill_status_name,
		t1.water_appro_user_id,
		t1.water_appro_user_name,
		date_format(t1.water_appro_timestamp,'%Y-%m-%d %H:%i:%s') as water_appro_timestamp,
		t1.water_appro_result,
		(case t1.water_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略' else
		'待审批' end)as water_appro_result_name,
		t1.info_appro_user_id,
		t1.info_appro_user_name,
		date_format(t1.info_appro_timestamp,'%Y-%m-%d %H:%i:%s') as info_appro_timestamp,
		t1.info_appro_result,
		(case
		t1.info_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略' else
		'待审批' end) as info_appro_result_name,
		t1.phone_appro_user_id,
		t1.phone_appro_user_name,
		date_format(t1.phone_appro_timestamp,'%Y-%m-%d %H:%i:%s')as phone_appro_timestamp,
		t1.phone_appro_result,
		(case t1.phone_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略' else
		'待审批' end)as phone_appro_result_name,
		t1.certificate_appro_user_id,
		t1.certificate_appro_user_name,
		date_format(t1.certificate_appro_timestamp,'%Y-%m-%d %H:%i:%s') as certificate_appro_timestamp,
		t1.certificate_appro_result,
		(case t1.certificate_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略'
		else '待审批' end)as certificate_appro_result_name,
		t1.create_user_id,
		t1.create_user_name,
		date_format(t1.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t1.last_update_user_id,
		date_format(t1.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
		t1.enable_flag,
		t1.check_back_remark,
		t2.wms_cre_credit_line_customer_change_head_id,
		t2.wms_cre_credit_head_id,
		t2.wms_cus_customer_head_id,
		t2.customer_code,
		t2.customer_name,
		t2.customer_ever_name,
		t2.customer_category,
		t2.gender,
		t2.max_degree,
		date_format(t2.birthday,'%Y-%m-%d') as birthday,
		t2.id_card,
		t2.province,
		t2.city,
		t2.district,
		t2.address_more,
		t2.has_children,
		t2.children_name,
		t2.children_address,
		t2.children_telephone,
		t2.has_married,
		t2.has_house,
		t2.current_address_province,
		t2.current_address_city,
		t2.current_address_district,
		t2.current_address_more,
		t2.post_code,
		t2.fixed_telephone,
		t2.mobile_telephone1,
		t2.service_password1,
		t2.mobile_telephone2,
		t2.service_password2,
		t2.personal_year_income,
		t2.customer_email,
		t2.credit_card_limit,
		t2.common_occupants,
		t2.status,
		t2.create_user_id,
		t2.create_user_name,
		date_format(t2.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t2.last_update_user_id,
		date_format(t2.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
		t2.enable_flag,
		t1.salesman_shortcode,
		CONCAT(t1.salesman_name,"/",t1.salesman_shortcode) as salesman_name_str
		from wms_cre_credit_head
		t1,wms_cre_credit_line_customer_change_head t2
		<where>
			t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id and
			t1.enable_flag=1 and t2.is_major='1'
			<if test="idList !=null">
				and t1.wms_cre_credit_head_id in
				<foreach collection="idList" item="wms_cre_credit_head_id" index="index" open="(" separator="," close=")">
					#{wms_cre_credit_head_id}
				</foreach>
			</if>
			<if test="bill_code!=null">
				and t1.bill_code like '${bill_code}'
			</if>
			<if test="bill_status!= null">
				and t1.bill_status=#{bill_status}
			</if>
			<if test="customer_name!=null">
				and t2.customer_name like '${customer_name}'
			</if>
			<if test="id_card!=null">
				and t2.id_card =#{id_card}
			</if>
			<if test="create_timestamp != null and create_timestamp1!=null">
				and t1.create_timestamp between #{create_timestamp} and
				#{create_timestamp1}
			</if>
			<if test="create_user_id != null">
				and t1.create_user_id = #{create_user_id}
			</if>
			<if test="cre_type !=null">
				and t1.cre_type = #{cre_type}
			</if>
		</where>
		<if test="sortname!=null and sortorder!=null">
			order by ${sortname} ${sortorder}
		</if>
	</select>
	<!-- 贷前退回查询列表分页 -->
	<select id="getLoanBeforeReturnListWithPaging" parameterType="map" resultType="java.util.HashMap">
		select
		t1.wms_cre_credit_head_id,
		t1.bill_code,
		t1.credit_purpose,
		t1.max_repayment_limit_per_month,
		t1.credit_limit,
		t1.max_repayment_time_limit,
		t1.enter_file_way,
		t1.payroll_payment_way,
		t1.data_type,
		t1.is_complete,
		t1.reference_type,
		t1.is_other_corporation_done,
		t1.is_to_public_stream,
		t1.is_house_certificate_original,
		t1.is_check,
		t1.person_condition,
		t1.salesman_id,
		t1.salesman_code,
		t1.salesman_name,
		t1.city,
		t1.cre_type,
		(case t1.cre_type when '1' then '信贷产品' when '2' then '房贷产品' end) as
		cre_type_name,
		t1.bill_status,
		(select value_meaning from wms_sys_dict_data where value_code = bill_status
		and wms_sys_dict_id = 24)as bill_status_name,
		t1.water_appro_user_id,
		t1.water_appro_user_name,
		date_format(t1.water_appro_timestamp,'%Y-%m-%d %H:%i:%s') as water_appro_timestamp,
		t1.water_appro_result,
		t1.info_appro_user_id,
		t1.info_appro_user_name,
		date_format(t1.info_appro_timestamp,'%Y-%m-%d %H:%i:%s') as info_appro_timestamp,
		t1.info_appro_result,
		t1.phone_appro_user_id,
		t1.phone_appro_user_name,
		date_format(t1.phone_appro_timestamp,'%Y-%m-%d %H:%i:%s')as phone_appro_timestamp,
		t1.phone_appro_result,
		t1.certificate_appro_user_id,
		t1.certificate_appro_user_name,

		date_format(t1.certificate_appro_timestamp,'%Y-%m-%d %H:%i:%s') as certificate_appro_timestamp,
		t1.certificate_appro_result,

		t1.create_user_id,
		t1.create_user_name,
		date_format(t1.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t1.last_update_user_id,
		date_format(t1.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as
		last_update_timestamp,
		t1.enable_flag,
		t1.is_link_repeat,
		t1.profession_type,
		t1.is_verify,
		t1.house_appro_result,
		t1.cre_loan_type,
		t1.loan_interest_rate,
		t1.check_back_remark,
		t2.wms_cre_credit_line_customer_change_head_id,
		t2.wms_cre_credit_head_id,
		t2.wms_cus_customer_head_id,
		t2.customer_code,
		t2.customer_name,
		t2.customer_ever_name,
		t2.customer_category,
		t2.gender,
		t2.max_degree,
		date_format(t2.birthday,'%Y-%m-%d') as birthday,
		t2.id_card,
		t2.province,
		t2.city,
		t2.district,
		t2.address_more,
		t2.has_children,
		t2.children_name,
		t2.children_address,
		t2.children_telephone,
		t2.has_married,
		t2.has_house,
		t2.current_address_province,
		t2.current_address_city,
		t2.current_address_district,
		t2.current_address_more,
		t2.post_code,
		t2.fixed_telephone,
		t2.mobile_telephone1,
		t2.service_password1,
		t2.mobile_telephone2,
		t2.service_password2,
		t2.personal_year_income,
		t2.customer_email,
		t2.credit_card_limit,
		t2.common_occupants,
		t2.status,
		t2.create_user_id,
		t2.create_user_name,
		date_format(t2.create_timestamp,'%Y-%m-%d %H:%i:%s') as
		create_timestamp,
		t2.last_update_user_id,
		date_format(t2.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
		t2.enable_flag,
		t1.salesman_shortcode,
		<!--房贷流程版本号 1为老流程 2为新流程 -->
		(case when t1.create_timestamp &lt; #{hprocess_time} then '1' else '2' end) as edition_num,
		t1.version_number,
		CONCAT(t1.salesman_name,"/",t1.salesman_shortcode) as salesman_name_str
		from wms_cre_credit_head t1,wms_cre_credit_line_customer_change_head t2
		<where>
			t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id and
			t2.is_major='1'
			and t1.is_review_back='1'
			<if test="id_card != null">
				and t2.id_card = #{id_card}
			</if>
			<if test="idList !=null">
				and t1.wms_cre_credit_head_id in
				<foreach collection="idList" item="wms_cre_credit_head_id" index="index" open="(" separator="," close=")">
					#{wms_cre_credit_head_id}
				</foreach>
			</if>
			and t1.enable_flag='1'
			<if test="bill_code != null">
				and t1.bill_code like '${bill_code}'
			</if>
			<if test="bill_status!= null">
				and t1.bill_status=#{bill_status}
			</if>
			<if test="salesman_name!=null or salesman_shortcode !=null">
				and (t1.salesman_name like #{salesman_name} or
				t1.salesman_shortcode like '${salesman_shortcode}')
			</if>
			<if test="customer_name != null">
				and t2.customer_name like '${customer_name}'
			</if>
			<if test="mobile_telephone != null">
				and (t2.mobile_telephone1 like '${mobile_telephone}' or
				t2.mobile_telephone2 like '${mobile_telephone}')
			</if>
			<if test="create_timestamp != null and create_timestamp1!=null">
				and t1.create_timestamp between #{create_timestamp} and
				#{create_timestamp1}
			</if>
			<if test="create_user_id != null">
				and t1.create_user_id = #{create_user_id}
			</if>
			<if test="cre_type !=null">
				and t1.cre_type = #{cre_type}
			</if>
		</where>
		<if test="sortname != null and sortorder !=null">
			ORDER BY ${sortname} ${sortorder}
		</if>
		<if test="offset != null and pagesize !=null">
			LIMIT ${offset} , ${pagesize}
		</if>
	</select>
	<!-- 查询贷前退回数据条数，直接返回int类型条数 -->
	<select id="findCountForLoanBeforeReturn" parameterType="map" resultType="int">
		select count(t1.wms_cre_credit_head_id) as count
		from
		wms_cre_credit_head t1,wms_cre_credit_line_customer_change_head t2
		<where>
			t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id and
			t2.is_major='1'
			and t1.is_review_back='1'
			<if test="id_card != null">
				and t2.id_card = #{id_card}
			</if>
			<if test="idList !=null">
				and t1.wms_cre_credit_head_id in
				<foreach collection="idList" item="wms_cre_credit_head_id" index="index" open="(" separator="," close=")">
					#{wms_cre_credit_head_id}
				</foreach>
			</if>
			and t1.enable_flag='1'
			<if test="bill_code != null">
				and t1.bill_code like '${bill_code}'
			</if>
			<if test="bill_status!= null">
				and t1.bill_status=#{bill_status}
			</if>
			<if test="salesman_name!=null or salesman_shortcode !=null">
				and (t1.salesman_name like #{salesman_name} or
				t1.salesman_shortcode like '${salesman_shortcode}')
			</if>
			<if test="create_timestamp != null and create_timestamp1!=null">
				and t1.create_timestamp between #{create_timestamp} and
				#{create_timestamp1}
			</if>
			<if test="create_user_id != null">
				and t1.create_user_id = #{create_user_id}
			</if>
			<if test="cre_type !=null">
				and t1.cre_type = #{cre_type}
			</if>
		</where>
	</select>
	<!-- 更新模型 -->
	<update id="updateModel" parameterType="map">
		update wms_cre_credit_head
		<set>
			<if test="model_one_amount != null">
				model_one_amount=#{model_one_amount},
			</if>
			<if test="model_two_amount != null">
				model_two_amount=#{model_two_amount},
			</if>
			<if test="model_three_amount != null">
				model_three_amount=#{model_three_amount},
			</if>
			<if test="model_four_amount != null">
				model_four_amount=#{model_four_amount},
			</if>

		</set>
		where wms_cre_credit_head_id = #{wms_cre_credit_head_id}
	</update>
	<!-- 房贷复核查询列表 -->
	<select id="recheckForHouse" parameterType="map" resultType="java.util.HashMap">
		select
		t1.wms_cre_credit_head_id,
		t1.bill_code,
		t1.credit_purpose,
		t1.max_repayment_limit_per_month,
		t1.credit_limit,
		t1.max_repayment_time_limit,
		t1.enter_file_way,
		t1.payroll_payment_way,
		t1.data_type,
		t1.is_complete,
		t1.reference_type,
		t1.is_other_corporation_done,
		t1.is_to_public_stream,
		t1.is_house_certificate_original,
		t1.is_check,
		t1.person_condition,
		t1.salesman_id,
		t1.salesman_code,
		t1.salesman_name,
		t1.city,
		t1.cre_type,
		(case t1.cre_type when '1' then '信贷产品' when '2' then '房贷产品' end) as
		cre_type_name,
		t1.bill_status,
		(select value_meaning from wms_sys_dict_data where value_code = bill_status
		and wms_sys_dict_id = 24)as bill_status_name,
		t1.water_appro_user_id,
		t1.water_appro_user_name,
		date_format(t1.water_appro_timestamp,'%Y-%m-%d %H:%i:%s') as water_appro_timestamp,
		t1.water_appro_result,
		t1.info_appro_user_id,
		t1.info_appro_user_name,
		date_format(t1.info_appro_timestamp,'%Y-%m-%d %H:%i:%s') as info_appro_timestamp,
		t1.info_appro_result,
		t1.phone_appro_user_id,
		t1.phone_appro_user_name,
		date_format(t1.phone_appro_timestamp,'%Y-%m-%d %H:%i:%s')as phone_appro_timestamp,
		t1.phone_appro_result,
		t1.certificate_appro_user_id,
		t1.certificate_appro_user_name,
		date_format(t1.certificate_appro_timestamp,'%Y-%m-%d %H:%i:%s') as certificate_appro_timestamp,
		t1.certificate_appro_result,
		t1.create_user_id,
		t1.create_user_name,
		date_format(t1.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t1.last_update_user_id,
		date_format(t1.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as
		last_update_timestamp,
		t1.enable_flag,
		t1.is_link_repeat,
		t1.profession_type,
		t1.is_verify,
		t1.house_appro_result,
		t1.cre_loan_type,
		t1.loan_interest_rate,
		t2.wms_cre_credit_line_customer_change_head_id,
		t2.wms_cre_credit_head_id,
		t2.wms_cus_customer_head_id,
		t2.customer_code,
		t2.customer_name,
		t2.customer_ever_name,
		t2.customer_category,
		t2.gender,
		t2.max_degree,
		date_format(t2.birthday,'%Y-%m-%d') as birthday,
		t2.id_card,
		t2.province,
		t2.city,
		t2.district,
		t2.address_more,
		t2.has_children,
		t2.children_name,
		t2.children_address,
		t2.children_telephone,
		t2.has_married,
		t2.has_house,
		t2.current_address_province,
		t2.current_address_city,
		t2.current_address_district,
		t2.current_address_more,
		t2.post_code,
		t2.fixed_telephone,
		t2.mobile_telephone1,
		t2.service_password1,
		t2.mobile_telephone2,
		t2.service_password2,
		t2.personal_year_income,
		t2.customer_email,
		t2.credit_card_limit,
		t2.common_occupants,
		t2.status,
		t2.create_user_id,
		t2.create_user_name,
		date_format(t2.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t2.last_update_user_id,
		date_format(t2.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
		t2.enable_flag,
		t1.is_review_back,
		t1.water_appro_result_page,
		t1.info_appro_result_page,
		t1.phone_appro_result_page,
		t1.certificate_appro_result_page,
		t1.inspection_appro_user_id,
		t1.inspection_appro_user_name,
		t1.inspection_appro_timestamp,
		t1.inspection_appro_result,
		t1.inspection_appro_advice,
		t1.inspection_appro_result_page,
		t1.create_user_city_code,
		t1.salesman_shortcode,
		<!--房贷流程版本号 1为老流程 2为新流程 -->
		(case when t1.create_timestamp &lt; #{hprocess_time} then '1' else '2' end) as edition_num,
		t1.version_number,
		CONCAT(t1.salesman_name,"/",t1.salesman_shortcode) as salesman_name_str
		from wms_cre_credit_head t1 left join
		wms_cre_credit_line_customer_change_head t2
		on t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id and
		t2.is_major='1'

		<where>
			and t1.create_user_city_code = #{create_user_city_code}
			<if test="customer_name != null">
				and t2.customer_name like '${customer_name}'
			</if>
			<if test="mobile_telephone != null">
				and (t2.mobile_telephone1 like '${mobile_telephone}' or
				t2.mobile_telephone2 like '${mobile_telephone}')
			</if>
			<if test="id_card != null">
				and t2.id_card = #{id_card}
			</if>
			<if test="idList !=null">
				and t1.wms_cre_credit_head_id in
				<foreach collection="idList" item="wms_cre_credit_head_id" index="index" open="(" separator="," close=")">
					#{wms_cre_credit_head_id}
				</foreach>
			</if>
			and t1.enable_flag='1'
			<if test="bill_code != null">
				and t1.bill_code like '${bill_code}'
			</if>
			<if test="bill_status!= null">
				and t1.bill_status=#{bill_status}
			</if>
			<if test="salesman_name != null or salesman_shortcode!=null">
				and (t1.salesman_name like '${salesman_name}' or
				t1.salesman_shortcode like '${salesman_shortcode}')
			</if>
			<if test="create_timestamp != null and create_timestamp1!=null">
				and t1.create_timestamp between #{create_timestamp} and
				#{create_timestamp1}
			</if>
			<if test="create_user_id != null">
				and t1.create_user_id != #{create_user_id}
			</if>
			<if test="cre_type !=null">
				and t1.cre_type = #{cre_type}
			</if>
		</where>
		<if test="sortname != null and sortorder !=null">
			ORDER BY ${sortname} ${sortorder}
		</if>
		<if test="offset != null and pagesize !=null">
			LIMIT ${offset} , ${pagesize}
		</if>
	</select>



	<!-- 查询信息完善数据条数，直接返回int类型条数 -->
	<select id="findCountRecheck0" parameterType="map" resultType="int">
		select count(t1.wms_cre_credit_head_id) as count
		from
		wms_cre_credit_head t1 left join
		wms_cre_credit_line_customer_change_head t2
		on
		t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id and
		t2.is_major='1'

		<where>
			and t1.create_user_city_code = #{create_user_city_code}
			<if test="id_card != null">
				and t2.id_card = #{id_card}
			</if>
			<if test="idList !=null">
				and t1.wms_cre_credit_head_id in
				<foreach collection="idList" item="wms_cre_credit_head_id" index="index" open="(" separator="," close=")">
					#{wms_cre_credit_head_id}
				</foreach>
			</if>
			and t1.enable_flag='1'
			<if test="bill_code != null">
				and t1.bill_code like '${bill_code}'
			</if>
			<if test="bill_status!= null">
				and t1.bill_status=#{bill_status}
			</if>
			<if test="salesman_name != null">
				and t1.salesman_name like '${salesman_name}'
			</if>
			<if test="salesman_shortcode!=null">
				and t1.salesman_shortcode like '${salesman_shortcode}'
			</if>
			<if test="create_timestamp != null and create_timestamp1!=null">
				and t1.create_timestamp between #{create_timestamp} and
				#{create_timestamp1}
			</if>
			<if test="create_user_id != null">
				and t1.create_user_id != #{create_user_id}
			</if>
			<if test="cre_type !=null">
				and t1.cre_type = #{cre_type}
			</if>
		</where>
	</select>
	<!-- 房贷完善信息列表导出 -->
	<select id="recheckForHouseWithout" parameterType="map" resultType="java.util.HashMap">
		select
		t1.wms_cre_credit_head_id,
		t1.bill_code,
		t1.credit_purpose,
		t1.max_repayment_limit_per_month,
		t1.credit_limit,
		t1.max_repayment_time_limit,
		t1.enter_file_way,
		t1.payroll_payment_way,
		t1.data_type,
		t1.is_complete,
		t1.reference_type,
		t1.is_other_corporation_done,
		t1.is_to_public_stream,
		t1.is_house_certificate_original,
		t1.is_check,
		t1.person_condition,
		t1.salesman_id,
		t1.salesman_code,
		t1.salesman_name,
		t1.city,
		t1.cre_type,
		(case t1.cre_type when '1' then '信贷产品' when '2' then '房贷产品' end) as
		cre_type_name,
		t1.bill_status,
		(select value_meaning from wms_sys_dict_data where value_code = bill_status
		and wms_sys_dict_id = 24)as bill_status_name,
		t1.water_appro_user_id,
		t1.water_appro_user_name,
		date_format(t1.water_appro_timestamp,'%Y-%m-%d %H:%i:%s') as water_appro_timestamp,
		t1.water_appro_result,
		t1.info_appro_user_id,
		t1.info_appro_user_name,
		date_format(t1.info_appro_timestamp,'%Y-%m-%d %H:%i:%s') as info_appro_timestamp,
		t1.info_appro_result,
		t1.phone_appro_user_id,
		t1.phone_appro_user_name,
		date_format(t1.phone_appro_timestamp,'%Y-%m-%d %H:%i:%s')as phone_appro_timestamp,
		t1.phone_appro_result,
		t1.certificate_appro_user_id,
		t1.certificate_appro_user_name,

		date_format(t1.certificate_appro_timestamp,'%Y-%m-%d %H:%i:%s') as certificate_appro_timestamp,
		t1.certificate_appro_result,

		t1.create_user_id,
		t1.create_user_name,
		date_format(t1.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t1.last_update_user_id,
		date_format(t1.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as
		last_update_timestamp,
		t1.enable_flag,
		t1.is_link_repeat,
		t1.profession_type,
		t1.is_verify,
		t1.cre_loan_type,
		t1.loan_interest_rate,
		t2.wms_cre_credit_line_customer_change_head_id,
		t2.wms_cre_credit_head_id,
		t2.wms_cus_customer_head_id,
		t2.customer_code,
		t2.customer_name,
		t2.customer_ever_name,
		t2.customer_category,
		t2.gender,
		t2.max_degree,
		date_format(t2.birthday,'%Y-%m-%d') as birthday,
		t2.id_card,
		t2.province,
		t2.city,
		t2.district,
		t2.address_more,
		t2.has_children,
		t2.children_name,
		t2.children_address,
		t2.children_telephone,
		t2.has_married,
		t2.has_house,
		t2.current_address_province,
		t2.current_address_city,
		t2.current_address_district,
		t2.current_address_more,
		t2.post_code,
		t2.fixed_telephone,
		t2.mobile_telephone1,
		t2.service_password1,
		t2.mobile_telephone2,
		t2.service_password2,
		t2.personal_year_income,
		t2.customer_email,
		t2.credit_card_limit,
		t2.common_occupants,
		t2.status,
		t2.create_user_id,
		t2.create_user_name,
		date_format(t2.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t2.last_update_user_id,
		date_format(t2.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
		t2.enable_flag,
		t1.create_user_city_code,
		t1.salesman_shortcode,
		CONCAT(t1.salesman_name,"/",t1.salesman_shortcode) as salesman_name_str
		from wms_cre_credit_head t1,wms_cre_credit_line_customer_change_head t2
		<where>
			t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id and
			t2.is_major='1'
			and t1.create_user_city_code = #{create_user_city_code}
			<if test="id_card != null">
				and t2.id_card =#{id_card}
			</if>
			<if test="idList !=null">
				and t1.wms_cre_credit_head_id in
				<foreach collection="idList" item="wms_cre_credit_head_id" index="index" open="(" separator="," close=")">
					#{wms_cre_credit_head_id}
				</foreach>
			</if>
			and t1.enable_flag=1
			<if test="bill_code != null">
				and t1.bill_code like '${bill_code}'
			</if>
			<if test="salesman_name != null or salesman_shortcode !=null">
				and (t1.salesman_name like '${salesman_name}' or
				t1.salesman_shortcode like '${salesman_shortcode}')
			</if>
			<if test="create_timestamp!=null and create_timestamp1!=null">
				and t1.create_timestamp between #{create_timestamp} and
				#{create_timestamp1}
			</if>
			<if test="create_user_id != null">
				and t1.create_user_id != #{create_user_id}
			</if>
			<if test="cre_type !=null">
				and t1.cre_type = #{cre_type}
			</if>
		</where>
		<if test="sortname != null and sortorder !=null">
			ORDER BY ${sortname} ${sortorder}
		</if>
	</select>
	<!-- 房贷办件列表查询页面数据显示 -->
	<select id="searchForFdForBJ" parameterType="map" resultType="java.util.HashMap">
		select
		t1.wms_cre_credit_head_id,
		t1.bill_code,
		t1.credit_purpose,
		t1.max_repayment_limit_per_month,
		t1.credit_limit,
		t1.max_repayment_time_limit,
		t1.enter_file_way,
		t1.payroll_payment_way,
		t1.data_type,
		t1.is_complete,
		t1.reference_type,
		t1.is_other_corporation_done,
		t1.is_to_public_stream,
		t1.is_house_certificate_original,
		t1.is_check,
		t1.person_condition,
		t1.salesman_id,
		t1.salesman_code,
		t1.salesman_name,
		t1.city,
		t1.cre_type,
		t1.bill_status,
		(select value_meaning from wms_sys_dict_data where value_code =
		bill_status
		and wms_sys_dict_id = 24)as bill_status_name,
		t1.water_appro_user_id,
		t1.water_appro_user_name,
		date_format(t1.water_appro_timestamp,'%Y-%m-%d %H:%i:%s') as water_appro_timestamp,
		t1.water_appro_result,
		t1.info_appro_user_id,
		t1.info_appro_user_name,
		date_format(t1.info_appro_timestamp,'%Y-%m-%d %H:%i:%s') as info_appro_timestamp,
		t1.info_appro_result,
		t1.phone_appro_user_id,
		t1.phone_appro_user_name,
		date_format(t1.phone_appro_timestamp,'%Y-%m-%d %H:%i:%s')as phone_appro_timestamp,
		t1.phone_appro_result,
		t1.certificate_appro_user_id,
		t1.certificate_appro_user_name,

		date_format(t1.certificate_appro_timestamp,'%Y-%m-%d %H:%i:%s') as certificate_appro_timestamp,
		t1.certificate_appro_result,

		t1.create_user_id,
		t1.create_user_name,
		date_format(t1.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t1.last_update_user_id,
		date_format(t1.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
		t1.enable_flag,
		t1.is_link_repeat,
		t1.profession_type,
		t1.is_verify,
		t1.house_appro_result,
		t1.cre_loan_type,
		t1.loan_interest_rate,
		t2.wms_cre_credit_line_customer_change_head_id,
		t2.wms_cre_credit_head_id,
		t2.wms_cus_customer_head_id,
		t2.customer_code,
		t2.customer_name,
		t2.customer_ever_name,
		t2.customer_category,
		t2.gender,
		t2.max_degree,
		date_format(t2.birthday,'%Y-%m-%d') as birthday,
		t2.id_card,
		t2.province,
		t2.city,
		t2.district,
		t2.address_more,
		t2.has_children,
		t2.children_name,
		t2.children_address,
		t2.children_telephone,
		t2.has_married,
		t2.has_house,
		t2.current_address_province,
		t2.current_address_city,
		t2.current_address_district,
		t2.current_address_more,
		t2.post_code,
		t2.fixed_telephone,
		t2.mobile_telephone1,
		t2.service_password1,
		t2.mobile_telephone2,
		t2.service_password2,
		t2.personal_year_income,
		t2.customer_email,
		t2.credit_card_limit,
		t2.common_occupants,
		t2.status,
		t2.create_user_id,
		t2.create_user_name,
		date_format(t2.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t2.last_update_user_id,
		date_format(t2.last_update_timestamp,'%Y-%m-%d
		%H:%i:%s') as last_update_timestamp,
		t2.enable_flag,
		t1.is_review_back,
		t1.water_appro_result_page,
		t1.info_appro_result_page,
		t1.phone_appro_result_page,
		t1.certificate_appro_result_page,
		t1.house_appro_result_page,
		t1.salesman_shortcode,
		t1.create_user_city_code,
		CONCAT(t1.salesman_name,"/",t1.salesman_shortcode) as salesman_name_str
		from wms_cre_credit_head t1,wms_cre_credit_line_customer_change_head t2
		<where>
			t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id and
			t2.is_major='1' and t1.cre_type='2'
			and t1.create_user_city_code =#{create_user_city_code}
			<if test="id_card != null">
				and t2.id_card = #{id_card}
			</if>
			<if test="idList !=null">
				and t1.wms_cre_credit_head_id in
				<foreach collection="idList" item="wms_cre_credit_head_id" index="index" open="(" separator="," close=")">
					#{wms_cre_credit_head_id}
				</foreach>
			</if>
			and t1.enable_flag='1'
			<if test="bill_code != null">
				and t1.bill_code like '${bill_code}'
			</if>
			<if test="customer_name != null">
				and t2.customer_name like '${customer_name}'
			</if>
			<if test="create_user_id != null">
				and t1.create_user_id != #{create_user_id}
			</if>
			<if test="mobile_telephone != null">
				and (t2.mobile_telephone1 like '${mobile_telephone}' or
				t2.mobile_telephone2 like '${mobile_telephone}')
			</if>
		</where>
		<if test="sortname != null and sortorder !=null">
			ORDER BY ${sortname} ${sortorder}
		</if>
		<if test="offset != null and pagesize !=null">
			LIMIT ${offset} , ${pagesize}
		</if>
	</select>
	<!-- 房贷办件导出列表显示 -->
	<select id="getBjListWithoutPagingForFd" parameterType="map" resultType="java.util.HashMap">
		select
		t1.wms_cre_credit_head_id,
		t1.bill_code,
		t1.credit_purpose,
		t1.max_repayment_limit_per_month,
		t1.credit_limit,
		t1.max_repayment_time_limit,
		t1.enter_file_way,
		t1.payroll_payment_way,
		t1.data_type,
		t1.is_complete,
		t1.reference_type,
		t1.is_other_corporation_done,
		t1.is_to_public_stream,
		t1.is_house_certificate_original,
		t1.is_check,
		t1.person_condition,
		t1.salesman_id,
		t1.salesman_code,
		t1.salesman_name,
		t1.city,
		t1.cre_type,
		t1.bill_status,
		(select value_meaning from wms_sys_dict_data where value_code =
		bill_status
		and wms_sys_dict_id = 24)as bill_status_name,
		t1.water_appro_user_id,
		t1.water_appro_user_name,
		date_format(t1.water_appro_timestamp,'%Y-%m-%d %H:%i:%s') as water_appro_timestamp,
		t1.water_appro_result,
		(case t1.water_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略' else
		'待审批' end)as water_appro_result_name,
		t1.info_appro_user_id,
		t1.info_appro_user_name,
		date_format(t1.info_appro_timestamp,'%Y-%m-%d %H:%i:%s') as info_appro_timestamp,
		t1.info_appro_result,
		(case
		t1.info_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略' else
		'待审批' end)as info_appro_result_name,
		t1.phone_appro_user_id,
		t1.phone_appro_user_name,
		date_format(t1.phone_appro_timestamp,'%Y-%m-%d %H:%i:%s')as phone_appro_timestamp,
		t1.phone_appro_result,
		(case t1.phone_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略' else
		'待审批' end)as phone_appro_result_name,
		t1.certificate_appro_user_id,
		t1.certificate_appro_user_name,
		date_format(t1.certificate_appro_timestamp,'%Y-%m-%d %H:%i:%s') as certificate_appro_timestamp,
		t1.certificate_appro_result,
		(case t1.certificate_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略'
		else '待审批' end)as certificate_appro_result_name,
		t1.create_user_id,
		t1.create_user_name,
		date_format(t1.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t1.last_update_user_id,
		date_format(t1.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
		t1.enable_flag,
		t1.cre_loan_type,
		t1.loan_interest_rate,
		t2.wms_cre_credit_line_customer_change_head_id,
		t2.wms_cre_credit_head_id,
		t2.wms_cus_customer_head_id,
		t2.customer_code,
		t2.customer_name,
		t2.customer_ever_name,
		t2.customer_category,
		t2.gender,
		t2.max_degree,
		date_format(t2.birthday,'%Y-%m-%d') as birthday,
		t2.id_card,
		t2.province,
		t2.city,
		t2.district,
		t2.address_more,
		t2.has_children,
		t2.children_name,
		t2.children_address,
		t2.children_telephone,
		t2.has_married,
		t2.has_house,
		t2.current_address_province,
		t2.current_address_city,
		t2.current_address_district,
		t2.current_address_more,
		t2.post_code,
		t2.fixed_telephone,
		t2.mobile_telephone1,
		t2.service_password1,
		t2.mobile_telephone2,
		t2.service_password2,
		t2.personal_year_income,
		t2.customer_email,
		t2.credit_card_limit,
		t2.common_occupants,
		t2.status,
		t2.create_user_id,
		t2.create_user_name,
		date_format(t2.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t2.last_update_user_id,
		date_format(t2.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as
		last_update_timestamp,
		t2.enable_flag,
		t1.salesman_shortcode,
		t1.create_user_city_code,
		CONCAT(t1.salesman_name,"/",t1.salesman_shortcode) as salesman_name_str
		from wms_cre_credit_head t1,wms_cre_credit_line_customer_change_head t2
		<where>
			t1.wms_cre_credit_head_id = t2.wms_cre_credit_head_id and
			t2.is_major='1'and t1.cre_type='2'
			and t1.create_user_city_code
			=#{create_user_city_code}
			<if test="bill_code != null">
				and t1.bill_code like '${bill_code}'
			</if>
			<if test="idList !=null">
				and t1.wms_cre_credit_head_id in
				<foreach collection="idList" item="wms_cre_credit_head_id" index="index" open="(" separator="," close=")">
					#{wms_cre_credit_head_id}
				</foreach>
			</if>
			<if test="customer_name != null">
				and t2.customer_name like '${customer_name}'
			</if>
			<if test="create_user_id != null">
				and t1.create_user_id != #{create_user_id}
			</if>
			<if test="id_card != null">
				and t2.id_card = #{id_card}
			</if>
			<if test="mobile_telephone != null">
				and (t2.mobile_telephone1 like '${mobile_telephone}' or
				t2.mobile_telephone2 like '${mobile_telephone}')
			</if>
		</where>
		<if test="sortname != null and sortorder !=null">
			ORDER BY ${sortname} ${sortorder}
		</if>
	</select>
	<!-- 实现房贷办件数据导出 -->
	<select id="getCardListWithoutPagingForFd" parameterType="map" resultType="java.util.HashMap">
		select
		t1.wms_cre_credit_head_id,
		t1.bill_code,
		t1.credit_purpose,
		t1.max_repayment_limit_per_month,
		t1.credit_limit,
		t1.max_repayment_time_limit,
		t1.enter_file_way,
		t1.payroll_payment_way,
		t1.data_type,
		t1.is_complete,
		t1.reference_type,
		t1.is_other_corporation_done,
		t1.is_to_public_stream,
		t1.is_house_certificate_original,
		t1.is_check,
		t1.person_condition,
		t1.salesman_id,
		t1.salesman_code,
		t1.salesman_name,
		t1.city,
		t1.cre_type,
		t1.bill_status,
		(select value_meaning from wms_sys_dict_data where value_code =
		bill_status
		and wms_sys_dict_id = 131)as bill_status_name,
		t1.water_appro_user_id,
		t1.water_appro_user_name,
		date_format(t1.water_appro_timestamp,'%Y-%m-%d %H:%i:%s') as water_appro_timestamp,
		t1.water_appro_result,
		(case t1.water_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略' else
		'待审批' end)as water_appro_result_name,
		t1.info_appro_user_id,
		t1.info_appro_user_name,
		date_format(t1.info_appro_timestamp,'%Y-%m-%d %H:%i:%s') as info_appro_timestamp,
		t1.info_appro_result,
		(case
		t1.info_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略' else
		'待审批' end)as info_appro_result_name,
		t1.phone_appro_user_id,
		t1.phone_appro_user_name,
		date_format(t1.phone_appro_timestamp,'%Y-%m-%d %H:%i:%s')as phone_appro_timestamp,
		t1.phone_appro_result,
		(case t1.phone_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略' else
		'待审批' end)as phone_appro_result_name,
		t1.certificate_appro_user_id,
		t1.certificate_appro_user_name,
		date_format(t1.certificate_appro_timestamp,'%Y-%m-%d %H:%i:%s') as certificate_appro_timestamp,
		t1.certificate_appro_result,
		(case t1.certificate_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略'
		else '待审批' end)as certificate_appro_result_name,
		t1.create_user_id,
		t1.create_user_name,
		date_format(t1.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t1.last_update_user_id,
		date_format(t1.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
		t1.enable_flag,
		t1.cre_loan_type,
		t1.loan_interest_rate,
		t2.wms_cre_credit_line_customer_change_head_id,
		t2.wms_cre_credit_head_id,
		t2.wms_cus_customer_head_id,
		t2.customer_code,
		t2.customer_name,
		t2.customer_ever_name,
		t2.customer_category,
		t2.gender,
		t2.max_degree,
		date_format(t2.birthday,'%Y-%m-%d') as birthday,
		t2.id_card,
		t2.province,
		t2.city,
		t2.district,
		t2.address_more,
		t2.has_children,
		t2.children_name,
		t2.children_address,
		t2.children_telephone,
		t2.has_married,
		t2.has_house,
		t2.current_address_province,
		t2.current_address_city,
		t2.current_address_district,
		t2.current_address_more,
		t2.post_code,
		t2.fixed_telephone,
		t2.mobile_telephone1,
		t2.service_password1,
		t2.mobile_telephone2,
		t2.service_password2,
		t2.personal_year_income,
		t2.customer_email,
		t2.credit_card_limit,
		t2.common_occupants,
		t2.status,
		t2.create_user_id,
		t2.create_user_name,
		date_format(t2.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t2.last_update_user_id,
		date_format(t2.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as
		last_update_timestamp,
		t2.enable_flag,
		t1.salesman_shortcode,
		t1.create_user_city_code,
		t1.mort_flag,
		(SELECT  value_meaning from wms_sys_dict_data  where wms_sys_dict_id=146 AND value_code=t1.mort_flag) as mort_flag_name,
		CONCAT(t1.salesman_name,"/",t1.salesman_shortcode) as salesman_name_str
		from wms_cre_credit_head t1,wms_cre_credit_line_customer_change_head t2
		<where>
			t1.wms_cre_credit_head_id = t2.wms_cre_credit_head_id and
			t2.is_major='1'and t1.cre_type='2'
			and t1.version_number='3'
			<if test="bill_code != null">
				and t1.bill_code like '${bill_code}'
			</if>
			<if test="idList !=null">
				and t1.wms_cre_credit_head_id in
				<foreach collection="idList" item="wms_cre_credit_head_id" index="index" open="(" separator="," close=")">
					#{wms_cre_credit_head_id}
				</foreach>
			</if>
			<if test="customer_name != null">
				and t2.customer_name like '${customer_name}'
			</if>
			<if test="create_user_id != null">
				and t1.create_user_id != #{create_user_id}
			</if>
			<if test="id_card != null">
				and t2.id_card = #{id_card}
			</if>
			<if test="mobile_telephone != null">
				and (t2.mobile_telephone1 like '${mobile_telephone}' or
				t2.mobile_telephone2 like '${mobile_telephone}')
			</if>
			<!-- 是办件审核组列表 -->
			<if test="bill_status != null">
				and t1.bill_status = #{bill_status}
			</if>
			<!-- 权限控制 -->
			<if test="childrendept != null">
				and (FIND_IN_SET(t1.salesman_dept_id, #{childrendept}) > 0)
			</if>
			<if test="mort_flag != null">
				and t1.mort_flag = #{mort_flag}
			</if>
		</where>
		<if test="sortname != null and sortorder !=null">
			ORDER BY ${sortname} ${sortorder}
		</if>
	</select>
	<!-- 查询车贷办件审核列表 ，返回List<Map>对象 -->
	<select id="searchForFdCardForAdd" parameterType="map" resultType="java.util.HashMap">
		select
		t1.wms_cre_credit_head_id,
		t1.bill_code,
		t1.credit_purpose,
		t1.max_repayment_limit_per_month,
		t1.credit_limit,
		t1.max_repayment_time_limit,
		t1.enter_file_way,
		t1.payroll_payment_way,
		t1.credit_limit,
		t1.data_type,
		t1.is_complete,
		t1.reference_type,
		t1.is_other_corporation_done,
		t1.is_to_public_stream,
		t1.is_house_certificate_original,
		t1.is_check,
		t1.person_condition,
		t1.salesman_id,
		t1.salesman_code,
		t1.salesman_name,
		t1.city,
		t1.cre_type,
		t1.bill_status,
		(select value_meaning from wms_sys_dict_data where
		value_code = bill_status
		and wms_sys_dict_id = 131)as bill_status_name,
		t1.water_appro_user_id,
		t1.water_appro_user_name,
		date_format(t1.water_appro_timestamp,'%Y-%m-%d %H:%i:%s') as water_appro_timestamp,
		t1.water_appro_result,
		t1.info_appro_user_id,
		t1.info_appro_user_name,
		date_format(t1.info_appro_timestamp,'%Y-%m-%d %H:%i:%s') as info_appro_timestamp,
		t1.info_appro_result,
		t1.phone_appro_user_id,
		t1.phone_appro_user_name,
		date_format(t1.phone_appro_timestamp,'%Y-%m-%d %H:%i:%s')as
		phone_appro_timestamp,
		t1.phone_appro_result,
		t1.certificate_appro_user_id,
		t1.certificate_appro_user_name,

		date_format(t1.certificate_appro_timestamp,'%Y-%m-%d %H:%i:%s') as certificate_appro_timestamp,
		t1.certificate_appro_result,

		t1.create_user_id,
		t1.create_user_name,
		date_format(t1.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t1.last_update_user_id,
		date_format(t1.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
		t1.enable_flag,
		t1.is_link_repeat,
		t1.profession_type,
		t1.is_verify,
		t1.house_appro_result,
		t1.cre_loan_type,
		(select value_meaning from wms_sys_dict_data where value_code = t1.cre_loan_type
		and wms_sys_dict_id = 75)as cre_loan_type_name,
		t1.loan_interest_rate,
		t2.wms_cre_credit_line_customer_change_head_id,
		t2.wms_cre_credit_head_id,
		t2.wms_cus_customer_head_id,
		t2.customer_code,
		t2.customer_name,
		t2.customer_ever_name,
		t2.customer_category,
		t2.gender,
		t2.max_degree,
		date_format(t2.birthday,'%Y-%m-%d') as birthday,
		t2.id_card,
		t2.province,
		t2.city,
		t2.district,
		t2.address_more,
		t2.has_children,
		t2.children_name,
		t2.children_address,
		t2.children_telephone,
		t2.has_married,
		t2.has_house,
		t2.current_address_province,
		t2.current_address_city,
		t2.current_address_district,
		t2.current_address_more,
		t2.post_code,
		t2.fixed_telephone,
		t2.mobile_telephone1,
		t2.service_password1,
		t2.mobile_telephone2,
		t2.service_password2,
		t2.personal_year_income,
		t2.customer_email,
		t2.credit_card_limit,
		t2.common_occupants,
		t2.status,
		t2.create_user_id,
		t2.create_user_name,
		date_format(t2.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t2.last_update_user_id,
		date_format(t2.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
		t2.enable_flag,
		t1.is_review_back,
		t1.water_appro_result_page,
		t1.info_appro_result_page,
		t1.phone_appro_result_page,
		t1.certificate_appro_result_page,
		t1.house_appro_result_page,
		t1.salesman_shortcode,
		t1.create_user_city_code,
		t1.version_number,
		t1.mort_flag,
		(SELECT  value_meaning from wms_sys_dict_data  where wms_sys_dict_id=146 AND value_code=t1.mort_flag) as mort_flag_name,	
		CONCAT(t1.salesman_name,"/",t1.salesman_shortcode) as salesman_name_str
		from
		wms_cre_credit_head t1,wms_cre_credit_line_customer_change_head t2
		<where>
			t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id
			and t2.is_major='1'
			and t1.cre_type='2'
			and t1.version_number='3'
			and t1.enable_flag='1'
			<if test="create_user_city_code != null">
				and t1.create_user_city_code = #{create_user_city_code}
			</if>
			<if test="id_card != null">
				and t2.id_card = #{id_card}
			</if>
			<if test="idList !=null">
				and t1.wms_cre_credit_head_id in
				<foreach collection="idList" item="wms_cre_credit_head_id" index="index" open="(" separator="," close=")">
					#{wms_cre_credit_head_id}
				</foreach>
			</if>

			<if test="bill_code != null">
				and t1.bill_code like '${bill_code}'
			</if>
			<if test="customer_name != null">
				and t2.customer_name like '${customer_name}'
			</if>
			<if test="create_user_id != null">
				and t1.create_user_id != #{create_user_id}
			</if>
			<if test="mobile_telephone != null">
				and (t2.mobile_telephone1 like '${mobile_telephone}' or
				t2.mobile_telephone2 like '${mobile_telephone}')
			</if>
			<!-- 是办件审核组列表 -->
			<if test="bill_status != null">
				and t1.bill_status = #{bill_status}
			</if>
			<!-- 权限控制 -->
			<if test="childrendept != null">
				and (FIND_IN_SET(t1.salesman_dept_id, #{childrendept}) > 0)
			</if>
			<if test="mort_flag != null">
				and t1.mort_flag = #{mort_flag}
			</if>
		</where>
		<if test="sortname != null and sortorder !=null">
			ORDER BY ${sortname} ${sortorder}
		</if>
		<if test="offset != null and pagesize !=null">
			LIMIT ${offset} , ${pagesize}
		</if>
	</select>
	<!-- 查询数据条数，直接返回int类型条数 -->
	<select id="findCountForFdCardForAdd" parameterType="map" resultType="int">
		select count(t1.wms_cre_credit_head_id) as count
		from
		wms_cre_credit_head t1,wms_cre_credit_line_customer_change_head t2
		<where>
			t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id and
			t2.is_major='1' and t1.cre_type='2'
			and t1.version_number='3'
			<if test="create_user_city_code != null">
				and t1.create_user_city_code = #{create_user_city_code}
			</if>
			<if test="id_card != null">
				and t2.id_card = #{id_card}
			</if>
			<if test="idList !=null">
				and t1.wms_cre_credit_head_id in
				<foreach collection="idList" item="wms_cre_credit_head_id" index="index" open="(" separator="," close=")">
					#{wms_cre_credit_head_id}
				</foreach>
			</if>
			and t1.enable_flag='1'
			<if test="bill_code != null">
				and t1.bill_code like '${bill_code}'
			</if>
			<if test="customer_name != null">
				and t2.customer_name like '${customer_name}'
			</if>
			<if test="create_user_id != null">
				and t1.create_user_id != #{create_user_id}
			</if>
			<if test="mobile_telephone != null">
				and (t2.mobile_telephone1 like '${mobile_telephone}' or
				t2.mobile_telephone2 like '${mobile_telephone}')
			</if>
			<!-- 是办件审核组列表 -->
			<if test="bill_status != null">
				and t1.bill_status = #{bill_status}
			</if>
			<!-- 权限控制 -->
			<if test="childrendept != null">
				and (FIND_IN_SET(t1.salesman_dept_id, #{childrendept}) > 0)
			</if>
			<if test="mort_flag != null">
				and t1.mort_flag = #{mort_flag}
			</if>
		</where>
	</select>
	<!-- 实现信贷验点审核导出 -->
	<select id="getYdListWithoutPaging" parameterType="map" resultType="java.util.HashMap">
		select
		t1.wms_cre_credit_head_id,
		t1.bill_code,
		t1.credit_purpose,
		t1.max_repayment_limit_per_month,
		t1.credit_limit,
		t1.max_repayment_time_limit,
		t1.enter_file_way,
		t1.payroll_payment_way,
		t1.data_type,
		t1.is_complete,
		t1.reference_type,
		t1.is_other_corporation_done,
		t1.is_to_public_stream,
		t1.is_house_certificate_original,
		t1.is_check,
		t1.person_condition,
		t1.salesman_id,
		t1.salesman_code,
		t1.salesman_name,
		t1.city,
		t1.cre_type,
		t1.bill_status,
		(select value_meaning from wms_sys_dict_data where value_code =
		bill_status
		and wms_sys_dict_id = 24)as bill_status_name,
		t1.water_appro_user_id,
		t1.water_appro_user_name,
		date_format(t1.water_appro_timestamp,'%Y-%m-%d %H:%i:%s') as water_appro_timestamp,
		t1.water_appro_result,
		(case t1.water_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略' else
		'待审批' end)as water_appro_result_name,
		t1.info_appro_user_id,
		t1.info_appro_user_name,
		date_format(t1.info_appro_timestamp,'%Y-%m-%d %H:%i:%s') as info_appro_timestamp,
		t1.info_appro_result,
		(case
		t1.info_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略' else
		'待审批' end)as info_appro_result_name,
		t1.phone_appro_user_id,
		t1.phone_appro_user_name,
		date_format(t1.phone_appro_timestamp,'%Y-%m-%d %H:%i:%s')as phone_appro_timestamp,
		t1.phone_appro_result,
		(case t1.phone_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略' else
		'待审批' end)as phone_appro_result_name,
		t1.certificate_appro_user_id,
		t1.certificate_appro_user_name,
		date_format(t1.certificate_appro_timestamp,'%Y-%m-%d %H:%i:%s') as certificate_appro_timestamp,
		t1.certificate_appro_result,
		(case t1.certificate_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略'
		else '待审批' end)as certificate_appro_result_name,
		t1.create_user_id,
		t1.create_user_name,
		date_format(t1.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t1.last_update_user_id,
		date_format(t1.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
		t1.enable_flag,
		t1.cre_loan_type,
		t1.loan_interest_rate,
		t2.wms_cre_credit_line_customer_change_head_id,
		t2.wms_cre_credit_head_id,
		t2.wms_cus_customer_head_id,
		t2.customer_code,
		t2.customer_name,
		t2.customer_ever_name,
		t2.customer_category,
		t2.gender,
		t2.max_degree,
		date_format(t2.birthday,'%Y-%m-%d') as birthday,
		t2.id_card,
		t2.province,
		t2.city,
		t2.district,
		t2.address_more,
		t2.has_children,
		t2.children_name,
		t2.children_address,
		t2.children_telephone,
		t2.has_married,
		t2.has_house,
		t2.current_address_province,
		t2.current_address_city,
		t2.current_address_district,
		t2.current_address_more,
		t2.post_code,
		t2.fixed_telephone,
		t2.mobile_telephone1,
		t2.service_password1,
		t2.mobile_telephone2,
		t2.service_password2,
		t2.personal_year_income,
		t2.customer_email,
		t2.credit_card_limit,
		t2.common_occupants,
		t2.status,
		t2.create_user_id,
		t2.create_user_name,
		date_format(t2.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t2.last_update_user_id,
		date_format(t2.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as
		last_update_timestamp,
		t2.enable_flag,
		t1.salesman_shortcode,
		CONCAT(t1.salesman_name,"/",t1.salesman_shortcode) as salesman_name_str
		from
		wms_cre_credit_head t1,wms_cre_credit_line_customer_change_head t2
		<where>
			t1.wms_cre_credit_head_id = t2.wms_cre_credit_head_id and
			t2.is_major='1' and t1.enable_flag=1 and t1.trial_interview_result=1
			and t1.create_user_city_code =#{create_user_city_code}
			<if test="idList !=null">
				and t1.wms_cre_credit_head_id in
				<foreach collection="idList" item="wms_cre_credit_head_id" index="index" open="(" separator="," close=")">
					#{wms_cre_credit_head_id}
				</foreach>
			</if>
			<if test="id_card != null">
				and t2.id_card = #{id_card}
			</if>
			<if test="bill_code != null">
				and t1.bill_code like '${bill_code}'
			</if>
			<if test="customer_name != null">
				and t2.customer_name like '${customer_name}'
			</if>
			<if test="mobile_telephone != null">
				and (t2.mobile_telephone1 like '${mobile_telephone}' or
				t2.mobile_telephone2 like '${mobile_telephone}')
			</if>
			<if test="create_user_id != null">
				and t1.create_user_id != #{create_user_id}
			</if>
			<if test="salesman_name != null or salesman_shortcode !=null">
				and (t1.salesman_name like '${salesman_name}' or
				t1.salesman_shortcode like '${salesman_shortcode}')
			</if>
			<if test="create_timestamp != null and create_timestamp1!=null">
				and t1.create_timestamp between #{create_timestamp} and
				#{create_timestamp1}
			</if>
		</where>
		<if test="sortname != null and sortorder !=null">
			ORDER BY ${sortname} ${sortorder}
		</if>
	</select>
	<!--《信贷》复议修订列表分页 -->
	<select id="getLoanReviewReturnListWithPaging" parameterType="map" resultType="java.util.HashMap">
		select
		t1.wms_cre_credit_head_id,
		t1.bill_code,
		t1.credit_purpose,
		t1.max_repayment_limit_per_month,
		t1.credit_limit,
		t1.max_repayment_time_limit,
		t1.enter_file_way,
		t1.payroll_payment_way,
		t1.data_type,
		t1.is_complete,
		t1.reference_type,
		t1.is_other_corporation_done,
		t1.is_to_public_stream,
		t1.is_house_certificate_original,
		t1.is_check,
		t1.person_condition,
		t1.salesman_id,
		t1.salesman_code,
		t1.salesman_name,
		t1.city,
		t1.cre_type,
		(case t1.cre_type when '1' then '信贷产品' when '2' then '房贷产品' end)as
		cre_type_name,
		t1.bill_status,
		(select value_meaning from wms_sys_dict_data where value_code =
		t1.bill_status and wms_sys_dict_id = 24)as bill_status_name,
		t1.water_appro_user_id,
		t1.water_appro_user_name,
		date_format(t1.water_appro_timestamp,'%Y-%m -%d %H:%i:%s') as water_appro_timestamp,
		t1.water_appro_result,
		t1.info_appro_user_id,
		t1.info_appro_user_name,
		date_format(t1.info_appro_timestamp,'%Y-%m -%d %H:%i:%s') as info_appro_timestamp,
		t1.info_appro_result,
		t1.phone_appro_user_id,
		t1.phone_appro_user_name,
		date_format(t1.phone_appro_timestamp,'%Y -%m -%d %H:%i:%s')as phone_appro_timestamp,
		t1.phone_appro_result,
		t1.certificate_appro_user_id,
		t1.certificate_appro_user_name,

		date_format(t1.certificate_appro_timestamp,'%Y -%m -%d %H:%i:%s') as certificate_appro_timestamp,
		t1.certificate_appro_result,

		t1.create_user_id,
		t1.create_user_name,
		date_format(t1.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t1.last_update_user_id,
		date_format(t1.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as
		last_update_timestamp,
		t1.enable_flag,
		t1.model_one_amount,
		t1.model_two_amount,
		t1.model_three_amount,
		t1.model_four_amount,
		t2.wms_cre_credit_line_customer_change_head_id,
		t2.wms_cre_credit_head_id,
		t2.wms_cus_customer_head_id,
		t2.customer_code,
		t2.customer_name,
		t2.customer_ever_name,
		t2.customer_category,
		t2.gender,
		t2.max_degree,
		date_format(t2.birthday,'%Y-%m-%d') as birthday,
		t2.id_card,
		t2.province,
		t2.city,
		t2.district,
		t2.address_more,
		t2.has_children,
		t2.children_name,
		t2.children_address,
		t2.children_telephone,
		t2.has_married,
		t2.has_house,
		t2.current_address_province,
		t2.current_address_city,
		t2.current_address_district,
		t2.current_address_more,
		t2.post_code,
		t2.fixed_telephone,
		t2.mobile_telephone1,
		t2.service_password1,
		t2.mobile_telephone2,
		t2.service_password2,
		t2.personal_year_income,
		t2.customer_email,
		t2.credit_card_limit,
		t2.common_occupants,
		t2.status,
		t2.create_user_id,
		t2.create_user_name,
		date_format(t2.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t2.last_update_user_id,
		date_format(t2.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
		t2.enable_flag,
		t1.inspection_appro_user_id,
		t1.inspection_appro_user_name,
		t1.inspection_appro_timestamp,
		t1.inspection_appro_result,
		t1.inspection_appro_advice,
		t1.inspection_appro_result_page,
		t1.cre_loan_type,
		t1.salesman_shortcode,
		CONCAT(t1.salesman_name,"/",t1.salesman_shortcode) as salesman_name_str,
		t1.review_the_reasons,
		t1.review_of_time,
		date_format(t1.review_of_time,'%Y-%m-%d %H:%i:%s') as review_of_time_str
		from wms_cre_credit_head
		t1,wms_cre_credit_line_customer_change_head t2
		<where>
			t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id and
			t1.enable_flag=1 and t1.bill_status=15 and t2.is_major='1'
			<if test="idList !=null">
				and t1.wms_cre_credit_head_id in
				<foreach collection="idList" index="index" item="wms_cre_credit_head_id" open="(" separator="," close=")">
					#{wms_cre_credit_head_id}
				</foreach>
			</if>
			<if test="bill_code!=null">
				and t1.bill_code like #{bill_code}
			</if>
			<if test="create_timestamp!=null and create_timestamp1!=null">
				and t1.create_timestamp between #{create_timestamp} and
				#{create_timestamp1}
			</if>
			<if test="salesman_name!=null or salesman_shortcode !=null">
				and (t1.salesman_name like#{salesman_name} or
				t1.salesman_shortcode like #{salesman_shortcode})
			</if>
			<if test="id_card!=null">
				and t2.id_card =#{id_card}
			</if>
			<if test="bill_status !=null">
				and t1.bill_status=#{bill_status}
			</if>
		</where>
		<if test="sortname!=null and sortorder!=null">
			order by ${sortname} ${sortorder}
		</if>
		<if test="offset!=null and pagesize!=null">
			limit ${offset},${pagesize}
		</if>
	</select>
	<!-- 《信贷》复议修订数据导出 -->
	<select id="getLoanReviewReturnListWithoutPaging" parameterType="map" resultType="java.util.HashMap">
		select
		t1.wms_cre_credit_head_id,
		t1.bill_code,
		t1.credit_purpose,
		t1.max_repayment_limit_per_month,
		t1.credit_limit,
		t1.max_repayment_time_limit,
		t1.enter_file_way,
		t1.payroll_payment_way,
		t1.data_type,
		t1.is_complete,
		t1.reference_type,
		t1.is_other_corporation_done,
		t1.is_to_public_stream,
		t1.is_house_certificate_original,
		t1.is_check,
		t1.person_condition,
		t1.salesman_id,
		t1.salesman_code,
		t1.salesman_name,
		t1.city,
		t1.cre_type,
		(case t1.cre_type when '1' then '信贷产品' when '2' then '房贷产品' end)as
		cre_type_name,
		t1.bill_status,
		(select value_meaning from wms_sys_dict_data where value_code =
		t1.bill_status and wms_sys_dict_id = 24)as bill_status_name,
		t1.water_appro_user_id,
		t1.water_appro_user_name,
		date_format(t1.water_appro_timestamp,'%Y-%m -%d %H:%i:%s') as water_appro_timestamp,
		t1.water_appro_result,
		(case t1.water_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略' else
		'待审批' end)as water_appro_result_name,
		t1.info_appro_user_id,
		t1.info_appro_user_name,
		date_format(t1.info_appro_timestamp,'%Y-%m -%d %H:%i:%s') as info_appro_timestamp,
		t1.info_appro_result,
		(case t1.info_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略' else
		'待审批' end) as info_appro_result_name,
		t1.phone_appro_user_id,
		t1.phone_appro_user_name,
		date_format(t1.phone_appro_timestamp,'%Y -%m -%d %H:%i:%s')as phone_appro_timestamp,
		t1.phone_appro_result,
		(case t1.phone_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略' else
		'待审批' end)as
		phone_appro_result_name,
		t1.certificate_appro_user_id,
		t1.certificate_appro_user_name,
		date_format(t1.certificate_appro_timestamp,'%Y -%m -%d %H:%i:%s') as certificate_appro_timestamp,
		t1.certificate_appro_result,
		(case t1.certificate_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略'
		else '待审批' end)as certificate_appro_result_name,
		t1.create_user_id,
		t1.create_user_name,
		date_format(t1.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t1.last_update_user_id,
		date_format(t1.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
		t1.enable_flag,
		t2.wms_cre_credit_line_customer_change_head_id,
		t2.wms_cre_credit_head_id,
		t2.wms_cus_customer_head_id,
		t2.customer_code,
		t2.customer_name,
		t2.customer_ever_name,
		t2.customer_category,
		t2.gender,
		t2.max_degree,
		date_format(t2.birthday,'%Y-%m-%d') as birthday,
		t2.id_card,
		t2.province,
		t2.city,
		t2.district,
		t2.address_more,
		t2.has_children,
		t2.children_name,
		t2.children_address,
		t2.children_telephone,
		t2.has_married,
		t2.has_house,
		t2.current_address_province,
		t2.current_address_city,
		t2.current_address_district,
		t2.current_address_more,
		t2.post_code,
		t2.fixed_telephone,
		t2.mobile_telephone1,
		t2.service_password1,
		t2.mobile_telephone2,
		t2.service_password2,
		t2.personal_year_income,
		t2.customer_email,
		t2.credit_card_limit,
		t2.common_occupants,
		t2.status,
		t2.create_user_id,
		t2.create_user_name,
		date_format(t2.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t2.last_update_user_id,
		date_format(t2.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
		t2.enable_flag,
		t1.inspection_appro_user_id,
		t1.inspection_appro_user_name,
		t1.inspection_appro_timestamp,
		t1.inspection_appro_result,
		(case
		when t1.credit_limit>=20 and t1.cre_loan_type=283 and
		t1.inspection_appro_result='0' then '未通过'
		when t1.credit_limit>=20 and t1.cre_loan_type=283 and
		t1.inspection_appro_result='1' then '通过'
		when t1.credit_limit>=20 and t1.cre_loan_type=283 and
		ISNULL(t1.inspection_appro_result) then
		'待审批'
		when t1.cre_loan_type=113 and t1.inspection_appro_result='0' then '未通过'
		when t1.cre_loan_type=113 and t1.inspection_appro_result='1' then '通过'
		when t1.cre_loan_type=113 and ISNULL(t1.inspection_appro_result) then
		'待审批'
		end) asinspection_appro_result_name,
		t1.inspection_appro_advice,
		t1.inspection_appro_result_page,
		t1.salesman_shortcode,
		CONCAT(t1.salesman_name,"/",t1.salesman_shortcode) as salesman_name_str,
		t1.review_the_reasons,
		t1.review_of_time,
		date_format(t1.review_of_time,'%Y-%m-%d
		%H:%i:%s') as review_of_time_str
		from wms_cre_credit_head t1,wms_cre_credit_line_customer_change_head t2
		<where>
			t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id and
			t1.enable_flag=1 and t1.bill_status=15 and t2.is_major='1'
			<if test="idList !=null">
				and t1.wms_cre_credit_head_id in
				<foreach collection="idList" index="index" item="wms_cre_credit_head_id" open="(" separator="," close=")">
					#{wms_cre_credit_head_id}
				</foreach>
			</if>
			<if test="bill_code!=null">
				and t1.bill_code like #{bill_code}
			</if>
			<if test="create_timestamp!=null and create_timestamp1!=null">
				and t1.create_timestamp between #{create_timestamp} and
				#{create_timestamp1}
			</if>
			<if test="salesman_name!=null or salesman_shortcode !=null">
				and (t1.salesman_name like#{salesman_name} or
				t1.salesman_shortcode like #{salesman_shortcode})
			</if>
			<if test="id_card!=null">
				and t2.id_card =#{id_card}
			</if>
		</where>
		<if test="sortname!=null and sortorder!=null">
			order by ${sortname} ${sortorder}
		</if>
	</select>
	<!-- 《信贷》复议修订查询总记录 -->
	<select id="getLoanReviewReturnCount" parameterType="map" resultType="int">
		select count(t1.wms_cre_credit_head_id) as count
		from
		wms_cre_credit_head t1 ,wms_cre_credit_line_customer_change_head t2
		<where>
			t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id and
			t1.enable_flag=1 and t1.bill_status=15 and t2.is_major='1'
			<if test="idList !=null">
				and t1.wms_cre_credit_head_id in
				<foreach collection="idList" index="index" item="wms_cre_credit_head_id" open="(" separator="," close=")">
					#{wms_cre_credit_head_id}
				</foreach>
			</if>
			<if test="bill_code!=null">
				and t1.bill_code like #{bill_code}
			</if>
			<if test="create_timestamp!=null and create_timestamp1!=null">
				and t1.create_timestamp between #{create_timestamp} and
				#{create_timestamp1}
			</if>
			<if test="salesman_name!=null or salesman_shortcode !=null">
				and (t1.salesman_name like#{salesman_name} or
				t1.salesman_shortcode like #{salesman_shortcode})
			</if>
			<if test="id_card!=null">
				and t2.id_card =#{id_card}
			</if>
			<if test="bill_status !=null">
				and t1.bill_status =#{bill_status}
			</if>
		</where>
	</select>
	<select id="searchforCreditCheck" parameterType="map" resultType="java.util.HashMap">
		select
		t1.wms_cre_credit_head_id,
		t1.bill_code,
		t1.credit_purpose,
		t1.max_repayment_limit_per_month,
		t1.credit_limit,
		t1.max_repayment_time_limit,
		t1.enter_file_way,
		t1.payroll_payment_way,
		t1.data_type,
		t1.is_complete,
		t1.reference_type,
		t1.is_other_corporation_done,
		t1.is_to_public_stream,
		t1.is_house_certificate_original,
		t1.is_check,
		t1.person_condition,
		t1.salesman_id,
		t1.salesman_code,
		t1.salesman_name,
		t1.city,
		t1.cre_type,
		(case t1.cre_type when '1' then '信贷产品' when '2' then '房贷产品' end) as
		cre_type_name,
		t1.bill_status,
		(select value_meaning from wms_sys_dict_data where value_code = bill_status
		and wms_sys_dict_id = 24)as bill_status_name,
		t1.water_appro_user_id,
		t1.water_appro_user_name,
		date_format(t1.water_appro_timestamp,'%Y-%m-%d %H:%i:%s') as water_appro_timestamp,
		t1.water_appro_result,
		t1.info_appro_user_id,
		t1.info_appro_user_name,
		date_format(t1.info_appro_timestamp,'%Y-%m-%d %H:%i:%s') as info_appro_timestamp,
		t1.info_appro_result,
		t1.phone_appro_user_id,
		t1.phone_appro_user_name,
		date_format(t1.phone_appro_timestamp,'%Y-%m-%d %H:%i:%s')as phone_appro_timestamp,
		t1.phone_appro_result,
		t1.certificate_appro_user_id,
		t1.certificate_appro_user_name,
		date_format(t1.certificate_appro_timestamp,'%Y-%m-%d %H:%i:%s') as certificate_appro_timestamp,
		t1.certificate_appro_result,
		t1.create_user_id,
		t1.create_user_name,
		date_format(t1.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t1.last_update_user_id,
		date_format(t1.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as
		last_update_timestamp,
		t1.enable_flag,
		t1.is_link_repeat,
		t1.profession_type,
		t1.is_verify,
		t1.house_appro_result,
		t1.cre_loan_type,
		t1.loan_interest_rate,
		t2.wms_cre_credit_line_customer_change_head_id,
		t2.wms_cre_credit_head_id,
		t2.wms_cus_customer_head_id,
		t2.customer_code,
		t2.customer_name,
		t2.customer_ever_name,
		t2.customer_category,
		t2.gender,
		t2.max_degree,
		date_format(t2.birthday,'%Y-%m-%d') as birthday,
		t2.id_card,
		t2.province,
		t2.city,
		t2.district,
		t2.address_more,
		t2.has_children,
		t2.children_name,
		t2.children_address,
		t2.children_telephone,
		t2.has_married,
		t2.has_house,
		t2.current_address_province,
		t2.current_address_city,
		t2.current_address_district,
		t2.current_address_more,
		t2.post_code,
		t2.fixed_telephone,
		t2.mobile_telephone1,
		t2.service_password1,
		t2.mobile_telephone2,
		t2.service_password2,
		t2.personal_year_income,
		t2.customer_email,
		t2.credit_card_limit,
		t2.common_occupants,
		t2.status,
		t2.create_user_id,
		t2.create_user_name,
		date_format(t2.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t2.last_update_user_id,
		date_format(t2.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
		t2.enable_flag,
		t1.is_review_back,
		t1.water_appro_result_page,
		t1.info_appro_result_page,
		t1.phone_appro_result_page,
		t1.certificate_appro_result_page,
		t1.inspection_appro_user_id,
		t1.inspection_appro_user_name,
		t1.inspection_appro_timestamp,
		t1.inspection_appro_result,
		t1.inspection_appro_advice,
		t1.inspection_appro_result_page,
		t1.salesman_shortcode,
		CONCAT(t1.salesman_name,"/",t1.salesman_shortcode) as salesman_name_str,
		t1.salesman_city_code,
		t1.create_user_city_code
		from wms_cre_credit_head t1 left join
		wms_cre_credit_line_customer_change_head t2
		on t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id and
		t2.is_major='1'
		<where>
			<!-- 实现信贷复核查询必要条件 -->
			and t1.create_user_city_code=${create_user_city_code}
			<if test="customer_name != null">
				and t2.customer_name like '${customer_name}'
			</if>
			<if test="mobile_telephone != null">
				and (t2.mobile_telephone1 like '${mobile_telephone}' or
				t2.mobile_telephone2 like '${mobile_telephone}')
			</if>
			<if test="id_card != null">
				and t2.id_card = #{id_card}
			</if>
			<if test="idList !=null">
				and t1.wms_cre_credit_head_id in
				<foreach collection="idList" item="wms_cre_credit_head_id" index="index" open="(" separator="," close=")">
					#{wms_cre_credit_head_id}
				</foreach>
			</if>
			and t1.enable_flag='1'
			<if test="bill_code != null">
				and t1.bill_code like '${bill_code}'
			</if>
			<if test="bill_status!= null">
				and t1.bill_status=#{bill_status}
			</if>
			<if test="salesman_name != null or salesman_shortcode!=null">
				and (t1.salesman_name like '${salesman_name}' or
				t1.salesman_shortcode like '${salesman_shortcode}')
			</if>
			<if test="create_timestamp != null and create_timestamp1!=null">
				and t1.create_timestamp between #{create_timestamp} and
				#{create_timestamp1}
			</if>
			<if test="create_user_id != null">
				and t1.create_user_id != #{create_user_id}
			</if>
			<if test="cre_type !=null">
				and t1.cre_type = #{cre_type}
			</if>
			<!-- 验点需要根据配置来判断 -->
			<if test="childrendept !=null">
				and (FIND_IN_SET(t1.salesman_dept_id,#{childrendept})>0)
			</if>
		</where>
		<if test="sortname != null and sortorder !=null">
			ORDER BY ${sortname} ${sortorder}
		</if>
		<if test="offset != null and pagesize !=null">
			LIMIT ${offset} , ${pagesize}
		</if>
	</select>
	<!-- 实现信贷复核查询数量 -->
	<select id="findCountforCreditCheck" parameterType="map" resultType="int">
		select count(t1.wms_cre_credit_head_id) as count
		from
		wms_cre_credit_head t1 left join
		wms_cre_credit_line_customer_change_head t2
		on
		t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id and
		t2.is_major='1'
		<where>
			and t1.create_user_city_code =#{create_user_city_code}
			<if test="id_card != null">
				and t2.id_card = #{id_card}
			</if>
			<if test="idList !=null">
				and t1.wms_cre_credit_head_id in
				<foreach collection="idList" item="wms_cre_credit_head_id" index="index" open="(" separator="," close=")">
					#{wms_cre_credit_head_id}
				</foreach>
			</if>
			and t1.enable_flag='1'
			<if test="bill_code != null">
				and t1.bill_code like '${bill_code}'
			</if>
			<if test="bill_status!= null">
				and t1.bill_status=#{bill_status}
			</if>
			<if test="salesman_name != null">
				and t1.salesman_name like '${salesman_name}'
			</if>
			<if test="create_timestamp != null and create_timestamp1!=null">
				and t1.create_timestamp between #{create_timestamp} and
				#{create_timestamp1}
			</if>
			<if test="create_user_id != null">
				and t1.create_user_id != #{create_user_id}
			</if>
			<if test="cre_type !=null">
				and t1.cre_type = #{cre_type}
			</if>
			<!-- 验点需要根据配置来判断 -->
			<if test="childrendept !=null">
				and (FIND_IN_SET(t1.salesman_dept_id,#{childrendept})>0)
			</if>
		</where>
	</select>
	<!-- 实现信贷验点组审批列表显示 -->
	<select id="getYdListWithPaging" parameterType="map" resultType="java.util.HashMap">
		select
		t1.wms_cre_credit_head_id,
		t1.bill_code,
		t1.credit_purpose,
		t1.max_repayment_limit_per_month,
		t1.credit_limit,
		t1.max_repayment_time_limit,
		t1.enter_file_way,
		t1.payroll_payment_way,
		t1.data_type,
		t1.is_complete,
		t1.reference_type,
		t1.is_other_corporation_done,
		t1.is_to_public_stream,
		t1.is_house_certificate_original,
		t1.is_check,
		t1.person_condition,
		t1.salesman_id,
		t1.salesman_code,
		t1.salesman_name,
		t1.city,
		t1.cre_type,
		t1.bill_status,
		(select value_meaning from wms_sys_dict_data where value_code =
		bill_status
		and wms_sys_dict_id = 24)as bill_status_name,
		t1.water_appro_user_id,
		t1.water_appro_user_name,
		date_format(t1.water_appro_timestamp,'%Y-%m-%d %H:%i:%s') as water_appro_timestamp,
		t1.water_appro_result,
		(case t1.water_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略' else
		'待审批' end)as water_appro_result_name,
		t1.info_appro_user_id,
		t1.info_appro_user_name,
		date_format(t1.info_appro_timestamp,'%Y-%m-%d %H:%i:%s') as info_appro_timestamp,
		t1.info_appro_result,
		(case
		t1.info_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略' else
		'待审批' end)as info_appro_result_name,
		t1.phone_appro_user_id,
		t1.phone_appro_user_name,
		date_format(t1.phone_appro_timestamp,'%Y-%m-%d %H:%i:%s')as phone_appro_timestamp,
		t1.phone_appro_result,
		(case t1.phone_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略' else
		'待审批' end)as phone_appro_result_name,
		t1.certificate_appro_user_id,
		t1.certificate_appro_user_name,
		date_format(t1.certificate_appro_timestamp,'%Y-%m-%d %H:%i:%s') as certificate_appro_timestamp,
		t1.certificate_appro_result,
		(case t1.certificate_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略'
		else '待审批' end)as certificate_appro_result_name,
		t1.create_user_id,
		t1.create_user_name,
		date_format(t1.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t1.last_update_user_id,
		date_format(t1.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
		t1.enable_flag,
		t1.cre_loan_type,
		t1.loan_interest_rate,
		t2.wms_cre_credit_line_customer_change_head_id,
		t2.wms_cre_credit_head_id,
		t2.wms_cus_customer_head_id,
		t2.customer_code,
		t2.customer_name,
		t2.customer_ever_name,
		t2.customer_category,
		t2.gender,
		t2.max_degree,
		date_format(t2.birthday,'%Y-%m-%d') as birthday,
		t2.id_card,
		t2.province,
		t2.city,
		t2.district,
		t2.address_more,
		t2.has_children,
		t2.children_name,
		t2.children_address,
		t2.children_telephone,
		t2.has_married,
		t2.has_house,
		t2.current_address_province,
		t2.current_address_city,
		t2.current_address_district,
		t2.current_address_more,
		t2.post_code,
		t2.fixed_telephone,
		t2.mobile_telephone1,
		t2.service_password1,
		t2.mobile_telephone2,
		t2.service_password2,
		t2.personal_year_income,
		t2.customer_email,
		t2.credit_card_limit,
		t2.common_occupants,
		t2.status,
		t2.create_user_id,
		t2.create_user_name,
		date_format(t2.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t2.last_update_user_id,
		date_format(t2.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as
		last_update_timestamp,
		t2.enable_flag,
		t1.salesman_shortcode,
		CONCAT(t1.salesman_name,"/",t1.salesman_shortcode) as salesman_name_str,
		t1.water_appro_result_page,
		t1.info_appro_result_page,
		t1.phone_appro_result_page,
		t1.certificate_appro_result_page,
		t1.inspection_appro_result_page
		from
		wms_cre_credit_head t1,wms_cre_credit_line_customer_change_head t2
		<where>
			t1.wms_cre_credit_head_id = t2.wms_cre_credit_head_id
			and t2.is_major='1'
			and t1.enable_flag=1
			and t1.trial_interview_result=1
			<if test="create_user_city_code != null">
				and t1.create_user_city_code=#{create_user_city_code}
			</if>
			<if test="idList !=null">
				and t1.wms_cre_credit_head_id in
				<foreach collection="idList" item="wms_cre_credit_head_id" index="index" open="(" separator="," close=")">
					#{wms_cre_credit_head_id}
				</foreach>
			</if>
			<if test="id_card != null">
				and t2.id_card = #{id_card}
			</if>
			<if test="bill_code != null">
				and t1.bill_code like '${bill_code}'
			</if>
			<if test="customer_name != null">
				and t2.customer_name like #{customer_name}
			</if>
			<if test="salesman_name != null or salesman_shortcode !=null">
				and (t1.salesman_name like #{salesman_name} or
				t1.salesman_shortcode like #{salesman_shortcode})
			</if>
			<if test="create_timestamp != null and create_timestamp1!=null">
				and t1.create_timestamp between #{create_timestamp} and
				#{create_timestamp1}
			</if>
			<!-- 验点需要根据配置来判断 -->
			<if test="childrendept !=null">
				and (FIND_IN_SET(t1.salesman_dept_id,#{childrendept})>0)
			</if>
		</where>
		<if test="sortname != null and sortorder !=null">
			ORDER BY ${sortname} ${sortorder}
		</if>
		<if test="offset != null and pagesize !=null">
			LIMIT ${offset} , ${pagesize}
		</if>
	</select>
	<!-- 实现验点审批数据数 -->
	<select id="findCountforYdListWithPaging" parameterType="map" resultType="int">
		select
		count(t1.wms_cre_credit_head_id) as count
		from
		wms_cre_credit_head t1,wms_cre_credit_line_customer_change_head t2
		<where>
			t1.wms_cre_credit_head_id = t2.wms_cre_credit_head_id
			and t2.is_major='1'
			and t1.enable_flag=1
			and t1.trial_interview_result=1
			<if test="create_user_city_code != null">
				and t1.create_user_city_code=#{create_user_city_code}
			</if>
			<if test="idList !=null">
				and t1.wms_cre_credit_head_id in
				<foreach collection="idList" item="wms_cre_credit_head_id" index="index" open="(" separator="," close=")">
					#{wms_cre_credit_head_id}
				</foreach>
			</if>
			<if test="id_card != null">
				and t2.id_card = #{id_card}
			</if>
			<if test="bill_code != null">
				and t1.bill_code like '${bill_code}'
			</if>
			<if test="customer_name != null">
				and t2.customer_name like #{customer_name}
			</if>
			<if test="salesman_name != null or salesman_shortcode !=null">
				and (t1.salesman_name like #{salesman_name} or
				t1.salesman_shortcode like #{salesman_shortcode})
			</if>
			<if test="create_timestamp != null and create_timestamp1!=null">
				and t1.create_timestamp between #{create_timestamp} and
				#{create_timestamp1}
			</if>
			<!-- 验点需要根据配置来判断 -->
			<if test="childrendept !=null">
				and (FIND_IN_SET(t1.salesman_dept_id,#{childrendept})>0)
			</if>
		</where>
		<if test="sortname != null and sortorder !=null">
			ORDER BY ${sortname} ${sortorder}
		</if>
		<if test="offset != null and pagesize !=null">
			LIMIT ${offset} , ${pagesize}
		</if>
	</select>
	<!-- deleteByPK 贷款查询对草稿状态的数据进行软删除即逻辑删除 -->
	<update id="deleteByPK" parameterType="map">
		update wms_cre_credit_head
		SET enable_flag=0 WHERE
		wms_cre_credit_head_id=#{wms_cre_credit_head_id} and
		cre_type=#{cre_type};
	</update>
	<!-- 更新 -->
	<update id="update" parameterType="WmsCreCreditHead">
		update wms_cre_credit_head
		<set>
			<if test="bill_type != null">
				bill_type=#{bill_type},
			</if>
			<if test="nullify_type !=null">
				nullify_type =#{nullify_type},
			</if>
			<if test="nullify_user_name !=null">
				nullify_user_name =#{nullify_user_name},
			</if>
			<if test="nullify_user_id !=null">
				nullify_user_id =#{nullify_user_id},
			</if>
			<if test="nullify_timestamp !=null">
				nullify_timestamp =#{nullify_timestamp},
			</if>
			<if test="nullify_reason !=null">
				nullify_reason =#{nullify_reason},
			</if>
			<if test="cre_loan_type != null">
				cre_loan_type = #{cre_loan_type},
			</if>
			<if test="is_achievement != null">
				is_achievement = #{is_achievement},
			</if>
			<if test="is_stock != null">
				is_stock = #{is_stock},
			</if>
		</set>
		where wms_cre_credit_head_id = #{wms_cre_credit_head_id}
	</update>
	
	<!-- 更新 -->
	<update id="updateApproUserId" parameterType="WmsCreCreditHead">
		update wms_cre_credit_head
		<set>
			house_appro_user_id=#{house_appro_user_id},
		</set>
		where wms_cre_credit_head_id = #{wms_cre_credit_head_id}
	</update>

	<!-- 根据ID查询单据相关信息，退件信息初始化查询 -->
	<select id="getWmsCreCredReturnInfoById" parameterType="int" resultType="java.util.HashMap">
		select
		t1.wms_cre_credit_head_id,
		t1.bill_code,
		t1.create_timestamp as head_create_datetime,
		t1.cre_type,
		t1.cre_loan_type,
		t2.customer_name as cus_name,
		t1.credit_limit,
		now() as audit_time,
		(
		<include refid="deptCityId" />
		) as city_code,
		(
		<include refid="deptCity" />
		) as city_name,
		(
		<include refid="deptId" />
		) as store_deptId,
		(
		<include refid="deptName" />
		) as store_name,
		t1.create_user_name,
		t1.create_user_id,
		t1.salesman_id,
		t1.salesman_name,
		now() as create_timestamp,
		'1' as enable_flag
		from wms_cre_credit_head t1 LEFT JOIN
		wms_cre_credit_line_customer_change_head t2
		on t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id and
		t2.is_major='1'
		where t1.wms_cre_credit_head_id = #{wms_cre_credit_head_id}
	</select>

	<!-- 查询客户的房贷信息（如果多条显示最后一条） -->
	<select id="getWmsCrecreditHeadInfoByCusid" parameterType="java.lang.Integer" resultType="java.util.HashMap">
		<!-- select h.wms_cre_credit_head_id, h.credit_purpose, h.cre_loan_type, h.max_repayment_time_limit, h.max_repayment_limit_per_month, h.credit_limit, h.loan_interest_rate, h.is_xudai, h.commission_rate, h.commission_fee, h.salesman_name, h.salesman_id, h.salesman_code, h.salesman_shortcode, h.city, h.salesman_city_code, h.salesman_dept_id, (select count(h.wms_cre_credit_head_id) from wms_cre_credit_head h, wms_cre_credit_line_customer_change_head c where c.wms_cus_customer_head_id = #{wms_cus_customer_id} 
			and h.wms_cre_credit_head_id = c.wms_cre_credit_head_id and h.cre_type = '2' ) as info_count from wms_cre_credit_head h, wms_fina_cre_repay p where h.cre_type = '2' and h.wms_cre_credit_head_id = p.wms_cre_credit_head_id and p.un_pay_period = '1' and h.bill_status = 'H' and h.wms_cre_credit_head_id = ( select max(wms_cre_credit_head_id) from wms_cre_credit_line_customer_change_head where wms_cus_customer_head_id = #{wms_cus_customer_id} ) -->
		select
		h.wms_cre_credit_head_id,
		h.credit_purpose,
		h.cre_loan_type,
		h.max_repayment_time_limit,
		h.max_repayment_limit_per_month,
		h.credit_limit,
		h.appro_limit,
		h.loan_interest_rate,
		h.is_xudai,
		h.commission_rate,
		h.commission_fee,
		h.salesman_name,
		h.salesman_id,
		h.salesman_code,
		h.salesman_shortcode,
		h.city,
		h.salesman_city_code,
		h.salesman_dept_id,
		(select count(h.wms_cre_credit_head_id) from wms_cre_credit_head h, wms_cre_credit_line_customer_change_head c
		where c.wms_cus_customer_head_id = #{wms_cus_customer_id} and h.wms_cre_credit_head_id = c.wms_cre_credit_head_id and h.cre_type = '2' and h.bill_status = 'H' and h.is_xudai in('0', '1')
		) as info_count
		from wms_cre_credit_head h, wms_fina_cre_repay p
		where h.cre_type = '2' and h.wms_cre_credit_head_id = p.wms_cre_credit_head_id
		and p.un_pay_period in ('1', '2') and h.bill_status = 'H' and h.is_xudai in('0', '1')
		and h.wms_cre_credit_head_id = (
		select max(h.wms_cre_credit_head_id) from wms_cre_credit_head h, wms_cre_credit_line_customer_change_head c
		where c.wms_cus_customer_head_id = #{wms_cus_customer_id} and h.wms_cre_credit_head_id = c.wms_cre_credit_head_id and h.cre_type = '2' and h.bill_status = 'H' and h.is_xudai in('0', '1')
		)
	</select>

	<!-- 根据ID查询单据信息 -->
	<select id="getWmsCusCreditHeadInfo" parameterType="java.lang.Integer" resultType="java.util.HashMap">
		select
		wms_cre_credit_head_id,
		credit_limit,
		max_repayment_time_limit,
		cre_loan_type
		from wms_cre_credit_head
		where wms_cre_credit_head_id = #{wms_cre_credit_head_id}
	</select>

	<!-- 查询车贷评估审核列表 ，返回List<Map>对象 -->
	<select id="searchForCdCardForAdd" parameterType="map" resultType="java.util.HashMap">
		select
		t1.wms_cre_credit_head_id,
		t1.bill_code,
		t1.credit_purpose,
		t1.max_repayment_limit_per_month,
		t1.credit_limit,
		t1.max_repayment_time_limit,
		t1.enter_file_way,
		t1.payroll_payment_way,
		t1.data_type,
		t1.is_complete,
		t1.credit_limit,
		t1.reference_type,
		t1.is_other_corporation_done,
		t1.is_to_public_stream,
		t1.is_house_certificate_original,
		t1.is_check,
		t1.person_condition,
		t1.salesman_id,
		t1.salesman_code,
		t1.salesman_name,
		t1.city,
		t1.cre_type,
		t1.bill_status,
		(select value_meaning from wms_sys_dict_data where
		value_code = bill_status
		and wms_sys_dict_id = 24)as bill_status_name,
		t1.water_appro_user_id,
		t1.water_appro_user_name,
		date_format(t1.water_appro_timestamp,'%Y-%m-%d %H:%i:%s') as water_appro_timestamp,
		t1.water_appro_result,
		t1.info_appro_user_id,
		t1.info_appro_user_name,
		date_format(t1.info_appro_timestamp,'%Y-%m-%d %H:%i:%s') as info_appro_timestamp,
		t1.info_appro_result,
		t1.phone_appro_user_id,
		t1.phone_appro_user_name,
		date_format(t1.phone_appro_timestamp,'%Y-%m-%d %H:%i:%s')as
		phone_appro_timestamp,
		t1.phone_appro_result,
		t1.certificate_appro_user_id,
		t1.certificate_appro_user_name,

		date_format(t1.certificate_appro_timestamp,'%Y-%m-%d %H:%i:%s') as certificate_appro_timestamp,
		t1.certificate_appro_result,

		t1.create_user_id,
		t1.create_user_name,
		date_format(t1.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t1.last_update_user_id,
		date_format(t1.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
		t1.enable_flag,
		t1.is_link_repeat,
		t1.profession_type,
		t1.is_verify,
		t1.house_appro_result,
		t1.cre_loan_type,
		(select value_meaning from wms_sys_dict_data where value_code = t1.cre_loan_type
		and wms_sys_dict_id = 75)as cre_loan_type_name,
		t1.loan_interest_rate,
		t2.wms_cre_credit_line_customer_change_head_id,
		t2.wms_cre_credit_head_id,
		t2.wms_cus_customer_head_id,
		t2.customer_code,
		t2.customer_name,
		t2.customer_ever_name,
		t2.customer_category,
		t2.gender,
		t2.max_degree,
		date_format(t2.birthday,'%Y-%m-%d') as birthday,
		t2.id_card,
		t2.province,
		t2.city,
		t2.district,
		t2.address_more,
		t2.has_children,
		t2.children_name,
		t2.children_address,
		t2.children_telephone,
		t2.has_married,
		t2.has_house,
		t2.current_address_province,
		t2.current_address_city,
		t2.current_address_district,
		t2.current_address_more,
		t2.post_code,
		t2.fixed_telephone,
		t2.mobile_telephone1,
		t2.service_password1,
		t2.mobile_telephone2,
		t2.service_password2,
		t2.personal_year_income,
		t2.customer_email,
		t2.credit_card_limit,
		t2.common_occupants,
		t2.status,
		t2.create_user_id,
		t2.create_user_name,
		date_format(t2.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t2.last_update_user_id,
		date_format(t2.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
		t2.enable_flag,
		t1.is_review_back,
		t1.water_appro_result_page,
		t1.info_appro_result_page,
		t1.phone_appro_result_page,
		t1.certificate_appro_result_page,
		t1.house_appro_result_page,
		t1.salesman_shortcode,
		t1.create_user_city_code,
		CONCAT(t1.salesman_name,"/",t1.salesman_shortcode) as salesman_name_str
		from wms_cre_credit_head
		t1,wms_cre_credit_line_customer_change_head t2
		<where>
			t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id and
			t2.is_major='1' and t1.cre_type='3'
			and t1.create_user_city_code = #{create_user_city_code}
			<if test="id_card != null">
				and t2.id_card = #{id_card}
			</if>
			<if test="idList !=null">
				and t1.wms_cre_credit_head_id in
				<foreach collection="idList" item="wms_cre_credit_head_id" index="index" open="(" separator="," close=")">
					#{wms_cre_credit_head_id}
				</foreach>
			</if>
			and t1.enable_flag='1'
			<if test="bill_code != null">
				and t1.bill_code like '${bill_code}'
			</if>
			<if test="customer_name != null">
				and t2.customer_name like '${customer_name}'
			</if>
			<if test="create_user_id != null">
				and t1.create_user_id != #{create_user_id}
			</if>
			<if test="mobile_telephone != null">
				and (t2.mobile_telephone1 like '${mobile_telephone}' or
				t2.mobile_telephone2 like '${mobile_telephone}')
			</if>
		</where>
		<if test="sortname != null and sortorder !=null">
			ORDER BY ${sortname} ${sortorder}
		</if>
		<if test="offset != null and pagesize !=null">
			LIMIT ${offset} , ${pagesize}
		</if>
	</select>
	<!-- 查询数据条数，直接返回int类型条数 -->
	<select id="findCountForCdCardForAdd" parameterType="map" resultType="int">
		select count(t1.wms_cre_credit_head_id) as count
		from
		wms_cre_credit_head t1,wms_cre_credit_line_customer_change_head t2
		<where>
			t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id and
			t2.is_major='1' and t1.cre_type='3'
			and t1.create_user_city_code = #{create_user_city_code}
			<if test="id_card != null">
				and t2.id_card = #{id_card}
			</if>
			<if test="idList !=null">
				and t1.wms_cre_credit_head_id in
				<foreach collection="idList" item="wms_cre_credit_head_id" index="index" open="(" separator="," close=")">
					#{wms_cre_credit_head_id}
				</foreach>
			</if>
			and t1.enable_flag='1'
			<if test="bill_code != null">
				and t1.bill_code like '${bill_code}'
			</if>
			<if test="customer_name != null">
				and t2.customer_name like '${customer_name}'
			</if>
			<if test="create_user_id != null">
				and t1.create_user_id != #{create_user_id}
			</if>
			<if test="mobile_telephone != null">
				and (t2.mobile_telephone1 like '${mobile_telephone}' or
				t2.mobile_telephone2 like '${mobile_telephone}')
			</if>
		</where>
	</select>


	<!-- 查询车贷贷前跟踪 ，返回List<Map>对象 -->
	<select id="searchForCar" parameterType="map" resultType="java.util.HashMap">
		select
		t1.wms_cre_credit_head_id,
		t1.bill_code,
		t1.credit_purpose,
		t1.max_repayment_limit_per_month,
		t1.credit_limit,
		t1.max_repayment_time_limit,
		t1.enter_file_way,
		t1.payroll_payment_way,
		t1.data_type,
		t1.is_complete,
		t1.reference_type,
		t1.is_other_corporation_done,
		t1.is_to_public_stream,
		t1.is_house_certificate_original,
		t1.is_check,
		t1.person_condition,
		t1.salesman_id,
		t1.salesman_code,
		t1.salesman_name,
		t1.city,
		t1.cre_type,
		t1.bill_status,
		(select value_meaning from wms_sys_dict_data where value_code =
		bill_status
		and wms_sys_dict_id = 24)as bill_status_name,
		t1.water_appro_user_id,
		t1.water_appro_user_name,
		date_format(t1.water_appro_timestamp,'%Y-%m-%d %H:%i:%s') as water_appro_timestamp,
		t1.water_appro_result,
		t1.water_appro_result_page,
		t1.info_appro_user_id,
		t1.info_appro_user_name,
		date_format(t1.info_appro_timestamp,'%Y-%m-%d %H:%i:%s') as info_appro_timestamp,
		t1.info_appro_result,
		t1.info_appro_result_page,
		t1.phone_appro_user_id,
		t1.phone_appro_user_name,
		date_format(t1.phone_appro_timestamp,'%Y-%m-%d %H:%i:%s')as phone_appro_timestamp,
		t1.phone_appro_result,
		t1.phone_appro_result_page,
		t1.certificate_appro_user_id,
		t1.certificate_appro_user_name,

		date_format(t1.certificate_appro_timestamp,'%Y-%m-%d %H:%i:%s') as certificate_appro_timestamp,
		t1.certificate_appro_result,
		t1.certificate_appro_result_page,
		t1.assessment_result,
		t1.assessment_result_page,
		t1.create_user_id,
		t1.create_user_name,
		date_format(t1.create_timestamp,'%Y-%m-%d %H:%i:%s') as
		create_timestamp,
		t1.last_update_user_id,
		date_format(t1.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
		t1.enable_flag,
		t1.is_link_repeat,
		t1.profession_type,
		t1.is_verify,
		t1.house_appro_result,
		t1.house_appro_result_page,
		t1.cre_loan_type,
		t1.loan_interest_rate,
		t2.wms_cre_credit_line_customer_change_head_id,
		t2.wms_cre_credit_head_id,
		t2.wms_cus_customer_head_id,
		t2.customer_code,
		t2.customer_name,
		t2.customer_ever_name,
		t2.customer_category,
		t2.gender,
		t2.max_degree,
		date_format(t2.birthday,'%Y-%m-%d') as birthday,
		t2.id_card,
		t2.province,
		t2.city,
		t2.district,
		t2.address_more,
		t2.has_children,
		t2.children_name,
		t2.children_address,
		t2.children_telephone,
		t2.has_married,
		t2.has_house,
		t2.current_address_province,
		t2.current_address_city,
		t2.current_address_district,
		t2.current_address_more,
		t2.post_code,
		t2.fixed_telephone,
		t2.mobile_telephone1,
		t2.service_password1,
		t2.mobile_telephone2,
		t2.service_password2,
		t2.personal_year_income,
		t2.customer_email,
		t2.credit_card_limit,
		t2.common_occupants,
		t2.status,
		t2.create_user_id,
		t2.create_user_name,
		date_format(t2.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t2.last_update_user_id,
		date_format(t2.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
		t2.enable_flag,
		t1.salesman_shortcode,
		CONCAT(t1.salesman_name,"/",t1.salesman_shortcode) as salesman_name_str,
		t1.documentary_opinion
		from wms_cre_credit_head t1,wms_cre_credit_line_customer_change_head t2
		<where>
			t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id and
			t2.is_major='1' and t1.cre_type='3' and t1.bill_status='D1'
			<if test="id_card != null">
				and t2.id_card = #{id_card}
			</if>
			and t1.enable_flag='1'
			<if test="bill_code != null">
				and t1.bill_code like '${bill_code}'
			</if>
			<if test="customer_name != null">
				and t2.customer_name like '${customer_name}'
			</if>
			<if test="mobile_telephone != null">
				and (t2.mobile_telephone1 like '${mobile_telephone}' or
				t2.mobile_telephone2 like '${mobile_telephone}')
			</if>
			<if test="create_timestamp != null and create_timestamp1!=null">
				and t1.create_timestamp between #{create_timestamp} and
				#{create_timestamp1}
			</if>
		</where>
		<if test="sortname != null and sortorder !=null">
			ORDER BY ${sortname} ${sortorder}
		</if>
		<if test="offset != null and pagesize !=null">
			LIMIT ${offset} , ${pagesize}
		</if>

	</select>
	<!-- 查询数据条数，直接返回int类型条数 -->
	<select id="findCountForCar" parameterType="map" resultType="int">
		select count(t1.wms_cre_credit_head_id) as count
		from
		wms_cre_credit_head t1,wms_cre_credit_line_customer_change_head t2
		<where>
			t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id and
			t2.is_major='1' and t1.cre_type='3' and t1.bill_status='D1'
			<if test="id_card != null">
				and t2.id_card = #{id_card}
			</if>
			and t1.enable_flag='1'
			<if test="bill_code != null">
				and t1.bill_code like '${bill_code}'
			</if>
			<if test="customer_name != null">
				and t2.customer_name like '${customer_name}'
			</if>
			<if test="mobile_telephone != null">
				and (t2.mobile_telephone1 like '${mobile_telephone}' or
				t2.mobile_telephone2 like '${mobile_telephone}')
			</if>
			<if test="create_timestamp != null and create_timestamp1!=null">
				and t1.create_timestamp between #{create_timestamp} and
				#{create_timestamp1}
			</if>
		</where>
	</select>
	<!-- 车贷贷前跟踪数据导出 -->
	<select id="getFollowCheckListWithoutPagingForCar" parameterType="map" resultType="java.util.HashMap">
		select
		t1.wms_cre_credit_head_id,
		t1.bill_code,
		t1.credit_purpose,
		t1.max_repayment_limit_per_month,
		t1.credit_limit,
		t1.max_repayment_time_limit,
		t1.enter_file_way,
		t1.payroll_payment_way,
		t1.data_type,
		t1.is_complete,
		t1.reference_type,
		t1.is_other_corporation_done,
		t1.is_to_public_stream,
		t1.is_house_certificate_original,
		t1.is_check,
		t1.person_condition,
		t1.salesman_id,
		t1.salesman_code,
		t1.salesman_name,
		t1.city,
		t1.cre_type,
		t1.bill_status,
		(select value_meaning from wms_sys_dict_data where value_code =
		bill_status
		and wms_sys_dict_id = 24)as bill_status_name,
		t1.create_user_id,
		t1.create_user_name,
		date_format(t1.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t1.last_update_user_id,
		date_format(t1.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
		t1.enable_flag,
		t1.house_appro_result,
		(case t1.house_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略' else
		'待审批' end)as house_appro_result_name,
		(case t1.assessment_result when '0' then '未通过' when '1' then
		'通过' when '3' then '已忽略' else
		'待审批' end)as assessment_result_name,
		t1.assessment_result_page,
		t2.wms_cre_credit_line_customer_change_head_id,
		t2.wms_cre_credit_head_id,
		t2.wms_cus_customer_head_id,
		t2.customer_code,
		t2.customer_name,
		t2.customer_ever_name,
		t2.customer_category,
		t2.gender,
		t2.max_degree,
		date_format(t2.birthday,'%Y-%m-%d') as birthday,
		t2.id_card,
		t2.province,
		t2.city,
		t2.district,
		t2.address_more,
		t2.has_children,
		t2.children_name,
		t2.children_address,
		t2.children_telephone,
		t2.has_married,
		t2.has_house,
		t2.current_address_province,
		t2.current_address_city,
		t2.current_address_district,
		t2.current_address_more,
		t2.post_code,
		t2.fixed_telephone,
		t2.mobile_telephone1,
		t2.service_password1,
		t2.mobile_telephone2,
		t2.service_password2,
		t2.personal_year_income,
		t2.customer_email,
		t2.credit_card_limit,
		t2.common_occupants,
		t2.status,
		t2.create_user_id,
		t2.create_user_name,
		date_format(t2.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t2.last_update_user_id,
		date_format(t2.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
		t2.enable_flag,
		t1.salesman_shortcode,
		CONCAT(t1.salesman_name,"/",t1.salesman_shortcode) as salesman_name_str
		from wms_cre_credit_head
		t1,wms_cre_credit_line_customer_change_head t2
		<where>
			t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id and
			t1.enable_flag=1 and t1.cre_type=3 and t2.is_major='1' and
			t1.bill_status='D1'
			<if test="bill_code!=null">
				and t1.bill_code like '${bill_code}'
			</if>
			<if test="customer_name!=null">
				and t2.customer_name like '${customer_name}'
			</if>
			<if test="id_card!=null">
				and t2.id_card = #{id_card}
			</if>
			<if test="mobile_telephone!=null">
				and (t2.mobile_telephone1 like '${mobile_telephone}' or
				t2.mobile_telephone2 like '${mobile_telephone}')
			</if>
			<if test="create_timestamp != null and create_timestamp1!=null">
				and t1.create_timestamp between #{create_timestamp} and
				#{create_timestamp1}
			</if>
		</where>
		<if test="sortname!=null and sortorder!=null">
			order by ${sortname} ${sortorder}
		</if>
	</select>

	<!-- 车贷复核查询列表 -->
	<select id="recheckForCar0" parameterType="map" resultType="java.util.HashMap">
		select
		t1.wms_cre_credit_head_id,
		t1.bill_code,
		t1.credit_purpose,
		t1.max_repayment_limit_per_month,
		(case t1.cre_type when '3' then (CAST(t1.credit_limit*0.0001 AS DECIMAL(8,4) )) else t1.credit_limit end) as credit_limit,
		t1.max_repayment_time_limit,
		t1.enter_file_way,
		t1.payroll_payment_way,
		t1.data_type,
		t1.is_complete,
		t1.reference_type,
		t1.is_other_corporation_done,
		t1.is_to_public_stream,
		t1.is_house_certificate_original,
		t1.is_check,
		t1.person_condition,
		t1.salesman_id,
		t1.salesman_code,
		t1.salesman_name,
		t1.city,
		t1.cre_type,
		(case t1.cre_type when '1' then '信贷产品' when '2' then '房贷产品' when '3' then '车贷产品' end) as
		cre_type_name,
		t1.bill_status,
		(select value_meaning from wms_sys_dict_data where value_code = bill_status
		and wms_sys_dict_id = 24)as bill_status_name,
		t1.water_appro_user_id,
		t1.water_appro_user_name,
		date_format(t1.water_appro_timestamp,'%Y-%m-%d %H:%i:%s') as water_appro_timestamp,
		t1.water_appro_result,
		t1.info_appro_user_id,
		t1.info_appro_user_name,
		date_format(t1.info_appro_timestamp,'%Y-%m-%d %H:%i:%s') as info_appro_timestamp,
		t1.info_appro_result,
		t1.phone_appro_user_id,
		t1.phone_appro_user_name,
		date_format(t1.phone_appro_timestamp,'%Y-%m-%d %H:%i:%s')as phone_appro_timestamp,
		t1.phone_appro_result,
		t1.certificate_appro_user_id,
		t1.certificate_appro_user_name,
		date_format(t1.certificate_appro_timestamp,'%Y-%m-%d %H:%i:%s') as certificate_appro_timestamp,
		t1.certificate_appro_result,
		t1.create_user_id,
		t1.create_user_name,
		date_format(t1.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t1.last_update_user_id,
		date_format(t1.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
		t1.enable_flag,
		t1.is_link_repeat,
		t1.profession_type,
		t1.is_verify,
		t1.house_appro_result,
		t1.cre_loan_type,
		t1.loan_interest_rate,
		t2.wms_cre_credit_line_customer_change_head_id,
		t2.wms_cre_credit_head_id,
		t2.wms_cus_customer_head_id,
		t2.customer_code,
		t2.customer_name,
		t2.customer_ever_name,
		t2.customer_category,
		t2.gender,
		t2.max_degree,
		date_format(t2.birthday,'%Y-%m-%d') as birthday,
		t2.id_card,
		t2.province,
		t2.city,
		t2.district,
		t2.address_more,
		t2.has_children,
		t2.children_name,
		t2.children_address,
		t2.children_telephone,
		t2.has_married,
		t2.has_house,
		t2.current_address_province,
		t2.current_address_city,
		t2.current_address_district,
		t2.current_address_more,
		t2.post_code,
		t2.fixed_telephone,
		t2.mobile_telephone1,
		t2.service_password1,
		t2.mobile_telephone2,
		t2.service_password2,
		t2.personal_year_income,
		t2.customer_email,
		t2.credit_card_limit,
		t2.common_occupants,
		t2.status,
		t2.create_user_id,
		t2.create_user_name,
		date_format(t2.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t2.last_update_user_id,
		date_format(t2.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
		t2.enable_flag,
		t1.is_review_back,
		t1.water_appro_result_page,
		t1.info_appro_result_page,
		t1.phone_appro_result_page,
		t1.certificate_appro_result_page,
		t1.inspection_appro_user_id,
		t1.inspection_appro_user_name,
		t1.inspection_appro_timestamp,
		t1.inspection_appro_result,
		t1.inspection_appro_advice,
		t1.inspection_appro_result_page,
		t1.create_user_city_code,
		t1.salesman_shortcode,
		t1.check_back_remark,
		CONCAT(t1.salesman_name,"/",t1.salesman_shortcode) as salesman_name_str
		from wms_cre_credit_head t1 left join
		wms_cre_credit_line_customer_change_head t2
		on t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id and
		t2.is_major='1'

		<where>
			<if test="customer_name != null">
				and t2.customer_name like '${customer_name}'
			</if>
			<if test="mobile_telephone != null">
				and (t2.mobile_telephone1 like '${mobile_telephone}' or
				t2.mobile_telephone2 like '${mobile_telephone}')
			</if>
			<if test="id_card != null">
				and t2.id_card like #{id_card}
			</if>
			<if test="idList !=null">
				and t1.wms_cre_credit_head_id in
				<foreach collection="idList" item="wms_cre_credit_head_id" index="index" open="(" separator="," close=")">
					#{wms_cre_credit_head_id}
				</foreach>
			</if>
			and t1.enable_flag='1'
			<if test="bill_code != null">
				and t1.bill_code like '${bill_code}'
			</if>
			<if test="bill_status!= null">
				and t1.bill_status=#{bill_status}
			</if>
			<if test="salesman_name != null">
				and (t1.salesman_name like '${salesman_name}' or t1.salesman_shortcode like '${salesman_name}')
			</if>
			<if test="salesman_shortcode!=null">
				and t1.salesman_shortcode like '${salesman_shortcode}'
			</if>
			<if test="create_timestamp_start != null">
			<![CDATA[
				and t1.create_timestamp >= #{create_timestamp_start}
			]]>
			</if>
			<if test="create_timestamp_end != null">
			<![CDATA[
				and t1.create_timestamp <  date_add(#{create_timestamp_end}, interval 1 day)
			]]>
			</if>
			<if test="create_timestamp != null and create_timestamp1!=null">
				and t1.create_timestamp between #{create_timestamp} and
				#{create_timestamp1}
			</if>
			<if test="create_user_id != null">
				and t1.create_user_id != #{create_user_id}
			</if>
			<if test="cre_type !=null">
				and t1.cre_type = #{cre_type}
			</if>
		</where>
		<if test="sortname != null and sortorder !=null">
			ORDER BY ${sortname} ${sortorder}
		</if>
		<if test="offset != null and pagesize !=null">
			LIMIT ${offset} , ${pagesize}
		</if>
	</select>
	<!-- 车贷查询列表 -->
	<select id="recheckForCar" parameterType="map" resultType="java.util.HashMap">
		select
		t1.wms_cre_credit_head_id,
		t1.bill_code,
		t1.credit_purpose,
		t1.max_repayment_limit_per_month,
		t1.credit_limit,
		t1.max_repayment_time_limit,
		t1.enter_file_way,
		t1.payroll_payment_way,
		t1.data_type,
		t1.is_complete,
		t1.reference_type,
		t1.is_other_corporation_done,
		t1.is_to_public_stream,
		t1.is_house_certificate_original,
		t1.is_check,
		t1.person_condition,
		t1.salesman_id,
		t1.salesman_code,
		t1.salesman_name,
		t1.city,
		t1.cre_type,
		(case t1.cre_type when '1' then '信贷产品' when '2' then '房贷产品' when '3' then '车贷产品' end)
		as
		cre_type_name,
		t1.bill_status,
		(select value_meaning from wms_sys_dict_data where value_code = bill_status
		and wms_sys_dict_id = 24)as bill_status_name,
		t1.water_appro_user_id,
		t1.water_appro_user_name,
		date_format(t1.water_appro_timestamp,'%Y-%m-%d %H:%i:%s') as water_appro_timestamp,
		t1.water_appro_result,
		t1.info_appro_user_id,
		t1.info_appro_user_name,
		date_format(t1.info_appro_timestamp,'%Y-%m-%d %H:%i:%s') as info_appro_timestamp,
		t1.info_appro_result,
		t1.phone_appro_user_id,
		t1.phone_appro_user_name,
		date_format(t1.phone_appro_timestamp,'%Y-%m-%d %H:%i:%s')as phone_appro_timestamp,
		t1.phone_appro_result,
		t1.certificate_appro_user_id,
		t1.certificate_appro_user_name,
		date_format(t1.certificate_appro_timestamp,'%Y-%m-%d %H:%i:%s') as certificate_appro_timestamp,
		t1.certificate_appro_result,
		t1.create_user_id,
		t1.create_user_name,
		date_format(t1.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t1.last_update_user_id,
		date_format(t1.last_update_timestamp,'%Y-%m-%d
		%H:%i:%s') as last_update_timestamp,
		t1.enable_flag,
		t1.is_link_repeat,
		t1.profession_type,
		t1.is_verify,
		t1.house_appro_result,
		t1.cre_loan_type,
		t1.loan_interest_rate,
		t2.wms_cre_credit_line_customer_change_head_id,
		t2.wms_cre_credit_head_id,
		t2.wms_cus_customer_head_id,
		t2.customer_code,
		t2.customer_name,
		t2.customer_ever_name,
		t2.customer_category,
		t2.gender,
		t2.max_degree,
		date_format(t2.birthday,'%Y-%m-%d') as birthday,
		t2.id_card,
		t2.province,
		t2.city,
		t2.district,
		t2.address_more,
		t2.has_children,
		t2.children_name,
		t2.children_address,
		t2.children_telephone,
		t2.has_married,
		t2.has_house,
		t2.current_address_province,
		t2.current_address_city,
		t2.current_address_district,
		t2.current_address_more,
		t2.post_code,
		t2.fixed_telephone,
		t2.mobile_telephone1,
		t2.service_password1,
		t2.mobile_telephone2,
		t2.service_password2,
		t2.personal_year_income,
		t2.customer_email,
		t2.credit_card_limit,
		t2.common_occupants,
		t2.status,
		t2.create_user_id,
		t2.create_user_name,
		date_format(t2.create_timestamp,'%Y-%m-%d %H:%i:%s') as
		create_timestamp,
		t2.last_update_user_id,
		date_format(t2.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
		t2.enable_flag,
		t1.is_review_back,
		t1.water_appro_result_page,
		t1.info_appro_result_page,
		t1.phone_appro_result_page,
		t1.certificate_appro_result_page,
		t1.inspection_appro_user_id,
		t1.inspection_appro_user_name,
		t1.inspection_appro_timestamp,
		t1.inspection_appro_result,
		t1.inspection_appro_advice,
		t1.inspection_appro_result_page,
		t1.create_user_city_code,
		t1.salesman_shortcode,
		t1.check_back_remark,
		CONCAT(t1.salesman_name,"/",t1.salesman_shortcode) as salesman_name_str
		from wms_cre_credit_head t1 left join
		wms_cre_credit_line_customer_change_head t2
		on t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id and
		t2.is_major='1'

		<where>
			<if test="customer_name != null">
				and t2.customer_name like '${customer_name}'
			</if>
			<if test="mobile_telephone != null">
				and (t2.mobile_telephone1 like '${mobile_telephone}' or
				t2.mobile_telephone2 like '${mobile_telephone}')
			</if>
			<if test="id_card != null">
				and t2.id_card = #{id_card}
			</if>
			<if test="idList !=null">
				and t1.wms_cre_credit_head_id in
				<foreach collection="idList" item="wms_cre_credit_head_id" index="index" open="(" separator="," close=")">
					#{wms_cre_credit_head_id}
				</foreach>
			</if>
			and t1.enable_flag='1'
			<if test="bill_code != null">
				and t1.bill_code like '${bill_code}'
			</if>
			<if test="bill_status!= null">
				and t1.bill_status=#{bill_status}
			</if>
			<if test="salesman_name != null">
				and (t1.salesman_name like '${salesman_name}' or t1.salesman_shortcode like '${salesman_name}')
			</if>
			<if test="salesman_shortcode!=null">
				and t1.salesman_shortcode like '${salesman_shortcode}'
			</if>
			<if test="create_timestamp_start != null">
			<![CDATA[
				and t1.create_timestamp >= #{create_timestamp_start}
			]]>
			</if>
			<if test="create_timestamp_end != null">
			<![CDATA[
				and t1.create_timestamp <  date_add(#{create_timestamp_end}, interval 1 day)
			]]>
			</if>
			<if test="customer_name != null">
				and t1.customer_name like '${customer_name}'
			</if>
			<if test="create_timestamp != null and create_timestamp1!=null">
				and t1.create_timestamp between #{create_timestamp} and
				#{create_timestamp1}
			</if>
			<if test="create_user_id != null">
				and t1.create_user_id = #{create_user_id}
			</if>
			<if test="cre_type !=null">
				and t1.cre_type = #{cre_type}
			</if>
		</where>
		<if test="sortname != null and sortorder !=null">
			ORDER BY ${sortname} ${sortorder}
		</if>
		<if test="offset != null and pagesize !=null">
			LIMIT ${offset} , ${pagesize}
		</if>
	</select>

	<!-- 查询复核退回和贷前退回数量 -->
	<select id="findCountRecheck" parameterType="map" resultType="int">
		select count(t1.wms_cre_credit_head_id) as count
		from
		wms_cre_credit_head t1 left join
		wms_cre_credit_line_customer_change_head t2
		on
		t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id and
		t2.is_major='1'

		<where>
			and t1.create_user_city_code = #{create_user_city_code}
			<if test="id_card != null">
				and t2.id_card = #{id_card}
			</if>
			<if test="idList !=null">
				and t1.wms_cre_credit_head_id in
				<foreach collection="idList" item="wms_cre_credit_head_id" index="index" open="(" separator="," close=")">
					#{wms_cre_credit_head_id}
				</foreach>
			</if>
			and t1.enable_flag='1'
			<if test="bill_code != null">
				and t1.bill_code like '${bill_code}'
			</if>
			<if test="bill_status!= null">
				and t1.bill_status=#{bill_status}
			</if>
			<if test="salesman_name != null">
				and t1.salesman_name like '${salesman_name}'
			</if>
			<if test="salesman_shortcode!=null">
				and t1.salesman_shortcode like '${salesman_shortcode}'
			</if>
			<if test="create_timestamp != null and create_timestamp1!=null">
				and t1.create_timestamp between #{create_timestamp} and
				#{create_timestamp1}
			</if>
			<if test="create_user_id != null">
				and t1.create_user_id = #{create_user_id}
			</if>
			<if test="cre_type !=null">
				and t1.cre_type = #{cre_type}
			</if>
		</where>
	</select>

	<!-- 查询房产初评列表 -->
	    <select id="housePreLiminaryAssessmentList" parameterType="map" resultType="java.util.HashMap">
        select
	        t1.wms_cre_credit_head_id,
	        t1.bill_code,
	        t1.credit_purpose,
	        t1.max_repayment_limit_per_month,
	        t1.credit_limit,
	        t1.max_repayment_time_limit,
	        t1.enter_file_way,
	        t1.payroll_payment_way,
	        t1.data_type,
	        t1.is_complete,
	        t1.credit_limit,
	        t1.reference_type,
	        t1.is_other_corporation_done,
	        t1.is_to_public_stream,
	        t1.is_house_certificate_original,
	        t1.is_check,
	        t1.person_condition,
	        t1.salesman_id,
	        t1.salesman_code,
	        t1.salesman_name,
	        t1.city,
	        t1.cre_type,
	        t1.bill_status,
	        (select value_meaning from wms_sys_dict_data where value_code = bill_status
	        and wms_sys_dict_id = 131) as bill_status_name,
	        t1.water_appro_user_id,
	        t1.water_appro_user_name,
	        date_format(t1.water_appro_timestamp,'%Y-%m-%d %H:%i:%s') as water_appro_timestamp,
	        t1.water_appro_result,
	        t1.info_appro_user_id,
	        t1.info_appro_user_name,
	        date_format(t1.info_appro_timestamp,'%Y-%m-%d %H:%i:%s') as info_appro_timestamp,
	        t1.info_appro_result,
	        t1.phone_appro_user_id,
	        t1.phone_appro_user_name,
	        date_format(t1.phone_appro_timestamp,'%Y-%m-%d %H:%i:%s')as phone_appro_timestamp,
	        t1.phone_appro_result,
	        t1.certificate_appro_user_id,
	        t1.certificate_appro_user_name,
	
	        date_format(t1.certificate_appro_timestamp,'%Y-%m-%d %H:%i:%s') as certificate_appro_timestamp,
	        t1.certificate_appro_result,
	
	        t1.create_user_id,
	        t1.create_user_name,
	        date_format(t1.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
	        t1.last_update_user_id,
	        date_format(t1.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
	        t1.enable_flag,
	        t1.is_link_repeat,
	        t1.profession_type,
	        t1.is_verify,
	        t1.house_appro_result,
	        t1.cre_loan_type,
	        (select value_meaning from wms_sys_dict_data where value_code = t1.cre_loan_type
	        and wms_sys_dict_id = 75)as cre_loan_type_name,
	        t1.loan_interest_rate,
	        t1.salesman_city_code,
	        
	        t2.wms_cre_credit_line_customer_change_head_id,
	        t2.wms_cre_credit_head_id,
	        t2.wms_cus_customer_head_id,
	        t2.customer_code,
	        t2.customer_name,
	        t2.customer_ever_name,
	        t2.customer_category,
	        t2.gender,
	        t2.max_degree,
	        date_format(t2.birthday,'%Y-%m-%d') as birthday,
	        t2.id_card,
	        t2.province,
	        t2.city,
	        t2.district,
	        t2.address_more,
	        t2.has_children,
	        t2.children_name,
	        t2.children_address,
	        t2.children_telephone,
	        t2.has_married,
	        t2.has_house,
	        t2.current_address_province,
	        t2.current_address_city,
	        t2.current_address_district,
	        t2.current_address_more,
	        t2.post_code,
	        t2.fixed_telephone,
	        t2.mobile_telephone1,
	        t2.service_password1,
	        t2.mobile_telephone2,
	        t2.service_password2,
	        t2.personal_year_income,
	        t2.customer_email,
	        t2.credit_card_limit,
	        t2.common_occupants,
	        t2.status,
	        t2.create_user_id,
	        t2.create_user_name,
	        date_format(t2.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
	        t2.last_update_user_id,
	        date_format(t2.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
	        t2.enable_flag,
	        t1.is_review_back,
	        t1.water_appro_result_page,
	        t1.info_appro_result_page,
	        t1.phone_appro_result_page,
	        t1.certificate_appro_result_page,
	        t1.house_appro_result_page,
	        t1.salesman_shortcode,
	        t1.create_user_city_code,
	        CONCAT(t1.salesman_name,"/",t1.salesman_shortcode) as salesman_name_str,
	        (case when t1.create_timestamp &lt; #{hprocess_time} then '1' else '2' end) as edition_num, 
	        t1.version_number,
	        t1.mort_flag,
			(SELECT  value_meaning from wms_sys_dict_data  where wms_sys_dict_id=146 AND value_code=t1.mort_flag) as mort_flag_name, 
	        '房贷产品' as product_type
        from wms_cre_credit_head t1, wms_cre_credit_line_customer_change_head t2
    		LEFT JOIN  (SELECT a.approval_result, 
                       a.wms_cre_credit_head_id,
    			       a.wms_cre_housing_approval_info,
    			       a.approval_time
    			  FROM wms_cre_housing_approval_info a,
    			       (select max(wms_cre_housing_approval_info) AS wms_cre_housing_approval_info 
    			          from wms_cre_housing_approval_info
    			         where enable_flag = '1' 
    			           and approval_task_code = "DKSQ" 
    			           and approval_result = "revise" 
    		          GROUP BY wms_cre_credit_head_id) b WHERE a.wms_cre_housing_approval_info = b.wms_cre_housing_approval_info
    		    ) t3  ON t2.wms_cre_credit_head_id = t3.wms_cre_credit_head_id
        <where>
            t1.wms_cre_credit_head_id = t2.wms_cre_credit_head_id 
            and t2.is_major = '1' 
            and t1.cre_type = '2'
            and t1.bill_status = 'B'
            and t1.version_number = 3
            <if test="id_card != null">
                and t2.id_card like #{id_card}
            </if>
            <if test="idList != null">
                and t1.wms_cre_credit_head_id in
                <foreach collection="idList" item="wms_cre_credit_head_id"
                    index="index" open="(" separator="," close=")">
                    #{wms_cre_credit_head_id}
                </foreach>
            </if>
            and t1.enable_flag = '1'
            <if test="bill_code != null">
                and t1.bill_code like '${bill_code}'
            </if>
            <if test="customer_name != null">
                and t2.customer_name like '${customer_name}'
            </if>
            <if test="create_user_id != null">
                and t1.create_user_id != #{create_user_id}
            </if>
            <if test="mobile_telephone != null">
                and (t2.mobile_telephone1 like '${mobile_telephone}' or
                t2.mobile_telephone2 like '${mobile_telephone}')
            </if>
            <if test="salesman_name_str != null">
                and (t1.salesman_name like '${salesman_name_str}' 
                 or t1.salesman_shortcode like '${salesman_name_str}')
            </if>
            <if test="create_timestamp_start != null">
				and date_format(t1.create_timestamp, '%Y-%m-%d') &gt;= #{create_timestamp_start}
			</if>
			<if test="create_timestamp_end != null">
				and date_format(t1.create_timestamp, '%Y-%m-%d') &lt;= #{create_timestamp_end}
			</if>
			<if test="salesman_city_code != null">
				and t1.salesman_city_code = #{salesman_city_code}
			</if>
            <!-- 权限控制 -->
			<if test="childrendept != null">
				and (FIND_IN_SET(t1.salesman_dept_id, #{childrendept}) > 0)
			</if>
			<if test="mort_flag != null">
				and t1.mort_flag = #{mort_flag}
			</if>
        </where>
        <if test="sortname != null and sortorder != null">
            ORDER BY ${sortname} ${sortorder}
        </if>
        <if test="offset != null and pagesize != null">
            LIMIT ${offset} , ${pagesize}
        </if>
    </select>
    
	<!-- 查询房产初评数据条数 -->
	<select id="housePreLiminaryAssessmentCount" parameterType="map" resultType="int">
		select count(t1.wms_cre_credit_head_id) as count
		from
		wms_cre_credit_head t1,wms_cre_credit_line_customer_change_head t2
		<where>
			t1.wms_cre_credit_head_id = t2.wms_cre_credit_head_id
			and t2.is_major = '1'
			and t1.cre_type = '2'
			and t1.bill_status = 'B'
			and t1.version_number = 3
			<if test="id_card != null">
				and t2.id_card like #{id_card}
			</if>
			<if test="idList != null">
				and t1.wms_cre_credit_head_id in
				<foreach collection="idList" item="wms_cre_credit_head_id" index="index" open="(" separator="," close=")">
					#{wms_cre_credit_head_id}
				</foreach>
			</if>
			and t1.enable_flag = '1'
			<if test="bill_code != null">
				and t1.bill_code like '${bill_code}'
			</if>
			<if test="customer_name != null">
				and t2.customer_name like '${customer_name}'
			</if>
			<if test="create_user_id != null">
				and t1.create_user_id != #{create_user_id}
			</if>
			<if test="mobile_telephone != null">
				and (t2.mobile_telephone1 like '${mobile_telephone}' or
				t2.mobile_telephone2 like '${mobile_telephone}')
			</if>
			<if test="salesman_name_str != null">
				and (t1.salesman_name like '${salesman_name_str}'
				or t1.salesman_shortcode like '${salesman_name_str}')
			</if>
			<if test="create_timestamp_start != null">
				and date_format(t1.create_timestamp, '%Y-%m-%d') &gt;= #{create_timestamp_start}
			</if>
			<if test="create_timestamp_end != null">
				and date_format(t1.create_timestamp, '%Y-%m-%d') &lt;= #{create_timestamp_end}
			</if>
			<if test="salesman_city_code != null">
				and t1.salesman_city_code = #{salesman_city_code}
			</if>
			<!-- 权限控制 -->
			<if test="childrendept != null">
				and (FIND_IN_SET(t1.salesman_dept_id, #{childrendept}) > 0)
			</if>
			<if test="mort_flag != null">
				and t1.mort_flag = #{mort_flag}
			</if>
		</where>
	</select>
	<!-- 更新用户 房贷新流程使用 -->
	<update id="updateforhouse" parameterType="WmsCreCreditHead">
		update wms_cre_credit_head
		<set>
			<if test="wms_cre_credit_head_id != null">
				wms_cre_credit_head_id = #{wms_cre_credit_head_id},
			</if>
			<if test="bill_code != null">
				bill_code = #{bill_code},
			</if>
			<if test="credit_purpose != null">
				credit_purpose = #{credit_purpose},
			</if>
			<if test="max_repayment_limit_per_month != null">
				max_repayment_limit_per_month = #{max_repayment_limit_per_month},
			</if>
			<if test="credit_limit != null">
				credit_limit = #{credit_limit},
			</if>
			<if test="max_repayment_time_limit != null">
				max_repayment_time_limit = #{max_repayment_time_limit},
			</if>
			<if test="enter_file_way != null">
				enter_file_way = #{enter_file_way},
			</if>
			<if test="payroll_payment_way != null">
				payroll_payment_way = #{payroll_payment_way},
			</if>
			<if test="data_type != null">
				data_type = #{data_type},
			</if>
			<if test="is_complete != null">
				is_complete = #{is_complete},
			</if>
			<if test="reference_type != null">
				reference_type = #{reference_type},
			</if>
			<if test="is_other_corporation_done != null">
				is_other_corporation_done = #{is_other_corporation_done},
			</if>
			<if test="is_to_public_stream != null">
				is_to_public_stream = #{is_to_public_stream},
			</if>
			<if test="is_house_certificate_original != null">
				is_house_certificate_original = #{is_house_certificate_original},
			</if>
			<if test="is_check != null">
				is_check = #{is_check},
			</if>
			<if test="person_condition != null">
				person_condition = #{person_condition},
			</if>
			<if test="salesman_id != null">
				salesman_id = #{salesman_id},
			</if>
			<if test="salesman_code != null">
				salesman_code = #{salesman_code},
			</if>
			<if test="salesman_name != null">
				salesman_name = #{salesman_name},
			</if>
			<if test="city != null">
				city = #{city},
			</if>
			<if test="cre_type != null">
				cre_type = #{cre_type},
			</if>
			<if test="bill_status != null">
				bill_status = #{bill_status},
			</if>
			<if test="water_appro_user_id != null">
				water_appro_user_id = #{water_appro_user_id},
			</if>
			<if test="water_appro_user_name != null">
				water_appro_user_name = #{water_appro_user_name},
			</if>
			<if test="water_appro_timestamp != null">
				water_appro_timestamp = #{water_appro_timestamp},
			</if>
			<if test="water_appro_result != null">
				water_appro_result = #{water_appro_result},
			</if>
			<if test="info_appro_user_id != null">
				info_appro_user_id = #{info_appro_user_id},
			</if>
			<if test="info_appro_user_name != null">
				info_appro_user_name = #{info_appro_user_name},
			</if>
			<if test="info_appro_timestamp != null">
				info_appro_timestamp = #{info_appro_timestamp},
			</if>
			<if test="info_appro_result != null">
				info_appro_result = #{info_appro_result},
			</if>
			<if test="phone_appro_user_id != null">
				phone_appro_user_id = #{phone_appro_user_id},
			</if>
			<if test="phone_appro_user_name != null">
				phone_appro_user_name = #{phone_appro_user_name},
			</if>
			<if test="phone_appro_timestamp != null">
				phone_appro_timestamp = #{phone_appro_timestamp},
			</if>
			<if test="phone_appro_result != null">
				phone_appro_result = #{phone_appro_result},
			</if>
			<if test="certificate_appro_user_id != null">
				certificate_appro_user_id = #{certificate_appro_user_id},
			</if>
			<if test="certificate_appro_user_name != null">
				certificate_appro_user_name = #{certificate_appro_user_name},
			</if>
			<if test="certificate_appro_timestamp != null">
				certificate_appro_timestamp = #{certificate_appro_timestamp},
			</if>
			<if test="certificate_appro_result != null">
				certificate_appro_result = #{certificate_appro_result},
			</if>
			<if test="create_user_id != null">
				create_user_id = #{create_user_id},
			</if>
			<if test="create_user_name != null">
				create_user_name = #{create_user_name},
			</if>
			<if test="create_timestamp != null">
				create_timestamp = #{create_timestamp},
			</if>
			<if test="last_update_user_id != null">
				last_update_user_id = #{last_update_user_id},
			</if>
			<if test="last_update_timestamp != null">
				last_update_timestamp = #{last_update_timestamp},
			</if>
			<if test="enable_flag != null">
				enable_flag = #{enable_flag},
			</if>
			<if test="protocol_amount != null">
				protocol_amount = #{protocol_amount},
			</if>
			<if test="is_link_repeat != null">
				is_link_repeat = #{is_link_repeat},
			</if>
			<if test="profession_type != null">
				profession_type = #{profession_type},
			</if>
			<if test="is_verify != null">
				is_verify = #{is_verify},
			</if>
			<if test="is_guarantee != null">
				is_guarantee = #{is_guarantee},
			</if>
			<if test="house_appro_user_id != null">
				house_appro_user_id = #{house_appro_user_id},
			</if>
			<if test="house_appro_user_name != null">
				house_appro_user_name = #{house_appro_user_name},
			</if>
			<if test="house_appro_timestamp != null">
				house_appro_timestamp = #{house_appro_timestamp},
			</if>
			<if test="house_appro_result != null">
				house_appro_result = #{house_appro_result},
			</if>
			<if test="cre_loan_type != null">
				cre_loan_type = #{cre_loan_type},
			</if>
			<if test="loan_interest_rate != null">
				loan_interest_rate = #{loan_interest_rate},
			</if>
			<if test="is_review_back != null">
				is_review_back = #{is_review_back},
			</if>
			<if test="check_back_remark != null">
				check_back_remark = #{check_back_remark},
			</if>
			<if test="water_appro_advice != null">
				water_appro_advice = #{water_appro_advice},
			</if>
			<if test="info_appro_advice != null">
				info_appro_advice = #{info_appro_advice},
			</if>
			<if test="phone_appro_advice != null">
				phone_appro_advice = #{phone_appro_advice},
			</if>
			<if test="certificate_appro_advice != null">
				certificate_appro_advice = #{certificate_appro_advice},
			</if>
			<if test="house_appro_advice != null">
				house_appro_advice = #{house_appro_advice},
			</if>
			<if test="phone_appro_eval != null">
				phone_appro_eval = #{phone_appro_eval},
			</if>
			<if test="water_appro_eval != null">
				water_appro_eval = #{water_appro_eval},
			</if>
			<if test="visa_limit != null">
				visa_limit = #{visa_limit},
			</if>
			<if test="appro_limit != null">
				appro_limit = #{appro_limit},
			</if>
			<if test="water_appro_result_page != null">
				water_appro_result_page = #{water_appro_result_page},
			</if>
			<if test="info_appro_result_page != null">
				info_appro_result_page = #{info_appro_result_page},
			</if>
			<if test="phone_appro_result_page != null">
				phone_appro_result_page = #{phone_appro_result_page},
			</if>
			<if test="certificate_appro_result_page != null">
				certificate_appro_result_page = #{certificate_appro_result_page},
			</if>
			<if test="house_appro_result_page != null">
				house_appro_result_page = #{house_appro_result_page},
			</if>
			<if test="model_one_amount != null">
				model_one_amount = #{model_one_amount},
			</if>
			<if test="model_two_amount != null">
				model_two_amount = #{model_two_amount},
			</if>
			<if test="model_three_amount != null">
				model_three_amount = #{model_three_amount},
			</if>
			<if test="model_four_amount != null">
				model_four_amount = #{model_four_amount},
			</if>
			<if test="inspection_appro_user_id != null">
				inspection_appro_user_id = #{inspection_appro_user_id},
			</if>
			<if test="inspection_appro_user_name != null">
				inspection_appro_user_name = #{inspection_appro_user_name},
			</if>
			<if test="inspection_appro_timestamp != null">
				inspection_appro_timestamp = #{inspection_appro_timestamp},
			</if>
			<if test="inspection_appro_result != null">
				inspection_appro_result = #{inspection_appro_result},
			</if>
			<if test="inspection_appro_advice != null">
				inspection_appro_advice = #{inspection_appro_advice},
			</if>
			<if test="inspection_appro_result_page != null">
				inspection_appro_result_page = #{inspection_appro_result_page},
			</if>
			<if test="salesman_city_code != null">
				salesman_city_code = #{salesman_city_code},
			</if>
			<if test="create_user_dept_id != null">
				create_user_dept_id = #{create_user_dept_id},
			</if>
			<if test="create_user_city_code != null">
				create_user_city_code = #{create_user_city_code},
			</if>
			<if test="salesman_dept_id != null">
				salesman_dept_id = #{salesman_dept_id},
			</if>
			<if test="salesman_shortcode != null">
				salesman_shortcode = #{salesman_shortcode},
			</if>
			<if test="max_repayment_time_limit_backup != null">
				max_repayment_time_limit_backup = #{max_repayment_time_limit_backup},
			</if>
			<if test="cre_loan_type_backup != null">
				cre_loan_type_backup = #{cre_loan_type_backup},
			</if>
			<if test="review_the_reasons != null">
				review_the_reasons = #{review_the_reasons},
			</if>
			<if test="review_of_time != null">
				review_of_time = #{review_of_time},
			</if>
			<if test="is_cycles != null">
				is_cycles = #{is_cycles},
			</if>
			<if test="lending_rates_execution_cycles != null">
				lending_rates_execution_cycles = #{lending_rates_execution_cycles},
			</if>
			<if test="trial_interview_uid != null">
				trial_interview_uid = #{trial_interview_uid},
			</if>
			<if test="trial_interview_uname != null">
				trial_interview_uname = #{trial_interview_uname},
			</if>
			<if test="trial_interview_timestamp != null">
				trial_interview_timestamp = #{trial_interview_timestamp},
			</if>
			<if test="trial_interview_result != null">
				trial_interview_result = #{trial_interview_result},
			</if>
			<if test="trial_interview_advice != null">
				trial_interview_advice = #{trial_interview_advice},
			</if>
			<if test="nullify_type != null">
				nullify_type = #{nullify_type},
			</if>
			<if test="nullify_user_name != null">
				nullify_user_name = #{nullify_user_name},
			</if>
			<if test="nullify_user_id != null">
				nullify_user_id = #{nullify_user_id},
			</if>
			<if test="nullify_timestamp != null">
				nullify_timestamp = #{nullify_timestamp},
			</if>
			<if test="nullify_reason != null">
				nullify_reason = #{nullify_reason},
			</if>
			<if test="documentary_opinion != null">
				documentary_opinion = #{documentary_opinion},
			</if>
			<if test="final_eval != null">
				final_eval = #{final_eval},
			</if>
			<if test="face_trial_eval != null">
				face_trial_eval = #{face_trial_eval},
			</if>
			<if test="credit_limit_backup != null">
				credit_limit_backup = #{credit_limit_backup},
			</if>
			<if test="is_xudai != null">
				is_xudai = #{is_xudai},
			</if>
			<if test="commission_rate != null">
				commission_rate = #{commission_rate},
			</if>
			<if test="commission_fee != null">
				commission_fee = #{commission_fee},
			</if>
			<if test="is_vehicle != null">
				is_vehicle = #{is_vehicle},
			</if>
			<if test="assessment_id != null">
				assessment_id = #{assessment_id},
			</if>
			<if test="assessment_datetime != null">
				assessment_datetime = #{assessment_datetime},
			</if>
			<if test="assessment_result != null">
				assessment_result = #{assessment_result},
			</if>
			<if test="assessment_advice != null">
				assessment_advice = #{assessment_advice},
			</if>
			<if test="assessment_result_page != null">
				assessment_result_page = #{assessment_result_page},
			</if>
			<if test="mort_flag != null">
				mort_flag = #{mort_flag},
			</if>
		</set>
		where
		wms_cre_credit_head_id = #{wms_cre_credit_head_id}
	</update>

	<!-- 根据主键查询贷款主表(返回类型为map 包含新旧流程区分标识1:旧流程 2:新流程) -->
	<select id="searchWmsCreCreditHeadByMap" resultType="java.util.HashMap" parameterType="map">
		select T.*,(case when T.create_timestamp &lt; #{hprocess_time} then '1' else '2' end) as edition_num
		from wms_cre_credit_head T
		where
		wms_cre_credit_head_id = #{wms_cre_credit_head_id}
		and T.enable_flag = '1'
	</select>
	<!-- 查询WmsCreCreditHead 返回业务员信息 -->
	<select id="getHeadSalesman" parameterType="map" resultType="java.util.HashMap">
		select
		wms_cre_credit_head_id,
		city,
		salesman_id,
		salesman_code,
		salesman_name,
		salesman_shortcode,
		salesman_city_code,
		salesman_dept_id
		from wms_cre_credit_head
		where
		wms_cre_credit_head_id =#{wms_cre_credit_head_id}
	</select>

	<!-- 更新记录 -->
	<update id="updateWmsCreCreditHead" parameterType="WmsCreCreditHead">
		update wms_cre_credit_head
		<set>
			<if test="wms_cre_credit_head_id != null">
				wms_cre_credit_head_id = #{wms_cre_credit_head_id},
			</if>
			<if test="bill_code != null">
				bill_code = #{bill_code},
			</if>
			<if test="credit_purpose != null">
				credit_purpose = #{credit_purpose},
			</if>
			<if test="max_repayment_limit_per_month != null">
				max_repayment_limit_per_month = #{max_repayment_limit_per_month},
			</if>
			<if test="credit_limit != null">
				credit_limit = #{credit_limit},
			</if>
			<if test="appro_limit != null">
				appro_limit = #{appro_limit},
			</if>
			<if test="max_repayment_time_limit != null">
				max_repayment_time_limit = #{max_repayment_time_limit},
			</if>
			<if test="enter_file_way != null">
				enter_file_way = #{enter_file_way},
			</if>
			<if test="payroll_payment_way != null">
				payroll_payment_way = #{payroll_payment_way},
			</if>
			<if test="data_type != null">
				data_type = #{data_type},
			</if>
			<if test="is_complete != null">
				is_complete = #{is_complete},
			</if>
			<if test="reference_type != null">
				reference_type = #{reference_type},
			</if>
			<if test="is_other_corporation_done != null">
				is_other_corporation_done = #{is_other_corporation_done},
			</if>
			<if test="is_to_public_stream != null">
				is_to_public_stream = #{is_to_public_stream},
			</if>
			<if test="is_house_certificate_original != null">
				is_house_certificate_original = #{is_house_certificate_original},
			</if>
			<if test="is_check != null">
				is_check = #{is_check},
			</if>
			<if test="person_condition != null">
				person_condition = #{person_condition},
			</if>
			<if test="salesman_id != null">
				salesman_id = #{salesman_id},
			</if>
			<if test="salesman_code != null">
				salesman_code = #{salesman_code},
			</if>
			<if test="salesman_name != null">
				salesman_name = #{salesman_name},
			</if>
			<if test="city != null">
				city = #{city},
			</if>
			<if test="bill_status != null">
				bill_status = #{bill_status},
			</if>
			<if test="cre_type != null">
				cre_type = #{cre_type},
			</if>
			<if test="create_user_id != null">
				create_user_id = #{create_user_id},
			</if>
			<if test="create_user_name != null">
				create_user_name = #{create_user_name},
			</if>
			<if test="create_timestamp != null">
				create_timestamp = #{create_timestamp},
			</if>
			<if test="last_update_user_id != null">
				last_update_user_id = #{last_update_user_id},
			</if>
			<if test="last_update_timestamp != null">
				last_update_timestamp = #{last_update_timestamp},
			</if>
			<if test="enable_flag != null">
				enable_flag = #{enable_flag},
			</if>
			<if test="is_link_repeat != null">
				is_link_repeat = #{is_link_repeat},
			</if>
			<if test="profession_type != null">
				profession_type = #{profession_type},
			</if>
			<if test="is_verify != null">
				is_verify = #{is_verify},
			</if>
			<if test="cre_loan_type != null">
				cre_loan_type = #{cre_loan_type},
			</if>
			<if test="loan_interest_rate != null">
				loan_interest_rate = #{loan_interest_rate},
			</if>
			<if test="create_user_dept_id != null">
				create_user_dept_id = #{create_user_dept_id},
			</if>
			<if test="salesman_city_code != null">
				salesman_city_code = #{salesman_city_code},
			</if>
			<if test="salesman_dept_id != null">
				salesman_dept_id = #{salesman_dept_id},
			</if>
			<if test="create_user_city_code != null">
				create_user_city_code = #{create_user_city_code},
			</if>
			<if test="salesman_shortcode != null">
				salesman_shortcode = #{salesman_shortcode},
			</if>
			<if test="max_repayment_time_limit_backup != null">
				max_repayment_time_limit_backup = #{max_repayment_time_limit_backup},
			</if>
			<if test="cre_loan_type_backup != null">
				cre_loan_type_backup = #{cre_loan_type_backup},
			</if>
			<if test="is_cycles != null">
				is_cycles = #{is_cycles},
			</if>
			<if test="documentary_opinion != null">
				documentary_opinion = #{documentary_opinion},
			</if>
			<if test="lending_rates_execution_cycles != null">
				lending_rates_execution_cycles = #{lending_rates_execution_cycles},
			</if>
			<if test="final_eval != null">
				final_eval = #{final_eval},
			</if>
			<if test="face_trial_eval != null">
				face_trial_eval = #{face_trial_eval},
			</if>
			<if test="is_xudai != null">
				is_xudai = #{is_xudai},
			</if>
			<if test="commission_rate != null">
				commission_rate = #{commission_rate},
			</if>
			<if test="commission_fee != null">
				commission_fee = #{commission_fee},
			</if>
			<if test="credit_limit_backup != null">
				credit_limit_backup = #{credit_limit_backup},
			</if>
			<if test="is_vehicle != null">
				is_vehicle = #{is_vehicle},
			</if>
			<if test="assessment_id != null">
				assessment_id = #{assessment_id},
			</if>
			<if test="assessment_datetime != null">
				assessment_datetime = #{assessment_datetime},
			</if>
			<if test="assessment_result != null">
				assessment_result = #{assessment_result},
			</if>
			<if test="assessment_advice != null">
				assessment_advice = #{assessment_advice},
			</if>
			<if test="assessment_result_page != null">
				assessment_result_page = #{assessment_result_page},
			</if>
		</set>
		where wms_cre_credit_head_id = #{wms_cre_credit_head_id}
	</update>

	<!-- 查询房贷单据信息完善列表 -->
	<select id="getHouseLoanCompletedList" parameterType="map" resultType="java.util.HashMap">
		select
		t1.wms_cre_credit_head_id,
		t1.bill_code,
		t1.credit_purpose,
		t1.max_repayment_limit_per_month,
		t1.credit_limit,
		t1.max_repayment_time_limit,
		t1.enter_file_way,
		t1.payroll_payment_way,
		t1.data_type,
		t1.is_complete,
		t1.credit_limit,
		t1.reference_type,
		t1.is_other_corporation_done,
		t1.is_to_public_stream,
		t1.is_house_certificate_original,
		t1.is_check,
		t1.person_condition,
		t1.salesman_id,
		t1.salesman_code,
		t1.salesman_name,
		t1.city,
		t1.cre_type,
		t1.bill_status,
		(select value_meaning from wms_sys_dict_data where value_code = bill_status
		and wms_sys_dict_id = 131) as bill_status_name,
		t1.water_appro_user_id,
		t1.water_appro_user_name,
		date_format(t1.water_appro_timestamp,'%Y-%m-%d %H:%i:%s') as water_appro_timestamp,
		t1.water_appro_result,
		t1.info_appro_user_id,
		t1.info_appro_user_name,
		date_format(t1.info_appro_timestamp,'%Y-%m-%d %H:%i:%s') as info_appro_timestamp,
		t1.info_appro_result,
		t1.phone_appro_user_id,
		t1.phone_appro_user_name,
		date_format(t1.phone_appro_timestamp,'%Y-%m-%d %H:%i:%s')as phone_appro_timestamp,
		t1.phone_appro_result,
		t1.certificate_appro_user_id,
		t1.certificate_appro_user_name,
		date_format(t1.certificate_appro_timestamp,'%Y-%m-%d %H:%i:%s') as certificate_appro_timestamp,
		t1.certificate_appro_result,
		t1.create_user_id,
		t1.create_user_name,
		date_format(t1.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t1.last_update_user_id,
		date_format(t1.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
		t1.enable_flag,
		t1.is_link_repeat,
		t1.profession_type,
		t1.is_verify,
		t1.house_appro_result,
		t1.cre_loan_type,
		(select value_meaning from wms_sys_dict_data where wms_sys_dict_data_id = t1.cre_loan_type
		and wms_sys_dict_id = 27) as cre_loan_type_name,
		t1.loan_interest_rate,
		t2.wms_cre_credit_line_customer_change_head_id,
		t2.wms_cre_credit_head_id,
		t2.wms_cus_customer_head_id,
		t2.customer_code,
		t2.customer_name,
		t2.customer_ever_name,
		t2.customer_category,
		t2.gender,
		t2.max_degree,
		date_format(t2.birthday,'%Y-%m-%d') as birthday,
		ifnull(t2.id_card, '') as id_card,
		t2.province,
		t2.city,
		t2.district,
		t2.address_more,
		t2.has_children,
		t2.children_name,
		t2.children_address,
		t2.children_telephone,
		t2.has_married,
		t2.has_house,
		t2.current_address_province,
		t2.current_address_city,
		t2.current_address_district,
		t2.current_address_more,
		t2.post_code,
		t2.fixed_telephone,
		t2.mobile_telephone1,
		t2.service_password1,
		t2.mobile_telephone2,
		t2.service_password2,
		t2.personal_year_income,
		t2.customer_email,
		t2.credit_card_limit,
		t2.common_occupants,
		t2.status,
		t2.create_user_id,
		t2.create_user_name,
		date_format(t2.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t2.last_update_user_id,
		date_format(t2.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
		t2.enable_flag,
		t1.is_review_back,
		t1.water_appro_result_page,
		t1.info_appro_result_page,
		t1.phone_appro_result_page,
		t1.certificate_appro_result_page,
		t1.house_appro_result_page,
		t1.salesman_shortcode,
		t1.create_user_city_code,
		CONCAT(t1.salesman_name,"/", t1.salesman_shortcode) as salesman_name_str,
		t1.version_number,
		t1.mort_flag,
		(SELECT  value_meaning from wms_sys_dict_data  where wms_sys_dict_id=146 AND value_code=t1.mort_flag) as mort_flag_name,
		'房贷产品' as product_type
		from wms_cre_credit_head t1, wms_cre_credit_line_customer_change_head t2
		<where>
			t1.wms_cre_credit_head_id = t2.wms_cre_credit_head_id
			and t2.is_major = '1'
			and t1.cre_type = '2'
			and t1.enable_flag = '1'
			<!--房贷：A 草稿 B待复核 C待贷前审核 D待终审 E待放款准备 F待放款审核 G待放款 H已完成 Z终止 I 复核退回 J 补件中 K待审批 L待初评预估 M合同完善完成 N授信确认 O 房产核查缴费 P初评退件 Q 终审退件 -->
			<!-- 志刚在2017年3月29日说除了草稿状态都可以完善 -->
			and t1.bill_status NOT IN ('A')
			and t1.version_number = '3'
			<!-- 因需求要求 现单据 沈阳可以看到鞍山单据 鞍山没有网引起 -->
			<if test="create_user_city_code != null">
				and t1.create_user_city_code = #{create_user_city_code}
			</if>
			<if test="id_card != null">
				and t2.id_card like #{id_card}
			</if>
			<if test="idList != null">
				and t1.wms_cre_credit_head_id in
				<foreach collection="idList" item="wms_cre_credit_head_id" index="index" open="(" separator="," close=")">
					#{wms_cre_credit_head_id}
				</foreach>
			</if>
			<if test="bill_code != null">
				and t1.bill_code like '${bill_code}'
			</if>
			<if test="create_timestamp != null">
				and date_format(t1.create_timestamp, '%Y-%m-%d') = #{create_timestamp}
			</if>
			<if test="create_timestamp_start != null">
				and date_format(t1.create_timestamp,'%Y-%m-%d') &gt;= #{create_timestamp_start}
			</if>
			<if test="create_timestamp_end != null">
				and date_format(t1.create_timestamp,'%Y-%m-%d') &lt;= #{create_timestamp_end}
			</if>
			<if test="salesman_nameOrSalesman_shortcode != null">
				and (t1.salesman_name like #{salesman_nameOrSalesman_shortcode}
				or t1.salesman_shortcode like #{salesman_nameOrSalesman_shortcode})
			</if>
			<if test="customer_name != null">
				and t2.customer_name like '${customer_name}'
			</if>
			<if test="create_user_id != null">
				and t1.create_user_id != #{create_user_id}
			</if>
			<if test="mobile_telephone != null">
				and (t2.mobile_telephone1 like '${mobile_telephone}'
				or t2.mobile_telephone2 like '${mobile_telephone}')
			</if>
			<if test="mort_flag != null">
				and t1.mort_flag = #{mort_flag}
			</if>
		</where>
		<if test="sortname != null and sortorder != null">
			ORDER BY t1.bill_status in ('P', 'Q') DESC, ${sortname} ${sortorder}
		</if>
		<if test="offset != null and pagesize != null">
			LIMIT ${offset} , ${pagesize}
		</if>
	</select>

	<!-- 查询房贷单据信息完善列表条数 -->
	<select id="getHouseLoanCompletedCount" parameterType="map" resultType="int">
		select count(t1.wms_cre_credit_head_id) as count
		from wms_cre_credit_head t1,wms_cre_credit_line_customer_change_head t2
		<where>
			t1.wms_cre_credit_head_id = t2.wms_cre_credit_head_id
			and t2.is_major = '1'
			and t1.cre_type = '2'
			and t1.enable_flag = '1'
			<!--房贷：A 草稿 B待复核 C待贷前审核 D待终审 E待放款准备 F待放款审核 G待放款 H已完成 Z终止 I 复核退回 J 补件中 K待审批 L待初评预估 M合同完善完成 N授信确认 O 房产核查缴费 P初评退件 Q 终审退件 -->
			<!-- 志刚在2017年3月29日说除了草稿状态都可以完善 -->
			and t1.bill_status NOT IN ('A')
			and t1.version_number = '3'
			<!-- 因需求要求 现单据 沈阳可以看到鞍山和抚顺单据 -->
			<if test="create_user_city_code != null">
				and t1.create_user_city_code = #{create_user_city_code}
			</if>
			<if test="id_card != null">
				and t2.id_card like #{id_card}
			</if>
			<if test="idList != null">
				and t1.wms_cre_credit_head_id in
				<foreach collection="idList" item="wms_cre_credit_head_id" index="index" open="(" separator="," close=")">
					#{wms_cre_credit_head_id}
				</foreach>
			</if>
			<if test="bill_code != null">
				and t1.bill_code like '${bill_code}'
			</if>
			<if test="create_timestamp != null">
				and date_format(t1.create_timestamp, '%Y-%m-%d') = #{create_timestamp}
			</if>
			<if test="create_timestamp_start != null">
				and date_format(t1.create_timestamp,'%Y-%m-%d') &gt;= #{create_timestamp_start}
			</if>
			<if test="create_timestamp_end != null">
				and date_format(t1.create_timestamp,'%Y-%m-%d') &lt;= #{create_timestamp_end}
			</if>
			<if test="salesman_nameOrSalesman_shortcode != null">
				and (t1.salesman_name like #{salesman_nameOrSalesman_shortcode}
				or t1.salesman_shortcode like #{salesman_nameOrSalesman_shortcode})
			</if>
			<if test="customer_name != null">
				and t2.customer_name like '${customer_name}'
			</if>
			<if test="create_user_id != null">
				and t1.create_user_id != #{create_user_id}
			</if>
			<if test="mobile_telephone != null">
				and (t2.mobile_telephone1 like '${mobile_telephone}'
				or t2.mobile_telephone2 like '${mobile_telephone}')
			</if>
			<if test="mort_flag != null">
				and t1.mort_flag = #{mort_flag}
			</if>
		</where>
	</select>


	<!-- 查询办件审核列表 ，返回List<Map>对象 完善 -->
	<select id="searchForFdCardForAddMakeup" parameterType="map" resultType="java.util.HashMap">
		select
		t1.wms_cre_credit_head_id,
		t1.bill_code,
		t1.credit_purpose,
		t1.max_repayment_limit_per_month,
		t1.credit_limit,
		t1.max_repayment_time_limit,
		t1.enter_file_way,
		t1.payroll_payment_way,
		t1.credit_limit,
		t1.data_type,
		t1.is_complete,
		t1.reference_type,
		t1.is_other_corporation_done,
		t1.is_to_public_stream,
		t1.is_house_certificate_original,
		t1.is_check,
		t1.person_condition,
		t1.salesman_id,
		t1.salesman_code,
		t1.salesman_name,
		t1.city,
		t1.cre_type,
		t1.bill_status,
		(select value_meaning from wms_sys_dict_data where
		value_code = bill_status
		and wms_sys_dict_id = 131)as bill_status_name,
		t1.water_appro_user_id,
		t1.water_appro_user_name,
		date_format(t1.water_appro_timestamp,'%Y-%m-%d %H:%i:%s') as water_appro_timestamp,
		t1.water_appro_result,
		t1.info_appro_user_id,
		t1.info_appro_user_name,
		date_format(t1.info_appro_timestamp,'%Y-%m-%d %H:%i:%s') as info_appro_timestamp,
		t1.info_appro_result,
		t1.phone_appro_user_id,
		t1.phone_appro_user_name,
		date_format(t1.phone_appro_timestamp,'%Y-%m-%d %H:%i:%s')as
		phone_appro_timestamp,
		t1.phone_appro_result,
		t1.certificate_appro_user_id,
		t1.certificate_appro_user_name,

		date_format(t1.certificate_appro_timestamp,'%Y-%m-%d %H:%i:%s') as certificate_appro_timestamp,
		t1.certificate_appro_result,

		t1.create_user_id,
		t1.create_user_name,
		date_format(t1.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t1.last_update_user_id,
		date_format(t1.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
		t1.enable_flag,
		t1.is_link_repeat,
		t1.profession_type,
		t1.is_verify,
		t1.house_appro_result,
		t1.cre_loan_type,
		(select value_meaning from wms_sys_dict_data where value_code = t1.cre_loan_type
		and wms_sys_dict_id = 75)as cre_loan_type_name,
		t1.loan_interest_rate,
		t2.wms_cre_credit_line_customer_change_head_id,
		t2.wms_cre_credit_head_id,
		t2.wms_cus_customer_head_id,
		t2.customer_code,
		t2.customer_name,
		t2.customer_ever_name,
		t2.customer_category,
		t2.gender,
		t2.max_degree,
		date_format(t2.birthday,'%Y-%m-%d') as birthday,
		t2.id_card,
		t2.province,
		t2.city,
		t2.district,
		t2.address_more,
		t2.has_children,
		t2.children_name,
		t2.children_address,
		t2.children_telephone,
		t2.has_married,
		t2.has_house,
		t2.current_address_province,
		t2.current_address_city,
		t2.current_address_district,
		t2.current_address_more,
		t2.post_code,
		t2.fixed_telephone,
		t2.mobile_telephone1,
		t2.service_password1,
		t2.mobile_telephone2,
		t2.service_password2,
		t2.personal_year_income,
		t2.customer_email,
		t2.credit_card_limit,
		t2.common_occupants,
		t2.status,
		t2.create_user_id,
		t2.create_user_name,
		date_format(t2.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t2.last_update_user_id,
		date_format(t2.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
		t2.enable_flag,
		t1.is_review_back,
		t1.water_appro_result_page,
		t1.info_appro_result_page,
		t1.phone_appro_result_page,
		t1.certificate_appro_result_page,
		t1.house_appro_result_page,
		t1.salesman_shortcode,
		t1.create_user_city_code,
		(case when t1.create_timestamp &lt; #{hprocess_time} then '1' else '2' end) as edition_num,
		t1.version_number,
		t1.mort_flag,
		(SELECT  value_meaning from wms_sys_dict_data  where wms_sys_dict_id=146 AND value_code=t1.mort_flag) as mort_flag_name,
		CONCAT(t1.salesman_name,"/",t1.salesman_shortcode) as salesman_name_str
		from wms_cre_credit_head t1,wms_cre_credit_line_customer_change_head t2
		<where>
			t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id and
			t2.is_major='1' and t1.cre_type='2'
			<!-- 因新流程影响 添加核查状态和核查结果 -->
			and (t1.bill_status in ('E','ET','EJ','EZ','EH','F','FZ','G','H','I','HT','HZ','K','KZ','KT'))
			and t1.version_number=3
			<if test="id_card != null">
				and t2.id_card = #{id_card}
			</if>
			<if test="idList !=null">
				and t1.wms_cre_credit_head_id in
				<foreach collection="idList" item="wms_cre_credit_head_id" index="index" open="(" separator="," close=")">
					#{wms_cre_credit_head_id}
				</foreach>
			</if>
			and t1.enable_flag='1'
			<if test="bill_code != null">
				and t1.bill_code like '${bill_code}'
			</if>
			<if test="customer_name != null">
				and t2.customer_name like '${customer_name}'
			</if>
			<if test="create_user_id != null">
				and t1.create_user_id != #{create_user_id}
			</if>
			<if test="mobile_telephone != null">
				and (t2.mobile_telephone1 like '${mobile_telephone}' or
				t2.mobile_telephone2 like '${mobile_telephone}')
			</if>
			<!-- 权限控制 -->
			<if test="childrendept != null">
				and (FIND_IN_SET(t1.salesman_dept_id, #{childrendept}) > 0)
			</if>
			<if test="mort_flag != null">
				and t1.mort_flag = #{mort_flag}
			</if>
			
		</where>
		<if test="sortname != null and sortorder !=null">
			ORDER BY ${sortname} ${sortorder}
		</if>
		<if test="offset != null and pagesize !=null">
			LIMIT ${offset} , ${pagesize}
		</if>
	</select>
	<!-- 查询数据条数，直接返回int类型条数 办件完善 -->
	<select id="findCountForFdCardForAddMakeup" parameterType="map" resultType="int">
		select count(t1.wms_cre_credit_head_id) as count
		from
		wms_cre_credit_head t1,wms_cre_credit_line_customer_change_head t2
		<where>
			t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id and
			t2.is_major='1' and t1.cre_type='2'
			<!-- 因新流程影响 添加核查状态和核查结果 -->
			and (t1.bill_status in ('E','ET','EJ','EZ','EH','F','FZ','G','H','I','HT','HZ','K','KZ','KT'))
			and t1.version_number=3
			<if test="id_card != null">
				and t2.id_card = #{id_card}
			</if>
			<if test="idList !=null">
				and t1.wms_cre_credit_head_id in
				<foreach collection="idList" item="wms_cre_credit_head_id" index="index" open="(" separator="," close=")">
					#{wms_cre_credit_head_id}
				</foreach>
			</if>
			and t1.enable_flag='1'
			<if test="bill_code != null">
				and t1.bill_code like '${bill_code}'
			</if>
			<if test="customer_name != null">
				and t2.customer_name like '${customer_name}'
			</if>
			<if test="create_user_id != null">
				and t1.create_user_id != #{create_user_id}
			</if>
			<if test="mobile_telephone != null">
				and (t2.mobile_telephone1 like '${mobile_telephone}' or
				t2.mobile_telephone2 like '${mobile_telephone}')
			</if>
			<!-- 权限控制 -->
			<if test="childrendept != null">
				and (FIND_IN_SET(t1.salesman_dept_id, #{childrendept}) > 0)
			</if>
			<if test="mort_flag != null">
				and t1.mort_flag = #{mort_flag}
			</if>
		</where>
	</select>

	<!-- 作废相关字段更新 -->
	<update id="updateForDocumentVoidUp" parameterType="map">
		update wms_cre_credit_head
		set nullify_user_id = #{nullify_user_id},
		nullify_timestamp = #{nullify_timestamp},
		nullify_reason = #{nullify_reason}
		where wms_cre_credit_head_id = #{wms_cre_credit_head_id}
	</update>
	<!-- 更新单据状态 -->
	<update id="updateBillStatus" parameterType="WmsCreCreditHead">
		update wms_cre_credit_head
		<set>
			<if test="bill_status !=null">
				bill_status =#{bill_status},
			</if>
		</set>
		where wms_cre_credit_head_id = #{wms_cre_credit_head_id}
	</update>
	<!--房产核查缴费列表 -->
	<select id="wmscrecustomerchangelinehouseinfowithpaginglist" parameterType="com.zx.emanage.util.gen.vo.WmsCreCreditHeadVO" resultType="java.util.HashMap">
		SELECT
		t1.wms_cre_credit_head_id,
		t1.bill_code,
		t1.salesman_id,
		t1.salesman_code,
		t1.salesman_name,
		CONCAT(
		t1.salesman_name,
		"/",
		t1.salesman_shortcode
		) AS salesman_name_str,
		t1.create_timestamp,
		date_format(
		t1.create_timestamp,
		'%Y-%m-%d %H:%i:%s'
		) AS create_timestamp_str,
		t1.bill_status,
		t1.mort_flag,
		(SELECT  value_meaning from wms_sys_dict_data  where wms_sys_dict_id=146 AND value_code=t1.mort_flag) as mort_flag_name,
		(
		SELECT
		value_meaning
		FROM
		wms_sys_dict_data
		WHERE
		value_code = t1.bill_status
		AND wms_sys_dict_id = 131
		) AS bill_status_name,
		t1.version_number,
		t3.wms_cre_customer_change_line_houseinfo_id,
		t3.house_address_province,
		t3.house_address_city,
		t3.house_address_district,
		t3.house_address_more,
		t3.wms_cre_credit_line_customer_change_head_id,
		t3.community_name,
		t2.customer_name,
		if(t2.mobile_telephone1 is null or t2.mobile_telephone1="",t5.mobile_telephone,t2.mobile_telephone1) as mobile_telephone1 
		FROM
		wms_cre_credit_head t1
		INNER JOIN wms_cre_credit_line_customer_change_head t2
		ON
		t1.wms_cre_credit_head_id = t2.wms_cre_credit_head_id
		AND
		is_major=1
		AND
		t1.enable_flag = t2.enable_flag = 1
		<!-- AND t1.salesman_city_code = #{citynum} -->
		LEFT JOIN (SELECT
		h.wms_cre_credit_head_id,
		f.wms_cre_customer_change_line_houseinfo_id,
		f.house_address_province,
		f.house_address_city,
		f.house_address_district,
		f.house_address_more,
		f.wms_cre_credit_line_customer_change_head_id,
		f.community_name,
		f.enable_flag
		from wms_cre_customer_change_line_houseinfo f,wms_cre_housing_customer_house h
		where h.wms_cre_customer_change_line_houseinfo_id = f.wms_cre_customer_change_line_houseinfo_id ) t3 ON t2.enable_flag = t3.enable_flag = 1 and t2.wms_cre_credit_head_id = t3.wms_cre_credit_head_id
		left join wms_cre_housing_payment t5 on t5.enable_flag = 1 and t5.wms_cre_credit_head_id = t2.wms_cre_credit_head_id
		<where>
			t1.enable_flag=1
			and t1.bill_status='C'
			and t1.version_number='3'
			<if test="salesman_name!=null or salesman_shortcode !=null">
				and (t1.salesman_name like#{salesman_name} or
				t1.salesman_shortcode like #{salesman_shortcode})
			</if>
			<if test="customer_name !=null">
				and t2.customer_name like '${customer_name}'
			</if>
			<if test="mobile_telephone1 !=null">
				and t2.mobile_telephone1 like '${mobile_telephone1}'
			</if>
			<if test="bill_code != null">
				and t1.bill_code like '${bill_code}'
			</if>
			<if test="create_timestamp_begin != null">
				and date_format(t1.create_timestamp,'%Y-%m-%d') &gt;= #{create_timestamp_begin}
			</if>
			<if test="create_timestamp_end != null">
				and date_format(t1.create_timestamp,'%Y-%m-%d') &lt;= #{create_timestamp_end}
			</if>
			<!-- 权限控制 -->
			<if test="childrendept != null">
				and (FIND_IN_SET(t1.salesman_dept_id, #{childrendept}) > 0)
			</if>
			<if test="mort_flag != null">
				and t1.mort_flag = #{mort_flag}
			</if>
		</where>
		<if test="sortname != '' and sortorder !=''">
			ORDER BY ${sortname} ${sortorder}
		</if>
		<if test="offset != null and pagesize !=null">
			LIMIT ${offset} , ${pagesize}
		</if>
	</select>

	<!-- 房产核查缴费列表数量 -->
	<select id="wmsCreCustomerChangeLineHouseInfoWithPagingCount" parameterType="com.zx.emanage.util.gen.vo.WmsCreCreditHeadVO" resultType="int">
		select
		count(t1.wms_cre_credit_head_id)
		FROM
		wms_cre_credit_head t1
		INNER JOIN
		wms_cre_credit_line_customer_change_head t2
		ON
		t1.wms_cre_credit_head_id = t2.wms_cre_credit_head_id
		AND
		is_major=1
		AND
		t1.enable_flag = t2.enable_flag = 1
		<!-- AND t1.salesman_city_code = #{citynum} -->
		LEFT JOIN (SELECT
		h.wms_cre_credit_head_id,
		f.wms_cre_customer_change_line_houseinfo_id,
		f.house_address_province,
		f.house_address_city,
		f.house_address_district,
		f.house_address_more,
		f.wms_cre_credit_line_customer_change_head_id,
		f.community_name,
		f.enable_flag
		from wms_cre_customer_change_line_houseinfo f,wms_cre_housing_customer_house h
		where h.wms_cre_customer_change_line_houseinfo_id = f.wms_cre_customer_change_line_houseinfo_id ) t3 ON t2.enable_flag = t3.enable_flag = 1 and t2.wms_cre_credit_head_id = t3.wms_cre_credit_head_id
		<where>
			t1.enable_flag=1
			and t1.bill_status='C'
			and t1.version_number='3'
			<if test="salesman_name!=null or salesman_shortcode !=null">
				and (t1.salesman_name like#{salesman_name} or
				t1.salesman_shortcode like #{salesman_shortcode})
			</if>
			<if test="customer_name !=null">
				and t2.customer_name like '${customer_name}'
			</if>
			<if test="mobile_telephone1 !=null">
				and t2.mobile_telephone1 like '${mobile_telephone1}'
			</if>
			<if test="bill_code != null">
				and t1.bill_code like '${bill_code}'
			</if>
			<if test="create_timestamp_begin != null">
				and date_format(t1.create_timestamp,'%Y-%m-%d') &gt;= #{create_timestamp_begin}
			</if>
			<if test="create_timestamp_end != null">
				and date_format(t1.create_timestamp,'%Y-%m-%d') &lt;= #{create_timestamp_end}
			</if>
			<!-- 权限控制 -->
			<if test="childrendept != null">
				and (FIND_IN_SET(t1.salesman_dept_id, #{childrendept}) > 0)
			</if>
			<if test="mort_flag != null">
				and t1.mort_flag = #{mort_flag}
			</if>
		</where>
	</select>
	<!-- 房产缴费核查导出 -->
	<select id="wmscrecustomerchangelinehouseinfowithpaginglistout" parameterType="com.zx.emanage.util.gen.vo.WmsCreCreditHeadVO" resultType="java.util.HashMap">
		select
		t1.wms_cre_credit_head_id,
		t1.bill_code,
		t1.salesman_id,
		t1.salesman_code,
		t1.salesman_name,
		CONCAT(t1.salesman_name,"/",t1.salesman_shortcode) as salesman_name_str,
		t1.create_timestamp,
		date_format(t1.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp_str,
		t1.bill_status,
		(select value_meaning from wms_sys_dict_data where value_code = t1.bill_status
		and wms_sys_dict_id = 131)as bill_status_name,
		t1.version_number,
		t3.wms_cre_customer_change_line_houseinfo_id,
		t3.house_address_province,
		t3.house_address_city,
		t3.house_address_district,
		t3.house_address_more,
		t3.wms_cre_credit_line_customer_change_head_id,
		t3.community_name,
		t2.customer_name,
		t2.mobile_telephone1
		FROM
		wms_cre_credit_head t1
		INNER JOIN
		wms_cre_credit_line_customer_change_head t2
		ON
		t1.wms_cre_credit_head_id = t2.wms_cre_credit_head_id
		AND
		is_major=1
		AND
		t1.enable_flag = t2.enable_flag = 1
		<!-- AND t1.salesman_city_code = #{citynum} -->
		LEFT JOIN (SELECT
		h.wms_cre_credit_head_id,
		f.wms_cre_customer_change_line_houseinfo_id,
		f.house_address_province,
		f.house_address_city,
		f.house_address_district,
		f.house_address_more,
		f.wms_cre_credit_line_customer_change_head_id,
		f.community_name,
		f.enable_flag
		from wms_cre_customer_change_line_houseinfo f,wms_cre_housing_customer_house h
		where h.wms_cre_customer_change_line_houseinfo_id = f.wms_cre_customer_change_line_houseinfo_id ) t3 ON t2.enable_flag = t3.enable_flag = 1 and t2.wms_cre_credit_head_id = t3.wms_cre_credit_head_id
		<where>
			t1.enable_flag=1
			and t1.bill_status='C'
			and t1.version_number='3'
			<if test="salesman_name!=null or salesman_shortcode !=null">
				and (t1.salesman_name like#{salesman_name} or
				t1.salesman_shortcode like #{salesman_shortcode})
			</if>
			<if test="customer_name !=null">
				and t2.customer_name like '${customer_name}'
			</if>
			<if test="mobile_telephone1 !=null">
				and t2.mobile_telephone1 like '${mobile_telephone1}'
			</if>
			<if test="bill_code != null">
				and t1.bill_code like '${bill_code}'
			</if>
			<if test="create_timestamp_begin != null">
				and date_format(t1.create_timestamp,'%Y-%m-%d') &gt;= #{create_timestamp_begin}
			</if>
			<if test="create_timestamp_end != null">
				and date_format(t1.create_timestamp,'%Y-%m-%d') &lt;= #{create_timestamp_end}
			</if>
			<!-- 权限控制 -->
			<if test="childrendept != null">
				and (FIND_IN_SET(t1.salesman_dept_id, #{childrendept}) > 0)
			</if>

		</where>
		<if test="sortname != '' and sortorder !=''">
			ORDER BY ${sortname} ${sortorder}
		</if>
	</select>

	<!-- 复议申请列表 -->
	<select id="getReviewRevisionOfHousingList" parameterType="com.zx.emanage.util.gen.vo.WmsCreCreditHeadVO" resultType="java.util.HashMap">
		select
		t1.wms_cre_credit_head_id,
		t1.bill_code,
		t1.salesman_id,
		t1.salesman_code,
		t1.salesman_name,
		CONCAT(t1.salesman_name,"/",t1.salesman_shortcode) as salesman_name_str,
		t1.create_timestamp,
		date_format(t1.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp_str,
		t1.bill_status,
		(select value_meaning from wms_sys_dict_data where value_code = t1.bill_status
		and wms_sys_dict_id = 24)as bill_status_name,
		t1.certificate_appro_result_page,
		t1.phone_appro_result_page,
		t1.house_appro_result_page,
		t1.assessment_result_page,
		t3.wms_cre_customer_change_line_houseinfo_id,
		t3.house_address_province,
		t3.house_address_city,
		t3.house_address_district,
		t3.house_address_more,
		t3.wms_cre_credit_line_customer_change_head_id,
		t3.community_name,
		t2.customer_name,
		t2.mobile_telephone1,
		t1.version_number
		from
		wms_cre_credit_head t1
		INNER JOIN
		wms_cre_credit_line_customer_change_head t2
		ON
		t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id
		AND
		is_major=1
		AND
		t1.enable_flag=t2.enable_flag=1
		AND
		t1.nullify_type IN(5,6,7,8,9,10,11)
		LEFT JOIN
		v_customer_houseinfo t3
		ON
		t2.wms_cre_credit_line_customer_change_head_id=t3.wms_cre_credit_line_customer_change_head_id
		AND
		t2.enable_flag=t3.enable_flag=1
		<where>
			t1.cre_type=2
			<if test="salesman_name!=null or salesman_shortcode !=null">
				and (t1.salesman_name like#{salesman_name} or
				t1.salesman_shortcode like #{salesman_shortcode})
			</if>
			<if test="customer_name !=null">
				and t2.customer_name like '${customer_name}'
			</if>
			<if test="mobile_telephone1 !=null">
				and t2.mobile_telephone1 like '${mobile_telephone1}'
			</if>
			<if test="bill_code != null">
				and t1.bill_code like '${bill_code}'
			</if>
			<if test="create_timestamp_begin != null">
				and date_format(t1.create_timestamp,'%Y-%m-%d') &gt;= #{create_timestamp_begin}
			</if>
			<if test="create_timestamp_end != null">
				and date_format(t1.create_timestamp,'%Y-%m-%d') &lt;= #{create_timestamp_end}
			</if>
		</where>
		<if test="sortname != '' and sortorder !=''">
			ORDER BY ${sortname} ${sortorder}
		</if>
		<if test="offset != null and pagesize !=null">
			LIMIT ${offset} , ${pagesize}
		</if>
	</select>
	<!-- 复议申请列表导出 -->
	<select id="getReviewRevisionOfHousingListOut" parameterType="com.zx.emanage.util.gen.vo.WmsCreCreditHeadVO" resultType="java.util.HashMap">
		select
		t1.wms_cre_credit_head_id,
		t1.bill_code,
		t1.salesman_id,
		t1.salesman_code,
		t1.salesman_name,
		CONCAT(t1.salesman_name,"/",t1.salesman_shortcode) as salesman_name_str,
		t1.create_timestamp,
		date_format(t1.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp_str,
		t1.bill_status,
		(select value_meaning from wms_sys_dict_data where value_code = t1.bill_status
		and wms_sys_dict_id = 24)as bill_status_name,
		t1.certificate_appro_result_page,
		t1.phone_appro_result_page,
		t1.house_appro_result_page,
		t1.assessment_result_page,
		t3.wms_cre_customer_change_line_houseinfo_id,
		t3.house_address_province,
		t3.house_address_city,
		t3.house_address_district,
		t3.house_address_more,
		t3.wms_cre_credit_line_customer_change_head_id,
		t3.community_name,
		t2.customer_name,
		t2.mobile_telephone1,
		t1.version_number
		from
		wms_cre_credit_head t1
		INNER JOIN
		wms_cre_credit_line_customer_change_head t2
		ON
		t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id
		AND
		is_major=1
		AND
		t1.enable_flag=t2.enable_flag=1
		AND
		t1.nullify_type IN(5,6,7,8,9,10,11)
		LEFT JOIN
		v_customer_houseinfo t3
		ON
		t2.wms_cre_credit_line_customer_change_head_id=t3.wms_cre_credit_line_customer_change_head_id
		AND
		t2.enable_flag=t3.enable_flag=1
		<where>
			t1.cre_type=2
			<if test="salesman_name!=null or salesman_shortcode !=null">
				and (t1.salesman_name like#{salesman_name} or
				t1.salesman_shortcode like #{salesman_shortcode})
			</if>
			<if test="customer_name !=null">
				and t2.customer_name like '${customer_name}'
			</if>
			<if test="mobile_telephone1 !=null">
				and t2.mobile_telephone1 like '${mobile_telephone1}'
			</if>
			<if test="bill_code != null">
				and t1.bill_code like '${bill_code}'
			</if>
			<if test="create_timestamp_begin != null">
				and date_format(t1.create_timestamp,'%Y-%m-%d') &gt;= #{create_timestamp_begin}
			</if>
			<if test="create_timestamp_end != null">
				and date_format(t1.create_timestamp,'%Y-%m-%d') &lt;= #{create_timestamp_end}
			</if>
		</where>
		<if test="sortname != '' and sortorder !=''">
			ORDER BY ${sortname} ${sortorder}
		</if>
	</select>



	<select id="getReviewRevisionOfHousingListCount" parameterType="com.zx.emanage.util.gen.vo.WmsCreCreditHeadVO" resultType="int">
		SELECT
		count(t1.wms_cre_credit_head_id)
		from
		wms_cre_credit_head t1
		INNER JOIN
		wms_cre_credit_line_customer_change_head t2
		ON
		t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id
		AND
		t1.enable_flag=t2.enable_flag=1
		AND
		is_major=1
		AND
		t1.nullify_type IN(5,6,7,8,9,10,11)
		LEFT JOIN
		v_customer_houseinfo t3
		ON
		t2.wms_cre_credit_line_customer_change_head_id=t3.wms_cre_credit_line_customer_change_head_id
		AND
		t2.enable_flag=t3.enable_flag=1
		<where>
			t1.cre_type=2
			<if test="salesman_name!=null or salesman_shortcode !=null">
				and (t1.salesman_name like#{salesman_name} or
				t1.salesman_shortcode like #{salesman_shortcode})
			</if>
			<if test="customer_name !=null">
				and t2.customer_name like '${customer_name}'
			</if>
			<if test="mobile_telephone1 !=null">
				and t2.mobile_telephone1 like '${mobile_telephone1}'
			</if>
			<if test="bill_code != null">
				and t1.bill_code like '${bill_code}'
			</if>
			<if test="create_timestamp_begin != null">
				and date_format(t1.create_timestamp,'%Y-%m-%d') &gt;= #{create_timestamp_begin}
			</if>
			<if test="create_timestamp_end != null">
				and date_format(t1.create_timestamp,'%Y-%m-%d') &lt;= #{create_timestamp_end}
			</if>
		</where>
	</select>
	<!-- 更新主表组合贷标志 -->
	<update id="updateGroupId" parameterType="WmsCreCreditHead">
		update
		wms_cre_credit_head
		set
		wms_cre_credit_group_id =#{wms_cre_credit_group_id}
		where
		wms_cre_credit_head_id = #{wms_cre_credit_head_id}
	</update>
	<!-- 查询贷款主表信息 -->
	<select id="getWmsCreCreditHeadList" parameterType="map" resultType="map">
		select t1.wms_cre_credit_head_id,
		t1.bill_code,
		t1.version_number,
		t1.is_workflow,
		t1.wms_cre_credit_group_id,
		t2.repay_status
		from wms_cre_credit_head t1
		right join wms_fina_cre_repay t2
		on t1.wms_cre_credit_head_id = t2.wms_cre_credit_head_id
		<where>
			t1.enable_flag = '1' and t2.enable_flag = '1' 
	        <![CDATA[ and t2.current_repay_date <= DATE_SUB(CURRENT_DATE(), INTERVAL - 30 day)]]>
			<if test="cre_type != null">
				and t1.cre_type = #{cre_type}
			</if>
			<if test="wms_cre_credit_group_id != null">
				and t1.wms_cre_credit_group_id = #{wms_cre_credit_group_id}
			</if>
			<if test="same_status != null">
				and t1.bill_status = (select a.bill_status from wms_cre_credit_head a
				where a.wms_cre_credit_head_id = #{wms_cre_credit_head_id})
			</if>
			<if test="repay_status_in != null">
				and t2.repay_status in ${repay_status_in}
			</if>
			<if test="sortname != null and sortorder != null">
				order by ${sortname} ${sortorder}
			</if>
		</where>
	</select>

	<!-- 获取WmsCreCreditHead -->
	<select id="getGroupHead" parameterType="Integer" resultType="WmsCreCreditHead">
		SELECT
		t1.*
		FROM
		wms_cre_credit_head t1,
		(
		SELECT
		a.wms_cre_credit_head_id,
		a.bill_status,
		a.wms_cre_credit_group_id
		FROM
		wms_cre_credit_head a
		WHERE
		a.wms_cre_credit_head_id =#{wms_cre_credit_head_id}
		) t2
		WHERE
		t1.enable_flag=1
		AND ((t1.wms_cre_credit_group_id = t2.wms_cre_credit_group_id
		AND t1.bill_status = t2.bill_status) OR t1.wms_cre_credit_head_id = #{wms_cre_credit_head_id})
	</select>
	<!-- 获取判断组合贷情况 -->
	<select id="judgeGroupCredit" parameterType="map" resultType="WmsCreCreditHead">
		SELECT
		*
		FROM
		wms_cre_credit_head h
		WHERE
		wms_cre_credit_group_id = #{wms_cre_credit_group_id}
		and bill_status = #{bill_status}
		and enable_flag=1
	</select>
	<!-- 获取组合贷 还款方式不通获取不通 等额本息获取全部同状态的单据 -->
	<select id="getGroupHeadByRepaymentType" parameterType="Integer" resultType="java.util.HashMap">
		SELECT
		t1.*,ifnull((SELECT payment_contract_type from wms_cre_appro_borrow_protocol where enable_flag=1 AND wms_cre_credit_head_id= t1.wms_cre_credit_head_id),
		(SELECT payment_contract_type from wms_sys_protocol_property where cre_loan_type=t1.cre_loan_type and enable_flag=1 GROUP BY payment_contract_type)) as payment_contract_type
		FROM
		wms_cre_credit_head t1,
		(
		SELECT
		a.wms_cre_credit_head_id,
		a.bill_status,
		a.wms_cre_credit_group_id
		FROM
		wms_cre_credit_head a
		WHERE
		a.wms_cre_credit_head_id =#{wms_cre_credit_head_id}
		) t2
		WHERE
		t1.enable_flag=1
		AND ((t1.wms_cre_credit_group_id = t2.wms_cre_credit_group_id
		AND t1.bill_status = t2.bill_status) OR t1.wms_cre_credit_head_id = #{wms_cre_credit_head_id})
	</select>
	<!-- 获取组合贷 还款方式不通获取不通 等额本息获取全部同状态的单据 -->
	<select id="getGroupHeadByNotariza" parameterType="map" resultType="java.util.HashMap">
		SELECT
		t1.*,
		(case when t1.create_timestamp &lt; #{hprocess_time} then '1' else '2' end) as edition_num
		FROM
		wms_cre_credit_head t1,
		(
		SELECT
		a.wms_cre_credit_head_id,
		a.bill_status,
		a.wms_cre_credit_group_id
		FROM
		wms_cre_credit_head a
		WHERE
		a.wms_cre_credit_head_id =#{wms_cre_credit_head_id}
		) t2
		WHERE
		t1.enable_flag=1
		AND ((t1.wms_cre_credit_group_id = t2.wms_cre_credit_group_id) OR t1.wms_cre_credit_head_id = #{wms_cre_credit_head_id})
		AND t1.bill_status in ('E','M')
	</select>

	<!-- 获取组合贷 手机端放款申请获取全部符合条件的单据 -->
	<select id="getGroupHeadByApp" parameterType="map" resultType="java.util.HashMap">
		SELECT
		t1.*,ifnull((SELECT payment_contract_type from wms_cre_appro_borrow_protocol where enable_flag=1 AND wms_cre_credit_head_id= t1.wms_cre_credit_head_id),
		(SELECT payment_contract_type from wms_sys_protocol_property where cre_loan_type=t1.cre_loan_type and enable_flag=1 GROUP BY payment_contract_type)) as payment_contract_type
		FROM
		wms_cre_credit_head t1,
		(
		SELECT
		a.wms_cre_credit_head_id,
		a.bill_status,
		a.wms_cre_credit_group_id
		FROM
		wms_cre_credit_head a
		WHERE
		a.wms_cre_credit_head_id =#{wms_cre_credit_head_id}
		) t2
		WHERE
		t1.enable_flag=1
		AND ((t1.wms_cre_credit_group_id = t2.wms_cre_credit_group_id) OR t1.wms_cre_credit_head_id = #{wms_cre_credit_head_id})
		AND FIND_IN_SET(t1.bill_status,#{bill_status})
	</select>

	<!-- 更新 -->
	<update id="updateCombindeLoan" parameterType="WmsCreCreditHead">
		update wms_cre_credit_head
		<set>
			<if test="appro_limit != null">
				appro_limit=#{appro_limit},
			</if>
			<if test="cre_loan_type != null">
				cre_loan_type=#{cre_loan_type},
			</if>
			<if test="max_repayment_time_limit != null">
				max_repayment_time_limit=#{max_repayment_time_limit},
			</if>
			<if test="loan_interest_rate != null">
				loan_interest_rate=#{loan_interest_rate},
			</if>
			<if test="wms_cre_credit_group_id !=null">
				wms_cre_credit_group_id =#{wms_cre_credit_group_id},
			</if>
		</set>
		where wms_cre_credit_head_id = #{wms_cre_credit_head_id}
	</update>



	<!-- 根据headId查询组合贷所有的headid -->
	<select id="getHeadIdListForHeadId" parameterType="int" resultType="int">
		SELECT
		wms_cre_credit_head_id
		FROM
		wms_cre_credit_head h
		WHERE
		wms_cre_credit_group_id =
		(
		select
		wms_cre_credit_group_id
		from
		wms_cre_credit_head
		where
		wms_cre_credit_head_id = #{wms_cre_credit_head}
		)
		and bill_status in('E','M')
		and enable_flag=1
	</select>
	<!-- 根据headId查询组合贷所有的headid -->
	<select id="getHeadIdListForHeadIdInAllStatus" parameterType="int" resultType="int">
		SELECT
		wms_cre_credit_head_id
		FROM
		wms_cre_credit_head h
		WHERE
		wms_cre_credit_group_id =
		(
		select
		wms_cre_credit_group_id
		from
		wms_cre_credit_head
		where
		wms_cre_credit_head_id = #{wms_cre_credit_head}
		)
		and enable_flag=1
	</select>


	<select id="getHeadIdList" parameterType="int" resultType="int">
		SELECT
		t1.wms_cre_credit_head_id
		FROM
		wms_cre_credit_head t1
		LEFT JOIN
		wms_fina_cre_repay t2 ON t1.wms_cre_credit_head_id = t2.wms_cre_credit_head_id

		WHERE
		wms_cre_credit_group_id = (
		SELECT
		wms_cre_credit_group_id
		FROM
		wms_cre_credit_head
		WHERE
		wms_cre_credit_head_id = #{wms_cre_credit_head_id}
		)
		AND t1.bill_status != 'Z'
		AND t2.repay_status != 3
		AND t1.enable_flag = 1
		AND t2.enable_flag = 1
	</select>

	<select id="selectZSJE" parameterType="int" resultType="WmsCreCreditHead">
		select
		*
		from
		wms_cre_credit_head t1
		left join
		wms_fina_cre_repay t2
		on
		t1.wms_cre_credit_head_id = t2.wms_cre_credit_head_id and t1.enable_flag=1 and t2.enable_flag=1
		and
		t2.repay_status != 3
		where
		t1.wms_cre_credit_head_id = #{wms_cre_credit_head_id}

	</select>

	<select id="getGroupIdForHeadId" parameterType="int" resultType="int">
		select
		wms_cre_credit_group_id
		from
		wms_cre_credit_head
		where
		wms_cre_credit_head_id = #{wms_cre_credit_head_id}
	</select>

	<!-- 获取组合贷 还款方式 -->
	<select id="getGroupType" parameterType="map" resultType="java.util.HashMap">
		SELECT
		t1.wms_cre_credit_head_id,
		p.payment_contract_type
		FROM
		wms_cre_credit_head t1
		LEFT JOIN wms_cre_appro_borrow_protocol p on t1.wms_cre_credit_head_id=p.wms_cre_credit_head_id and p.enable_flag=1
		WHERE
		t1.enable_flag=1

		and t1.wms_cre_credit_group_id= #{wms_cre_credit_group_id}
		AND IFNULL((SELECT repay_status from wms_fina_cre_repay where t1.wms_cre_credit_head_id=wms_cre_credit_head_id and enable_flag=1),0) !=3
	</select>

	<!-- 更新 -->
	<update id="updateDelete" parameterType="WmsCreCreditHead">
		update wms_cre_credit_head
		<set>
			<if test="enable_flag !=null">
				enable_flag =#{enable_flag},
			</if>
			<if test="last_update_timestamp !=null">
				last_update_timestamp = #{last_update_timestamp},
			</if>
			<if test="last_update_user_id != null">
				last_update_user_id = #{last_update_user_id},
			</if>
			<if test="bill_status != null">
				bill_status = #{bill_status},
			</if>
		</set>
		<where>
			<if test="wms_cre_credit_head_id != null">
				and wms_cre_credit_head_id = #{wms_cre_credit_head_id}
			</if>
		</where>
	</update>
	
	<!-- 查询件数统计列表 -->
	<select id="searchLoanNumberStatisticsList" parameterType="map" resultType="map">
	    select * from (select t1.dept_pname as first_level_dept_name,
					    	  t1.dept_name as second_level_dept_name,
					    	  ifnull(concat(t1.personnel_name, '/', t1.personnel_shortcode), '') as personnel_name,
					    	  t1.personnel_shortcode,
					    	  ifnull(t1.personnel_regionNumber, '') as personnel_regionNumber,
					    	  (case when t1.dept_level_coding like '001002001001%' then 1 else 2 end) as sort_column,
							  t1.dept_level_coding,
						      ifnull(t4.count, '0') as intern_num,
							  ifnull(t5.count, '0') as check_point_num,
							  ifnull(t3.number_loans, '0') as loans_num,
							  ifnull(replace(replace(format(cast(t3.amount_loans as decimal) / 10000, 2), ',', ''), '.00', ''), '0') as loans_amount
						 from (select a1.dept_id,
						   			  a2.personnel_name,
						   			  a2.personnel_shortcode,
						   			  a2.personnel_regionNumber,
									  a1.dept_name,
									  a3.dept_name as dept_pname,
									  a1.dept_level_coding
						         from sys_dept a1, pm_personnel a2, sys_dept a3
						        where a1.dept_id = a2.personnel_deptid
							      and a1.dept_pid = a3.dept_id
						          and a2.enable_flag = 1
						          and a1.enable_flag = 1
						        union
						       select a3.personnel_deptid,
						              a3.personnel_name,
						        	  a3.personnel_shortcode,
						        	  a3.personnel_regionNumber,
									  a5.dept_name,
									  a6.dept_name as dept_pname,
									  a5.dept_level_coding
						         from pm_personnel a3, wms_cre_credit_notary_warn a4, sys_dept a5, sys_dept a6
						        where a3.personnel_shortcode = a4.salesman_shortcode
								  and a4.salesman_own_dept_id = a5.dept_id
								  and a5.dept_pid = a6.dept_id
						          and a4.salesman_shortcode is not null
						          and a4.salesman_shortcode != ''
						          <if test="create_timestamp_start != null">
						           	  and a4.protocol_date &gt;= #{create_timestamp_start}
						          </if>
						          <if test="create_timestamp_end != null">
						              and a4.protocol_date &lt;= #{create_timestamp_end}
						          </if>
						          and a4.enable_flag = '1'
						          and a4.is_achievement = '1'
				                  and a3.personnel_state = '1'
								  and a3.enable_flag = '1'
						     group by a3.personnel_shortcode) t1
					left join (select t.salesman_shortcode, 
					 				  count(*) as number_loans,
					 				  sum(t.amount_loans) as amount_loans
					 			 from (select a3.salesman_shortcode,
								              count(a3.wms_cre_credit_notary_warn_id) as number_loans, 
								              sum(a3.appro_limit) as amount_loans 
								         from wms_cre_credit_notary_warn a3, wms_fina_cre_loan_app a4
								        where a3.wms_cre_credit_head_id = a4.wms_cre_credit_head_id
								          and a3.bill_type = '01' 
								          and (a3.data_sources in (10, 11) or a3.cre_type = 2)
									      <if test="create_timestamp_start != null">
								           	  and a4.loan_date &gt;= #{create_timestamp_start}
								          </if>
								          <if test="create_timestamp_end != null">
								              and a4.loan_date &lt;= #{create_timestamp_end}
								          </if>
									      and a3.enable_flag = '1'
									      and a3.salesman_shortcode != ''
									      and a3.is_achievement = '1'
									 group by a3.salesman_shortcode, ifnull(a3.bill_code_group, uuid())) t
					         group by salesman_shortcode) t3
				           on t1.personnel_shortcode = t3.salesman_shortcode
				    left join (select c3.salesman_shortcode, 
							          count(*) as count 			             
					             from wms_cre_housing_approval_info c1, wms_cre_credit_head c3
								where c1.wms_cre_credit_head_id = c3.wms_cre_credit_head_id
								  and c1.approval_task_code = 'FCCP'
								  and c1.approval_type = 1							      
								  <if test="create_timestamp_start != null">
						           	  and date_format(c1.approval_time, '%Y-%m-%d') &gt;= #{create_timestamp_start}
						          </if>
						          <if test="create_timestamp_end != null">
						              and date_format(c1.approval_time, '%Y-%m-%d') &lt;= #{create_timestamp_end}
						          </if>				         
							 group by c3.salesman_shortcode) t4
						   on t1.personnel_shortcode = t4.salesman_shortcode
				    left join (select c3.salesman_shortcode, 
							          count(*) as count 
							     from wms_cre_housing_approval_info c1, wms_cre_credit_head c3
							    where c1.wms_cre_credit_head_id = c3.wms_cre_credit_head_id
							      and c1.approval_task_code = 'FCHC'
							      and c1.approval_type = 1							      
							      <if test="create_timestamp_start != null">
						          	   and date_format(c1.approval_time, '%Y-%m-%d') &gt;= #{create_timestamp_start}
						          </if>
						          <if test="create_timestamp_end != null">
						              and date_format(c1.approval_time, '%Y-%m-%d') &lt;= #{create_timestamp_end}
						          </if>
							 group by c3.salesman_shortcode) t5
						   on t1.personnel_shortcode = t5.salesman_shortcode) t
		<where>
		    and (t.intern_num != 0 or check_point_num != 0 or loans_num != 0)
			<if test="dept_name != null">
				and t.second_level_dept_name like '${dept_name}'
			</if>
			<if test="city != null">
				and t.personnel_regionNumber = #{city}
			</if>
			<if test="salesman_name != null">
				and (t.personnel_name like '${salesman_name}' or t.personnel_shortcode like '${salesman_name}')
			</if>
		</where>
		<if test="sortname != null and sortorder != null">
			order by ${sortname} ${sortorder}
		</if>
		<if test="offset != null and pagesize != null">
			limit ${offset}, ${pagesize}
		</if>
	</select>
	
	<!-- 查询件数统计列表数量 -->
	<select id="searchLoanNumberStatisticsListCount" parameterType="map" resultType="Integer">
	    select count(*) from (select t1.dept_pname as first_level_dept_name,
							    	 t1.dept_name as second_level_dept_name,
							    	 t1.personnel_name,
							    	 t1.personnel_shortcode,
							    	 ifnull(t1.personnel_regionNumber, '') as personnel_regionNumber,
								     ifnull(t4.count, '0') as intern_num,
									 ifnull(t5.count, '0') as check_point_num,
									 ifnull(t3.number_loans, '0') as loans_num,
									 ifnull(replace(replace(format(cast(t3.amount_loans as decimal) / 10000, 2), ',', ''), '.00', ''), '0') as loans_amount
						        from (select a1.dept_id,
								   			 a2.personnel_name,
								   			 a2.personnel_shortcode,
								   			 a2.personnel_regionNumber,
										     a1.dept_name,
										     a3.dept_name as dept_pname
						         		from sys_dept a1, pm_personnel a2, sys_dept a3
								       where a1.dept_id = a2.personnel_deptid
									     and a1.dept_pid = a3.dept_id
								         and a2.enable_flag = 1
								         and a1.enable_flag = 1
								       union
								      select a3.personnel_deptid,
								             a3.personnel_name,
								        	 a3.personnel_shortcode,
								        	 a3.personnel_regionNumber,
											 a5.dept_name,
											 a6.dept_name as dept_pname
								        from pm_personnel a3, wms_cre_credit_notary_warn a4, sys_dept a5, sys_dept a6
								       where a3.personnel_shortcode = a4.salesman_shortcode
										 and a4.salesman_own_dept_id = a5.dept_id
										 and a5.dept_pid = a6.dept_id
								         and a4.salesman_shortcode is not null
								         and a4.salesman_shortcode != ''
								         <if test="create_timestamp_start != null">
								           	 and a4.protocol_date &gt;= #{create_timestamp_start}
								         </if>
								         <if test="create_timestamp_end != null">
								             and a4.protocol_date &lt;= #{create_timestamp_end}
								         </if>
								         and a4.enable_flag = '1'
								         and a4.is_achievement = '1'
						                 and a3.personnel_state = '1'
										 and a3.enable_flag = '1'
								    group by a3.personnel_shortcode) t1
						   left join (select t.salesman_shortcode, 
							 				 count(*) as number_loans,
							 				 sum(t.amount_loans) as amount_loans
							 		    from (select a3.salesman_shortcode,
										             count(a3.wms_cre_credit_notary_warn_id) as number_loans, 
										             sum(a3.appro_limit) as amount_loans 
										        from wms_cre_credit_notary_warn a3, wms_fina_cre_loan_app a4
										       where a3.wms_cre_credit_head_id = a4.wms_cre_credit_head_id
										         and a3.bill_type = '01' 
										         and (a3.data_sources in (10, 11) or a3.cre_type = 2)
											     <if test="create_timestamp_start != null">
										           	 and a4.loan_date &gt;= #{create_timestamp_start}
										         </if>
										         <if test="create_timestamp_end != null">
										             and a4.loan_date &lt;= #{create_timestamp_end}
										         </if>
											     and a3.enable_flag = '1'
											     and a3.salesman_shortcode != ''
											     and a3.is_achievement = '1'
											group by a3.salesman_shortcode, ifnull(a3.bill_code_group, uuid())) t
							        group by salesman_shortcode) t3
						          on t1.personnel_shortcode = t3.salesman_shortcode
						   left join (select c3.salesman_shortcode, 
									         count(*) as count 			             
							            from wms_cre_housing_approval_info c1, wms_cre_credit_head c3
									   where c1.wms_cre_credit_head_id = c3.wms_cre_credit_head_id
										 and c1.approval_task_code = 'FCCP'
										 and c1.approval_type = 1							      
										 <if test="create_timestamp_start != null">
								           	 and date_format(c1.approval_time, '%Y-%m-%d') &gt;= #{create_timestamp_start}
								         </if>
								         <if test="create_timestamp_end != null">
								             and date_format(c1.approval_time, '%Y-%m-%d') &lt;= #{create_timestamp_end}
								         </if>				         
									group by c3.salesman_shortcode) t4
								  on t1.personnel_shortcode = t4.salesman_shortcode
						   left join (select c3.salesman_shortcode, 
									         count(*) as count 
									    from wms_cre_housing_approval_info c1, wms_cre_credit_head c3
									   where c1.wms_cre_credit_head_id = c3.wms_cre_credit_head_id
									     and c1.approval_task_code = 'FCHC'
									     and c1.approval_type = 1							      
									     <if test="create_timestamp_start != null">
								          	  and date_format(c1.approval_time, '%Y-%m-%d') &gt;= #{create_timestamp_start}
								         </if>
								         <if test="create_timestamp_end != null">
								             and date_format(c1.approval_time, '%Y-%m-%d') &lt;= #{create_timestamp_end}
								         </if>
									group by c3.salesman_shortcode) t5
								  on t1.personnel_shortcode = t5.salesman_shortcode) t
						   
		<where>
			and (t.intern_num != 0 or check_point_num != 0 or loans_num != 0)
			<if test="dept_name != null">
				and t.second_level_dept_name like '${dept_name}'
			</if>
			<if test="city != null">
				and t.personnel_regionNumber = #{city}
			</if>
			<if test="salesman_name != null">
				and (t.personnel_name like '${salesman_name}' or t.personnel_shortcode like '${salesman_name}')
			</if>
		</where>
	</select>
	
		<!-- 获取对应单据状态的数量 -->
	<select id="getStatusCount" parameterType="map" resultType="java.util.HashMap">
		SELECT	
		wms_cre_credit_head_id
		FROM
		wms_cre_credit_head 
		WHERE
		 FIND_IN_SET(bill_status,#{bill_status})
		and enable_flag=1
		and cre_type=2
		and version_number=3
	</select>
	
	<!-- 上单、放款总件数、金额汇总 -->
	<select id="loansStatisticsAll" parameterType="map" resultType="java.util.HashMap">
		select a.count1, 
			   b.count2, 
			   c.count3, 
			   ifnull(replace(replace(format(cast(d.sum as decimal) / 10000, 2), ',', ''), '.00', ''), '0') as sum
		  from (select count(*) as count1 from wms_cre_credit_head t1 
	             where date_format(t1.create_timestamp, '%Y-%m-%d') &gt;= #{effective_time}
			  	   and t1.is_group_flag = 0
			  	   and t1.bill_status != 'A') a,
			   (select count(*) as count2 from wms_cre_credit_head t1 
			     where date_format(t1.create_timestamp, '%Y-%m-%d') = date_format(now(), '%Y-%m-%d')
			       and t1.is_group_flag = 0
			       and t1.bill_status != 'A') b,
			   (select count(*) as count3 from wms_cre_credit_head t1, wms_fina_cre_loan_app t2 
				 where t1.wms_cre_credit_head_id = t2.wms_cre_credit_head_id
				   and bill_status = 'W' 
				   and date_format(t2.loan_date, '%Y-%m-%d') = date_format(now(), '%Y-%m-%d')
			       and t1.is_group_flag = 0) c,
			   (select sum(t2.appro_limit) as sum from wms_cre_credit_head t1, wms_cre_appro_borrow_protocol t2, wms_fina_cre_loan_app t3
				 where t1.wms_cre_credit_head_id = t2.wms_cre_credit_head_id 
				   and t1.wms_cre_credit_head_id = t3.wms_cre_credit_head_id
				   and t1.bill_status = 'W' 
				   and date_format(t3.loan_date, '%Y-%m-%d') = date_format(now(), '%Y-%m-%d')) d
	</select>
	
	<!-- 上单、放款数汇总(年) -->
	<select id="searchBillStatusStaticsByYear" parameterType="map" resultType="java.util.HashMap">
		select t1.year as time,
		       t1.year as real_time,
			   ifnull(t2.count1, 0) as count1, 
			   ifnull(t3.count2, 0) as count2, 
			   ifnull(replace(replace(format(cast(t4.sum as decimal) / 10000, 2), ',', ''), '.00', ''), '0') as sum
		  from (select date_format(now(), '%Y') as year 
			     union 
				select date_format(date_sub(now(), interval 1 year), '%Y') as year) t1
	 left join (select count(*) as count1, 
	 				   a.year 
	 			  from (select date_format(create_timestamp, '%Y') as year
	 			          from wms_cre_credit_head t1 
					     where date_format(create_timestamp, '%Y-%m-%d') &gt;= #{effective_time}
					       and t1.is_group_flag = 0
					       and t1.bill_status != 'A') a 
			  group by a.year) t2
            on t1.year = t2.year
	 left join (select count(*) as count2, 
	 				   a.year 
	 			  from (select date_format(t2.loan_date, '%Y') as year
	 			          from wms_cre_credit_head t1, wms_fina_cre_loan_app t2 
			             where t1.wms_cre_credit_head_id = t2.wms_cre_credit_head_id
						   and date_format(t2.loan_date, '%Y-%m-%d') &gt;= #{effective_time}
						   and t2.loan_date is not null
						   and t1.bill_status = 'W'
					  	   and t1.is_group_flag = 0) a 
			  group by a.year) t3
            on t1.year = t3.year
	 left join (select sum(a.appro_limit) as sum, 
	 				   a.year 
	 			  from (select date_format(t2.loan_date, '%Y') as year, 
	 			               sum(t3.appro_limit) as appro_limit
	 			          from wms_cre_credit_head t1, wms_fina_cre_loan_app t2, wms_cre_appro_borrow_protocol t3 
	      				 where t1.wms_cre_credit_head_id = t2.wms_cre_credit_head_id
				           and t1.wms_cre_credit_head_id = t3.wms_cre_credit_head_id
					       and date_format(t2.loan_date, '%Y-%m-%d') &gt;= #{effective_time}
				           and t2.loan_date is not null
				           and t1.bill_status = 'W') a 
			  group by a.year) t4
		    on t1.year = t4.year
         where t1.year &gt;= date_format(#{effective_time}, '%Y')
	</select>
	
	<!-- 上单、放款数汇总(月) -->
	<select id="searchBillStatusStaticsByMonth" parameterType="map" resultType="java.util.HashMap">
	    select ifnull(count(*), 0) as data, 
			   a.month as time,
			   '1' as type
		  from (select date_format(create_timestamp, '%Y-%m') as month
			      from wms_cre_credit_head t1 
			     where date_format(t1.create_timestamp, '%Y-%m-%d') &gt;= #{effective_time}
			       and date_format(t1.create_timestamp, '%Y') = #{statistics_time}
			  	   and t1.is_group_flag = 0
			  	   and t1.bill_status != 'A') a 
	  group by a.month
	     union
	    select ifnull(count(*), 0) as data,  
			   a.month,
			   '2' as type 
		  from (select date_format(t2.loan_date, '%Y-%m') as month
		          from wms_cre_credit_head t1, wms_fina_cre_loan_app t2 
	             where t1.wms_cre_credit_head_id = t2.wms_cre_credit_head_id
				   and date_format(t2.loan_date, '%Y-%m-%d') &gt;= #{effective_time}
				   and date_format(t2.loan_date, '%Y') = #{statistics_time}
				   and t2.loan_date is not null
				   and t1.bill_status = 'W'
			  	   and t1.is_group_flag = 0) a 
	  group by a.month
	    union
	   select ifnull(replace(replace(format(cast(sum(a.appro_limit) as decimal) / 10000, 2), ',', ''), '.00', ''), '0') as data,
			  a.month,
			  '3' as type 
			  from (select date_format(t2.loan_date, '%Y-%m') as month, 
			               t3.appro_limit
			          from wms_cre_credit_head t1, wms_fina_cre_loan_app t2, wms_cre_appro_borrow_protocol t3 
					 where t1.wms_cre_credit_head_id = t2.wms_cre_credit_head_id
			           and t1.wms_cre_credit_head_id = t3.wms_cre_credit_head_id
				       and date_format(t2.loan_date, '%Y-%m-%d') &gt;= #{effective_time}
				       and date_format(t2.loan_date, '%Y') = #{statistics_time}
			           and t2.loan_date is not null
			           and t1.bill_status = 'W') a 
	  group by a.month
	</select>
	
	<!-- 上单、放款数汇总(日) -->
	<select id="searchBillStatusStaticsByDay" parameterType="map" resultType="java.util.HashMap">
	    select ifnull(count(*), 0) as data, 
			   a.day as time,
			   '1' as type
		  from (select date_format(create_timestamp, '%Y-%m-%d') as day
			      from wms_cre_credit_head t1 
			     where date_format(t1.create_timestamp, '%Y-%m-%d') &gt;= #{effective_time}
			       and date_format(t1.create_timestamp, '%Y-%m') = #{statistics_time}
			  	   and t1.is_group_flag = 0
			  	   and t1.bill_status != 'A') a 
	  group by a.day
	     union
	    select ifnull(count(*), 0) as data, 
			   a.day as time,
			   '2' as type 
		  from (select date_format(t2.loan_date, '%Y-%m-%d') as day 
		          from wms_cre_credit_head t1, wms_fina_cre_loan_app t2 
	             where t1.wms_cre_credit_head_id = t2.wms_cre_credit_head_id
				   and date_format(t2.loan_date, '%Y-%m-%d') &gt;= #{effective_time}
				   and date_format(t2.loan_date, '%Y-%m') = #{statistics_time}
				   and t2.loan_date is not null
				   and t1.bill_status = 'W'
			  	   and t1.is_group_flag = 0) a 
	  group by a.day
	    union
	   select ifnull(replace(replace(format(cast(sum(a.appro_limit) as decimal) / 10000, 2), ',', ''), '.00', ''), '0') as data,
			  a.day as time,
			  '3' as type 
			  from (select date_format(t2.loan_date, '%Y-%m-%d') as day, 
			               t3.appro_limit
			          from wms_cre_credit_head t1, wms_fina_cre_loan_app t2, wms_cre_appro_borrow_protocol t3 
					 where t1.wms_cre_credit_head_id = t2.wms_cre_credit_head_id
			           and t1.wms_cre_credit_head_id = t3.wms_cre_credit_head_id
				       and date_format(t2.loan_date, '%Y-%m-%d') &gt;= #{effective_time}
				       and date_format(t2.loan_date, '%Y-%m') = #{statistics_time}
			           and t2.loan_date is not null
			           and t1.bill_status = 'W') a 
	  group by a.day
	</select>
	
	<!-- 单据状态统计 -->
	<select id="loansStatistics" parameterType="map" resultType="java.util.HashMap">
	    select * 
	      from (select concat(t3.value_meaning, '(申请金额)') as value_meaning,
	      			   t1.bill_status, 
			      	   ifnulL(t2.count, 0) as count, 
			      	   ifnull(t2.total_amount, 0) as total_amount 
	      	      from (select 'B' as bill_status 
						 union select 'BT' as bill_status 
						 union select 'BJ' as bill_status 
						 union select 'C' as bill_status
						 union select 'CZ' as bill_status 
						 union select 'D' as bill_status 
						 union select 'DZ' as bill_status 
						 union select 'E' as bill_status 
						 union select 'EJ' as bill_status 
						 union select 'EZ' as bill_status) t1 
			 left join (select a.bill_status, 
			                   count(*) as count, 
			                   sum(a.credit_limit) as total_amount 
			              from wms_cre_credit_head a
						 where date_format(a.create_timestamp, '%Y-%m-%d') &gt;= #{effective_time}
					  group by a.bill_status) t2 
					on t1.bill_status =  t2.bill_status
			 left join wms_sys_dict_data t3
				    on t1.bill_status = t3.value_code
				   and t3.wms_sys_dict_id = 131
				   
				 union
				 
				select concat(t3.value_meaning, '(终审金额)') as value_meaning,
					   t1.bill_status, 
				       ifnull(t2.count, 0) as count, 
				       ifnull(cast(t2.total_amount as signed), 0) as total_amount 
				  from (select 'F' as bill_status 
							   union select 'FZ' as bill_status 
							   union select 'G' as bill_status
							   union select 'H' as bill_status 
							   union select 'HT' as bill_status 
							   union select 'HZ' as bill_status) t1 
			 left join (select b.bill_status,
			 				   count(*) as count,
			                   sum(b.total_amount) as total_amount
			              from (select a.bill_status, 
					                   count(*) as count, 
					                   sum(a.appro_limit) as total_amount 
					              from wms_cre_credit_head a
			                     where date_format(a.create_timestamp, '%Y-%m-%d') &gt;= #{effective_time}
					          group by a.bill_status, ifnull(a.wms_cre_credit_group_id, uuid())) b
					  group by b.bill_status) t2
			        on t1.bill_status = t2.bill_status
		     left join wms_sys_dict_data t3
				    on t1.bill_status = t3.value_code
			       and t3.wms_sys_dict_id = 131
			        
				 union
				 
			    select concat(t3.value_meaning, '(合同金额)') as value_meaning,
			    	   t1.bill_status, 
			           ifnull(t2.count, 0) as count, 
			           ifnull(replace(replace(format(cast(t2.principal_lower as decimal) / 10000, 2), ',', ''), '.00', ''), '0') as total_amount
			      from (select 'I' as bill_status 
					     union 
					    select 'W' as bill_status) t1 
			 left join (select b.bill_status,
			 				   count(*) as count,
			                   sum(b.principal_lower) as principal_lower
			              from (select a.bill_status, 
					                   count(*) as count, 
					                   sum(b.principal_lower) as principal_lower 
					              from wms_cre_credit_head a, wms_cre_appro_borrow_protocol b
					             where a.wms_cre_credit_head_id = b.wms_cre_credit_head_id
				                   and date_format(a.create_timestamp, '%Y-%m-%d') &gt;= #{effective_time}
				              group by a.bill_status, ifnull(a.wms_cre_credit_group_id, uuid())) b
					  group by b.bill_status) t2
		            on t1.bill_status = t2.bill_status
		      left join wms_sys_dict_data t3
				     on t1.bill_status = t3.value_code
				    and t3.wms_sys_dict_id = 131) a
	</select>
	<select id="getGroupIdForHeadIdStatus" parameterType="map" resultType="java.util.HashMap">
		SELECT * from wms_cre_credit_head where  (wms_cre_credit_group_id = (select
			wms_cre_credit_group_id
		from
			wms_cre_credit_head
		where
			wms_cre_credit_head_id = #{wms_cre_credit_head_id} ) or wms_cre_credit_head_id = #{wms_cre_credit_head_id}) and FIND_IN_SET(bill_status, #{bill_status})and enable_flag=1
	</select>
	<select id="getGroupInfo" parameterType="map" resultType="java.util.HashMap">
	SELECT
		 (select value_meaning from wms_sys_dict_data where value_code = bill_status
		 and wms_sys_dict_id = 131)as bill_status_name,
	     wms_cre_credit_head_id,
 	     bill_code,
   		 bill_status
	FROM
		wms_cre_credit_head
	WHERE
		(
			wms_cre_credit_group_id = (
				SELECT
					wms_cre_credit_group_id
				FROM
					wms_cre_credit_head
				WHERE
					wms_cre_credit_head_id = #{wms_cre_credit_head_id}
			)
			OR wms_cre_credit_head_id = #{wms_cre_credit_head_id}
		) and FIND_IN_SET(bill_status, #{bill_status}) and enable_flag=1
	</select>
</mapper> 
