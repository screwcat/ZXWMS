<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- namespace必须指向Dao接口 -->
<mapper namespace="com.zx.emanage.inve.persist.WmsInveDebtHeadDao">
	<!-- get entity by pk -->
	<select id="get" parameterType="int" resultType="WmsInveDebtHead">
		select
        				wms_inve_debt_head_id,
        				debt_reason,
        				wms_inve_transa_id,
        				wms_inve_transa_prod_id,
        				wms_inve_pruduct_category_id,
        				wms_inve_customer_id,
        				bill_code,
        				data_status,
        				sup_user_id,
        				sup_dept_id,
        				sup_advice,
        				sup_result,
						date_format(sup_date,'%Y-%m-%d') as sup_date_str,
        				sup_date,
        				submger_user_id,
        				submger_dept_id,
        				submger_advice,
        				submger_result,
						date_format(submger_date,'%Y-%m-%d') as submger_date_str,
        				submger_date,
        				mger_user_id,
        				mger_dept_id,
        				mger_advice,
        				mger_result,
						date_format(mger_date,'%Y-%m-%d') as mger_date_str,
        				mger_date,
        				is_sp_app,
        				sp_app_operator_id,
						date_format(sp_app_date,'%Y-%m-%d %H:%i:%s') as sp_app_date_str,
        				sp_app_date,
        				sp_app_leader_id,
        				sp_app_leader_name,
        				sp_app_result,
        				sp_app_advice,
        				is_debtadj_confirm,
        				is_debtmatch_finish,
        				is_protocol_finish,
						date_format(create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp_str,
        				create_timestamp,
        				create_user_id,
        				create_dept_id,
        				enable_flag
        	from
        		wms_inve_debt_head
        	where
        				wms_inve_debt_head_id = #{wms_inve_debt_head_id}
	</select>

	<!--财务管理-【债权变动申请】-列表查询数据数 -->
	<select id="findCountCusOriginalClaims" parameterType="map" resultType="int">
		SELECT 
			count(t1.wms_inve_transa_id) as count		 
		from 
			wms_inve_transa t1,
			wms_inve_transa_prod t2,
			wms_inve_customer t3,
			wms_inve_pruduct_category t4
		<where>
			t1.data_status = 4 
			and	t1.wms_inve_customer_id=t3.wms_inve_customer_id
			and t1.wms_inve_transa_id=t2.wms_inve_transa_id
			and t2.wms_inve_pruduct_category_id=t4.wms_inve_pruduct_category_id
			and t2.enable_flag = 1
			and 1=#{key}
			<if test="cus_name != null">
				and	t1.cus_name like #{cus_name}
			</if>
			<if test="category_name != null">
				and t2.wms_inve_pruduct_category_id = #{category_name}
			</if>
			<if test="id_card != null">
				and t1.id_card like #{id_card}
			</if>
			<if test="create_timestamp_begin != null">
				and date_format(t1.create_timestamp,'%Y-%m-%d') &gt;=#{create_timestamp_begin}
			</if>
			<if test="create_timestamp_end != null">
				and date_format(t1.create_timestamp,'%Y-%m-%d') &lt;=#{create_timestamp_end}
			</if>
		</where> 
	</select>

	<!-- list -->
	<select id="search" parameterType="map" resultType="java.util.HashMap">
		select 
				wms_inve_debt_head_id,
				debt_reason,
				wms_inve_transa_id,
				wms_inve_transa_prod_id,
				wms_inve_pruduct_category_id,
				wms_inve_customer_id,
				bill_code,
				data_status,
				sup_user_id,
				sup_dept_id,
				sup_advice,
				sup_result,
				date_format(sup_date,'%Y-%m-%d') as sup_date_str,
				sup_date,
				submger_user_id,
				submger_dept_id,
				submger_advice,
				submger_result,
				date_format(submger_date,'%Y-%m-%d') as submger_date_str,
				submger_date,
				mger_user_id,
				mger_dept_id,
				mger_advice,
				mger_result,
				date_format(mger_date,'%Y-%m-%d') as mger_date_str,
				mger_date,
				is_sp_app,
				sp_app_operator_id,
				date_format(sp_app_date,'%Y-%m-%d %H:%i:%s') as sp_app_date_str,
				sp_app_date,
				sp_app_leader_id,
				sp_app_leader_name,
				sp_app_result,
				sp_app_advice,
				is_debtadj_confirm,
				is_debtmatch_finish,
				is_protocol_finish,
				date_format(create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp_str,
				create_timestamp,
				create_user_id,
				create_dept_id,
				enable_flag
		from wms_inve_debt_head
		<where>
			<if test="paramname != null">
				<!-- and columnName = #{columnName} -->
			</if>
		</where>
		<if test="sortname != '' and sortorder !=''">
			ORDER BY ${sortname} ${sortorder}
		</if>
		<if test="offset != null and pagesize !=null">
			LIMIT ${offset} , ${pagesize}
		</if>
	</select>

	<!-- save -->
	<insert id="save" parameterType="WmsInveDebtHead" useGeneratedKeys="true" keyProperty="wms_inve_debt_head_id">
		INSERT INTO wms_inve_debt_head
		(
				wms_inve_debt_head_id,

				debt_reason,

				wms_inve_transa_id,

				wms_inve_transa_prod_id,

				wms_inve_pruduct_category_id,

				wms_inve_customer_id,

				bill_code,

				data_status,

				sup_user_id,

				sup_dept_id,

				sup_advice,

				sup_result,

				sup_date,

				submger_user_id,

				submger_dept_id,

				submger_advice,

				submger_result,

				submger_date,

				mger_user_id,

				mger_dept_id,

				mger_advice,

				mger_result,

				mger_date,

				is_sp_app,

				sp_app_operator_id,

				sp_app_date,

				sp_app_leader_id,

				sp_app_leader_name,

				sp_app_result,

				sp_app_advice,

				is_debtadj_confirm,

				is_debtmatch_finish,

				is_protocol_finish,

				create_timestamp,

				create_user_id,

				create_dept_id,

				enable_flag
		)
		VALUES
		(
				#{wms_inve_debt_head_id},
				#{debt_reason},
				#{wms_inve_transa_id},
				#{wms_inve_transa_prod_id},
				#{wms_inve_pruduct_category_id},
				#{wms_inve_customer_id},
				#{bill_code},
				#{data_status},
				#{sup_user_id},
				#{sup_dept_id},
				#{sup_advice},
				#{sup_result},
				#{sup_date},
				#{submger_user_id},
				#{submger_dept_id},
				#{submger_advice},
				#{submger_result},
				#{submger_date},
				#{mger_user_id},
				#{mger_dept_id},
				#{mger_advice},
				#{mger_result},
				#{mger_date},
				#{is_sp_app},
				#{sp_app_operator_id},
				#{sp_app_date},
				#{sp_app_leader_id},
				#{sp_app_leader_name},
				#{sp_app_result},
				#{sp_app_advice},
				#{is_debtadj_confirm},
				#{is_debtmatch_finish},
				#{is_protocol_finish},
				#{create_timestamp},
				#{create_user_id},
				#{create_dept_id},
				#{enable_flag}
		);
	</insert>

	<!-- 更新用户 -->
	<update id="update" parameterType="WmsInveDebtHead">
		update wms_inve_debt_head
		<set>
					<if test="wms_inve_debt_head_id != null">
						 wms_inve_debt_head_id = #{wms_inve_debt_head_id},
					</if>
					<if test="debt_reason != null">
						 debt_reason = #{debt_reason},
					</if>
					<if test="wms_inve_transa_id != null">
						 wms_inve_transa_id = #{wms_inve_transa_id},
					</if>
					<if test="wms_inve_transa_prod_id != null">
						 wms_inve_transa_prod_id = #{wms_inve_transa_prod_id},
					</if>
					<if test="wms_inve_pruduct_category_id != null">
						 wms_inve_pruduct_category_id = #{wms_inve_pruduct_category_id},
					</if>
					<if test="wms_inve_customer_id != null">
						 wms_inve_customer_id = #{wms_inve_customer_id},
					</if>
					<if test="bill_code != null">
						 bill_code = #{bill_code},
					</if>
					<if test="data_status != null">
						 data_status = #{data_status},
					</if>
					<if test="sup_user_id != null">
						 sup_user_id = #{sup_user_id},
					</if>
					<if test="sup_dept_id != null">
						 sup_dept_id = #{sup_dept_id},
					</if>
					<if test="sup_advice != null">
						 sup_advice = #{sup_advice},
					</if>
					<if test="sup_result != null">
						 sup_result = #{sup_result},
					</if>
					<if test="sup_date != null">
						 sup_date = #{sup_date},
					</if>
					<if test="submger_user_id != null">
						 submger_user_id = #{submger_user_id},
					</if>
					<if test="submger_dept_id != null">
						 submger_dept_id = #{submger_dept_id},
					</if>
					<if test="submger_advice != null">
						 submger_advice = #{submger_advice},
					</if>
					<if test="submger_result != null">
						 submger_result = #{submger_result},
					</if>
					<if test="submger_date != null">
						 submger_date = #{submger_date},
					</if>
					<if test="mger_user_id != null">
						 mger_user_id = #{mger_user_id},
					</if>
					<if test="mger_dept_id != null">
						 mger_dept_id = #{mger_dept_id},
					</if>
					<if test="mger_advice != null">
						 mger_advice = #{mger_advice},
					</if>
					<if test="mger_result != null">
						 mger_result = #{mger_result},
					</if>
					<if test="mger_date != null">
						 mger_date = #{mger_date},
					</if>
					<if test="is_sp_app != null">
						 is_sp_app = #{is_sp_app},
					</if>
					<if test="sp_app_operator_id != null">
						 sp_app_operator_id = #{sp_app_operator_id},
					</if>
					<if test="sp_app_date != null">
						 sp_app_date = #{sp_app_date},
					</if>
					<if test="sp_app_leader_id != null">
						 sp_app_leader_id = #{sp_app_leader_id},
					</if>
					<if test="sp_app_leader_name != null">
						 sp_app_leader_name = #{sp_app_leader_name},
					</if>
					<if test="sp_app_result != null">
						 sp_app_result = #{sp_app_result},
					</if>
					<if test="sp_app_advice != null">
						 sp_app_advice = #{sp_app_advice},
					</if>
					<if test="is_debtadj_confirm != null">
						 is_debtadj_confirm = #{is_debtadj_confirm},
					</if>
					<if test="is_debtmatch_finish != null">
						 is_debtmatch_finish = #{is_debtmatch_finish},
					</if>
					<if test="is_protocol_finish != null">
						 is_protocol_finish = #{is_protocol_finish},
					</if>
					<if test="create_timestamp != null">
						 create_timestamp = #{create_timestamp},
					</if>
					<if test="create_user_id != null">
						 create_user_id = #{create_user_id},
					</if>
					<if test="create_dept_id != null">
						 create_dept_id = #{create_dept_id},
					</if>
					<if test="enable_flag != null">
						 enable_flag = #{enable_flag},
					</if>
	   </set>
		 where 
    				wms_inve_debt_head_id = #{wms_inve_debt_head_id}
	</update>
	<select id="getListByEntity" parameterType="WmsInveDebtHead" resultType="WmsInveDebtHead">
		select 
				wms_inve_debt_head_id,
				debt_reason,
				wms_inve_transa_id,
				wms_inve_transa_prod_id,
				wms_inve_pruduct_category_id,
				wms_inve_customer_id,
				bill_code,
				data_status,
				sup_user_id,
				sup_dept_id,
				sup_advice,
				sup_result,
				date_format(sup_date,'%Y-%m-%d') as sup_date_str,
				sup_date,
				submger_user_id,
				submger_dept_id,
				submger_advice,
				submger_result,
				date_format(submger_date,'%Y-%m-%d') as submger_date_str,
				submger_date,
				mger_user_id,
				mger_dept_id,
				mger_advice,
				mger_result,
				date_format(mger_date,'%Y-%m-%d') as mger_date_str,
				mger_date,
				is_sp_app,
				sp_app_operator_id,
				date_format(sp_app_date,'%Y-%m-%d %H:%i:%s') as sp_app_date_str,
				sp_app_date,
				sp_app_leader_id,
				sp_app_leader_name,
				sp_app_result,
				sp_app_advice,
				is_debtadj_confirm,
				is_debtmatch_finish,
				is_protocol_finish,
				date_format(create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp_str,
				create_timestamp,
				create_user_id,
				create_dept_id,
				enable_flag
		from
		wms_inve_debt_head
		<where>
					<if test="wms_inve_debt_head_id != null">
						and wms_inve_debt_head_id = #{wms_inve_debt_head_id}
					</if>
					<if test="debt_reason != null">
						and debt_reason = #{debt_reason}
					</if>
					<if test="wms_inve_transa_id != null">
						and wms_inve_transa_id = #{wms_inve_transa_id}
					</if>
					<if test="wms_inve_transa_prod_id != null">
						and wms_inve_transa_prod_id = #{wms_inve_transa_prod_id}
					</if>
					<if test="wms_inve_pruduct_category_id != null">
						and wms_inve_pruduct_category_id = #{wms_inve_pruduct_category_id}
					</if>
					<if test="wms_inve_customer_id != null">
						and wms_inve_customer_id = #{wms_inve_customer_id}
					</if>
					<if test="bill_code != null">
						and bill_code = #{bill_code}
					</if>
					<if test="data_status != null">
						and data_status = #{data_status}
					</if>
					<if test="sup_user_id != null">
						and sup_user_id = #{sup_user_id}
					</if>
					<if test="sup_dept_id != null">
						and sup_dept_id = #{sup_dept_id}
					</if>
					<if test="sup_advice != null">
						and sup_advice = #{sup_advice}
					</if>
					<if test="sup_result != null">
						and sup_result = #{sup_result}
					</if>
					<if test="sup_date != null">
						and sup_date = #{sup_date}
					</if>
					<if test="submger_user_id != null">
						and submger_user_id = #{submger_user_id}
					</if>
					<if test="submger_dept_id != null">
						and submger_dept_id = #{submger_dept_id}
					</if>
					<if test="submger_advice != null">
						and submger_advice = #{submger_advice}
					</if>
					<if test="submger_result != null">
						and submger_result = #{submger_result}
					</if>
					<if test="submger_date != null">
						and submger_date = #{submger_date}
					</if>
					<if test="mger_user_id != null">
						and mger_user_id = #{mger_user_id}
					</if>
					<if test="mger_dept_id != null">
						and mger_dept_id = #{mger_dept_id}
					</if>
					<if test="mger_advice != null">
						and mger_advice = #{mger_advice}
					</if>
					<if test="mger_result != null">
						and mger_result = #{mger_result}
					</if>
					<if test="mger_date != null">
						and mger_date = #{mger_date}
					</if>
					<if test="is_sp_app != null">
						and is_sp_app = #{is_sp_app}
					</if>
					<if test="sp_app_operator_id != null">
						and sp_app_operator_id = #{sp_app_operator_id}
					</if>
					<if test="sp_app_date != null">
						and sp_app_date = #{sp_app_date}
					</if>
					<if test="sp_app_leader_id != null">
						and sp_app_leader_id = #{sp_app_leader_id}
					</if>
					<if test="sp_app_leader_name != null">
						and sp_app_leader_name = #{sp_app_leader_name}
					</if>
					<if test="sp_app_result != null">
						and sp_app_result = #{sp_app_result}
					</if>
					<if test="sp_app_advice != null">
						and sp_app_advice = #{sp_app_advice}
					</if>
					<if test="is_debtadj_confirm != null">
						and is_debtadj_confirm = #{is_debtadj_confirm}
					</if>
					<if test="is_debtmatch_finish != null">
						and is_debtmatch_finish = #{is_debtmatch_finish}
					</if>
					<if test="is_protocol_finish != null">
						and is_protocol_finish = #{is_protocol_finish}
					</if>
					<if test="create_timestamp != null">
						and create_timestamp = #{create_timestamp}
					</if>
					<if test="create_user_id != null">
						and create_user_id = #{create_user_id}
					</if>
					<if test="create_dept_id != null">
						and create_dept_id = #{create_dept_id}
					</if>
					<if test="enable_flag != null">
						and enable_flag = #{enable_flag}
					</if>
				 	<if test="isExcludePKFlag != null and isExcludePKFlag == true">
		        				and wms_inve_debt_head_id != #{wms_inve_debt_head_id}
					</if>
		</where>
	</select>
	<!-- 获取【债权调整申请】页面所有符合要求的数据信息-->
	<select id="getCusOriginalClaims" parameterType="map" resultType="java.util.HashMap">
		SELECT 
			t1.wms_inve_transa_id,		 
			t1.bill_code,
			t1.cus_name,
			t1.id_card,
			date_format(t1.create_timestamp,'%Y-%m-%d') as create_timestamp,
			t2.wms_inve_transa_prod_id,
			t2.category_name,
			t2.product_deadline,
			(t2.product_account/10000) as product_account,
			t3.wms_inve_customer_id,
			t4.wms_inve_pruduct_category_id,
			t5.wms_inve_transa_protocol_id,
			(select value_meaning from wms_sys_dict_data where wms_sys_dict_id=55 and value_code=t1.data_status) as data_status 
		from 
			wms_inve_transa t1,
			wms_inve_transa_prod t2,
			wms_inve_customer t3,
			wms_inve_pruduct_category t4,
			wms_inve_transa_protocol t5
		<where>
			t1.data_status = 4 
			and	t1.wms_inve_customer_id=t3.wms_inve_customer_id
			and t1.wms_inve_transa_id=t2.wms_inve_transa_id
			and t2.wms_inve_pruduct_category_id=t4.wms_inve_pruduct_category_id
			and t1.wms_inve_transa_id = t5.wms_inve_transa_id
			and t2.enable_flag = 1 
			and t5.wms_inve_redeem_id=0
			and 1=#{key}
			<if test="cus_name != null">
				and	t1.cus_name like #{cus_name}
			</if>
			<if test="category_name != null">
				and t2.wms_inve_pruduct_category_id = #{category_name}
			</if>
			<if test="id_card != null">
				and t1.id_card like #{id_card}
			</if>
			<if test="create_timestamp_begin != null and create_timestamp_begin != '' ">
				and date_format(t1.create_timestamp,'%Y-%m-%d') &gt;=#{create_timestamp_begin}
			</if>
			<if test="create_timestamp_end != null and create_timestamp_end != '' ">
				and date_format(t1.create_timestamp,'%Y-%m-%d') &lt;=#{create_timestamp_end}
			</if>
			<if test="sortname != '' and sortorder !=''">
				ORDER BY ${sortname} ${sortorder}
			</if>
			<if test="offset != null and pagesize !=null">
				LIMIT ${offset} , ${pagesize}
			</if>
		</where> 
	</select>
	<!-- 根据上单产品id获取债权匹配信息  -->
	<select id="getMatchInfoByProd" parameterType="int" resultType="java.util.HashMap">
		select 
			wms_inve_transa_match,
			wms_inve_transa_prod_id,
			wms_fina_cre_repay_id,
			credit_name,
			protocol_code,
			credit_id_card,
			assign_account,
			date_of_assign,
			repay_begin_date,
			repay_end_date,
			product_interest_month
		from 
			wms_inve_transa_match
		<where>
				enable_flag = 1
			<if test="wms_inve_redeem_id != null">
                and wms_inve_redeem_id = #{wms_inve_redeem_id}
            </if>
			<if test="wms_inve_transa_prod_id != null">
				and wms_inve_transa_prod_id = #{wms_inve_transa_prod_id}
			</if>
				ORDER BY wms_inve_transa_match desc
			<if test="offset != null and pagesize !=null">
				LIMIT ${offset} , ${pagesize}
			</if>	
		</where>	
	</select>
	<!-- 理财管理-理财债权变动-债权变动审核-显示列表数据 -->
	<select id="getAllFromWmsInveDebtHead" parameterType="map" resultType="java.util.HashMap">
		SELECT 
			t1.wms_inve_debt_head_id,
			t1.debt_reason,
			t1.wms_inve_transa_id,
			t1.wms_inve_transa_prod_id,
			t1.wms_inve_pruduct_category_id,
			t1.wms_inve_customer_id,
			t1.bill_code,
			t2.cus_name,
      		t2.id_card,
      		t4.category_name,
			t4.product_deadline,
			(t4.product_account/10000) as product_account,
			date_format(t2.create_timestamp,'%Y-%m-%d') as create_timestamp,
			(select value_meaning from wms_sys_dict_data where wms_sys_dict_id=55 and value_code=9) as data_status_name,
			(select value_meaning from wms_sys_dict_data where wms_sys_dict_id=83 and value_code=t1.data_status) as data_status
		from 
			wms_inve_debt_head t1,wms_inve_transa t2,wms_inve_pruduct_category t3,wms_inve_transa_prod t4
		<where>
			t1.wms_inve_transa_id=t2.wms_inve_transa_id 
			and t1.wms_inve_transa_prod_id=t4.wms_inve_transa_prod_id 
			and t1.wms_inve_pruduct_category_id=t3.wms_inve_pruduct_category_id and t1.enable_flag=1
			and t2.data_status = 9 and t1.data_status in (1,2,3)
			<if test="idList != null">
				and t1.wms_inve_debt_head_id in
				<foreach collection="idList" item="wms_inve_debt_head_id"
					index="index" open="(" separator="," close=")">
					#{wms_inve_debt_head_id}
				</foreach>
			</if>
			and t3.enable_flag = 1
			<if test="cus_name != null">
				and	t2.cus_name like #{cus_name}
			</if>
			<if test="category_name != null">
				and t3.wms_inve_pruduct_category_id = #{category_name}
			</if>
			<if test="id_card != null">
				and t2.id_card like #{id_card}
			</if>
			<if test="create_timestamp_begin != null and create_timestamp_begin != '' ">
				and date_format(t2.create_timestamp,'%Y-%m-%d') &gt;=#{create_timestamp_begin}
			</if>
			<if test="create_timestamp_end != null and create_timestamp_end != '' ">
				and date_format(t2.create_timestamp,'%Y-%m-%d') &lt;= #{create_timestamp_end}
			</if>
			<if test="sortname != '' and sortorder !=''">
				ORDER BY ${sortname} ${sortorder}
			</if>
			<if test="offset != null and pagesize !=null">
				LIMIT ${offset} , ${pagesize}
			</if>
		</where> 
	</select>
	<!-- 理财管理-理财债权变动-债权变动修订-显示列表数据 -->
	<select id="getUpdateWmsInveDebtHead" parameterType="map" resultType="java.util.HashMap">
		SELECT 
			t1.wms_inve_debt_head_id,
			t1.debt_reason,
			t1.wms_inve_transa_id,
			t1.wms_inve_transa_prod_id,
			t1.wms_inve_pruduct_category_id,
			t1.wms_inve_customer_id,
			t1.bill_code,
			t2.cus_name,
      		t2.id_card,
      		t4.category_name,
			t4.product_deadline,
			(t4.product_account/10000) as product_account,
			date_format(t2.create_timestamp,'%Y-%m-%d') as create_timestamp,
			(select value_meaning from wms_sys_dict_data where wms_sys_dict_id=55 and value_code=9) as data_status_name,
			(select value_meaning from wms_sys_dict_data where wms_sys_dict_id=83 and value_code=t1.data_status) as data_status
		from 
			wms_inve_debt_head t1,wms_inve_transa t2,wms_inve_pruduct_category t3,wms_inve_transa_prod t4
		<where>
			t1.wms_inve_transa_id=t2.wms_inve_transa_id 
			and t1.wms_inve_transa_prod_id=t4.wms_inve_transa_prod_id 
			and t1.wms_inve_pruduct_category_id=t3.wms_inve_pruduct_category_id and t1.enable_flag=1
			and t2.data_status = 9 
			<if test="idList != null">
				and t1.wms_inve_debt_head_id in
				<foreach collection="idList" item="wms_inve_debt_head_id"
					index="index" open="(" separator="," close=")">
					#{wms_inve_debt_head_id}
				</foreach>
			</if>
			and t3.enable_flag = 1
			and t1.data_status = 4
			<if test="cus_name != null">
				and	t2.cus_name like #{cus_name}
			</if>
			<if test="category_name != null">
				and t3.wms_inve_pruduct_category_id = #{category_name}
			</if>
			<if test="id_card != null">
				and t2.id_card like #{id_card}
			</if>
			<if test="create_timestamp_begin != null and create_timestamp_begin != '' ">
				and date_format(t2.create_timestamp,'%Y-%m-%d') &gt;=#{create_timestamp_begin}
			</if>
			<if test="create_timestamp_end != null and create_timestamp_end != '' ">
				and date_format(t2.create_timestamp,'%Y-%m-%d') &lt;= #{create_timestamp_end}
			</if>
			<if test="sortname != '' and sortorder !=''">
				ORDER BY ${sortname} ${sortorder}
			</if>
			<if test="offset != null and pagesize !=null">
				LIMIT ${offset} , ${pagesize}
			</if>
		</where> 
	</select>
	<!--理财管理-理财债权变动-债权变动审核-显示列表数据数  -->
	<select id="findCountAllFromWmsInveDebtHead" parameterType="map" resultType="int">
		SELECT 
			count(t1.wms_inve_debt_head_id) as count
		from 
			wms_inve_debt_head t1,wms_inve_transa t2,wms_inve_pruduct_category t3,wms_inve_transa_prod t4
		<where>
			t1.wms_inve_transa_id=t2.wms_inve_transa_id 
			and t1.wms_inve_transa_prod_id=t4.wms_inve_transa_prod_id 
			and t1.wms_inve_pruduct_category_id=t3.wms_inve_pruduct_category_id and t1.enable_flag=1
			and t2.data_status = 9 and t1.data_status in (1,2,3)
			 <if test="idList != null">
				and t1.wms_inve_debt_head_id in
				<foreach collection="idList" item="wms_inve_debt_head_id"
					index="index" open="(" separator="," close=")">
					#{wms_inve_debt_head_id}
				</foreach>
			</if>
			<if test="cus_name != null">
				and	t2.cus_name like #{cus_name}
			</if>
			<if test="category_name != null">
				and t3.wms_inve_pruduct_category_id = #{category_name}
			</if>
			<if test="id_card != null">
				and t2.id_card like #{id_card}
			</if>
			<if test="create_timestamp_begin != null and create_timestamp_begin != '' ">
				and t2.create_timestamp &lt;=#{create_timestamp_begin}
			</if>
			<if test="create_timestamp_end != null and create_timestamp_end != '' ">
				and t2.create_timestamp &gt;= #{create_timestamp_end}
			</if>
		</where> 
	</select>
	<!-- 根据id硬删除 -->
	<delete id="delete" parameterType="int">
		delete from 
			wms_inve_debt_head 
		where 
			wms_inve_debt_head_id = #{wms_inve_debt_head_id}
	</delete>
	<!-- 获取债权变更原因 -->
	<select id="getDebtReason" parameterType="int" resultType="java.lang.String">
		select 
			debt_reason
		from 
			wms_inve_debt_head
		where 
			wms_inve_debt_head_id =#{wms_inve_debt_head_id}
	</select>
	<!-- 通过传递Map 更改相对应的数据信息 -->
	<select id="updateRecord" parameterType="map">
	  update wms_inve_debt_head
		<set>
			<if test="wms_inve_debt_head_id != null">
				wms_inve_debt_head_id = #{wms_inve_debt_head_id},
			</if>
			<if test="debt_reason != null">
				debt_reason = #{debt_reason},
			</if>
			<if test="wms_inve_transa_id != null">
				wms_inve_transa_id = #{wms_inve_transa_id},
			</if>
			<if test="wms_inve_transa_prod_id != null">
				wms_inve_transa_prod_id = #{wms_inve_transa_prod_id},
			</if>
			<if test="wms_inve_pruduct_category_id != null">
				wms_inve_pruduct_category_id = #{wms_inve_pruduct_category_id},
			</if>
			<if test="wms_inve_customer_id != null">
				wms_inve_customer_id = #{wms_inve_customer_id},
			</if>
			<if test="bill_code != null">
				bill_code = #{bill_code},
			</if>
			<if test="data_status != null">
				data_status = #{data_status},
			</if>
			<if test="sup_user_id != null">
				 sup_user_id = #{sup_user_id},
			</if>
			<if test="sup_dept_id != null">
				 sup_dept_id = #{sup_dept_id},
			</if>
			<if test="sup_advice != null">
				 sup_advice = #{sup_advice},
			</if>
			<if test="sup_result != null">
				 sup_result = #{sup_result},
			</if>
			<if test="sup_date != null">
				 sup_date = #{sup_date},
			</if>
			<if test="submger_user_id != null">
				 submger_user_id = #{submger_user_id},
			</if>
			<if test="submger_dept_id != null">
				 submger_dept_id = #{submger_dept_id},
			</if>
			<if test="submger_advice != null">
				 submger_advice = #{submger_advice},
			</if>
			<if test="submger_result != null">
				 submger_result = #{submger_result},
			</if>
			<if test="submger_date != null">
				 submger_date = #{submger_date},
			</if>
			<if test="mger_user_id != null">
				 mger_user_id = #{mger_user_id},
			</if>
			<if test="mger_dept_id != null">
				 mger_dept_id = #{mger_dept_id},
			</if>
			<if test="mger_advice != null">
				 mger_advice = #{mger_advice},
			</if>
			<if test="mger_result != null">
				 mger_result = #{mger_result},
			</if>
			<if test="mger_date != null">
				 mger_date = #{mger_date},
			</if>
			<if test="is_sp_app != null">
				 is_sp_app = #{is_sp_app},
			</if>
			<if test="sp_app_operator_id != null">
				 sp_app_operator_id = #{sp_app_operator_id},
			</if>
			<if test="sp_app_date != null">
				 sp_app_date = #{sp_app_date},
			</if>
			<if test="sp_app_leader_id != null">
				 sp_app_leader_id = #{sp_app_leader_id},
			</if>
			<if test="sp_app_leader_name != null">
				 sp_app_leader_name = #{sp_app_leader_name},
			</if>
			<if test="sp_app_result != null">
				 sp_app_result = #{sp_app_result},
			</if>
			<if test="sp_app_advice != null">
				 sp_app_advice = #{sp_app_advice},
			</if>
			<if test="is_debtadj_confirm != null">
				 is_debtadj_confirm = #{is_debtadj_confirm},
			</if>
			<if test="is_debtmatch_finish != null">
				 is_debtmatch_finish = #{is_debtmatch_finish},
			</if>
			<if test="is_protocol_finish != null">
				 is_protocol_finish = #{is_protocol_finish},
			</if>
			<if test="create_timestamp != null">
				 create_timestamp = #{create_timestamp},
			</if>
			<if test="create_user_id != null">
				 create_user_id = #{create_user_id},
			</if>
			<if test="create_dept_id != null">
				 create_dept_id = #{create_dept_id},
			</if>
			<if test="enable_flag != null">
				 enable_flag = #{enable_flag},
			</if>
			<if test="key !=null">
						 sup_user_id = null,
						 sup_dept_id = null,
						 sup_advice =null,
						 sup_result = null,
						 sup_date = null,
						 submger_user_id = null,
						 submger_dept_id = null,
						 submger_advice = null,
						 submger_result = null,
						 submger_date = null,
						 mger_user_id = null,
						 mger_dept_id = null,
						 mger_advice = null,
						 mger_result = null,
						 mger_date = null,
			</if>
  	</set>
 		where 
  				wms_inve_debt_head_id = #{wms_inve_debt_head_id}
	</select>
	
	<!-- 债权变动【确认】以及【债权调整】【签订协议】 -->
	<select id="searchList" parameterType="map" resultType="java.util.HashMap">
		select 
				t1.wms_inve_debt_head_id,
				t1.debt_reason,
				t1.wms_inve_transa_id,
				t1.wms_inve_transa_prod_id,
				t1.wms_inve_pruduct_category_id,
				t1.wms_inve_customer_id,
				t1.bill_code,
				t1.data_status,
				(select value_meaning from wms_sys_dict_data where value_code = t1.data_status and wms_sys_dict_id = 83) as data_status_name,
				t1.sup_user_id,
				t1.sup_dept_id,
				t1.sup_advice,
				t1.sup_result,
				date_format(t1.sup_date,'%Y-%m-%d') as sup_date_str,
				t1.sup_date,
				(case t1.sup_result when '1' then '通过' when '0' then '不通过' else '待审批' end) as sup_result_str,
				t1.submger_user_id,
				t1.submger_dept_id,
				t1.submger_advice,
				t1.submger_result,
				date_format(t1.submger_date,'%Y-%m-%d') as submger_date_str,
				t1.submger_date,
				(case t1.submger_result when '1' then '通过' when '0' then '不通过' else '待审批' end) as submger_result_str,
				t1.mger_user_id,
				t1.mger_dept_id,
				t1.mger_advice,
				t1.mger_result,
				date_format(t1.mger_date,'%Y-%m-%d') as mger_date_str,
				t1.mger_date,
				(case t1.mger_result when '1' then '通过' when '0' then '不通过' else '待审批' end) as mger_result_str,
				t1.is_sp_app,
				t1.sp_app_operator_id,
				date_format(t1.sp_app_date,'%Y-%m-%d %H:%i:%s') as sp_app_date_str,
				t1.sp_app_date,
				t1.sp_app_leader_id,
				t1.sp_app_leader_name,
				t1.sp_app_result,
				t1.sp_app_advice,
				t1.is_debtadj_confirm,
               (case t1.is_debtadj_confirm when '1' then '是' when '0' then '否' else '----' end) as is_debtadj_confirm_str,
				t1.is_debtmatch_finish,
			   (case t1.is_debtmatch_finish when '1' then '是' when '0' then '否' else '----' end) as is_debtmatch_finish_str,
				t1.is_protocol_finish,
               (case t1.is_protocol_finish when '1' then '是' when '0' then '否' else '----' end) as is_protocol_finish_str,
				date_format(t1.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp_str,
				t1.create_timestamp,
				t1.create_user_id,
				t1.create_dept_id,
				t1.enable_flag,
				t2.cus_name,
				t2.id_card,
				date_format(t2.create_timestamp,'%Y-%m-%d %H:%i:%s') as date_of_create,
				t2.data_status as transa_data_status,
				(select value_meaning from wms_sys_dict_data where value_code = t2.data_status and wms_sys_dict_id = 55) as transa_data_status_name,
				(select category_interest_pay_method from wms_inve_pruduct_category where wms_inve_pruduct_category_id = t1.wms_inve_pruduct_category_id) as category_interest_pay_method,
				t3.category_name,
				t3.category_type,
				t3.product_deadline,
				t3.product_account
		from wms_inve_debt_head t1, wms_inve_transa t2, wms_inve_transa_prod t3
		<where>
			t1.wms_inve_transa_id = t2.wms_inve_transa_id
			and t1.wms_inve_transa_prod_id = t3.wms_inve_transa_prod_id
			and t1.enable_flag = '1'
			and t2.enable_flag = '1'
			and t3.enable_flag = '1'
			<if test="data_statusList !=null">
			    and t1.data_status in
			<foreach collection="data_statusList" item="data_status"
					index="index" open="(" separator="," close=")">
					#{data_status}
			</foreach>
			</if> 
			<if test="idList != null">
				and t1.wms_inve_debt_head_id in
				<foreach collection="idList" item="wms_inve_debt_head_id"
					index="index" open="(" separator="," close=")">
					#{wms_inve_debt_head_id}
				</foreach>
			</if>
			<if test="cus_name != null">
				and t2.cus_name like #{cus_name}
			</if>
			<if test="id_card != null">
				and t2.id_card like #{id_card}
			</if>
			<if test="category_name != null">
				and t3.category_name = #{category_name}
			</if>
			<if test="create_timestamp_begin != null and create_timestamp_begin !=''">
				and date_format(t2.create_timestamp,'%Y-%m-%d') &gt;= #{create_timestamp_begin}
			</if>
			<if test="create_timestamp_end != null  and create_timestamp_end !=''">
				and date_format(t2.create_timestamp,'%Y-%m-%d') &lt;= #{create_timestamp_end}
			</if>
		</where>
		<if test="sortname != null and sortorder != null">
			ORDER BY ${sortname} ${sortorder}
		</if>
		<if test="offset != null and pagesize !=null">
			LIMIT ${offset} , ${pagesize}
		</if>
	</select>
	<!--债权变动【确认】以及【债权调整】【签订协议】 数据数-->
	<select id="findListCount" parameterType="map" resultType="int">
		select 
				count(t1.wms_inve_debt_head_id) as count
		
		from wms_inve_debt_head t1, wms_inve_transa t2, wms_inve_transa_prod t3
		<where>
			t1.wms_inve_transa_id = t2.wms_inve_transa_id
			and t1.wms_inve_transa_prod_id = t3.wms_inve_transa_prod_id
			and t1.enable_flag = '1'
			and t2.enable_flag = '1'
			and t3.enable_flag = '1' 
			<if test="data_statusList !=null">
			    and t1.data_status in
			<foreach collection="data_statusList" item="data_status"
					index="index" open="(" separator="," close=")">
					#{data_status}
			</foreach>
			</if> 
			<if test="idList != null">
				and t1.wms_inve_debt_head_id in
				<foreach collection="idList" item="wms_inve_debt_head_id"
					index="index" open="(" separator="," close=")">
					#{wms_inve_debt_head_id}
				</foreach>
			</if>
			<if test="cus_name != null">
				and t2.cus_name like #{cus_name}
			</if>
			<if test="id_card != null">
				and t2.id_card like #{id_card}
			</if>
			<if test="category_name != null">
				and t3.category_name = #{category_name}
			</if>
			<if test="create_timestamp_begin != null and create_timestamp_begin !=''">
				and date_format(t2.create_timestamp,'%Y-%m-%d') &gt;= #{create_timestamp_begin}
			</if>
			<if test="create_timestamp_end != null  and create_timestamp_end !=''">
				and date_format(t2.create_timestamp,'%Y-%m-%d') &lt;= #{create_timestamp_end}
			</if>
		</where>
		<if test="sortname != null and sortorder != null">
			ORDER BY ${sortname} ${sortorder}
		</if>
	</select>
	<!-- 【债权变动确认】和【债权调整】和【协议签订】 导出 -->
	<select id="searchExcelList" parameterType="map" resultType="java.util.HashMap">
		select 
				t1.wms_inve_debt_head_id,
				t1.debt_reason,
				t1.wms_inve_transa_id,
				t1.wms_inve_transa_prod_id,
				t1.wms_inve_pruduct_category_id,
				t1.wms_inve_customer_id,
				t1.bill_code,
				t1.data_status,
				(select value_meaning from wms_sys_dict_data where value_code = t1.data_status and wms_sys_dict_id = 83) as data_status_name,
				t1.sup_user_id,
				t1.sup_dept_id,
				t1.sup_advice,
				(case t1.sup_result when '0' then '未通过' when '1' then '通过' else '待审批' end) as sup_result,
				date_format(t1.sup_date,'%Y-%m-%d') as sup_date_str,
				t1.sup_date,
				t1.submger_user_id,
				t1.submger_dept_id,
				t1.submger_advice,
				(case t1.submger_result when '0' then '未通过' when '1' then '通过' else '待审批' end) as submger_result,
				date_format(t1.submger_date,'%Y-%m-%d') as submger_date_str,
				t1.submger_date,
				t1.mger_user_id,
				t1.mger_dept_id,
				t1.mger_advice,
				(case t1.mger_result when '0' then '未通过' when '1' then '通过' else '待审批' end) as mger_result,
				date_format(t1.mger_date,'%Y-%m-%d') as mger_date_str,
				t1.mger_date,
				t1.is_sp_app,
				t1.sp_app_operator_id,
				date_format(t1.sp_app_date,'%Y-%m-%d %H:%i:%s') as sp_app_date_str,
				t1.sp_app_date,
				t1.sp_app_leader_id,
				t1.sp_app_leader_name,
				t1.sp_app_result,
				t1.sp_app_advice,
				(case t1.is_debtadj_confirm when '0' then '否' when '1' then '是' else '--' end) as is_debtadj_confirm_name,
				(case t1.is_debtmatch_finish when '0' then '否' when '1' then '是' else '--' end) as is_debtmatch_finish_name,
				(case t1.is_protocol_finish when '0' then '否' when '1' then '是' else '--' end) as is_protocol_finish_name,
				date_format(t1.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp_str,
				t1.create_timestamp,
				t1.create_user_id,
				t1.create_dept_id,
				t1.enable_flag,
				t2.cus_name,
				t2.id_card,
				date_format(t2.create_timestamp,'%Y-%m-%d %H:%i:%s') as date_of_create,
				t2.data_status as transa_data_status,
				(select value_meaning from wms_sys_dict_data where value_code = t2.data_status and wms_sys_dict_id = 55) as transa_data_status_name,
				(select category_interest_pay_method from wms_inve_pruduct_category where wms_inve_pruduct_category_id = t1.wms_inve_pruduct_category_id) as category_interest_pay_method,
				t3.category_name,
				t3.category_type,
				t3.product_deadline,
				(t3.product_account/10000) as product_account
		from wms_inve_debt_head t1, wms_inve_transa t2, wms_inve_transa_prod t3
		<where>
			t1.wms_inve_transa_id = t2.wms_inve_transa_id
			and t1.wms_inve_transa_prod_id = t3.wms_inve_transa_prod_id
			and t1.enable_flag = '1'
			and t2.enable_flag = '1'
			and t3.enable_flag = '1'
			<if test="data_statusList !=null">
			    	and t1.data_status in
				<foreach collection="data_statusList" item="data_status"
						index="index" open="(" separator="," close=")">
						#{data_status}
				</foreach>
			</if>
			<if test="idList != null">
				and t1.wms_inve_debt_head_id in
				<foreach collection="idList" item="wms_inve_debt_head_id"
					index="index" open="(" separator="," close=")">
					#{wms_inve_debt_head_id}
				</foreach>
			</if>
			<if test="cus_name != null">
				and t2.cus_name like #{cus_name}
			</if>
			<if test="id_card != null">
				and t2.id_card like #{id_card}
			</if>
			<if test="category_name != null">
				and t3.category_name = #{category_name}
			</if>
			<if test="create_timestamp_begin != null and create_timestamp_begin !=''">
				and date_format(t2.create_timestamp,'%Y-%m-%d') &gt;= #{create_timestamp_begin}
			</if>
			<if test="create_timestamp_end != null and create_timestamp_end !=''">
				and date_format(t2.create_timestamp,'%Y-%m-%d') &lt;=#{create_timestamp_end}
			</if>
		</where>
		<if test="sortname != null and sortorder != null">
			ORDER BY ${sortname} ${sortorder}
		</if>
		<if test="offset != null and pagesize !=null">
			LIMIT ${offset} , ${pagesize}
		</if>
	</select>
	
	<!-- 根据对象查单个对象 -->
	<select id="searchOneByObj">
			select
						wms_inve_debt_head_id,
        				debt_reason,
        				wms_inve_transa_id,
        				wms_inve_transa_prod_id,
        				wms_inve_pruduct_category_id,
        				wms_inve_customer_id,
        				bill_code,
        				data_status,
        				sup_user_id,
        				sup_dept_id,
        				sup_advice,
        				sup_result,
						date_format(sup_date,'%Y-%m-%d') as sup_date_str,
        				sup_date,
        				submger_user_id,
        				submger_dept_id,
        				submger_advice,
        				submger_result,
						date_format(submger_date,'%Y-%m-%d') as submger_date_str,
        				submger_date,
        				mger_user_id,
        				mger_dept_id,
        				mger_advice,
        				mger_result,
						date_format(mger_date,'%Y-%m-%d') as mger_date_str,
        				mger_date,
        				is_sp_app,
        				sp_app_operator_id,
						date_format(sp_app_date,'%Y-%m-%d %H:%i:%s') as sp_app_date_str,
        				sp_app_date,
        				sp_app_leader_id,
        				sp_app_leader_name,
        				sp_app_result,
        				sp_app_advice,
        				is_debtadj_confirm,
        				is_debtmatch_finish,
        				is_protocol_finish,
						date_format(create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp_str,
        				create_timestamp,
        				create_user_id,
        				create_dept_id,
        				enable_flag
        	from
        		wms_inve_debt_head
        	<where>
        		<if test="wms_inve_debt_head_id != null">
						 wms_inve_debt_head_id = #{wms_inve_debt_head_id},
					</if>
					<if test="debt_reason != null">
						 debt_reason = #{debt_reason},
					</if>
					<if test="wms_inve_transa_id != null">
						 wms_inve_transa_id = #{wms_inve_transa_id},
					</if>
					<if test="wms_inve_transa_prod_id != null">
						 wms_inve_transa_prod_id = #{wms_inve_transa_prod_id},
					</if>
					<if test="wms_inve_pruduct_category_id != null">
						 wms_inve_pruduct_category_id = #{wms_inve_pruduct_category_id},
					</if>
					<if test="wms_inve_customer_id != null">
						 wms_inve_customer_id = #{wms_inve_customer_id},
					</if>
					<if test="bill_code != null">
						 bill_code = #{bill_code},
					</if>
					<if test="data_status != null">
						 data_status = #{data_status},
					</if>
					<if test="sup_user_id != null">
						 sup_user_id = #{sup_user_id},
					</if>
					<if test="sup_dept_id != null">
						 sup_dept_id = #{sup_dept_id},
					</if>
					<if test="sup_advice != null">
						 sup_advice = #{sup_advice},
					</if>
					<if test="sup_result != null">
						 sup_result = #{sup_result},
					</if>
					<if test="sup_date != null">
						 sup_date = #{sup_date},
					</if>
					<if test="submger_user_id != null">
						 submger_user_id = #{submger_user_id},
					</if>
					<if test="submger_dept_id != null">
						 submger_dept_id = #{submger_dept_id},
					</if>
					<if test="submger_advice != null">
						 submger_advice = #{submger_advice},
					</if>
					<if test="submger_result != null">
						 submger_result = #{submger_result},
					</if>
					<if test="submger_date != null">
						 submger_date = #{submger_date},
					</if>
					<if test="mger_user_id != null">
						 mger_user_id = #{mger_user_id},
					</if>
					<if test="mger_dept_id != null">
						 mger_dept_id = #{mger_dept_id},
					</if>
					<if test="mger_advice != null">
						 mger_advice = #{mger_advice},
					</if>
					<if test="mger_result != null">
						 mger_result = #{mger_result},
					</if>
					<if test="mger_date != null">
						 mger_date = #{mger_date},
					</if>
					<if test="is_sp_app != null">
						 is_sp_app = #{is_sp_app},
					</if>
					<if test="sp_app_operator_id != null">
						 sp_app_operator_id = #{sp_app_operator_id},
					</if>
					<if test="sp_app_date != null">
						 sp_app_date = #{sp_app_date},
					</if>
					<if test="sp_app_leader_id != null">
						 sp_app_leader_id = #{sp_app_leader_id},
					</if>
					<if test="sp_app_leader_name != null">
						 sp_app_leader_name = #{sp_app_leader_name},
					</if>
					<if test="sp_app_result != null">
						 sp_app_result = #{sp_app_result},
					</if>
					<if test="sp_app_advice != null">
						 sp_app_advice = #{sp_app_advice},
					</if>
					<if test="is_debtadj_confirm != null">
						 is_debtadj_confirm = #{is_debtadj_confirm},
					</if>
					<if test="is_debtmatch_finish != null">
						 is_debtmatch_finish = #{is_debtmatch_finish},
					</if>
					<if test="is_protocol_finish != null">
						 is_protocol_finish = #{is_protocol_finish},
					</if>
					<if test="create_timestamp != null">
						 create_timestamp = #{create_timestamp},
					</if>
					<if test="create_user_id != null">
						 create_user_id = #{create_user_id},
					</if>
					<if test="create_dept_id != null">
						 create_dept_id = #{create_dept_id},
					</if>
					<if test="enable_flag != null">
						 enable_flag = #{enable_flag},
					</if>
        	</where>
	</select>
</mapper> 
