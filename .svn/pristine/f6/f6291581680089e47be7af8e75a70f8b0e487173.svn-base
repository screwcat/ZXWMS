<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-

transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link href="../../css/zx-all.css" rel="stylesheet" type="text/css" />
<link href="../../css/app.css" rel="stylesheet" type="text/css" />
<link href="../../css/ligerui-main.css" rel="stylesheet" type="text/css" />
<script src="../../js/zx-all.js" type="text/javascript"></script>
<title>终审审批</title>
<style type="text/css">
.td_title {
	background: none repeat scroll 0 0 #EAF0FB;
}

.tb_input TD {
	background: none repeat scroll 0 0 #FFFFFF;
	padding: 3px 1px 1px 4px;
}
</style>
</head>
<body>
	<!-- 页面加载的时候，审批流程为显示 -->
	<hr />
	<!--<div id="grid"></div>-->
<div class="pop-center overflow-au"  style="top: 1px;">
	<div class="float-l clearboth" style="height: 10px;"></div>
	<div class="center-content clearboth" style="min-width: 400px;overflow:auto">
		<div class="center-title">流程历程</div>
		<div class="center-txt" style="margin-bottom: 10px;">
			<div id="grid"></div>
		</div>
	</div>
	<div class="center-content clearboth"
		style="min-width: 770px; margin-top: -25px;overflow:auto">
		<div class="center-title">贷款信息</div>
		<div id="grid_idea">
			<div  id="zhddiv" class="float-l clearboth"style="border: 1px solid #BFBFBF; width: 100%;" >
			 <div class="pop-form-item" >
				<input type="radio" name="cre_status" value="0" class="radio3" checked="checked" style="margin-left: 40px" onchange="changeRadio('1')"/>单一贷
			    <input type="radio" name="cre_status" value="1" class="radio3" style="margin-left: 50px" onchange="changeRadio('1')"/>组合贷
			 </div>
			<div style="float: left; margin-left:60px;display: none;" id="add_toolbar" ><a href="#"  class="btnType1 btnSize1" onclick="addNewkh()">新增</a></div>
		    </div>	
		    <div id="copyMain">
				<div class="float-l" style="border: 1px solid #BFBFBF; width: 100%;">
					<div class="pop-form-title2">申请贷款金额：</div>
					<div class="pop-form-item">
						<input type="text" id="credit_limit" style="width: 150px;"
							isRequired="1" isFloat="1" maxVal="10000" minVal="0" onchange="getCreditLimit(this,1)"/><span>万元</span>
						<input type="text" id="credit_limit_backup" style="display: none;" />
					</div>
					<div class="pop-form-title2">还款期限：</div>
					<div class="pop-form-item">
						<input type="text" id="max_repayment_time_limit"   style="width: 150px;"
							isRequired="1" isFloat="1" maxVal="10000" minVal="0" /><span>月</span>
						<input type="text" id="max_repayment_time_limit_backup" style="display: none;" />
						<input type="hidden" id="payment_contract_type" style="width: 150px;"/>
					</div>
					<div class="pop-form-title2">房贷产品：</div>
					<div class="pop-form-item">
						<!--  <input type="text" id="cre_loan_type" onchange="creTypeChange()" />-->
						<!-- <input type="text" id="cre_loan_type" />-->
						<select id="cre_loan_type" onchange="creTypeChange()">
			            </select>
						<input type="text" id="cre_loan_type_backup" style="display: none;" />
					</div>		
				</div>
				<div class="float-l" style="border: 1px solid #BFBFBF; width: 100%;display: none" >
					<div class="pop-form-title2">申请贷款金额：</div>
					<div class="pop-form-item">
						<input type="text" name="credit_limit" style="width: 150px;"
							isRequired="1" isFloat="1" maxVal="10000" minVal="0" onchange="changeVal(this),getCreditLimit(this,4)"  /><span>万元</span>
					</div>
					<div class="pop-form-title2">还款期限：</div>
					<div class="pop-form-item">
						<input type="text" name="max_repayment_time_limit" style="width: 150px;"
							isRequired="1" isFloat="1" maxVal="10000" minVal="0" onchange="changeVal(this)" /><span>月</span>
						<input type="hidden" name="loan_interest_rate" style="width: 150px;"/>
						<input type="hidden" name="payment_contract_type" style="width: 150px;"/>
					</div>
					<div class="pop-form-title2">房贷产品：</div>
					<div class="pop-form-item">
						<select name="cre_loan_type" onchange="changeVal(this)">
			            </select>
					</div>	
					<div class="l-icon l-icon-delete" style=" margin-top: 5px"onclick="deleteNewkh(this)">
					</div>		
				</div>
			</div>
			<div class="clearboth">
				<table align="center" border="1" cellpadding="0" cellspacing="2"
					width="100%" style="font-size: 10.5pt;">
					<tr>
						<td id="apprpve" class="td_title" width="14%" rowspan="2"
							align="center">审批意见</td>
						<td><input type="radio" id="transition" name="pass"
							value="iscontinue" class="radio5" style="display: none;" /><span
							style="display: none;" id="sp">继续贷前审核</span> <input type="radio"
							id="transition_reject" name="pass" class="radio5" value="true"
							checked="checked" /><span id="sp">通过 </span> <input type="radio"
							id="transition_reject" name="pass" class="radio5" value="false" /><span
							id="sp">不通过</span></td>
					</tr>
					<tr>
						<td><textarea id="advice" name="advice" rows="50"
								style="width: 100%; height: 80px; resize: none;" maxlength="250"></textarea>
						</td>
					</tr>
				</table>
			</div>
		</div>
	</div>

	<div class="center-content clearboth" style="min-width: 200px;hidth: 200px;overflow:auto">
		<div class="center-title">贷款核定信息</div>
		<hr />
		<div id="grid2" class="float-l">
			<div class="pop-form-title2">最终发放贷款金额：</div>
			<div class="pop-form-item">
				<input type="text" id="appro_limit" style="width: 200px;"
					isRequired="1" isFloat="1" maxVal="10000" minVal="0"  onchange="getCreditLimit(this,2)"/>（万元） <input
					type="radio" name="assure" class="radio5" value="1"
					checked="checked" /><span>需担保 </span> <input type="radio"
					class="radio5" name="assure" value="0" /><span>无需担保</span>
			</div>
		</div>
	</div>
	<div class="center-content clearboth" style="overflow:auto">
	</div>
</div>
	<div class="pop-footer5 clearboth" style="bottom: 1px;">
		<input id="tjbtn" class="btn-saveT"
			onmouseover="this.className='btn-saveT-over'"
			onmouseout="this.className='btn-saveT'"
			onmousedown="this.className='btn-saveT-down'" type="button"
			style="margin-right: 7px;" onclick="save()" /> <input
			id="cancelBtnId" class="btn-cancel"
			onmouseover="this.className='btn-cancel-over'"
			onmouseout="this.className='btn-cancel'"
			onmousedown="this.className='btn-cancel-down'" type="button"
			onclick="closeDialog();" />
	</div>
	<!-- 工具条初始化 -->
	<script type="text/javascript">
	 	var gridTop;//审批流程数据显示
		var dialog;
		var columns;		
		var approve_type;
		var wms_cre_credit_head_id ;
		var judge_appro ;
		var taskId;
		var iscontinueenable;
		var credit_limit;
		var appro_limit;
		var create_timestamp_str;
		var temp_date_2;
		var temp_date;
		var edition_num;//流程版本号
		var version_number;//数据来源
		//产品利率
		var loan_interest_rate = 0;
		var cre_loan_type1="785";
		var cre_loan_type2="786";
		var cre_loan_type3="970";
		$(function() {
			wms_cre_credit_head_id = $.query.get("wms_cre_credit_head_id");//wms_cre_credit_head_id 为选择审批的记录id
			iscontinueenable = $.query.get("iscontinueenable");//iscontinueenable 判断是否有继续贷前审批按钮
			judge_appro = $.query.get("judge_appro");//wms_cre_credit_head_id 为选择审批的记录id
			taskId = $.query.get("taskId");//taskId 为选择审批的记录id
			credit_limit = $.query.get("credit_limit");//credit_limit 信用贷款金额
			appro_limit = $.query.get("appro_limit");//appro_limit 最终放款金额
			create_timestamp_str = $.query.get("create_timestamp_str");
			edition_num=$.query.get('edition_num');//流程版本号
			version_number=$.query.get('version_number');//流程版本号
			if(appro_limit == "") {
				company_type(credit_limit);//初始化最终放款金额
			} else {
				company_type(appro_limit);//初始化最终放款金额
			}
			
			//以下代码是比较时间 用于  继续贷前审批按钮
			var value=create_timestamp_str;
            var year = value.substring(0, 4);
            var month = value.substring(5, 7);
            var day = value.substring(8, 10);
            temp_date = new Date(year, parseFloat(month) - 1, parseFloat(day));
			var date2_str = "2014-08-15";
			var year2 = date2_str.substring(0, 4);
            var month2 = date2_str.substring(5, 7);
            var day2 = date2_str.substring(8, 10);
            temp_date_2 = new Date(year2, parseFloat(month2) - 1, parseFloat(day2));
            judge();
			initGrid();
			search();
			init_wms_cre_credit_head(wms_cre_credit_head_id);
			if(globalUtil.getCreType($("#cre_loan_type_hidden").val())){
				 $("#max_repayment_time_limit,#credit_limit").die().live("focusout", function() {
		            	creTypeChange();
		         });	
			};
			//如果version_number字段为空则不准组合贷
			notZHD();
		});
		//如果version_number字段为空则不准组合贷
		function notZHD(){
			//如果没有版本号则隐藏组合贷按钮
			if(version_number==""||version_number=="undefined"){
				$("#zhddiv").css('display','none');
			}
		}
		//获取申请金额并根据终审金额比较
		function getCreditLimit(obj,num){
			var credit_limit=parseFloat($("#credit_limit").val()|0);
			if(!credit_limit>0&&num=="1"){
				globalUtil.warnMsg(globalErrorMsg['500204']); //贷款金额填写不正确
				$("#credit_limit").val("");
				return ;
			}
			if(num=="1"||num=="2"||num=="3"||num=="4"){
				$("#copyMain").find("input[name='credit_limit']").each(function (i){
					if($(this).val()!=""&&$(this).val()!=undefined){
						if(!parseFloat($(this).val()|0)>0){
							globalUtil.warnMsg(globalErrorMsg['500204']); //贷款金额填写不正确
							$(this).val("");
							return false;
						}
						credit_limit+=parseFloat($(this).val());
					}
				});
				if(num=="1"||num=="4"){
					$("#appro_limit").val(credit_limit);
				}				
			}
			if(num=="2"||num=="3"){
				var appro_limit=$("#appro_limit").val();
				if(appro_limit==undefined||appro_limit==""){
					globalUtil.warnMsg(globalErrorMsg['500202']); //终审金额不正确
					return true;
				}
				if(parseFloat(appro_limit)<credit_limit){
					if(num=="2"){
						$(obj).val("");
					}
					globalUtil.warnMsg(globalErrorMsg['500202']); //终审金额不正确
					return true;
				}
			}
		}
		//新增行
		function addNewkh(){
			//如果是隐藏
			if($("#copyMain").find(".float-l").last().css("display")=='none'){
				$("#copyMain").find(".float-l").last().css('display','');
			}else{
				$("#copyMain").append($("#copyMain").find(".float-l").last().clone(true));
			}
			//统计金额
			 getCreditLimit('','1');
		}
		//删除行
		function deleteNewkh(obj){
			var num=$("#copyMain").find(".float-l").length;
			//如果剩俩个的时候要隐藏
			if(num==2){
				$(obj).parent().css('display','none');
			}else{
				$(obj).parent().remove();
			}
				
		}
		//单选按钮
		function changeRadio(obj){
			var cre_status="";
			$("input[name='cre_status']").each(function() {
				if ($(this).is(':checked')) {
					cre_status = $(this).val();
					return false;//退出each循环
				}
			});	
			if(obj=="1"){
				//单一贷
				if(cre_status=='0'){
					$("#add_toolbar").css('display','none');
					$("#copyMain").find(".float-l").each(function(i){
						if(i!==1&&i!==0){
							$(this).remove();	
						}else if(i===1){
							$(this).css('display','none');
						}
					})
				}
				//组合贷
				else if(cre_status=='1')
				{
					$("#add_toolbar").css('display','');
					$("#copyMain").find(".float-l").last().css('display','');
				}
			}
			return cre_status;
		}
		//根据客户操作改变值获取对应利率
		function  changeVal(obj){
			var credit_limit=$(obj).parent().parent().find("input[name='credit_limit']").val();
			var max_repayment_time_limit=$(obj).parent().parent().find("input[name='max_repayment_time_limit']").val();
			var cre_loan_type=$(obj).parent().parent().find("select[name='cre_loan_type']").val();
			//判断产品
			if(globalUtil.getCreType(cre_loan_type)) {
				//判断是否为空
				if(credit_limit!=''&&max_repayment_time_limit!=''&&cre_loan_type!='-1'&&credit_limit!=undefined&&max_repayment_time_limit!=undefined&&cre_loan_type!=undefined){
					var data =globalUtil.syncGetJson('/loanappro/getprotocolProperty.do',{  
			               'cre_loan_type': cre_loan_type,
			               'borrow_deadline': max_repayment_time_limit,
			               'credit_limit': credit_limit,
			               'wms_cre_credit_head_id': wms_cre_credit_head_id
			             },'GET');
					 if(!$.isEmptyObject(data)&&!$.isEmptyObject(data["newFD"])) {        	
						 var objVal =data["newFD"];
						 var loan_interest_rate = Math.round(objVal["FD_DKLL"]*100*100)/100;
			                 //贷款利率
			                 if(objVal["borrow_interest"]!=null&&objVal["borrow_interest"]!=''&&objVal["borrow_interest"]!=undefined){
			                	 loan_interest_rate=Math.round(objVal["borrow_interest"]*100)/100; 
			                 }
			                 
		                	 $(obj).parent().parent().find("[name='loan_interest_rate']").val(loan_interest_rate);
			                 $(obj).parent().parent().find("[name='payment_contract_type']").val(objVal.payment_contract_type);
					 }
				}
			}else{
				$(obj).val('-1');
				globalUtil.warnMsg(globalErrorMsg['500197']); //此产品不允许组合贷！
			}
		}
		//更改车贷产品类型
		function creTypeChange() {
			var creLoanType = $("#cre_loan_type").val();
			var data = {};
			if(isZHD()&&!globalUtil.getCreType(creLoanType)){
				$("#cre_loan_type").val('-1');
				//组合贷不能选择此产品
				 globalUtil.warnMsg(globalErrorMsg['500197']);
				 return;
			}
			/* globalUtil.syncGetJson('/sysmanage/wmssysgetajaxrequest.do',{
				'cre_loan_type': creLoanType 
	            },'GET');
			 */
			var max_repayment_time_limit=$("#max_repayment_time_limit").val();//贷款期数
		    var credit_limit=$("#credit_limit").val();//贷款金额
			if(globalUtil.getCreType(creLoanType)) {	
				data =globalUtil.syncGetJson('/loanappro/getprotocolProperty.do',{  
	                'cre_loan_type': creLoanType,
	                'borrow_deadline': max_repayment_time_limit,
	                'credit_limit': credit_limit,
	                'wms_cre_credit_head_id' :wms_cre_credit_head_id
	              },'GET');
				 if(!$.isEmptyObject(data)&&!$.isEmptyObject(data["newFD"])) {        	
					 var obj =data["newFD"];
						loan_interest_rate = Math.round(obj["FD_DKLL"]*100*100)/100;
		                 //贷款利率
		                 if(obj["borrow_interest"]!=null&&obj["borrow_interest"]!=''&&obj["borrow_interest"]!=undefined){
		                	 loan_interest_rate=Math.round(obj["borrow_interest"]*100)/100;
		                	 $("#payment_contract_type").val(obj.payment_contract_type);//还款类型
		                 }
				 }
				 //绑定还款期限事件（只能绑定一次）
	            $("#max_repayment_time_limit,#credit_limit").die().live("focusout", function() {
	            	creTypeChange()
	            });
			} else {
				data = globalUtil.syncGetJson('/sysmanage/wmssysgetajaxrequest.do',{
					'cre_loan_type': creLoanType 
		            },'GET');
				//取消绑定
				$("#max_repayment_time_limit").die();
				if(!$.isEmptyObject(data)) {
					loan_interest_rate = Math.round(data["FD_DKLL"]*100*100)/100;
				}
			}
		}
		
		//初始化贷款单据信息
		function init_wms_cre_credit_head(wms_cre_credit_head_id) {
			var wmsCusCreditHeadInfo = globalUtil.syncGetJson('/cremanage/getwmscrecreditheadinfobyid.do',{
				'wms_cre_credit_head_id': wms_cre_credit_head_id 
	            },'POST');
			
			$("#credit_limit, #credit_limit_backup").val(wmsCusCreditHeadInfo["credit_limit"]);
			$("#max_repayment_time_limit, #max_repayment_time_limit_backup").val(wmsCusCreditHeadInfo["max_repayment_time_limit"]);
			$("#cre_loan_type_backup").val(wmsCusCreditHeadInfo["cre_loan_type"]);
			init_cre_loan_type(wmsCusCreditHeadInfo);
			$("#cre_loan_type").val(wmsCusCreditHeadInfo["cre_loan_type"]);
			creTypeChange();
			//loan_interest_rate=wmsCusCreditHeadInfo["loan_interest_rate"];
			
		}
		//房屋贷款产品种类
		function init_cre_loan_type(json){
			/*var cre_loan_type_params ={
					dest_url:'/sysmanage/wmssysdictdatabydictidempty.do?isEmpty=true&wms_sys_dict_id=27',
					t_col_name:'cre_loan_type',
					valueField:'wms_sys_dict_data_id',   //下拉框value对应的值，默认为id
					textField:'value_meaning',    //下拉框text对应的值，默认为text
					def_val:'first'
					};
			global_ligerui_extend.initCombox("cre_loan_type",function (){
				creTypeChange();
			},cre_loan_type_params);
			if(json){
				//把值装载设定
				global_ligerui_extend.syncRequestInitComboxData(json,"cre_loan_type");
				//让其不可编辑
				//global_ligerui_extend.disabledCombox("cre_loan_type");
			}else{			
			    global_ligerui_extend.initComboxDefVal("cre_loan_type");
			}*/
			globalUtil.init_select_value('cre_loan_type', 'value_code', 'value_meaning', true, '102');
			globalUtil.init_select_value_name('cre_loan_type', 'value_code', 'value_meaning', true, '102');
			
		}

		
		//初始化贷款金额
		function company_type(money){
			var appro_limit = document.getElementById("appro_limit");
			appro_limit.value = money;
		}
		//判断是否全部审批完成 如果完成则隐藏继续贷前审批
		function judge(){
			if((!globalUtil.isEmpty(iscontinueenable))&&iscontinueenable=="true"){
				if(temp_date<temp_date_2){
					$('#transition').css('display','');//继续贷前审批按钮
					$('#sp').css('display','');//隐藏按钮
				}
			}
		}
		var dialog;
		//初始化审批流程
        function initGrid() {
        	var columns_top = [{
                display: '节点名称',
                name: 'taskName',
                width: 110,
                minWidth: 110,
                render: function (rowdata, rowindex, value) { 
					if(rowdata.taskName == '证信审批'){
						return  '征信审批';
					}else if(rowdata.taskName == '信息审批'){
						return  '信息调查';
					}
					return value;
        		}
            }, {
                display: '审批人',
                name: 'approvers',
                width: 130,
                minWidth: 130
            },{
                display: '审批人部门',
                name: 'personnel_deptName',
                width: 130,
                minWidth: 130
            },{
                display: '职务',
                name: 'personnel_postName',
                width: 100,
                minWidth: 100	
            },{
                display: '审批结果',
                name: 'approveResult',
                width: 100,
                minWidth: 120
            },{
                display: '审批意见',
                name: 'approveAdvice',
                width: 135,
                minWidth: 155
            },{
                display: '审批时间',
                name: 'approveTime',
                width: 130,
                minWidth: 150
            }];
        	
            gridTop = $("#grid").ligerGrid({
        		columns: columns_top,
        		url: global_param.context_name + '/loancheck/houseCreditWorkFlowView.do?wms_cre_credit_head_id='+wms_cre_credit_head_id,
        		rownumbers: true,
        		allowUnSelectRow: true,
        		usePager: false,
        		width: '100%',
        		height: '40%',
        		heightDiff: -4,
        		parms: {
        			_filterParms: -1
        		}
            });
        }
		function  save(){
			if(globalVali.checkForm("grid2", true)){
				return;
			}
			if(document.getElementById("appro_limit").value==''){
				globalUtil.errorMsg(globalErrorMsg['500111']); //保存失败
			}else{
			//var approvePageVO = JSON.stringify(paramJson);
			$("input[name='pass']").each(function() {
				if ($(this).is(':checked')) {
					if( $(this).val()!="true"){
						if(document.getElementById("advice").value==""){
							alertMsg();
							//globalUtil.errorMsg("请填写审批意见！！"); //提示x
						}else{
							saveSp();
						}	
					}else{
						saveSp();
					}
				}
			});
			}
		}
		var type=1;//还款方式1等额本金
		//保存方法
		function saveSp(){
			if($("#max_repayment_time_limit").val() == null || $("#max_repayment_time_limit").val() == "") {
				globalUtil.errorMsg(globalErrorMsg['500177']);
				return;
			}
			//判断终审金额
			if(getCreditLimit("","3")){
				return;
			}
			var paramJson = globalUtil.getFormParamByid("grid_idea");
			
			globalUtil.getFormParam("grid2",paramJson);//
			
			getOtherVal(paramJson);
			
			getRadioVal_Assure(paramJson);//是否担保
			
			paramJson.taskId=taskId;
			
			paramJson.edition_num=edition_num;//流程版本号
			
			paramJson.version_number=version_number;//数据来源
			
			paramJson.cre_loan_type=$("#cre_loan_type").val();
			if(loan_interest_rate==0||loan_interest_rate==null||loan_interest_rate==""){
			}else{
				paramJson.loan_interest_rate = loan_interest_rate;
			}
			//获取值标示 false正常 true有问题
			var getZHVal=false;
			//获取组合贷数据
			if(changeRadio()=='1'&&isZHD()){
				if(!globalUtil.getCreType($("#cre_loan_type").val())){
					//组合贷不能选择此产品
					 globalUtil.warnMsg(globalErrorMsg['500501']);
					 return;
				}
			    var arraryJson=[]
			    //贷款产品是否存在空
			    var is_type_null=false;
			    //还款类型
			    var payment_type=false;
				$("#copyMain").find(".float-l").each(function (i){
					if(i!=0){
						var copyMain={};
						var credit_limit=$(this).find("input[name='credit_limit']").val();
						var max_repayment_time_limit=$(this).find("input[name='max_repayment_time_limit']").val();
						var cre_loan_type=$(this).find("select[name='cre_loan_type']").val();
						var loan_interest_rate=$(this).find("input[name='loan_interest_rate']").val();
						var payment_contract_type=$(this).find("input[name='payment_contract_type']").val();

						//判断产品是否为空
						if(cre_loan_type=="-1"||cre_loan_type==""||cre_loan_type==undefined){
							is_type_null=true;
							return false;
						}
						//如果产品类型是等额本金
						if(payment_contract_type==type){
							payment_type=true;
						}
						//申请金额
						if(credit_limit!=""&&credit_limit!=undefined){
							copyMain.credit_limit=credit_limit;
						}else{
							 globalUtil.warnMsg(globalErrorMsg['500198'])
							 getZHVal=true;
							 return false;
						}
						//期限
						if(max_repayment_time_limit!=""&&max_repayment_time_limit!=undefined){
							copyMain.max_repayment_time_limit=max_repayment_time_limit;
						}else{
							 globalUtil.warnMsg(globalErrorMsg['500199'])
							 getZHVal=true;
							 return false;	 		 
						}
						//产品
						if(cre_loan_type!="-1"&&cre_loan_type!=undefined){
							copyMain.cre_loan_type=cre_loan_type;
						}else{
							 globalUtil.warnMsg(globalErrorMsg['500200'])
							 getZHVal=true;
							 return false;
						}
						//利率
						if(loan_interest_rate!=""&&loan_interest_rate!=undefined){
							copyMain.loan_interest_rate=loan_interest_rate;
						}else{
							 globalUtil.warnMsg(globalErrorMsg['500201'])
							 getZHVal=true;
							 return false;
						}
						arraryJson.push(copyMain);
					}
				});
				//如果产品类型是等额本金
				if($("#payment_contract_type").val()==type){
					payment_type=true;
				}
				if(!payment_type){
					 globalUtil.warnMsg(globalErrorMsg['500203']); //
					 return;
				}
				//判断产品是否为空
				if(is_type_null||$("#cre_loan_type").val()=="-1"||$("#cre_loan_type").val()==""){
					 globalUtil.warnMsg(globalErrorMsg['500502']); //组合贷必须选择产品
					 return;
				}
				paramJson.arraryJson=JSON.stringify(arraryJson);
			}
			//判断是否有获取值错误
			if(getZHVal){
				 return;
			}
			$.post(globalUtil.getTimestampUrl("/loanappro/wmscreapproappealforHousesave.do?wms_cre_credit_head_id="+wms_cre_credit_head_id), paramJson,
					function(data) {
	        	if (data === 'success') {
	            	 globalUtil.successMsg(globalErrorMsg['100002'],
	            			 function(){            		 		
	                		refreshAndClosePage();
	            	 });//保存成功
	            	 
	            }else {
	                globalUtil.errorMsg(globalErrorMsg['100012']); //保存失败
	            }
	        });
		}
		//判断是否是组合贷
		function isZHD(){
			var num=$("#copyMain").find(".float-l").length;
			//如果剩俩个的时候要隐藏
			if(num==2){
				var is_ZHD=false;
				$("#copyMain").find(".float-l").each(function (i){
					if(i!=0&&$(this).css('display')=='none'){
						is_ZHD=false;
					}else if(i!=0){
						is_ZHD=true;
					}
				});
				return is_ZHD;
			}else{
				return true;
			}
		}
		//关闭本页并刷新查询页面
	    function refreshAndClosePage(){   
	    	window.parent.location.reload();
	    	closePage();
	    }
		//关闭页面
	    function closePage(){
	    	window.parent.dialog.hide();
	    }
		//弹窗
		function alertMsg(){
			 globalUtil.errorMsg(globalErrorMsg['500112']); //保存失败
		}
		//查询
		function search() {
			 global_ligerui_extend.search(gridTop);
		}
		function close(){
			dialog.close();
			search();
		}
		function closeDialog(){
			window.parent.dialog.hide();
		}
		function isContinueVal(jsonStr) {
			$("input[id='transition']").each(function() {
				if ($(this).is(':checked')) {
					jsonStr.iscontinue = $(this).val();
					return false;//退出each循环
				}
			});		
				
		}
		function getOtherVal(jsonStr) {
			$("input[name='pass']").each(function() {
				if ($(this).is(':checked')) {
					jsonStr.pass = $(this).val();
					return false;//退出each循环
				}
			});		
				
		}
	
		function getRadioVal_Assure(paramJson) {
			$("input[name='assure']").each(function() {
				if ($(this).is(':checked')) {
					paramJson.is_guarantee = $(this).val();
					return false;//退出each循环
				}
			});		
				
		}


	</script>

</body>


</html>
