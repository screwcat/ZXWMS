package com.zx.emanage.remind.service.impl;import java.text.SimpleDateFormat;import java.util.HashMap;import java.util.List;import java.util.Map;import org.slf4j.Logger;import org.slf4j.LoggerFactory;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Service;import org.springframework.transaction.annotation.Transactional;import com.zx.emanage.remind.persist.WmsCreCreditPhoneHistoryDao;import com.zx.emanage.remind.service.IWmsCreCreditPhoneHistoryService;import com.zx.emanage.remind.vo.WmsCreCreditPhoneHistorySearchBeanVO;import com.zx.emanage.util.gen.entity.WmsCreCreditPhoneHistory;import com.zx.platform.syscontext.vo.GridDataBean;import com.zx.sframe.util.vo.UserBean;/** *  * @ClassName: WmsCreCreditPhoneHistoryServiceImpl * @Description: 内容摘要： 拨打电话历史表 * @author baisong * @date 2016年11月22日 * @version V1.0 * history: * 1、2016年11月22日 baisong 创建文件 */@Service("WmsCreCreditPhoneHistoryService")public class WmsCreCreditPhoneHistoryServiceImpl implements IWmsCreCreditPhoneHistoryService {    private static Logger log = LoggerFactory.getLogger(WmsCreCreditPhoneHistoryServiceImpl.class);    @Autowired    private WmsCreCreditPhoneHistoryDao wmscrecreditphonehistoryDao;    /**     * Description : 查询列表(不带分页)     *      * @param queryInfo     * @return record list     * @author administrator     */    @Override    public Map<String, Object> getListWithoutPaging(WmsCreCreditPhoneHistorySearchBeanVO queryInfo) {        Map<String, Object> paramMap = new HashMap<String, Object>();                paramMap.put("wms_cre_credit_notary_warn_id", queryInfo.getWms_cre_credit_notary_warn_id());        paramMap.put("phone_history_type", queryInfo.getPhone_history_type());                paramMap.put("sortname", queryInfo.getSortname());        paramMap.put("sortorder", queryInfo.getSortorder());        List<Map<String, Object>> list = wmscrecreditphonehistoryDao.search(paramMap);        Map<String, Object> resMap = new HashMap<String, Object>();        resMap.put("Rows", list);        return resMap;    }    /**     * Description : 查询列表(带分页)     *      * @param queryInfo     * @return record list     * @author administrator     */    @Override    public Map<String, Object> getListWithPaging(WmsCreCreditPhoneHistorySearchBeanVO queryInfo) {        Map<String, Object> paramMap = new HashMap<String, Object>();        paramMap.put("sortname", queryInfo.getSortname());        paramMap.put("sortorder", queryInfo.getSortorder());        paramMap.put("pagesize", queryInfo.getPagesize());        paramMap.put("offset", queryInfo.getOffset());        List<Map<String, Object>> list = wmscrecreditphonehistoryDao.search(paramMap);        GridDataBean<Map<String, Object>> bean =             new GridDataBean<Map<String, Object>>(queryInfo.getPage(), wmscrecreditphonehistoryDao.findCount(paramMap), list);        return bean.getGridData();    }    /**     * Description : 根据主键查询     *      * @param primary key     * @return WmsCreCreditPhoneHistory     * @author administrator     */    @Override    public WmsCreCreditPhoneHistory getInfoByPK(Integer wms_cre_credit_phone_history_id) {        return wmscrecreditphonehistoryDao.get(wms_cre_credit_phone_history_id);    }    /**     * @Title: searchloansSearchList     * @Description: (拨打电话记录保存)     * @param queryInfo     * @param user     * @return Map<String, Object>     * @author: wangyihan     * @time:2016年11月23日 上午9:49:04      * history:      * 1、2016年11月23日wangyihan 创建方法     * 2、2016年11月23日baisong 修改     */    @Override    @Transactional    public String save(WmsCreCreditPhoneHistory bean, UserBean user) {        String resStr = "success";        int ret = 0;                SimpleDateFormat format = new SimpleDateFormat("yyyyMMdd");        long now_time_long = System.currentTimeMillis();        java.sql.Timestamp now_time_timestamp = new java.sql.Timestamp(now_time_long);        java.util.Date now_time_date = new java.util.Date(now_time_long);        String now_time_string = format.format(now_time_date);        // 更新历史数据        WmsCreCreditPhoneHistory phoneHistory = new WmsCreCreditPhoneHistory();        phoneHistory.setWms_cre_credit_notary_warn_id(bean.getWms_cre_credit_notary_warn_id());        phoneHistory.setIs_new("0");        phoneHistory.setPhone_history_type(bean.getPhone_history_type());        wmscrecreditphonehistoryDao.update(phoneHistory);        //单据编号根据当前日期生成        Map<String, Object> paramMap = new HashMap<String, Object>();        paramMap.put("now_time", now_time_string);                bean.setPhone_history_code(this.wmscrecreditphonehistoryDao.getPhoneHistoryCode(paramMap));        bean.setCreate_user_id(user.getUserId());        bean.setCreate_user_name(user.getRealname());        bean.setCreate_timestamp(now_time_timestamp);        bean.setIs_new("1");// 是否是最新记录        bean.setEnable_flag("1");        ret = wmscrecreditphonehistoryDao.save(bean);        if (ret == 0) {            resStr = "error";        }        return resStr;    }    /**     * Description : 修改     *      * @param bean contains pk at least     * @return "success" or "error" or user defined     * @author administrator     */    @Override    @Transactional    public String update(WmsCreCreditPhoneHistory bean, UserBean user) {        String resStr = "success";        int ret = 0;        ret = wmscrecreditphonehistoryDao.update(bean); // update a record replace columns,                                                   // nonsupport null val        if (ret == 0) {            resStr = "error";        }        return resStr;    }    /**     * Description : è·åList<WmsCreCreditPhoneHistory>ç»æé     *      * @param queryInfo     * @param isExludePKFlag, true is exclude primary key, false is include     *            primary key     * @return "success" or "repeat"     * @author administrator     */    private List<WmsCreCreditPhoneHistory> getListByEntity(WmsCreCreditPhoneHistory queryInfo, Boolean isExcludePKFlag) {        Map<String, Object> paramMap = new HashMap<String, Object>();        paramMap.put("isExcludePKFlag", isExcludePKFlag);        String resStr = "success";        List<WmsCreCreditPhoneHistory> beanList = wmscrecreditphonehistoryDao.getListByEntity(queryInfo);        return beanList;    }            }