<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- namespace必须指向Dao接口 -->
<mapper namespace="com.zx.emanage.loanappro.persist.WmsCreCreditApproDao">
	<!-- 终审审批数据导出 -->
	<select id="getLoanApproApproveListWithoutPaging" parameterType="map"
		resultType="java.util.HashMap">
		select
		t1.wms_cre_credit_head_id,
		t1.bill_code,
		t1.credit_purpose,
		t1.max_repayment_limit_per_month,
		t1.credit_limit,
		t1.max_repayment_time_limit,
		t1.enter_file_way,
		t1.payroll_payment_way,
		t1.data_type,
		t1.is_complete,
		t1.reference_type,
		t1.is_other_corporation_done,
		t1.is_to_public_stream,
		t1.is_house_certificate_original,
		t1.is_check,
		t1.person_condition,
		t1.salesman_id,
		t1.salesman_code,
		t1.salesman_name,
		t1.city,
		t1.cre_type,
		(case t1.cre_type when '1' then '信贷产品' when '2' then '房贷产品' end)as
		cre_type_name,
		t1.bill_status,
		(select value_meaning from wms_sys_dict_data where value_code =
		t1.bill_status and wms_sys_dict_id = 24)as bill_status_name,
		t1.water_appro_user_id,
		t1.water_appro_user_name,
		date_format(t1.water_appro_timestamp,'%Y-%m -%d %H:%i:%s') as water_appro_timestamp,
		t1.water_appro_result,
		(case t1.water_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略' else
		'待审批' end)as water_appro_result_name,
		t1.info_appro_user_id,
		t1.info_appro_user_name,
		date_format(t1.info_appro_timestamp,'%Y-%m -%d %H:%i:%s') as info_appro_timestamp,
		t1.info_appro_result,
		(case t1.info_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略' else
		'待审批' end) as info_appro_result_name,
		t1.phone_appro_user_id,
		t1.phone_appro_user_name,
		date_format(t1.phone_appro_timestamp,'%Y -%m -%d %H:%i:%s')as phone_appro_timestamp,
		t1.phone_appro_result,
		(case t1.phone_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略' else
		'待审批' end)as phone_appro_result_name,
		t1.certificate_appro_user_id,
		t1.certificate_appro_user_name,
		date_format(t1.certificate_appro_timestamp,'%Y -%m -%d %H:%i:%s') as certificate_appro_timestamp,
		t1.certificate_appro_result,
		(case t1.certificate_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略'
		else '待审批' end)as certificate_appro_result_name,
		t1.create_user_id,
		t1.create_user_name,
		date_format(t1.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t1.last_update_user_id,
		date_format(t1.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
		t1.enable_flag,
		t2.wms_cre_credit_line_customer_change_head_id,
		t2.wms_cre_credit_head_id,
		t2.wms_cus_customer_head_id,
		t2.customer_code,
		t2.customer_name,
		t2.customer_ever_name,
		t2.customer_category,
		t2.gender,
		t2.max_degree,
		date_format(t2.birthday,'%Y-%m-%d') as birthday,
		t2.id_card,
		t2.province,
		t2.city,
		t2.district,
		t2.address_more,
		t2.has_children,
		t2.children_name,
		t2.children_address,
		t2.children_telephone,
		t2.has_married,
		t2.has_house,
		t2.current_address_province,
		t2.current_address_city,
		t2.current_address_district,
		t2.current_address_more,
		t2.post_code,
		t2.fixed_telephone,
		t2.mobile_telephone1,
		t2.service_password1,
		t2.mobile_telephone2,
		t2.service_password2,
		t2.personal_year_income,
		t2.customer_email,
		t2.credit_card_limit,
		t2.common_occupants,
		t2.status,
		t2.create_user_id,
		t2.create_user_name,
		date_format(t2.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t2.last_update_user_id,
		date_format(t2.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
		t2.enable_flag,
		t1.inspection_appro_user_id,
		t1.inspection_appro_user_name,
		t1.inspection_appro_timestamp,
		t1.inspection_appro_result,
		(case
		when t1.trial_interview_result=1 and
		t1.cre_loan_type=283 and t1.inspection_appro_result='0' then '未通过'
		when t1.trial_interview_result=1 and
		t1.cre_loan_type=283 and t1.inspection_appro_result='1' then '通过'
		when t1.trial_interview_result=1 and
		t1.cre_loan_type=283 and ISNULL(t1.inspection_appro_result) then '待审批'
		when t1.trial_interview_result=1 and t1.cre_loan_type=113 and
		t1.inspection_appro_result='0' then '未通过'
		when t1.trial_interview_result=1 and t1.cre_loan_type=113 and
		t1.inspection_appro_result='1' then '通过'
		when t1.trial_interview_result=1 and t1.cre_loan_type=113 and
		ISNULL(t1.inspection_appro_result) then '待审批'
		end) as inspection_appro_result_name,
		t1.inspection_appro_advice,
		t1.inspection_appro_result_page,
		t1.salesman_shortcode,
		CONCAT(t1.salesman_name,"/",t1.salesman_shortcode) as salesman_name_str
		from wms_cre_credit_head
		t1,wms_cre_credit_line_customer_change_head t2
		<where>
			t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id and
			t1.enable_flag=1 and t1.bill_status=3 and t2.is_major='1'
			and t1.wms_cre_credit_head_id in
			<if test="idList !=null">
				<foreach collection="idList" index="index" item="wms_cre_credit_head_id"
					open="(" separator="," close=")">
					#{wms_cre_credit_head_id}
				</foreach>
			</if>
			<if test="bill_code!=null">
				and t1.bill_code like #{bill_code}
			</if>
			<if test="create_timestamp!=null and create_timestamp1!=null">
				and t1.create_timestamp between #{create_timestamp} and
				#{create_timestamp1}
			</if>
			<if test="salesman_name!=null or salesman_shortcode !=null">
				and (t1.salesman_name like#{salesman_name} or
				t1.salesman_shortcode like #{salesman_shortcode})
			</if>
			<if test="id_card!=null">
				and t2.id_card =#{id_card}
			</if>
		</where>
		<if test="sortname!=null and sortorder!=null">
			order by ${sortname} ${sortorder}
		</if>
	</select>
	<!--终审审批列表分页 -->
	<select id="getLoanApproApproveListWithPaging" parameterType="map"
		resultType="java.util.HashMap">
		select
		t1.wms_cre_credit_head_id,
		t1.bill_code,
		t1.credit_purpose,
		t1.max_repayment_limit_per_month,
		t1.credit_limit,
		t1.max_repayment_time_limit,
		t1.enter_file_way,
		t1.payroll_payment_way,
		t1.data_type,
		t1.is_complete,
		t1.reference_type,
		t1.is_other_corporation_done,
		t1.is_to_public_stream,
		t1.is_house_certificate_original,
		t1.is_check,
		t1.person_condition,
		t1.salesman_id,
		t1.salesman_code,
		t1.salesman_name,
		t1.city,
		t1.cre_type,
		(case t1.cre_type when '1' then '信贷产品' when '2' then '房贷产品' end)as
		cre_type_name,
		t1.bill_status,
		(select value_meaning from wms_sys_dict_data where value_code =
		t1.bill_status and wms_sys_dict_id = 24)as bill_status_name,
		t1.water_appro_user_id,
		t1.water_appro_user_name,
		date_format(t1.water_appro_timestamp,'%Y-%m -%d %H:%i:%s') as water_appro_timestamp,
		t1.water_appro_result,
		t1.info_appro_user_id,
		t1.info_appro_user_name,
		date_format(t1.info_appro_timestamp,'%Y-%m -%d %H:%i:%s') as info_appro_timestamp,
		t1.info_appro_result,
		t1.phone_appro_user_id,
		t1.phone_appro_user_name,
		date_format(t1.phone_appro_timestamp,'%Y -%m -%d %H:%i:%s')as phone_appro_timestamp,
		t1.phone_appro_result,
		t1.certificate_appro_user_id,
		t1.certificate_appro_user_name,

		date_format(t1.certificate_appro_timestamp,'%Y -%m -%d %H:%i:%s') as certificate_appro_timestamp,
		t1.certificate_appro_result,

		t1.create_user_id,
		t1.create_user_name,
		date_format(t1.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t1.last_update_user_id,
		date_format(t1.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
		t1.enable_flag,
		t1.model_one_amount,
		t1.model_two_amount,
		t1.model_three_amount,
		t1.model_four_amount,
		t2.wms_cre_credit_line_customer_change_head_id,
		t2.wms_cre_credit_head_id,
		t2.wms_cus_customer_head_id,
		t2.customer_code,
		t2.customer_name,
		t2.customer_ever_name,
		t2.customer_category,
		t2.gender,
		t2.max_degree,
		date_format(t2.birthday,'%Y-%m-%d') as birthday,
		t2.id_card,
		t2.province,
		t2.city,
		t2.district,
		t2.address_more,
		t2.has_children,
		t2.children_name,
		t2.children_address,
		t2.children_telephone,
		t2.has_married,
		t2.has_house,
		t2.current_address_province,
		t2.current_address_city,
		t2.current_address_district,
		t2.current_address_more,
		t2.post_code,
		t2.fixed_telephone,
		t2.mobile_telephone1,
		t2.service_password1,
		t2.mobile_telephone2,
		t2.service_password2,
		t2.personal_year_income,
		t2.customer_email,
		t2.credit_card_limit,
		t2.common_occupants,
		t2.status,
		t2.create_user_id,
		t2.create_user_name,
		date_format(t2.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t2.last_update_user_id,
		date_format(t2.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
		t2.enable_flag,
		t1.inspection_appro_user_id,
		t1.inspection_appro_user_name,
		t1.inspection_appro_timestamp,
		t1.inspection_appro_result,
		t1.inspection_appro_advice,
		t1.inspection_appro_result_page,
		t1.cre_loan_type,
		t1.salesman_shortcode,
		CONCAT(t1.salesman_name,"/",t1.salesman_shortcode) as salesman_name_str,
		t1.trial_interview_uid,
		t1.trial_interview_uname,
		t1.trial_interview_timestamp,
		t1.trial_interview_result,
		t1.trial_interview_advice,
		t1.documentary_opinion
		from wms_cre_credit_head t1,wms_cre_credit_line_customer_change_head
		t2
		<where>
			t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id and
			t1.enable_flag=1 and t1.bill_status=3 and t2.is_major='1'
			<if test="idList !=null">
				and t1.wms_cre_credit_head_id in
				<foreach collection="idList" index="index" item="wms_cre_credit_head_id"
					open="(" separator="," close=")">
					#{wms_cre_credit_head_id}
				</foreach>
			</if>
			<if test="bill_code!=null">
				and t1.bill_code like #{bill_code}
			</if>
			<if test="create_timestamp!=null and create_timestamp1!=null">
				and t1.create_timestamp between #{create_timestamp} and
				#{create_timestamp1}
			</if>
			<if test="salesman_name!=null or salesman_shortcode !=null">
				and (t1.salesman_name like#{salesman_name} or
				t1.salesman_shortcode like #{salesman_shortcode})
			</if>
			<if test="id_card!=null">
				and t2.id_card =#{id_card}
			</if>
		</where>
		<if test="sortname!=null and sortorder!=null">
			order by ${sortname} ${sortorder}
		</if>
		<if test="offset!=null and pagesize!=null">
			limit ${offset},${pagesize}
		</if>
	</select>
	<!-- 终审审批查询总记录 -->
	<select id="getLoanApproApproveCount" parameterType="map"
		resultType="int">
		select count(t1.wms_cre_credit_head_id) as count
		from
		wms_cre_credit_head t1 ,wms_cre_credit_line_customer_change_head t2
		<where>
			t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id and
			t1.enable_flag=1 and t1.bill_status=3 and t2.is_major='1'
			<if test="idList !=null">
				and t1.wms_cre_credit_head_id in
				<foreach collection="idList" index="index" item="wms_cre_credit_head_id"
					open="(" separator="," close=")">
					#{wms_cre_credit_head_id}
				</foreach>
			</if>
			<if test="bill_code!=null">
				and t1.bill_code like #{bill_code}
			</if>
			<if test="create_timestamp!=null and create_timestamp1!=null">
				and t1.create_timestamp between #{create_timestamp} and
				#{create_timestamp1}
			</if>
			<if test="salesman_name!=null">
				and t1.salesman_name like#{salesman_name}
			</if>
			<if test="id_card!=null">
				and t2.id_card =#{id_card}
			</if>
		</where>
	</select>
	<!-- 终审面签数据导出 -->
	<select id="getLoanApproInterViewListWithoutPaging"
		parameterType="map" resultType="java.util.HashMap">
		select
		t1.wms_cre_credit_head_id,
		t1.bill_code,
		t1.credit_purpose,
		t1.max_repayment_limit_per_month,
		t1.credit_limit,
		t1.max_repayment_time_limit,
		t1.enter_file_way,
		t1.payroll_payment_way,
		t1.data_type,
		t1.is_complete,
		t1.reference_type,
		t1.is_other_corporation_done,
		t1.is_to_public_stream,
		t1.is_house_certificate_original,
		t1.is_check,
		t1.person_condition,
		t1.salesman_id,
		t1.salesman_code,
		t1.salesman_name,
		t1.city,
		t1.cre_type,
		(case t1.cre_type when '1' then '信贷产品' when '2' then '房贷产品' end)as
		cre_type_name,
		t1.bill_status,
		(select value_meaning from wms_sys_dict_data where value_code =
		t1.bill_status and wms_sys_dict_id = 24)as bill_status_name,
		t1.water_appro_user_id,
		t1.water_appro_user_name,
		date_format(t1.water_appro_timestamp,'%Y-%m -%d %H:%i:%s') as water_appro_timestamp,
		t1.water_appro_result,
		(case t1.water_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略' else
		'待审批' end)as water_appro_result_name,
		t1.info_appro_user_id,
		t1.info_appro_user_name,
		date_format(t1.info_appro_timestamp,'%Y-%m -%d %H:%i:%s') as info_appro_timestamp,
		t1.info_appro_result,
		(case t1.info_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略' else
		'待审批' end) as info_appro_result_name,
		t1.phone_appro_user_id,
		t1.phone_appro_user_name,
		date_format(t1.phone_appro_timestamp,'%Y -%m -%d %H:%i:%s')as phone_appro_timestamp,
		t1.phone_appro_result,
		(case t1.phone_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略' else
		'待审批' end)as phone_appro_result_name,
		t1.certificate_appro_user_id,
		t1.certificate_appro_user_name,
		date_format(t1.certificate_appro_timestamp,'%Y -%m -%d %H:%i:%s') as certificate_appro_timestamp,
		t1.certificate_appro_result,
		(case t1.certificate_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略'
		else '待审批' end)as certificate_appro_result_name,
		t1.create_user_id,
		t1.create_user_name,
		date_format(t1.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t1.last_update_user_id,
		date_format(t1.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
		t1.enable_flag,
		t2.wms_cre_credit_line_customer_change_head_id,
		t2.wms_cre_credit_head_id,
		t2.wms_cus_customer_head_id,
		t2.customer_code,
		t2.customer_name,
		t2.customer_ever_name,
		t2.customer_category,
		t2.gender,
		t2.max_degree,
		date_format(t2.birthday,'%Y-%m-%d') as birthday,
		t2.id_card,
		t2.province,
		t2.city,
		t2.district,
		t2.address_more,
		t2.has_children,
		t2.children_name,
		t2.children_address,
		t2.children_telephone,
		t2.has_married,
		t2.has_house,
		t2.current_address_province,
		t2.current_address_city,
		t2.current_address_district,
		t2.current_address_more,
		t2.post_code,
		t2.fixed_telephone,
		t2.mobile_telephone1,
		t2.service_password1,
		t2.mobile_telephone2,
		t2.service_password2,
		t2.personal_year_income,
		t2.customer_email,
		t2.credit_card_limit,
		t2.common_occupants,
		t2.status,
		t2.create_user_id,
		t2.create_user_name,
		date_format(t2.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t2.last_update_user_id,
		date_format(t2.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
		t2.enable_flag,
		t1.inspection_appro_user_id,
		t1.inspection_appro_user_name,
		t1.inspection_appro_timestamp,
		t1.inspection_appro_result,
		(case
		when t1.trial_interview_result=1 and
		t1.cre_loan_type=283 and t1.inspection_appro_result='0' then '未通过'
		when t1.trial_interview_result=1 and
		t1.cre_loan_type=283 and t1.inspection_appro_result='1' then '通过'
		when t1.trial_interview_result=1 and
		t1.cre_loan_type=283 and ISNULL(t1.inspection_appro_result) then '待审批'
		when t1.trial_interview_result=1 and t1.cre_loan_type=113 and
		t1.inspection_appro_result='0' then '未通过'
		when t1.trial_interview_result=1 and t1.cre_loan_type=113 and
		t1.inspection_appro_result='1' then '通过'
		when t1.trial_interview_result=1 and t1.cre_loan_type=113 and
		ISNULL(t1.inspection_appro_result) then '待审批'
		END) as inspection_appro_result_name,
		t1.inspection_appro_advice,
		t1.inspection_appro_result_page,
		t1.salesman_shortcode,
		CONCAT(t1.salesman_name,"/",t1.salesman_shortcode) as salesman_name_str
		from wms_cre_credit_head
		t1,wms_cre_credit_line_customer_change_head t2
		<where>
			t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id and
			t1.enable_flag=1 and t1.bill_status=4 and t2.is_major='1'
			<if test="create_user_city_code !=null">
				and t1.create_user_city_code =#{create_user_city_code}
			</if>
			<if test="idList !=null">
				and t1.wms_cre_credit_head_id in
				<foreach collection="idList" index="index" item="wms_cre_credit_head_id"
					open="(" separator="," close=")">
					#{wms_cre_credit_head_id}
				</foreach>
			</if>
			<if test="bill_code!=null">
				and t1.bill_code like #{bill_code}
			</if>
			<if test="create_timestamp!=null and create_timestamp1!=null">
				and t1.create_timestamp between #{create_timestamp} and
				#{create_timestamp1}
			</if>
			<if test="salesman_name!=null or salesman_shortcode !=null">
				and (t1.salesman_name like#{salesman_name} or
				t1.salesman_shortcode like #{salesman_shortcode})
			</if>
			<if test="id_card!=null">
				and t2.id_card =#{id_card}
			</if>
			<!-- 面签需要根据配置来判断 -->
			<if test="childrendept !=null">
				and (FIND_IN_SET(t1.salesman_dept_id,#{childrendept})>0)
			</if>
		</where>
		<if test="sortname!=null and sortorder!=null">
			order by ${sortname} ${sortorder}
		</if>
	</select>
	<!--终审面签列表分页 -->
	<select id="getLoanApproInterViewListWithPaging" parameterType="map"
		resultType="java.util.HashMap">
		select
		t1.wms_cre_credit_head_id,
		t1.bill_code,
		t1.credit_purpose,
		t1.max_repayment_limit_per_month,
		t1.credit_limit,
		t1.appro_limit,
		t1.max_repayment_time_limit,
		t1.enter_file_way,
		t1.payroll_payment_way,
		t1.data_type,
		t1.is_complete,
		t1.reference_type,
		t1.is_other_corporation_done,
		t1.is_to_public_stream,
		t1.is_house_certificate_original,
		t1.is_check,
		t1.person_condition,
		t1.salesman_id,
		t1.salesman_code,
		t1.salesman_name,
		t1.city,
		t1.cre_type,
		(case t1.cre_type when '1' then '信贷产品' when '2' then '房贷产品' end)as
		cre_type_name,
		t1.bill_status,
		(select value_meaning from wms_sys_dict_data where value_code =
		t1.bill_status and wms_sys_dict_id = 24)as bill_status_name,
		t1.water_appro_user_id,
		t1.water_appro_user_name,
		date_format(t1.water_appro_timestamp,'%Y-%m -%d %H:%i:%s') as water_appro_timestamp,
		t1.water_appro_result,
		t1.info_appro_user_id,
		t1.info_appro_user_name,
		date_format(t1.info_appro_timestamp,'%Y-%m -%d %H:%i:%s') as info_appro_timestamp,
		t1.info_appro_result,
		t1.phone_appro_user_id,
		t1.phone_appro_user_name,
		date_format(t1.phone_appro_timestamp,'%Y -%m -%d %H:%i:%s')as phone_appro_timestamp,
		t1.phone_appro_result,
		t1.certificate_appro_user_id,
		t1.certificate_appro_user_name,

		date_format(t1.certificate_appro_timestamp,'%Y -%m -%d %H:%i:%s') as certificate_appro_timestamp,
		t1.certificate_appro_result,

		t1.create_user_id,
		t1.create_user_name,
		date_format(t1.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t1.last_update_user_id,
		date_format(t1.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
		t1.enable_flag,
		t2.wms_cre_credit_line_customer_change_head_id,
		t2.wms_cre_credit_head_id,
		t2.wms_cus_customer_head_id,
		t2.customer_code,
		t2.customer_name,
		t2.customer_ever_name,
		t2.customer_category,
		t2.gender,
		t2.max_degree,
		date_format(t2.birthday,'%Y-%m-%d') as birthday,
		t2.id_card,
		t2.province,
		t2.city,
		t2.district,
		t2.address_more,
		t2.has_children,
		t2.children_name,
		t2.children_address,
		t2.children_telephone,
		t2.has_married,
		t2.has_house,
		t2.current_address_province,
		t2.current_address_city,
		t2.current_address_district,
		t2.current_address_more,
		t2.post_code,
		t2.fixed_telephone,
		t2.mobile_telephone1,
		t2.service_password1,
		t2.mobile_telephone2,
		t2.service_password2,
		t2.personal_year_income,
		t2.customer_email,
		t2.credit_card_limit,
		t2.common_occupants,
		t2.status,
		t2.create_user_id,
		t2.create_user_name,
		date_format(t2.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t2.last_update_user_id,
		date_format(t2.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
		t2.enable_flag,
		t1.inspection_appro_user_id,
		t1.inspection_appro_user_name,
		t1.inspection_appro_timestamp,
		t1.inspection_appro_result,
		t1.inspection_appro_advice,
		t1.inspection_appro_result_page,
		t1.cre_loan_type,
		t1.salesman_shortcode,
		CONCAT(t1.salesman_name,"/",t1.salesman_shortcode) as salesman_name_str,
		t1.trial_interview_uid,
		t1.trial_interview_uname,
		t1.trial_interview_timestamp,
		t1.trial_interview_result,
		t1.trial_interview_advice,
		t1.documentary_opinion
		from wms_cre_credit_head t1,wms_cre_credit_line_customer_change_head
		t2
		<where>
			t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id and
			t1.enable_flag=1 and t1.bill_status=4 and t2.is_major='1'
			<if test="create_user_city_code !=null">
				and
				t1.create_user_city_code =#{create_user_city_code}			
			</if>
			<if test="idList !=null">
				and t1.wms_cre_credit_head_id in
				<foreach collection="idList" index="index" item="wms_cre_credit_head_id"
					open="(" separator="," close=")">
					#{wms_cre_credit_head_id}
				</foreach>
			</if>
			<if test="bill_code!=null">
				and t1.bill_code like #{bill_code}
			</if>
			<if test="create_timestamp!=null and create_timestamp1!=null">
				and t1.create_timestamp between #{create_timestamp} and
				#{create_timestamp1}
			</if>
			<if test="salesman_name!=null or salesman_shortcode !=null">
				and (t1.salesman_name like#{salesman_name} or
				t1.salesman_shortcode like #{salesman_shortcode})
			</if>
			<if test="id_card!=null">
				and t2.id_card =#{id_card}
			</if>
			<!-- 面签需要根据配置来判断 -->
			<if test="childrendept !=null">
				and (FIND_IN_SET(t1.salesman_dept_id,#{childrendept})>0)
			</if>
		</where>
		<if test="sortname!=null and sortorder!=null">
			order by ${sortname} ${sortorder}
		</if>
		<if test="offset!=null and pagesize!=null">
			limit ${offset},${pagesize}
		</if>
	</select>
	<!-- 终审面签查询总记录 -->
	<select id="getLoanApproInterViewCount" parameterType="map"
		resultType="int">
		select count(t1.wms_cre_credit_head_id) as count
		from
		wms_cre_credit_head t1 ,wms_cre_credit_line_customer_change_head t2
		<where>
			t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id and
			t1.enable_flag=1 and t1.bill_status=4 and t2.is_major='1'
			<if test="create_user_city_code !=null">
			and t1.create_user_city_code =#{create_user_city_code}			
			</if>
			<if test="idList !=null">
				and t1.wms_cre_credit_head_id in
				<foreach collection="idList" index="index" item="wms_cre_credit_head_id"
					open="(" separator="," close=")">
					#{wms_cre_credit_head_id}
				</foreach>
			</if>
			<if test="bill_code!=null">
				and t1.bill_code like #{bill_code}
			</if>
			<if test="create_timestamp!=null and create_timestamp1!=null">
				and t1.create_timestamp between #{create_timestamp} and
				#{create_timestamp1}
			</if>
			<if test="salesman_name!=null or salesman_shortcode !=null">
				and t(t1.salesman_name like#{salesman_name} or
				t1.salesman_shortcode like #{salesman_shortcode})
			</if>
			<if test="id_card!=null">
				and t2.id_card =#{id_card}
			</if>
			<!-- 面签需要根据配置来判断 -->
			<if test="childrendept !=null">
				and (FIND_IN_SET(t1.salesman_dept_id,#{childrendept})>0)
			</if>
		</where>
	</select>
	<!--合同签订数据导出 -->
	<select id="getAgreePrintLoanListWithoutPaging" parameterType="map"
		resultType="java.util.HashMap">
		select
		t1.wms_cre_credit_head_id,
		t1.bill_code,
		t1.credit_purpose,
		t1.max_repayment_limit_per_month,
		t1.credit_limit,
		t1.max_repayment_time_limit,
		t1.enter_file_way,
		t1.payroll_payment_way,
		t1.data_type,
		t1.is_complete,
		t1.reference_type,
		t1.is_other_corporation_done,
		t1.is_to_public_stream,
		t1.is_house_certificate_original,
		t1.is_check,
		t1.person_condition,
		t1.salesman_id,
		t1.salesman_code,
		t1.salesman_name,
		t1.city,
		t1.cre_type,
		(case t1.cre_type when '1' then '信贷产品' when '2' then '房贷产品' end)as
		cre_type_name,
		t1.bill_status,
		(select value_meaning from wms_sys_dict_data where value_code =
		t1.bill_status and wms_sys_dict_id = 24)as bill_status_name,
		t1.water_appro_user_id,
		t1.water_appro_user_name,
		date_format(t1.water_appro_timestamp,'%Y-%m -%d %H:%i:%s') as water_appro_timestamp,
		t1.water_appro_result,
		t1.info_appro_user_id,
		t1.info_appro_user_name,
		date_format(t1.info_appro_timestamp,'%Y-%m -%d %H:%i:%s') as info_appro_timestamp,
		t1.info_appro_result,
		t1.phone_appro_user_id,
		t1.phone_appro_user_name,
		date_format(t1.phone_appro_timestamp,'%Y -%m -%d %H:%i:%s')as phone_appro_timestamp,
		t1.phone_appro_result,
		t1.certificate_appro_user_id,
		t1.certificate_appro_user_name,

		date_format(t1.certificate_appro_timestamp,'%Y -%m -%d %H:%i:%s') as certificate_appro_timestamp,
		t1.certificate_appro_result,

		t1.create_user_id,
		t1.create_user_name,
		date_format(t1.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t1.last_update_user_id,
		date_format(t1.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
		t1.enable_flag,
		t2.wms_cre_credit_line_customer_change_head_id,
		t2.wms_cre_credit_head_id,
		t2.wms_cus_customer_head_id,
		t2.customer_code,
		t2.customer_name,
		t2.customer_ever_name,
		t2.customer_category,
		t2.gender,
		t2.max_degree,
		date_format(t2.birthday,'%Y-%m-%d') as birthday,
		t2.id_card,
		t2.province,
		t2.city,
		t2.district,
		t2.address_more,
		t2.has_children,
		t2.children_name,
		t2.children_address,
		t2.children_telephone,
		t2.has_married,
		t2.has_house,
		t2.current_address_province,
		t2.current_address_city,
		t2.current_address_district,
		t2.current_address_more,
		t2.post_code,
		t2.fixed_telephone,
		t2.mobile_telephone1,
		t2.service_password1,
		t2.mobile_telephone2,
		t2.service_password2,
		t2.personal_year_income,
		t2.customer_email,
		t2.credit_card_limit,
		t2.common_occupants,
		t2.status,
		t2.create_user_id,
		t2.create_user_name,
		date_format(t2.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t2.last_update_user_id,
		date_format(t2.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
		t2.enable_flag,
		t1.salesman_shortcode,
		CONCAT(t1.salesman_name,"/",t1.salesman_shortcode) as salesman_name_str
		from wms_cre_credit_head
		t1,wms_cre_credit_line_customer_change_head t2
		<where>
			t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id and
			t1.enable_flag=1 and t1.bill_status=10 and t2.is_major='1'
			and
			t1.create_user_city_code =#{create_user_city_code}
			<if test="idList !=null">
				and t1.wms_cre_credit_head_id in
				<foreach collection="idList" index="index" item="wms_cre_credit_head_id"
					open="(" separator="," close=")">
					#{wms_cre_credit_head_id}
				</foreach>
			</if>
			<if test="bill_code!=null">
				and t1.bill_code like #{bill_code}
			</if>
			<if test="create_timestamp!=null and create_timestamp1!=null">
				and t1.create_timestamp between #{create_timestamp} and
				#{create_timestamp1}
			</if>
			<if test="salesman_name!=null or salesman_shortcode !=null">
				and (t1.salesman_name like#{salesman_name} or
				t1.salesman_shortcode like #{salesman_shortcode})
			</if>
			<if test="id_card!=null">
				and t2.id_card =#{id_card}
			</if>
		</where>
		<if test="sortname!=null and sortorder!=null">
			order by ${sortname} ${sortorder}
		</if>
	</select>
	<!--合同签订列表分页 -->
	<select id="getAgreePrintLoanListWithPaging" parameterType="map"
		resultType="java.util.HashMap">
		select
		t1.wms_cre_credit_head_id,
		t1.bill_code,
		t1.credit_purpose,
		t1.max_repayment_limit_per_month,
		t1.credit_limit,
		t1.max_repayment_time_limit,
		t1.enter_file_way,
		t1.payroll_payment_way,
		t1.data_type,
		t1.is_complete,
		t1.reference_type,
		t1.is_other_corporation_done,
		t1.is_to_public_stream,
		t1.is_house_certificate_original,
		t1.is_check,
		t1.person_condition,
		t1.salesman_id,
		t1.salesman_code,
		t1.salesman_name,
		t1.city,
		t1.cre_type,
		(case t1.cre_type when '1' then '信贷产品' when '2' then '房贷产品' end)as
		cre_type_name,
		t1.bill_status,
		(select value_meaning from wms_sys_dict_data where value_code =
		t1.bill_status and wms_sys_dict_id = 24)as bill_status_name,
		t1.water_appro_user_id,
		t1.water_appro_user_name,
		date_format(t1.water_appro_timestamp,'%Y-%m -%d %H:%i:%s') as water_appro_timestamp,
		t1.water_appro_result,
		t1.info_appro_user_id,
		t1.info_appro_user_name,
		date_format(t1.info_appro_timestamp,'%Y-%m -%d %H:%i:%s') as info_appro_timestamp,
		t1.info_appro_result,
		t1.phone_appro_user_id,
		t1.phone_appro_user_name,
		date_format(t1.phone_appro_timestamp,'%Y -%m -%d %H:%i:%s')as phone_appro_timestamp,
		t1.phone_appro_result,
		t1.certificate_appro_user_id,
		t1.certificate_appro_user_name,

		date_format(t1.certificate_appro_timestamp,'%Y -%m -%d %H:%i:%s') as certificate_appro_timestamp,
		t1.certificate_appro_result,

		t1.create_user_id,
		t1.cre_loan_type,
		t1.create_user_name,
		date_format(t1.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t1.last_update_user_id,
		date_format(t1.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
		t1.enable_flag,
		t2.wms_cre_credit_line_customer_change_head_id,
		t2.wms_cre_credit_head_id,
		t2.wms_cus_customer_head_id,
		t2.customer_code,
		t2.customer_name,
		t2.customer_ever_name,
		t2.customer_category,
		t2.gender,
		t2.max_degree,
		date_format(t2.birthday,'%Y-%m-%d') as birthday,
		t2.id_card,
		t2.province,
		t2.city,
		t2.district,
		t2.address_more,
		t2.has_children,
		t2.children_name,
		t2.children_address,
		t2.children_telephone,
		t2.has_married,
		t2.has_house,
		t2.current_address_province,
		t2.current_address_city,
		t2.current_address_district,
		t2.current_address_more,
		t2.post_code,
		t2.fixed_telephone,
		t2.mobile_telephone1,
		t2.service_password1,
		t2.mobile_telephone2,
		t2.service_password2,
		t2.personal_year_income,
		t2.customer_email,
		t2.credit_card_limit,
		t2.common_occupants,
		t2.status,
		t2.create_user_id,
		t2.create_user_name,
		date_format(t2.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t2.last_update_user_id,
		date_format(t2.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
		t2.enable_flag,
		t1.salesman_shortcode,
		CONCAT(t1.salesman_name,"/",t1.salesman_shortcode) as salesman_name_str
		from wms_cre_credit_head
		t1,wms_cre_credit_line_customer_change_head t2
		<where>
			t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id and
			t1.enable_flag=1 and t1.bill_status=10 and t2.is_major='1'
			and
			t1.create_user_city_code =#{create_user_city_code}
			<if test="idList !=null">
				and t1.wms_cre_credit_head_id in
				<foreach collection="idList" index="index" item="wms_cre_credit_head_id"
					open="(" separator="," close=")">
					#{wms_cre_credit_head_id}
				</foreach>
			</if>
			<if test="bill_code!=null">
				and t1.bill_code like #{bill_code}
			</if>
			<if test="create_timestamp!=null and create_timestamp1!=null">
				and t1.create_timestamp between #{create_timestamp} and
				#{create_timestamp1}
			</if>
			<if test="salesman_name!=null or salesman_shortcode !=null">
				and (t1.salesman_name like#{salesman_name} or
				t1.salesman_shortcode like #{salesman_shortcode})
			</if>
			<if test="id_card!=null">
				and t2.id_card =#{id_card}
			</if>
		</where>
		<if test="sortname!=null and sortorder!=null">
			order by ${sortname} ${sortorder}
		</if>
		<if test="offset!=null and pagesize!=null">
			limit ${offset},${pagesize}
		</if>
	</select>
	<!-- 合同签订查询总记录 -->
	<select id="getAgreePrintLoanCount" parameterType="map"
		resultType="int">
		select count(t1.wms_cre_credit_head_id) as count
		from
		wms_cre_credit_head t1 ,wms_cre_credit_line_customer_change_head t2
		<where>
			t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id and
			t1.enable_flag=1 and t1.bill_status=10 and t2.is_major='1'
			and t1.create_user_city_code =#{create_user_city_code}
			<if test="idList !=null">
				and t1.wms_cre_credit_head_id in
				<foreach collection="idList" index="index" item="wms_cre_credit_head_id"
					open="(" separator="," close=")">
					#{wms_cre_credit_head_id}
				</foreach>
			</if>
			<if test="bill_code!=null">
				and t1.bill_code like #{bill_code}
			</if>
			<if test="create_timestamp!=null and create_timestamp1!=null">
				and t1.create_timestamp between #{create_timestamp} and
				#{create_timestamp1}
			</if>
			<if test="salesman_name!=null or salesman_shortcode !=null">
				and (t1.salesman_name like#{salesman_name} or
				t1.salesman_shortcode like #{salesman_shortcode})
			</if>
			<if test="id_card!=null">
				and t2.id_card =#{id_card}
			</if>
		</where>
	</select>
	<!-- 终审管理-审批查询列表数据导出 -->
	<select id="getLoanApproSearchListWithoutPaging" parameterType="map"
		resultType="java.util.HashMap">
		select
		t1.wms_cre_credit_head_id,
		t1.bill_code,
		t1.credit_purpose,
		t1.max_repayment_limit_per_month,
		(case t1.cre_type when '3' then (CAST(t1.credit_limit*0.0001 AS DECIMAL(8,4) )) else t1.credit_limit end) as credit_limit,
		t1.max_repayment_time_limit,
		t1.enter_file_way,
		t1.payroll_payment_way,
		t1.data_type,
		t1.is_complete,
		t1.reference_type,
		t1.is_other_corporation_done,
		t1.is_to_public_stream,
		t1.is_house_certificate_original,
		t1.is_check,
		t1.person_condition,
		t1.salesman_id,
		t1.salesman_code,
		t1.salesman_name,
		t1.city,
		t1.cre_type,
		(select value_meaning from wms_sys_dict_data where value_code=t1.cre_type and wms_sys_dict_id=15)as
		cre_type_name,
		t1.bill_status,
		(case t1.cre_type when '1' then ((select value_meaning from wms_sys_dict_data where value_code = t1.bill_status
		and wms_sys_dict_id =24)) when '2' then ((select value_meaning from wms_sys_dict_data where value_code = t1.bill_status
		and wms_sys_dict_id =131)) when '3' then ((select value_meaning from wms_sys_dict_data where value_code = t1.bill_status
		and wms_sys_dict_id =24)) end)as bill_status_name,
		t1.water_appro_user_id,
		t1.water_appro_user_name,
		date_format(t1.water_appro_timestamp,'%Y-%m -%d %H:%i:%s') as water_appro_timestamp,
		t1.water_appro_result,
		if(t1.cre_type ='2','----',(case t1.water_appro_result when '1' then '通过' when '0' then '未通过' when '3' then '已忽略' else
		'待审批' end)) as water_appro_result_name,
		t1.info_appro_user_id,
		t1.info_appro_user_name,
		date_format(t1.info_appro_timestamp,'%Y-%m -%d %H:%i:%s') as info_appro_timestamp,
		t1.info_appro_result,
		if(t1.cre_type ='2','----',(case t1.info_appro_result when '1' then '通过' when '0' then '未通过' when '3' then '已忽略' else
		'待审批' end)) as info_appro_result_name,
		t1.phone_appro_user_id,
		t1.phone_appro_user_name,
		date_format(t1.phone_appro_timestamp,'%Y -%m -%d %H:%i:%s')as phone_appro_timestamp,
		t1.phone_appro_result,
		if(t1.cre_type ='2','----',(case t1.phone_appro_result when '1' then '通过' when '0' then '未通过' when '3' then '已忽略' else
		'待审批' end)) as phone_appro_result_name,
		t1.certificate_appro_user_id,
		t1.certificate_appro_user_name,
		date_format(t1.certificate_appro_timestamp,'%Y -%m -%d %H:%i:%s') as certificate_appro_timestamp,
		t1.certificate_appro_result,
		if(t1.cre_type ='2','----',(case t1.certificate_appro_result when '1' then '通过' when '0' then '未通过' when '3' then '已忽略'
		else '待审批' end)) as certificate_appro_result_name,
		IF(t8.wms_cre_housing_approval_info is NULL,(
			CASE t1.assessment_result
			WHEN '1' THEN
				'通过'
			WHEN '0' THEN
				'未通过'
			WHEN '3' THEN
				'已忽略'
			ELSE
				'待审批'
			END
		),'----') AS assessment_result_name,
		t1.assessment_result_page,
		t1.create_user_id,
		t1.create_user_name,
		date_format(t1.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t1.last_update_user_id,
		date_format(t1.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
		t1.enable_flag,
		t1.version_number,
		t2.wms_cre_credit_line_customer_change_head_id,
		t2.wms_cre_credit_head_id,
		t2.wms_cus_customer_head_id,
		t2.customer_code,
		t2.customer_name,
		t2.customer_ever_name,
		t2.customer_category,
		t2.gender,
		t2.max_degree,
		date_format(t2.birthday,'%Y-%m-%d') as birthday,
		t2.id_card,
		t2.province,
		t2.city,
		t2.district,
		t2.address_more,
		t2.has_children,
		t2.children_name,
		t2.children_address,
		t2.children_telephone,
		t2.has_married,
		t2.has_house,
		t2.current_address_province,
		t2.current_address_city,
		t2.current_address_district,
		t2.current_address_more,
		t2.post_code,
		t2.fixed_telephone,
		t2.mobile_telephone1,
		t2.service_password1,
		t2.mobile_telephone2,
		t2.service_password2,
		t2.personal_year_income,
		t2.customer_email,
		t2.credit_card_limit,
		t2.common_occupants,
		t2.status,
		t2.create_user_id,
		t2.create_user_name,
		date_format(t2.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t2.last_update_user_id,
		date_format(t2.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
		t2.enable_flag,
		t1.salesman_shortcode,
		CONCAT(t1.salesman_name,"/",t1.salesman_shortcode) as salesman_name_str,
		t1.appro_limit,
		t1.visa_limit,
		t7.principal_lower as principal_lower,
		ROUND(t7.principal_lower/10000,4) as principal_lower_str,
		
		(CASE EXISTS(select bill_status from wms_cre_credit_head where
		wms_cre_credit_head_id=t1.wms_cre_credit_head_id and (bill_status='7'
		or bill_status='H'))
		WHEN '1'
		THEN ROUND((select loan_amount from wms_fina_cre_loan_app where
		wms_cre_credit_head_id=t1.wms_cre_credit_head_id and enable_flag=1)/10000,4)
		END) as loan_amount_str,
		t1.house_appro_result,
		IF(t8.wms_cre_housing_approval_info is NULL,(
		CASE t1.house_appro_result
		WHEN '1' THEN
			'通过'
		WHEN '0' THEN
			'未通过'
		ELSE
			'待审批'
		END
	    ),'----') AS house_appro_result_name,
		t1.info_appro_result_page,
		t1.phone_appro_result_page,
		t1.certificate_appro_result_page,
		t1.inspection_appro_result_page,
		t1.water_appro_result_page,
		t1.inspection_appro_result,
		if(t1.cre_type ='2',(case
		when t1.trial_interview_result=1 and t1.credit_limit>=20 and
		t1.cre_loan_type=283 and t1.inspection_appro_result='0' then '未通过'
		when t1.trial_interview_result=1 and t1.credit_limit>=20 and
		t1.cre_loan_type=283 and t1.inspection_appro_result='1' then '通过'
		when t1.trial_interview_result=1 and t1.credit_limit>=20 and
		t1.cre_loan_type=283 and ISNULL(t1.inspection_appro_result) then '待审批'
		when t1.trial_interview_result=1 and t1.cre_loan_type=113 and
		t1.inspection_appro_result='0' then '未通过'
		when t1.trial_interview_result=1 and t1.cre_loan_type=113 and
		t1.inspection_appro_result='1' then '通过'
		when t1.trial_interview_result=1 and t1.cre_loan_type=113 and
		ISNULL(t1.inspection_appro_result) then '待审批'
		END),'----') as inspection_appro_result_name,
		t1.house_appro_result_page,
		t1.cre_loan_type,
		(CASE t1.cre_type
		when '1' then (select value_meaning from wms_sys_dict_data where
		wms_sys_dict_data_id=t1.cre_loan_type and wms_sys_dict_id=26 )
		when '2' then (select value_meaning from wms_sys_dict_data where
		wms_sys_dict_data_id=t1.cre_loan_type and wms_sys_dict_id=27 )
		when '3' then (select value_meaning from wms_sys_dict_data where
		value_code=t1.cre_loan_type and wms_sys_dict_id=75 )
		END) as cre_loan_type_name,
		t1.model_one_amount,
		t1.model_two_amount,
		t1.model_three_amount,
		t1.model_four_amount,
		CONCAT(ROUND(t1.model_one_amount,0),"/",ROUND(t1.model_two_amount,0),"/",ROUND(t1.model_three_amount,0),"/",ROUND(t1.model_four_amount,0))
		as model_result,
		EXISTS(select repay_status from wms_fina_cre_repay where
		wms_cre_credit_head_id=t1.wms_cre_credit_head_id and repay_status=2)
		as repay_status,
		(case EXISTS(select repay_status from wms_fina_cre_repay where
		wms_cre_credit_head_id=t1.wms_cre_credit_head_id and repay_status=2)
		when '1' then '是' when '0' then '否' end) as repay_status_name,
		t1.trial_interview_uid,
		t1.trial_interview_uname,
		t1.trial_interview_timestamp,
		t1.trial_interview_result,
		t1.trial_interview_advice,
		<!--房贷流程版本号 1为老流程  2为新流程-->
		(case when t1.create_timestamp &lt; #{hprocess_time} then '1' else '2' end) as edition_num, 
		(SELECT protocol_type from wms_cre_appro_borrow_protocol where wms_cre_credit_head_id =t2.wms_cre_credit_head_id and enable_flag = '1' order by wms_cre_appro_id desc LIMIT 0, 1) as protocol_type,
		(<include refid="deptCity" />) as dept_city,
		(<include refid="deptName" />) as dept_name,
		(select ifnull(a.bill_code_group, '') from wms_cre_credit_group a where t1.wms_cre_credit_group_id = a.wms_cre_credit_group_id) as bill_code_group,
		t4.credit_confirm_result  as credit_confirm_result,
		CONCAT(t1.salesman_name,"/",t1.salesman_shortcode) as salesman_name_str,
		
		 IF(t8.wms_cre_housing_approval_info is NULL,(
			CASE t5.approval_result
			WHEN 'false' THEN
				'未通过'
			WHEN 'true' THEN
				'通过'
			ELSE
				'待审批'
			END
		),'----') AS final_result_name,
		t5.approval_result AS final_result,
	 	IF(t8.wms_cre_housing_approval_info is NULL,(
			CASE t6.approval_result
			WHEN 'false' THEN
				'未通过'
			WHEN 'true' THEN
				'通过'
			ELSE
				'待审批'
			END
		),'----') AS face_result_name,
		t6.approval_result AS face_result,
		t8.wms_cre_housing_approval_info
		from wms_cre_credit_head t1 
		left join wms_cre_credit_line_customer_change_head t2 
		       on t1.wms_cre_credit_head_id = t2.wms_cre_credit_head_id and t2.enable_flag=1 and t2.is_major='1'
		left join wms_cre_housing_credit_confirm t4 
		       on t1.wms_cre_credit_head_id = t4.wms_cre_credit_head_id and t4.enable_flag=1
		       
		 left join wms_cre_appro_borrow_protocol t7 
		       on t1.wms_cre_credit_head_id = t7.wms_cre_credit_head_id and t7.enable_flag=1  
		           
        LEFT JOIN  (SELECT a.approval_result, 
                           a.wms_cre_credit_head_id,
        			       a.wms_cre_housing_approval_info 
        			  FROM wms_cre_housing_approval_info a,
        			       (select max(wms_cre_housing_approval_info) AS wms_cre_housing_approval_info 
        			          from wms_cre_housing_approval_info
        			         where enable_flag = '1' 
        			           and approval_task_code = "ZSSP" 
        		          GROUP BY wms_cre_credit_head_id) b WHERE a.wms_cre_housing_approval_info = b.wms_cre_housing_approval_info
        		    ) t5  ON t1.wms_cre_credit_head_id = t5.wms_cre_credit_head_id
        	            
        LEFT JOIN  (SELECT a.approval_result, 
                           a.wms_cre_credit_head_id,
        			       a.wms_cre_housing_approval_info 
        			  FROM wms_cre_housing_approval_info a,
        			       (select max(wms_cre_housing_approval_info) AS wms_cre_housing_approval_info 
        			          from wms_cre_housing_approval_info
        			         where enable_flag = '1' 
        			           and approval_task_code = "MSSP" 
        		          GROUP BY wms_cre_credit_head_id) b WHERE a.wms_cre_housing_approval_info = b.wms_cre_housing_approval_info
        		    ) t6  ON t1.wms_cre_credit_head_id = t6.wms_cre_credit_head_id	            
        LEFT JOIN (
			SELECT
				wms_cre_housing_approval_info,
				wms_cre_credit_head_id
			FROM
				wms_cre_housing_approval_info
			WHERE
				enable_flag = '1'
			AND approval_type = "4"
			GROUP BY wms_cre_credit_head_id
		)t8 ON t8.wms_cre_credit_head_id = t1.wms_cre_credit_head_id	  
		<where>
			t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id
			and t1.enable_flag=1
			and (t1.cre_type in ('1','3') or (t1.cre_type='2' and t1.version_number='3'))
			<if test="id_card!=null">
				and t2.id_card =#{id_card}
			</if>
			<if test="customer_name !=null">
				and t2.customer_name like #{customer_name}
			</if>
			<if test="bill_code != null">
				and (t1.bill_code like #{bill_code} or (select ifnull(bill_code_group, '') from wms_cre_credit_group  where t1.wms_cre_credit_group_id = wms_cre_credit_group_id)  like #{bill_code})
			</if>
			<if test="create_timestamp!=null and create_timestamp1!=null">
				and t1.create_timestamp between #{create_timestamp} and
				#{create_timestamp1}
			</if>
			<if test="salesman_name!=null or salesman_shortcode !=null">
				and (t1.salesman_name like#{salesman_name} or
				t1.salesman_shortcode like #{salesman_shortcode})
			</if>
			<if test="cre_type!=null">
				and t1.cre_type =#{cre_type}
			</if>
			<if test="cre_loan_type!=null">
				and (t1.cre_loan_type =#{cre_loan_type}  or t7.cre_loan_type =#{cre_loan_type})
			</if>
			<if test="city !=null">
				and t1.city like #{city}
			</if>
			<if test="bill_status !=null">
				and t1.bill_status =#{bill_status}
			</if>
			<!-- 判断贷款金额区间 -->
			<if test="credit_limit_begin !=null and credit_limit_end !=null ">
				and ((case t1.cre_type when '3' then (CAST(t1.credit_limit*0.0001 AS DECIMAL(8,4))) else t1.credit_limit end) between #{credit_limit_begin} and
				#{credit_limit_end})
			</if>
			<!-- 判断放款金额 -->
			<if test="loan_amount_str_begin !=null and loan_amount_str_end !=null">
				and ((CASE EXISTS(select bill_status from
				wms_cre_credit_head where
				wms_cre_credit_head_id=t1.wms_cre_credit_head_id and
				(bill_status='7' or bill_status='H'))
				WHEN '1'
				THEN ROUND((select loan_amount from wms_fina_cre_loan_app where
				wms_cre_credit_head_id=t1.wms_cre_credit_head_id)/10000,4)
				END) between #{loan_amount_str_begin} and #{loan_amount_str_end})
			</if>
			<!-- 判断申请时间区间 -->
			<if test="create_timestamp_begin !=null and create_timestamp_end !=null">
				and t1.create_timestamp between #{create_timestamp_begin}
				and #{create_timestamp_end}
			</if>
			<!--判断1是逾期 -->
			<if test="repay_status !=null and repay_status==1">
				and (EXISTS(select repay_status from wms_fina_cre_repay
				where wms_cre_credit_head_id=t1.wms_cre_credit_head_id and
				repay_status=2))
			</if>
			<!--判断0不是逾期 -->
			<if test="repay_status !=null and repay_status==0">
				and (EXISTS(select repay_status from wms_fina_cre_repay
				where wms_cre_credit_head_id=t1.wms_cre_credit_head_id and
				repay_status not in (2)))
			</if>
			<if test="dept_city_sel !=null">
				and t1.salesman_city_code in (select value_meaning from wms_sys_dict_data  where value_code=#{dept_city_sel} and wms_sys_dict_id=71)
			</if>
			<if test="dept_name_sel !=null">
				and t1.salesman_dept_id in (select dept_id from sys_dept where dept_pid = #{dept_name_sel})
			</if>
			<if test="salesman_city_code != null">
                and t1.salesman_city_code = ${salesman_city_code}
            </if>
            <!-- 权限控制 -->
			<if test="childrendept != null">
				and (FIND_IN_SET(t1.salesman_dept_id, #{childrendept}) > 0)
			</if>
		</where>
		<if test="sortname!=null and sortorder!=null">
			order by ${sortname} ${sortorder}
		</if>
	</select>
	
	<sql id="deptCity">
		select value_meaning from wms_sys_dict_data where  value_code=t1.salesman_city_code and wms_sys_dict_id=25
	</sql>
	
	<sql id="deptName">
		select dept_name from sys_dept where dept_id = 
		 (case (select dept_pid from sys_dept where dept_id = t1.salesman_dept_id) 
		 	when '89' then (t1.salesman_dept_id) 
		 	when '90' then (t1.salesman_dept_id) 
		 	else ((select dept_pid from sys_dept where dept_id = t1.salesman_dept_id)) 
		 end)
	</sql>
	
	<!--终审管理-审批查询列表分页 -->
	<select id="getLoanApproSearchListWithPaging" parameterType="map"
		resultType="java.util.HashMap">
		select
		t1.wms_cre_credit_head_id,
		t1.bill_code,
		t1.credit_purpose,
		t1.max_repayment_limit_per_month,
		(case t1.cre_type when '3' then (CAST(t1.credit_limit*0.0001 AS DECIMAL(8,4) )) else t1.credit_limit end) as credit_limit,
		t1.max_repayment_time_limit,
		t1.enter_file_way,
		t1.payroll_payment_way,
		t1.data_type,
		t1.is_complete,
		t1.reference_type,
		t1.is_other_corporation_done,
		t1.is_to_public_stream,
		t1.is_house_certificate_original,
		t1.is_check,
		t1.person_condition,
		t1.salesman_id,
		t1.salesman_code,
		t1.salesman_name,
		t1.city,
		t1.cre_type,
		(select value_meaning from wms_sys_dict_data where value_code=t1.cre_type and wms_sys_dict_id=15)as
		cre_type_name,
		t1.bill_status,
		(case t1.cre_type when '1' then ((select value_meaning from wms_sys_dict_data where value_code = t1.bill_status
		and wms_sys_dict_id =24)) when '2' then ((select value_meaning from wms_sys_dict_data where value_code = t1.bill_status
		and wms_sys_dict_id =131)) when '3' then ((select value_meaning from wms_sys_dict_data where value_code = t1.bill_status
		and wms_sys_dict_id =24)) end)as bill_status_name,
		t1.water_appro_user_id,
		t1.water_appro_user_name,
		date_format(t1.water_appro_timestamp,'%Y-%m -%d %H:%i:%s') as water_appro_timestamp,
		t1.water_appro_result,
		(case t1.water_appro_result when '1' then '通过' when '0' then '未通过' when '3' then '已忽略' else
		'待审批' end) as water_appro_result_name,
		t1.info_appro_user_id,
		t1.info_appro_user_name,
		date_format(t1.info_appro_timestamp,'%Y-%m -%d %H:%i:%s') as info_appro_timestamp,
		t1.info_appro_result,
		(case t1.info_appro_result when '1' then '通过' when '0' then '未通过' when '3' then '已忽略' else
		'待审批' end) as info_appro_result_name,
		t1.phone_appro_user_id,
		t1.phone_appro_user_name,
		date_format(t1.phone_appro_timestamp,'%Y -%m -%d %H:%i:%s')as phone_appro_timestamp,
		t1.phone_appro_result,
		(case t1.phone_appro_result when '1' then '通过' when '0' then '未通过' when '3' then '已忽略' else
		'待审批' end) as phone_appro_result_name,
		t1.certificate_appro_user_id,
		t1.certificate_appro_user_name,
		date_format(t1.certificate_appro_timestamp,'%Y -%m -%d %H:%i:%s') as certificate_appro_timestamp,
		t1.certificate_appro_result,
		(case t1.certificate_appro_result when '1' then '通过' when '0' then '未通过' when '3' then '已忽略'
		else '待审批' end) as certificate_appro_result_name,
		(case t1.assessment_result when '1' then '通过' when '0' then '未通过' when '3' then '已忽略'
		else '待审批' end) as assessment_result_name,
		t1.assessment_result_page,
		t1.create_user_id,
		t1.create_user_name,
		date_format(t1.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t1.last_update_user_id,
		date_format(t1.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
		t1.enable_flag,
		t1.version_number,
		t2.wms_cre_credit_line_customer_change_head_id,
		t2.wms_cre_credit_head_id,
		t2.wms_cus_customer_head_id,
		t2.customer_code,
		t2.customer_name,
		t2.customer_ever_name,
		t2.customer_category,
		t2.gender,
		t2.max_degree,
		date_format(t2.birthday,'%Y-%m-%d') as birthday,
		t2.id_card,
		t2.province,
		t2.city,
		t2.district,
		t2.address_more,
		t2.has_children,
		t2.children_name,
		t2.children_address,
		t2.children_telephone,
		t2.has_married,
		t2.has_house,
		t2.current_address_province,
		t2.current_address_city,
		t2.current_address_district,
		t2.current_address_more,
		t2.post_code,
		t2.fixed_telephone,
		t2.mobile_telephone1,
		t2.service_password1,
		t2.mobile_telephone2,
		t2.service_password2,
		t2.personal_year_income,
		t2.customer_email,
		t2.credit_card_limit,
		t2.common_occupants,
		t2.status,
		t2.create_user_id,
		t2.create_user_name,
		date_format(t2.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t2.last_update_user_id,
		date_format(t2.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
		t2.enable_flag,
		t1.salesman_shortcode,
		CONCAT(t1.salesman_name,"/",t1.salesman_shortcode) as salesman_name_str,
		t1.appro_limit,
		t1.visa_limit,
		t7.principal_lower as principal_lower,
		ROUND(t7.principal_lower/10000,4) as principal_lower_str,
		
		(CASE EXISTS(select bill_status from wms_cre_credit_head where
		wms_cre_credit_head_id=t1.wms_cre_credit_head_id and (bill_status='7'
		or bill_status='H'))
		WHEN '1'
		THEN ROUND((select loan_amount from wms_fina_cre_loan_app where
		wms_cre_credit_head_id=t1.wms_cre_credit_head_id and enable_flag=1)/10000,4)
		END) as loan_amount_str,
		t1.house_appro_result,
		(case t1.house_appro_result when '1' then '通过' when '0' then '未通过' else
		'待审批' end) as house_appro_result_name,
		t1.info_appro_result_page,
		t1.phone_appro_result_page,
		t1.certificate_appro_result_page,
		t1.inspection_appro_result_page,
		t1.water_appro_result_page,
		t1.inspection_appro_result,
		(case
		when t1.trial_interview_result=1 and t1.credit_limit>=20 and
		t1.cre_loan_type=283 and t1.inspection_appro_result='0' then '未通过'
		when t1.trial_interview_result=1 and t1.credit_limit>=20 and
		t1.cre_loan_type=283 and t1.inspection_appro_result='1' then '通过'
		when t1.trial_interview_result=1 and t1.credit_limit>=20 and
		t1.cre_loan_type=283 and ISNULL(t1.inspection_appro_result) then '待审批'
		when t1.trial_interview_result=1 and t1.cre_loan_type=113 and
		t1.inspection_appro_result='0' then '未通过'
		when t1.trial_interview_result=1 and t1.cre_loan_type=113 and
		t1.inspection_appro_result='1' then '通过'
		when t1.trial_interview_result=1 and t1.cre_loan_type=113 and
		ISNULL(t1.inspection_appro_result) then '待审批'
		END) as inspection_appro_result_name,
		t1.house_appro_result_page,
		t1.cre_loan_type,
		(CASE t1.cre_type
		when '1' then (select value_meaning from wms_sys_dict_data where
		wms_sys_dict_data_id=t1.cre_loan_type and wms_sys_dict_id=26 )
		when '2' then (select value_meaning from wms_sys_dict_data where
		wms_sys_dict_data_id=t1.cre_loan_type and wms_sys_dict_id=27 )
		when '3' then (select value_meaning from wms_sys_dict_data where
		value_code=t1.cre_loan_type and wms_sys_dict_id=75 )
		END) as cre_loan_type_name,
		t1.model_one_amount,
		t1.model_two_amount,
		t1.model_three_amount,
		t1.model_four_amount,
		CONCAT(ROUND(t1.model_one_amount,0),"/",ROUND(t1.model_two_amount,0),"/",ROUND(t1.model_three_amount,0),"/",ROUND(t1.model_four_amount,0))
		as model_result,
		EXISTS(select repay_status from wms_fina_cre_repay where
		wms_cre_credit_head_id=t1.wms_cre_credit_head_id and repay_status=2)
		as repay_status,
		(case EXISTS(select repay_status from wms_fina_cre_repay where
		wms_cre_credit_head_id=t1.wms_cre_credit_head_id and repay_status=2)
		when '1' then '是' when '0' then '否' end) as repay_status_name,
		t1.trial_interview_uid,
		t1.trial_interview_uname,
		t1.trial_interview_timestamp,
		t1.trial_interview_result,
		t1.trial_interview_advice,
		<!--房贷流程版本号 1为老流程  2为新流程-->
		(case when t1.create_timestamp &lt; #{hprocess_time} then '1' else '2' end) as edition_num, 
		(SELECT protocol_type from wms_cre_appro_borrow_protocol where wms_cre_credit_head_id =t2.wms_cre_credit_head_id and enable_flag = '1' order by wms_cre_appro_id desc LIMIT 0, 1) as protocol_type,
		(<include refid="deptCity" />) as dept_city,
		(<include refid="deptName" />) as dept_name,
		(select ifnull(a.bill_code_group, '') from wms_cre_credit_group a where t1.wms_cre_credit_group_id = a.wms_cre_credit_group_id) as bill_code_group,
		t4.credit_confirm_result  as credit_confirm_result,
		CONCAT(t1.salesman_name,"/",t1.salesman_shortcode) as salesman_name_str,
		
		(case t5.approval_result 
		 when 'false' then '未通过' 
		 when 'true' then '通过' 
		 else '待审批' end) as final_result_name,
		t5.approval_result as final_result,
		
		(case t6.approval_result 
		 when 'false' then '未通过' 
		 when 'true' then '通过' 
		 else '待审批' end) as face_result_name,
		t6.approval_result as face_result,
	    t8.wms_cre_housing_approval_info,
	    t1.bill_type
		from wms_cre_credit_head t1 
		left join wms_cre_credit_line_customer_change_head t2 
		       on t1.wms_cre_credit_head_id = t2.wms_cre_credit_head_id and t2.enable_flag=1 and t2.is_major='1'
		left join wms_cre_housing_credit_confirm t4 
		       on t1.wms_cre_credit_head_id = t4.wms_cre_credit_head_id and t4.enable_flag=1
		       
		 left join wms_cre_appro_borrow_protocol t7 
		       on t1.wms_cre_credit_head_id = t7.wms_cre_credit_head_id and t7.enable_flag=1  
		           
        LEFT JOIN  (SELECT a.approval_result, 
                           a.wms_cre_credit_head_id,
        			       a.wms_cre_housing_approval_info 
        			  FROM wms_cre_housing_approval_info a,
        			       (select max(wms_cre_housing_approval_info) AS wms_cre_housing_approval_info 
        			          from wms_cre_housing_approval_info
        			         where enable_flag = '1' 
        			           and approval_task_type = "终审审批" 
        		          GROUP BY wms_cre_credit_head_id) b WHERE a.wms_cre_housing_approval_info = b.wms_cre_housing_approval_info
        		    ) t5  ON t1.wms_cre_credit_head_id = t5.wms_cre_credit_head_id
        	            
        LEFT JOIN  (SELECT a.approval_result, 
                           a.wms_cre_credit_head_id,
        			       a.wms_cre_housing_approval_info 
        			  FROM wms_cre_housing_approval_info a,
        			       (select max(wms_cre_housing_approval_info) AS wms_cre_housing_approval_info 
        			          from wms_cre_housing_approval_info
        			         where enable_flag = '1' 
        			           and approval_task_type = "面审审批" 
        		          GROUP BY wms_cre_credit_head_id) b WHERE a.wms_cre_housing_approval_info = b.wms_cre_housing_approval_info
        		    ) t6  ON t1.wms_cre_credit_head_id = t6.wms_cre_credit_head_id	            
        LEFT JOIN (SELECT
						wms_cre_housing_approval_info,
						wms_cre_credit_head_id
					FROM
						wms_cre_housing_approval_info
					WHERE
						enable_flag = '1'
					AND approval_type = "4"
					GROUP BY wms_cre_credit_head_id
				)t8 ON t8.wms_cre_credit_head_id = t1.wms_cre_credit_head_id	  
		<where>
			t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id
			and t1.enable_flag=1
			and (t1.cre_type in ('1','3') or (t1.cre_type='2' and t1.version_number='3'))
			<if test="id_card!=null">
				and t2.id_card =#{id_card}
			</if>
			<if test="customer_name !=null">
				and t2.customer_name like #{customer_name}
			</if>
			<if test="bill_code != null">
				and (t1.bill_code like #{bill_code} or (select ifnull(bill_code_group, '') from wms_cre_credit_group  where t1.wms_cre_credit_group_id = wms_cre_credit_group_id)  like #{bill_code})
			</if>
			<if test="create_timestamp!=null and create_timestamp1!=null">
				and t1.create_timestamp between #{create_timestamp} and
				#{create_timestamp1}
			</if>
			<if test="salesman_name!=null or salesman_shortcode !=null">
				and (t1.salesman_name like#{salesman_name} or
				t1.salesman_shortcode like #{salesman_shortcode})
			</if>
			<if test="cre_type!=null">
				and t1.cre_type =#{cre_type}
			</if>
			<if test="cre_loan_type!=null">
				and (t1.cre_loan_type =#{cre_loan_type}  or t7.cre_loan_type =#{cre_loan_type})
			</if>
			<if test="city !=null">
				and t1.city like #{city}
			</if>
			<if test="bill_status !=null">
				and t1.bill_status =#{bill_status}
			</if>
			<!-- 判断贷款金额区间 -->
			<if test="credit_limit_begin !=null and credit_limit_end !=null ">
				and ((case t1.cre_type when '3' then (CAST(t1.credit_limit*0.0001 AS DECIMAL(8,4))) else t1.credit_limit end) between #{credit_limit_begin} and
				#{credit_limit_end})
			</if>
			<!-- 判断放款金额 -->
			<if test="loan_amount_str_begin !=null and loan_amount_str_end !=null">
				and ((CASE EXISTS(select bill_status from
				wms_cre_credit_head where
				wms_cre_credit_head_id=t1.wms_cre_credit_head_id and
				(bill_status='7' or bill_status='H'))
				WHEN '1'
				THEN ROUND((select loan_amount from wms_fina_cre_loan_app where
				wms_cre_credit_head_id=t1.wms_cre_credit_head_id)/10000,4)
				END) between #{loan_amount_str_begin} and #{loan_amount_str_end})
			</if>
			<!-- 判断申请时间区间 -->
			<if test="create_timestamp_begin !=null and create_timestamp_end !=null">
				and t1.create_timestamp between #{create_timestamp_begin}
				and #{create_timestamp_end}
			</if>
			<!--判断1是逾期 -->
			<if test="repay_status !=null and repay_status==1">
				and (EXISTS(select repay_status from wms_fina_cre_repay
				where wms_cre_credit_head_id=t1.wms_cre_credit_head_id and
				repay_status=2))
			</if>
			<!--判断0不是逾期 -->
			<if test="repay_status !=null and repay_status==0">
				and (EXISTS(select repay_status from wms_fina_cre_repay
				where wms_cre_credit_head_id=t1.wms_cre_credit_head_id and
				repay_status not in (2)))
			</if>
			<if test="dept_city_sel !=null">
				and t1.salesman_city_code in (select value_meaning from wms_sys_dict_data  where value_code=#{dept_city_sel} and wms_sys_dict_id=71)
			</if>
			<if test="dept_name_sel !=null">
				and t1.salesman_dept_id in (select dept_id from sys_dept where dept_pid = #{dept_name_sel})
			</if>
			<if test="salesman_city_code != null">
                and t1.salesman_city_code = ${salesman_city_code}
            </if>
            <!-- 权限控制 -->
			<if test="childrendept != null">
				and (FIND_IN_SET(t1.salesman_dept_id, #{childrendept}) > 0)
			</if>
		</where>
		<if test="sortname!=null and sortorder!=null">
			order by ${sortname} ${sortorder}
		</if>
		<if test="offset!=null and pagesize!=null">
			limit ${offset},${pagesize}
		</if>
	</select>
	<!-- 审批查询总记录 -->
	<select id="getLoanApproSearchCount" parameterType="map"
		resultType="int">
		select count(t1.wms_cre_credit_head_id) as count
		from
		wms_cre_credit_head t1 , wms_cre_credit_line_customer_change_head t2
		left join wms_cre_appro_borrow_protocol t7 
		       on t2.wms_cre_credit_head_id = t7.wms_cre_credit_head_id and t7.enable_flag=1  
		<where>
			t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id
			and t1.enable_flag=1
			and t2.is_major='1'
			and (t1.cre_type in ('1','3') or (t1.cre_type='2' and t1.version_number='3'))
			<if test="id_card!=null">
				and t2.id_card =#{id_card}
			</if>
			<if test="customer_name !=null">
				and t2.customer_name like #{customer_name}
			</if>
			<if test="bill_code != null">
				and (t1.bill_code like #{bill_code} or (select ifnull(bill_code_group, '') from wms_cre_credit_group  where t1.wms_cre_credit_group_id = wms_cre_credit_group_id)  like #{bill_code})
			</if>
			<if test="create_timestamp!=null and create_timestamp1!=null">
				and t1.create_timestamp between #{create_timestamp} and
				#{create_timestamp1}
			</if>
			<if test="salesman_name!=null or salesman_shortcode !=null">
				and (t1.salesman_name like#{salesman_name} or
				t1.salesman_shortcode like #{salesman_shortcode})
			</if>
			<if test="cre_type!=null">
				and t1.cre_type =#{cre_type}
			</if>
			<if test="cre_loan_type!=null">
				and (t1.cre_loan_type =#{cre_loan_type}  or t7.cre_loan_type =#{cre_loan_type})
			</if>
			<if test="city !=null">
				and t1.city like #{city}
			</if>
			<if test="bill_status !=null">
				and t1.bill_status =#{bill_status}
			</if>
			<!-- 判断贷款金额区间 -->
			<if test="credit_limit_begin !=null and credit_limit_end !=null ">
				and ((case t1.cre_type when '3' then (CAST(t1.credit_limit*0.0001 AS DECIMAL(8,4))) else t1.credit_limit end) between #{credit_limit_begin} and
				#{credit_limit_end})
			</if>
			<!-- 判断放款金额区间 -->
			<if test="loan_amount_str_begin !=null and loan_amount_str_end !=null">
				and ((CASE EXISTS(select bill_status from
				wms_cre_credit_head where
				wms_cre_credit_head_id=t1.wms_cre_credit_head_id and
				(bill_status='7' or bill_status='H'))
				WHEN '1'
				THEN ROUND((select loan_amount from wms_cre_appro_borrow_protocol where
				wms_cre_credit_head_id=t1.wms_cre_credit_head_id)/10000,4)
				END) between #{loan_amount_str_begin} and #{loan_amount_str_end})
			</if>
			<!-- 判断申请时间区间 -->
			<if test="create_timestamp_begin !=null and create_timestamp_end !=null">
				and t1.create_timestamp between #{create_timestamp_begin}
				and #{create_timestamp_end}
			</if>
			<!--判断1是逾期 -->
			<if test="repay_status !=null and repay_status==1">
				and (EXISTS(select repay_status from wms_fina_cre_repay
				where wms_cre_credit_head_id=t1.wms_cre_credit_head_id and
				repay_status=2))
			</if>
			<!--判断0不是逾期 -->
			<if test="repay_status !=null and repay_status==0">
				and (EXISTS(select repay_status from wms_fina_cre_repay
				where wms_cre_credit_head_id=t1.wms_cre_credit_head_id and
				repay_status not in (2)))
			</if>
			<if test="dept_city_sel !=null">
				and t1.salesman_city_code in (select value_meaning from wms_sys_dict_data  where value_code=#{dept_city_sel} and wms_sys_dict_id=71)
			</if>
			<if test="dept_name_sel !=null">
				and t1.salesman_dept_id in (select dept_id from sys_dept where dept_pid = #{dept_name_sel})
			</if>
			<if test="salesman_city_code != null">
                and t1.salesman_city_code = ${salesman_city_code}
            </if>
            <!-- 权限控制 -->
			<if test="childrendept != null">
				and (FIND_IN_SET(t1.salesman_dept_id, #{childrendept}) > 0)
			</if>
		</where>
	</select>
	<!-- 信贷放款申请列表信息导出 -->
	<select id="getMakeLoansListWithoutPaging" parameterType="map"
		resultType="java.util.HashMap">
		select
		t1.wms_cre_credit_head_id,
		t1.bill_code,
		t1.credit_purpose,
		t1.max_repayment_limit_per_month,
		t1.credit_limit,
		t1.max_repayment_time_limit,
		t1.enter_file_way,
		t1.payroll_payment_way,
		t1.data_type,
		t1.is_complete,
		t1.reference_type,
		t1.is_other_corporation_done,
		t1.is_to_public_stream,
		t1.is_house_certificate_original,
		t1.is_check,
		t1.person_condition,
		t1.salesman_id,
		t1.salesman_code,
		t1.salesman_name,
		t1.city,
		t1.cre_type,
		(case t1.cre_type when '1' then '信贷产品' when '2' then '房贷产品' end)as
		cre_type_name,
		t1.bill_status,
		(select value_meaning from wms_sys_dict_data where value_code =
		t1.bill_status and wms_sys_dict_id = 24)as bill_status_name,
		t1.water_appro_user_id,
		t1.water_appro_user_name,
		t1.water_appro_timestamp,
		date_format(t1.water_appro_timestamp,'%Y-%m -%d %H:%i:%s') as water_appro_timestamp,
		t1.water_appro_result,
		t1.info_appro_user_id,
		t1.info_appro_user_name,
		t1.info_appro_timestamp,
		date_format(t1.info_appro_timestamp,'%Y-%m -%d %H:%i:%s') as info_appro_timestamp,
		t1.info_appro_result,
		t1.phone_appro_user_id,
		t1.phone_appro_user_name,
		t1.phone_appro_timestamp,
		date_format(t1.phone_appro_timestamp,'%Y-%m -%d %H:%i:%s') as phone_appro_timestamp,
		t1.phone_appro_result,
		t1.certificate_appro_user_id,
		t1.certificate_appro_user_name,
		t1.certificate_appro_timestamp,
		date_format(t1.certificate_appro_timestamp,'%Y-%m -%d %H:%i:%s') as certificate_appro_timestamp,
		t1.certificate_appro_result,
		t1.create_user_id,
		t1.create_user_name,
		t1.create_timestamp,
		date_format(t1.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t1.last_update_user_id,
		t1.last_update_timestamp,
		date_format(t1.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
		t1.enable_flag,
		t1.protocol_amount,
		t1.is_link_repeat,
		t1.profession_type,
		t1.is_verify,
		t2.wms_cre_appro_id,
		t2.protocol_id_year,
		t2.protocol_id_num,
		t2.protocol_id_year_num,
		t2.protocol_date,
		t2.creditor_name,
		t2.creditor_identity_id,
		t2.debtor_name,
		t2.debtor_identity_id,
		t2.creditor_address,
		t2.debtor_address,
		t2.creditor_tel,
		t2.debtor_tel,
		t2.debtor_fixed_line,
		t2.principal_caps,
		t2.principal_lower,
		t2.borrow_deadline,
		t2.borrow_begin_date,
		t2.borrow_end_date,
		t2.borrow_purpose,
		t2.borrow_interest,
		t2.refund_bank,
		t2.refund_number,
		t2.refund_name,
		t2.refund_limit_month,
		t2.refund_day,
		t2.liquidated_damages,
		t2.wms_cre_credit_head_id,
		t2.create_user_id,
		t2.create_user_name,
		t2.create_timestamp,
		t2.last_update_user_id,
		t2.last_update_timestamp,
		t2.enable_flag,
		t1.salesman_shortcode,
		CONCAT(t1.salesman_name,"/",t1.salesman_shortcode) as salesman_name_str
		from wms_cre_credit_head t1
		,wms_cre_appro_borrow_protocol t2
		<where>
			t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id and
			t1.enable_flag=1 and t1.cre_type=1
			<if test="idList !=null">
				and t1.wms_cre_credit_head_id in
				<foreach collection="idList" index="index" item="wms_cre_credit_head_id"
					open="(" separator="," close=")">
					#{wms_cre_credit_head_id}
				</foreach>
			</if>
			<if test="salesman_name!=null or salesman_shortcode !=null">
				and (t1.salesman_name like#{salesman_name} or t1.salesman_shortcode
				like #{salesman_shortcode})
			</if>
			<if test="protocol_id_year_num!=null">
				and t2.protocol_id_year_num like '${protocol_id_year_num}'
			</if>
			<if test="debtor_name!=null">
				and t2.debtor_name like '${debtor_name}'
			</if>
			<if test="debtor_tel!=null">
				and t2.debtor_tel like '${debtor_tel}'
			</if>
		</where>
		<if test="sortname!=null and sortorder!=null">
			order by ${sortname} ${sortorder}
		</if>
	</select>
	<!-- 信贷放款申请信息列表分页 -->
	<select id="getMakeLoansListWithPaging" parameterType="map"
		resultType="java.util.HashMap">
		select
		t1.wms_cre_credit_head_id,
		t1.bill_code,
		t1.credit_purpose,
		t1.max_repayment_limit_per_month,
		t1.credit_limit,
		t1.max_repayment_time_limit,
		t1.enter_file_way,
		t1.payroll_payment_way,
		t1.data_type,
		t1.is_complete,
		t1.reference_type,
		t1.is_other_corporation_done,
		t1.is_to_public_stream,
		t1.is_house_certificate_original,
		t1.is_check,
		t1.person_condition,
		t1.salesman_id,
		t1.salesman_code,
		t1.salesman_name,
		t1.city,
		t1.cre_type,
		(case t1.cre_type when '1' then '信贷产品' when '2' then '房贷产品' end)as
		cre_type_name,
		t1.bill_status,
		(select value_meaning from wms_sys_dict_data where value_code =
		t1.bill_status and wms_sys_dict_id = 24)as bill_status_name,
		t1.water_appro_user_id,
		t1.water_appro_user_name,
		t1.water_appro_timestamp,
		date_format(t1.water_appro_timestamp,'%Y-%m -%d %H:%i:%s') as water_appro_timestamp,
		t1.water_appro_result,
		(case t1.water_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略' else
		'待审批' end)as water_appro_result_name,
		t1.info_appro_user_id,
		t1.info_appro_user_name,
		t1.info_appro_timestamp,
		date_format(t1.info_appro_timestamp,'%Y-%m -%d %H:%i:%s') as info_appro_timestamp,
		t1.info_appro_result,
		(case t1.info_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略' else
		'待审批' end) as info_appro_result_name,
		t1.phone_appro_user_id,
		t1.phone_appro_user_name,
		t1.phone_appro_timestamp,
		date_format(t1.phone_appro_timestamp,'%Y-%m -%d %H:%i:%s') as phone_appro_timestamp,
		t1.phone_appro_result,
		(case t1.phone_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略' else
		'待审批' end)as phone_appro_result_name,
		t1.certificate_appro_user_id,
		t1.certificate_appro_user_name,
		t1.certificate_appro_timestamp,
		date_format(t1.certificate_appro_timestamp,'%Y-%m -%d %H:%i:%s') as certificate_appro_timestamp,
		t1.certificate_appro_result,
		(case t1.certificate_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略'
		else '待审批' end)as certificate_appro_result_name,
		t1.create_user_id,
		t1.create_user_name,
		t1.create_timestamp,
		date_format(t1.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t1.last_update_user_id,
		t1.last_update_timestamp,
		date_format(t1.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
		t1.enable_flag,
		t1.protocol_amount,
		t1.is_link_repeat,
		t1.profession_type,
		t1.is_verify,
		t2.wms_cre_appro_id,
		t2.protocol_id_year,
		t2.protocol_id_num,
		t2.protocol_id_year_num,
		t2.protocol_date,
		t2.creditor_name,
		t2.creditor_identity_id,
		t2.debtor_name,
		t2.debtor_identity_id,
		t2.creditor_address,
		t2.debtor_address,
		t2.creditor_tel,
		t2.debtor_tel,
		t2.debtor_fixed_line,
		t2.principal_caps,
		t2.principal_lower,
		t2.borrow_deadline,
		t2.borrow_begin_date,
		t2.borrow_end_date,
		t2.borrow_purpose,
		t2.borrow_interest,
		t2.refund_bank,
		t2.refund_number,
		t2.refund_name,
		t2.refund_limit_month,
		t2.refund_day,
		t2.liquidated_damages,
		t2.wms_cre_credit_head_id,
		t2.create_user_id,
		t2.create_user_name,
		t2.create_timestamp,
		t2.last_update_user_id,
		t2.last_update_timestamp,
		t2.enable_flag,
		t2.interest,
		t2.principal,
		t2.loan_amount,
		t3.service_cost_month,
		t1.salesman_shortcode,
		CONCAT(t1.salesman_name,"/",t1.salesman_shortcode) as salesman_name_str
		from wms_cre_credit_head t1
		,wms_cre_appro_borrow_protocol t2,wms_cre_appro_service_protocol t3
		<where>
			t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id and
			t1.wms_cre_credit_head_id=t3.wms_cre_credit_head_id and
			t1.enable_flag=1 and t1.cre_type=1
			<if test="idList !=null">
				and t1.wms_cre_credit_head_id in
				<foreach collection="idList" index="index" item="wms_cre_credit_head_id"
					open="(" separator="," close=")">
					#{wms_cre_credit_head_id}
				</foreach>
			</if>
			<if test="salesman_name!=null or salesman_shortcode !=null">
				and (t1.salesman_name like '${salesman_name}' or t1.salesman_shortcode
				like '${salesman_shortcode}')
			</if>
			<if test="protocol_id_year_num!=null">
				and t2.protocol_id_year_num like'${protocol_id_year_num}'
			</if>
			<if test="debtor_name!=null">
				and t2.debtor_name like '${debtor_name}'
			</if>
			<if test="debtor_tel!=null">
				and t2.debtor_tel like '${debtor_tel}'
			</if>
		</where>
		<if test="sortname!=null and sortorder!=null">
			order by ${sortname} ${sortorder}
		</if>
		<if test="offset!=null and pagesize!=null">
			limit ${offset},${pagesize}
		</if>
	</select>
	<!-- 信贷放款申请总记录 -->
	<select id="getMakeLoansCount" parameterType="map" resultType="int">
		select count(t1.wms_cre_credit_head_id) as count
		from
		wms_cre_credit_head t1 ,wms_cre_appro_borrow_protocol t2
		<where>
			t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id and
			t1.enable_flag=1 and t1.cre_type=1
			<if test="idList !=null">
				and t1.wms_cre_credit_head_id in
				<foreach collection="idList" index="index" item="wms_cre_credit_head_id"
					open="(" separator="," close=")">
					#{wms_cre_credit_head_id}
				</foreach>
			</if>
			<if test="salesman_name!=null">
				and t1.salesman_name like '${salesman_name}'
			</if>
			<if test="protocol_id_year_num!=null">
				and t2.protocol_id_year_num like'${protocol_id_year_num}'
			</if>
			<if test="debtor_name!=null">
				and t2.debtor_name like '${debtor_name}'
			</if>
			<if test="debtor_tel!=null">
				and t2.debtor_tel like '${debtor_tel}'
			</if>
		</where>
	</select>
	<!-- 放款确认信息导出 -->
	<select id="getPaymentConfirmationListWithoutPaging"
		parameterType="map" resultType="java.util.HashMap">
		select
		t1.wms_cre_credit_head_id,
		t1.bill_code,
		t1.credit_purpose,
		t1.max_repayment_limit_per_month,
		t1.credit_limit,
		t1.max_repayment_time_limit,
		t1.enter_file_way,
		t1.payroll_payment_way,
		t1.data_type,
		t1.is_complete,
		t1.reference_type,
		t1.is_other_corporation_done,
		t1.is_to_public_stream,
		t1.is_house_certificate_original,
		t1.is_check,
		t1.person_condition,
		t1.salesman_id,
		t1.salesman_code,
		t1.salesman_name,
		(select value_meaning from wms_sys_dict_data where wms_sys_dict_id=25 and value_code=t1.create_user_city_code) as city,
		t1.cre_type,
		(select value_meaning from wms_sys_dict_data where wms_sys_dict_id=15 and value_code=t1.cre_type) as
		cre_type_name,
		t1.bill_status,
		(select value_meaning from wms_sys_dict_data where value_code =
		t1.bill_status and wms_sys_dict_id = 24)as bill_status_name,
		t1.water_appro_user_id,
		t1.water_appro_user_name,
		t1.water_appro_timestamp,
		date_format(t1.water_appro_timestamp,'%Y-%m -%d %H:%i:%s') as water_appro_timestamp,
		t1.water_appro_result,
		t1.info_appro_user_id,
		t1.info_appro_user_name,
		t1.info_appro_timestamp,
		date_format(t1.info_appro_timestamp,'%Y-%m -%d %H:%i:%s') as info_appro_timestamp,
		t1.info_appro_result,
		t1.phone_appro_user_id,
		t1.phone_appro_user_name,
		t1.phone_appro_timestamp,
		date_format(t1.phone_appro_timestamp,'%Y-%m -%d %H:%i:%s') as phone_appro_timestamp,
		t1.phone_appro_result,
		t1.certificate_appro_user_id,
		t1.certificate_appro_user_name,
		t1.certificate_appro_timestamp,
		date_format(t1.certificate_appro_timestamp,'%Y-%m -%d %H:%i:%s') as certificate_appro_timestamp,
		t1.certificate_appro_result,
		t1.create_user_id,
		t1.create_user_name,
		t1.create_timestamp,
		date_format(t1.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t1.last_update_user_id,
		t1.last_update_timestamp,
		date_format(t1.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
		t1.enable_flag,
		t1.protocol_amount,
		t1.is_link_repeat,
		t1.profession_type,
		t1.is_verify,
		t2.wms_cre_appro_id,
		t2.protocol_id_year,
		t2.protocol_id_num,
		t2.protocol_id_year_num,
		t2.protocol_date,
		t2.creditor_name,
		t2.creditor_identity_id,
		IFNULL(t2.debtor_name,t3.customer_name) as debtor_name,	
		t2.debtor_identity_id,
		t2.creditor_address,
		t2.debtor_address,
		t2.creditor_tel,
		IFNULL(t2.debtor_tel,t3.mobile_telephone1) as debtor_tel,
		t2.debtor_fixed_line,
		t2.principal_caps,
		t2.principal_lower,
		t2.borrow_deadline,
		t2.borrow_begin_date,
		t2.borrow_end_date,
		t2.borrow_purpose,
		t2.borrow_interest,
		t2.refund_bank,
		t2.refund_number,
		t2.refund_name,
		t2.refund_limit_month,
		t2.refund_day,
		t2.liquidated_damages,
		t2.wms_cre_credit_head_id,
		t2.create_user_id,
		t2.create_user_name,
		t2.create_timestamp,
		t2.last_update_user_id,
		t2.last_update_timestamp,
		t2.protocol_type,
		t2.enable_flag,
		t1.salesman_shortcode,
		CONCAT(t1.salesman_name,"/",t1.salesman_shortcode) as salesman_name_str,
		t1.is_xudai,
		t2.payment_contract_type,
		(case when t1.create_timestamp &lt; #{hprocess_time} then '1' else '2' end) as edition_num,
		(select ifnull(a.bill_code_group, '') from wms_cre_credit_group a where t1.wms_cre_credit_group_id = a.wms_cre_credit_group_id) as bill_code_group 
		from wms_cre_credit_head t1
		,wms_cre_appro_borrow_protocol t2
		left JOIN wms_cre_credit_line_customer_change_head t3 on t3.wms_cre_credit_head_id=t2.wms_cre_credit_head_id  and t3.enable_flag=1
		<where>
			t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id and
			t1.enable_flag=1 and t3.is_major=1
			<if test="idList !=null">
				and (t1.wms_cre_credit_head_id in
				<foreach collection="idList" index="index" item="wms_cre_credit_head_id"
					open="(" separator="," close=")">
					#{wms_cre_credit_head_id}
				</foreach>
				or (t1.is_workflow=0 and t1.wms_cre_credit_group_id  is not null and t1.bill_status='G'))
			</if>
			<if test="salesman_name!=null or salesman_shortcode !=null">
				and (t1.salesman_name like#{salesman_name} or t1.salesman_shortcode
				like #{salesman_shortcode})
			</if>
			<if test="cre_type==1">
				and t1.cre_type =#{cre_type}
				and t1.bill_status=6
			</if>
			<if test="cre_type==2">
				and t1.cre_type=#{cre_type}
				and t1.bill_status='G'
			</if>
			<if test="cre_type==3">
				and t1.cre_type=#{cre_type}
			</if>
			<if test="cre_type==null and cre_type=='' ">
				and (t1.bill_status=6 or t1.bill_status='G')
			</if>
			<if test="protocol_id_year_num!=null">
				and t2.protocol_id_year_num like'${protocol_id_year_num}'
			</if>
			<if test="debtor_name!=null">
				and t2.debtor_name like '${debtor_name}'
			</if>
			<if test="debtor_tel!=null">
				and t2.debtor_tel like '${debtor_tel}'
			</if>
			<if test="salesman_city_code != null">
                and t1.salesman_city_code = ${salesman_city_code}
            </if>
		</where>
		<if test="sortname!=null and sortorder!=null">
			order by ${sortname} ${sortorder}
		</if>
	</select>
	<!-- 放款确认列表分页 -->
	<select id="getPaymentConfirmationListWithPaging" parameterType="map"
		resultType="java.util.HashMap">
		select
		t1.wms_cre_credit_head_id,
		t1.bill_code,
		t1.credit_purpose,
		t1.max_repayment_limit_per_month,
		t1.credit_limit,
		t1.max_repayment_time_limit,
		t1.enter_file_way,
		t1.payroll_payment_way,
		t1.data_type,
		t1.is_complete,
		t1.reference_type,
		t1.is_other_corporation_done,
		t1.is_to_public_stream,
		t1.is_house_certificate_original,
		t1.is_check,
		t1.person_condition,
		t1.salesman_id,
		t1.salesman_code,
		t1.salesman_name,
		(select value_meaning from wms_sys_dict_data where wms_sys_dict_id=25 and value_code=t1.create_user_city_code) as city,
		t1.cre_type,
		(select value_meaning from wms_sys_dict_data where wms_sys_dict_id=15 and value_code=t1.cre_type) as
		cre_type_name,
		t1.bill_status,
		(select value_meaning from wms_sys_dict_data where value_code =
		t1.bill_status and wms_sys_dict_id = 24)as bill_status_name,
		t1.water_appro_user_id,
		t1.water_appro_user_name,
		t1.water_appro_timestamp,
		date_format(t1.water_appro_timestamp,'%Y-%m -%d %H:%i:%s') as water_appro_timestamp,
		t1.water_appro_result,
		t1.info_appro_user_id,
		t1.info_appro_user_name,
		t1.info_appro_timestamp,
		date_format(t1.info_appro_timestamp,'%Y-%m -%d %H:%i:%s') as info_appro_timestamp,
		t1.info_appro_result,
		t1.phone_appro_user_id,
		t1.phone_appro_user_name,
		t1.phone_appro_timestamp,
		date_format(t1.phone_appro_timestamp,'%Y-%m -%d %H:%i:%s') as phone_appro_timestamp,
		t1.phone_appro_result,
		t1.certificate_appro_user_id,
		t1.certificate_appro_user_name,
		t1.certificate_appro_timestamp,
		date_format(t1.certificate_appro_timestamp,'%Y-%m -%d %H:%i:%s') as certificate_appro_timestamp,
		t1.certificate_appro_result,
		t1.create_user_id,
		t1.create_user_name,
		t1.create_timestamp,
		date_format(t1.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t1.last_update_user_id,
		t1.last_update_timestamp,
		date_format(t1.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
		t1.enable_flag,
		t1.protocol_amount,
		t1.is_link_repeat,
		t1.profession_type,
		t1.is_verify,
		t1.version_number,
		t2.wms_cre_appro_id,
		t2.protocol_id_year,
		t2.protocol_id_num,
		t2.protocol_id_year_num,
		t2.protocol_date,
		t2.creditor_name,
		t2.creditor_identity_id,
		IFNULL(t2.debtor_name,t3.customer_name) as debtor_name,	
		t2.debtor_identity_id,
		t2.creditor_address,
		t2.debtor_address,
		t2.creditor_tel,
		IFNULL(t2.debtor_tel,t3.mobile_telephone1) as debtor_tel,
		t2.debtor_fixed_line,
		t2.principal_caps,
		t2.principal_lower,
		t2.borrow_deadline,
		t2.borrow_begin_date,
		t2.borrow_end_date,
		t2.borrow_purpose,
		t2.borrow_interest,
		t2.refund_bank,
		t2.refund_number,
		t2.refund_name,
		t2.refund_limit_month,
		t2.refund_day,
		t2.liquidated_damages,
		t2.wms_cre_credit_head_id,
		t2.create_user_id,
		t2.create_user_name,
		t2.create_timestamp,
		t2.last_update_user_id,
		t2.last_update_timestamp,
		t2.protocol_type,
		t2.enable_flag,
		t1.salesman_shortcode,
		CONCAT(t1.salesman_name,"/",t1.salesman_shortcode) as salesman_name_str,
		t1.is_xudai,
		t2.payment_contract_type,
		(case when t1.create_timestamp &lt; #{hprocess_time} then '1' else '2' end) as edition_num,
		ifnull(t1.wms_cre_credit_group_id, '') as wms_cre_credit_group_id,
		(select ifnull(a.bill_code_group, '') from wms_cre_credit_group a where t1.wms_cre_credit_group_id = a.wms_cre_credit_group_id) as bill_code_group
		from wms_cre_credit_head t1
		,wms_cre_appro_borrow_protocol t2
		left JOIN wms_cre_credit_line_customer_change_head t3 on t3.wms_cre_credit_head_id=t2.wms_cre_credit_head_id  and t3.enable_flag=1
		<where>
			t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id and
			t1.enable_flag=1 and t3.is_major=1
			<if test="idList !=null">
				and(t1.wms_cre_credit_head_id in
				<foreach collection="idList" index="index" item="wms_cre_credit_head_id"
					open="(" separator="," close=")">
					#{wms_cre_credit_head_id}
				</foreach>
				or (t1.is_workflow=0 and t1.wms_cre_credit_group_id  is not null and t1.bill_status='G'))
			</if>
			<if test="salesman_name!=null or salesman_shortcode !=null">
				and (t1.salesman_name like#{salesman_name} or t1.salesman_shortcode
				like #{salesman_shortcode})
			</if>
			<if test="cre_type==1">
				and t1.cre_type =#{cre_type}
				and t1.bill_status=6
			</if>
			<if test="cre_type==2">
				and t1.cre_type=#{cre_type}
				and t1.bill_status='G'
			</if>
			<if test="cre_type==3">
				and t1.cre_type=#{cre_type}
			</if>
			<if test="cre_type==null and cre_type=='' ">
				and (t1.bill_status=6 or t1.bill_status='G')
			</if>
			<if test="protocol_id_year_num!=null">
				and t2.protocol_id_year_num like'${protocol_id_year_num}'
			</if>
			<if test="debtor_name!=null">
				and t2.debtor_name like '${debtor_name}'
			</if>
			<if test="debtor_tel!=null">
				and t2.debtor_tel like '${debtor_tel}'
			</if>
			<if test="salesman_city_code != null">
			    and t1.salesman_city_code = ${salesman_city_code}
			</if>
		</where>
		<if test="sortname!=null and sortorder!=null">
			order by ${sortname} ${sortorder}
		</if>
		<if test="offset!=null and pagesize!=null">
			limit ${offset},${pagesize}
		</if>
	</select>
	<!-- 放款确认列表总记录数 -->
	<select id="getPaymentConfirmationCount" parameterType="map"
		resultType="int">
		select count(t1.wms_cre_credit_head_id) as count
		from
		wms_cre_credit_head t1 ,wms_cre_appro_borrow_protocol t2
		<where>
			t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id and
			t1.enable_flag=1
			<if test="idList !=null">
				and (t1.wms_cre_credit_head_id in
				<foreach collection="idList" index="index" item="wms_cre_credit_head_id"
					open="(" separator="," close=")">
					#{wms_cre_credit_head_id}
				</foreach>
				or (t1.is_workflow=0 and t1.wms_cre_credit_group_id  is not null and t1.bill_status='G'))
			</if>
			<if test="salesman_name!=null or salesman_shortcode !=null">
				and (t1.salesman_name like#{salesman_name} or t1.salesman_shortcode
				like #{salesman_shortcode})
			</if>
			<if test="cre_type==1">
				and t1.cre_type =#{cre_type}
				and t1.bill_status=6
			</if>
			<if test="cre_type==2">
				and t1.cre_type =#{cre_type}
				and t1.bill_status='G'
			</if>
			<if test="cre_type==null and cre_type==''">
				and (t1.bill_status=6 or t1.bill_status='G')
			</if>
			<if test="protocol_id_year_num!=null">
				and t2.protocol_id_year_num like'${protocol_id_year_num}'
			</if>
			<if test="debtor_name!=null">
				and t2.debtor_name like '${debtor_name}'
			</if>
			<if test="debtor_tel!=null">
				and t2.debtor_tel like '${debtor_tel}'
			</if>
			<if test="salesman_city_code != null">
                and t1.salesman_city_code = ${salesman_city_code}
            </if>
		</where>
	</select>
	<!-- 公证列表分页 -->
	<select id="getNotarizationListWithPaging" parameterType="map"
		resultType="java.util.HashMap">
		select
		t1.wms_cre_credit_head_id,
		t1.bill_code,
		t1.credit_purpose,
		t1.max_repayment_limit_per_month,
		t1.credit_limit,
		t1.max_repayment_time_limit,
		t1.enter_file_way,
		t1.payroll_payment_way,
		t1.data_type,
		t1.is_complete,
		t1.reference_type,
		t1.is_other_corporation_done,
		t1.is_to_public_stream,
		t1.is_house_certificate_original,
		t1.is_check,
		t1.person_condition,
		t1.salesman_id,
		t1.salesman_code,
		t1.salesman_name,
		t1.city,
		t1.cre_type,
		(case t1.cre_type when '1' then '信贷产品' when '2' then '房贷产品' end)as
		cre_type_name,
		t1.bill_status,
		(select value_meaning from wms_sys_dict_data where value_code =
		t1.bill_status and wms_sys_dict_id = 24)as bill_status_name,
		t1.water_appro_user_id,
		t1.water_appro_user_name,
		date_format(t1.water_appro_timestamp,'%Y-%m -%d %H:%i:%s') as water_appro_timestamp,
		t1.water_appro_result,
		t1.info_appro_user_id,
		t1.info_appro_user_name,
		date_format(t1.info_appro_timestamp,'%Y-%m -%d %H:%i:%s') as info_appro_timestamp,
		t1.info_appro_result,
		t1.phone_appro_user_id,
		t1.phone_appro_user_name,
		date_format(t1.phone_appro_timestamp,'%Y -%m -%d %H:%i:%s')as phone_appro_timestamp,
		t1.phone_appro_result,
		t1.certificate_appro_user_id,
		t1.certificate_appro_user_name,

		date_format(t1.certificate_appro_timestamp,'%Y -%m -%d %H:%i:%s') as certificate_appro_timestamp,
		t1.certificate_appro_result,

		t1.create_user_id,
		t1.create_user_name,
		date_format(t1.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t1.last_update_user_id,
		date_format(t1.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
		t1.enable_flag,
		t2.wms_cre_credit_line_customer_change_head_id,
		t2.wms_cre_credit_head_id,
		t2.wms_cus_customer_head_id,
		t2.customer_code,
		t2.customer_name,
		t2.customer_ever_name,
		t2.customer_category,
		t2.gender,
		t2.max_degree,
		date_format(t2.birthday,'%Y-%m-%d') as birthday,
		t2.id_card,
		t2.province,
		t2.city,
		t2.district,
		t2.address_more,
		t2.has_children,
		t2.children_name,
		t2.children_address,
		t2.children_telephone,
		t2.has_married,
		t2.has_house,
		t2.current_address_province,
		t2.current_address_city,
		t2.current_address_district,
		t2.current_address_more,
		t2.post_code,
		t2.fixed_telephone,
		t2.mobile_telephone1,
		t2.service_password1,
		t2.mobile_telephone2,
		t2.service_password2,
		t2.personal_year_income,
		t2.customer_email,
		t2.credit_card_limit,
		t2.common_occupants,
		t2.status,
		t2.create_user_id,
		t2.create_user_name,
		date_format(t2.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t2.last_update_user_id,
		date_format(t2.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
		t2.enable_flag,
		t1.salesman_shortcode,
		t1.create_user_city_code,
		<!--房贷流程版本号 1为老流程  2为新流程-->
		(case when t1.create_timestamp &lt; #{hprocess_time} then '1' else '2' end) as edition_num, 
		CONCAT(t1.salesman_name,"/",t1.salesman_shortcode) as salesman_name_str
		from wms_cre_credit_head
		t1,wms_cre_credit_line_customer_change_head t2
		<where>
			t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id and
			t1.enable_flag=1 and t2.is_major=1
			and t1.create_user_city_code =
			#{create_user_city_code}
			<if test="idList !=null">
				and (t1.wms_cre_credit_head_id in
				<foreach collection="idList" index="index" item="wms_cre_credit_head_id"
					open="(" separator="," close=")">
					#{wms_cre_credit_head_id}
				</foreach>
				or   t1.bill_status  in ('E','M') and t1.version_number!=2	and t1.is_workflow=0 and (SELECT wms_cre_housing_approval_info from wms_cre_housing_approval_info where  approval_task_type="公证" and enable_flag=1 and wms_cre_credit_head_id=t1.wms_cre_credit_head_id limit 0,1) is null)
			</if>
			<if test="idList ==null">
				 and ( t1.bill_status  in ('E','M')	and t1.version_number!=2 and t1.is_workflow=0 and (SELECT wms_cre_housing_approval_info from wms_cre_housing_approval_info where  approval_task_type="公证" and enable_flag=1 and wms_cre_credit_head_id=t1.wms_cre_credit_head_id limit 0,1) is null)
			</if>
			<if test="bill_code!=null">
				and t1.bill_code like #{bill_code}
			</if>
			<if test="create_timestamp!=null and create_timestamp1!=null">
				and t1.create_timestamp between #{create_timestamp} and
				#{create_timestamp1}
			</if>
			<if test="salesman_name!=null or salesman_shortcode !=null">
				and (t1.salesman_name like#{salesman_name} or
				t1.salesman_shortcode like #{salesman_shortcode})
			</if>
			<if test="id_card!=null">
				and t2.id_card =#{id_card}
			</if>
		</where>
		<if test="sortname != '' and sortorder !=''">
			ORDER BY ${sortname} ${sortorder}
		</if>
		<if test="offset != null and pagesize !=null">
			LIMIT ${offset} , ${pagesize}
		</if>
	</select>
	<!-- 公证列表信息导出 -->
	<select id="getNotarizationListWithoutPaging" parameterType="map"
		resultType="java.util.HashMap">
		select
		t1.wms_cre_credit_head_id,
		t1.bill_code,
		t1.credit_purpose,
		t1.max_repayment_limit_per_month,
		t1.credit_limit,
		t1.max_repayment_time_limit,
		t1.enter_file_way,
		t1.payroll_payment_way,
		t1.data_type,
		t1.is_complete,
		t1.reference_type,
		t1.is_other_corporation_done,
		t1.is_to_public_stream,
		t1.is_house_certificate_original,
		t1.is_check,
		t1.person_condition,
		t1.salesman_id,
		t1.salesman_code,
		t1.salesman_name,
		t1.city,
		t1.cre_type,
		(case t1.cre_type when '1' then '信贷产品' when '2' then '房贷产品' when '3' then '车贷产品' end)as
		cre_type_name,
		t1.bill_status,
		(select value_meaning from wms_sys_dict_data where value_code =
		t1.bill_status and wms_sys_dict_id = 24)as bill_status_name,
		t1.water_appro_user_id,
		t1.water_appro_user_name,
		date_format(t1.water_appro_timestamp,'%Y-%m -%d %H:%i:%s') as water_appro_timestamp,
		t1.water_appro_result,
		(case t1.water_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略' else
		'待审批' end)as water_appro_result_name,
		t1.info_appro_user_id,
		t1.info_appro_user_name,
		date_format(t1.info_appro_timestamp,'%Y-%m -%d %H:%i:%s') as info_appro_timestamp,
		t1.info_appro_result,
		(case t1.info_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略' else
		'待审批' end) as info_appro_result_name,
		t1.phone_appro_user_id,
		t1.phone_appro_user_name,
		date_format(t1.phone_appro_timestamp,'%Y -%m -%d %H:%i:%s')as phone_appro_timestamp,
		t1.phone_appro_result,
		(case t1.phone_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略' else
		'待审批' end)as phone_appro_result_name,
		t1.certificate_appro_user_id,
		t1.certificate_appro_user_name,
		date_format(t1.certificate_appro_timestamp,'%Y -%m -%d %H:%i:%s') as certificate_appro_timestamp,
		t1.certificate_appro_result,
		(case t1.certificate_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略'
		else '待审批' end)as certificate_appro_result_name,
		t1.create_user_id,
		t1.create_user_name,
		date_format(t1.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t1.last_update_user_id,
		date_format(t1.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
		t1.enable_flag,
		t2.wms_cre_credit_line_customer_change_head_id,
		t2.wms_cre_credit_head_id,
		t2.wms_cus_customer_head_id,
		t2.customer_code,
		t2.customer_name,
		t2.customer_ever_name,
		t2.customer_category,
		t2.gender,
		t2.max_degree,
		date_format(t2.birthday,'%Y-%m-%d') as birthday,
		t2.id_card,
		t2.province,
		t2.city,
		t2.district,
		t2.address_more,
		t2.has_children,
		t2.children_name,
		t2.children_address,
		t2.children_telephone,
		t2.has_married,
		t2.has_house,
		t2.current_address_province,
		t2.current_address_city,
		t2.current_address_district,
		t2.current_address_more,
		t2.post_code,
		t2.fixed_telephone,
		t2.mobile_telephone1,
		t2.service_password1,
		t2.mobile_telephone2,
		t2.service_password2,
		t2.personal_year_income,
		t2.customer_email,
		t2.credit_card_limit,
		t2.common_occupants,
		t2.status,
		t2.create_user_id,
		t2.create_user_name,
		date_format(t2.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t2.last_update_user_id,
		date_format(t2.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
		t2.enable_flag,
		t1.salesman_shortcode,
		t1.create_user_city_code,
		CONCAT(t1.salesman_name,"/",t1.salesman_shortcode) as salesman_name_str
		from wms_cre_credit_head
		t1,wms_cre_credit_line_customer_change_head t2
		<where>
			t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id and
			t1.enable_flag=1 and t2.is_major=1
			and t1.create_user_city_code =
			#{create_user_city_code}
			<if test="idList !=null">
				and (t1.wms_cre_credit_head_id in
				<foreach collection="idList" index="index" item="wms_cre_credit_head_id"
					open="(" separator="," close=")">
					#{wms_cre_credit_head_id}
				</foreach>
				or   t1.bill_status in ('E','M') and t1.version_number!=2	and t1.is_workflow=0 and (SELECT wms_cre_housing_approval_info from wms_cre_housing_approval_info where  approval_task_type="公证" and enable_flag=1 and wms_cre_credit_head_id=t1.wms_cre_credit_head_id limit 0,1) is null)
			</if>
			<if test="idList ==null">
				 and ( t1.bill_status  in ('E','M') and t1.version_number!=2	and t1.is_workflow=0 and (SELECT wms_cre_housing_approval_info from wms_cre_housing_approval_info where  approval_task_type="公证" and enable_flag=1 and wms_cre_credit_head_id=t1.wms_cre_credit_head_id limit 0,1) is null)
			</if>
			<if test="bill_code!=null">
				and t1.bill_code like #{bill_code}
			</if>
			<if test="create_timestamp!=null and create_timestamp1!=null">
				and t1.create_timestamp between #{create_timestamp} and
				#{create_timestamp1}
			</if>
			<if test="salesman_name!=null or salesman_shortcode !=null">
				and (t1.salesman_name like#{salesman_name} or
				t1.salesman_shortcode like #{salesman_shortcode})
			</if>
			<if test="id_card!=null">
				and t2.id_card =#{id_card}
			</if>
		</where>
		<if test="sortname != '' and sortorder !=''">
			ORDER BY ${sortname} ${sortorder}
		</if>
		<if test="offset != null and pagesize !=null">
			LIMIT ${offset} , ${pagesize}
		</if>
	</select>
	<!-- 公证列表总记录 -->
	<select id="getNotarizationCount" parameterType="map"
		resultType="int">
		select count(t1.wms_cre_credit_head_id) as count
		from
		wms_cre_credit_head t1 ,wms_cre_credit_line_customer_change_head t2
		<where>
			t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id and
			t1.enable_flag=1 and t2.is_major=1
			and t1.create_user_city_code = #{create_user_city_code}
			<if test="idList !=null">
				and (t1.wms_cre_credit_head_id in
				<foreach collection="idList" index="index" item="wms_cre_credit_head_id"
					open="(" separator="," close=")">
					#{wms_cre_credit_head_id}
				</foreach>
				or   t1.bill_status  in ('E','M') and t1.version_number!=2 and t1.is_workflow=0 and (SELECT wms_cre_housing_approval_info from wms_cre_housing_approval_info where  approval_task_type="公证" and enable_flag=1 and wms_cre_credit_head_id=t1.wms_cre_credit_head_id limit 0,1) is null)
			</if>
			<if test="idList ==null">
				 and ( t1.bill_status  in ('E','M') and t1.version_number!=2 and t1.is_workflow=0 and (SELECT wms_cre_housing_approval_info from wms_cre_housing_approval_info where  approval_task_type="公证" and enable_flag=1 and wms_cre_credit_head_id=t1.wms_cre_credit_head_id limit 0,1) is null)
			</if>
			<if test="bill_code!=null">
				and t1.bill_code like #{bill_code}
			</if>
			<if test="create_timestamp!=null and create_timestamp1!=null">
				and t1.create_timestamp between #{create_timestamp} and
				#{create_timestamp1}
			</if>
			<if test="salesman_name!=null or salesman_shortcode !=null">
				and (t1.salesman_name like#{salesman_name} or
				t1.salesman_shortcode like #{salesman_shortcode})
			</if>
			<if test="id_card!=null">
				and t2.id_card =#{id_card}
			</if>
		</where>
	</select>
	<!--他项列表分页 -->
	<select id="getOthersListWithPaging" parameterType="map"
		resultType="java.util.HashMap">
		select
		t1.wms_cre_credit_head_id,
		t1.bill_code,
		t1.credit_purpose,
		t1.max_repayment_limit_per_month,
		t1.credit_limit,
		t1.max_repayment_time_limit,
		t1.enter_file_way,
		t1.payroll_payment_way,
		t1.data_type,
		t1.is_complete,
		t1.reference_type,
		t1.is_other_corporation_done,
		t1.is_to_public_stream,
		t1.is_house_certificate_original,
		t1.is_check,
		t1.person_condition,
		t1.salesman_id,
		t1.salesman_code,
		t1.salesman_name,
		t1.city,
		t1.cre_type,
		(case t1.cre_type when '1' then '信贷产品' when '2' then '房贷产品' end)as
		cre_type_name,
		t1.bill_status,
		(select value_meaning from wms_sys_dict_data where value_code =
		t1.bill_status and wms_sys_dict_id = 24)as bill_status_name,
		t1.water_appro_user_id,
		t1.water_appro_user_name,
		date_format(t1.water_appro_timestamp,'%Y-%m -%d %H:%i:%s') as water_appro_timestamp,
		t1.water_appro_result,
		t1.info_appro_user_id,
		t1.info_appro_user_name,
		date_format(t1.info_appro_timestamp,'%Y-%m -%d %H:%i:%s') as info_appro_timestamp,
		t1.info_appro_result,
		t1.phone_appro_user_id,
		t1.phone_appro_user_name,
		date_format(t1.phone_appro_timestamp,'%Y -%m -%d %H:%i:%s')as phone_appro_timestamp,
		t1.phone_appro_result,
		t1.certificate_appro_user_id,
		t1.certificate_appro_user_name,

		date_format(t1.certificate_appro_timestamp,'%Y -%m -%d %H:%i:%s') as certificate_appro_timestamp,
		t1.certificate_appro_result,

		t1.create_user_id,
		t1.create_user_name,
		date_format(t1.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t1.last_update_user_id,
		date_format(t1.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
		t1.enable_flag,
		t2.wms_cre_credit_line_customer_change_head_id,
		t2.wms_cre_credit_head_id,
		t2.wms_cus_customer_head_id,
		t2.customer_code,
		t2.customer_name,
		t2.customer_ever_name,
		t2.customer_category,
		t2.gender,
		t2.max_degree,
		date_format(t2.birthday,'%Y-%m-%d') as birthday,
		t2.id_card,
		t2.province,
		t2.city,
		t2.district,
		t2.address_more,
		t2.has_children,
		t2.children_name,
		t2.children_address,
		t2.children_telephone,
		t2.has_married,
		t2.has_house,
		t2.current_address_province,
		t2.current_address_city,
		t2.current_address_district,
		t2.current_address_more,
		t2.post_code,
		t2.fixed_telephone,
		t2.mobile_telephone1,
		t2.service_password1,
		t2.mobile_telephone2,
		t2.service_password2,
		t2.personal_year_income,
		t2.customer_email,
		t2.credit_card_limit,
		t2.common_occupants,
		t2.status,
		t2.create_user_id,
		t2.create_user_name,
		date_format(t2.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t2.last_update_user_id,
		date_format(t2.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
		t2.enable_flag,
		t1.salesman_shortcode,
		t1.create_user_city_code,
		<!--房贷流程版本号 1为老流程  2为新流程-->
		(case when t1.create_timestamp &lt; #{hprocess_time} then '1' else '2' end) as edition_num, 
		CONCAT(t1.salesman_name,"/",t1.salesman_shortcode) as salesman_name_str
		from wms_cre_credit_head
		t1,wms_cre_credit_line_customer_change_head t2
		<where>
			t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id and
			t1.enable_flag=1 and t2.is_major=1
			and t1.create_user_city_code =
			#{create_user_city_code}
			<if test="idList !=null">
				and (t1.wms_cre_credit_head_id in
				<foreach collection="idList" index="index" item="wms_cre_credit_head_id"
					open="(" separator="," close=")">
					#{wms_cre_credit_head_id}
				</foreach>
				or   t1.bill_status  in ('E','M') and t1.version_number!=2	and t1.is_workflow=0 and (SELECT wms_cre_housing_approval_info from wms_cre_housing_approval_info where  approval_task_type="他项" and enable_flag=1 and wms_cre_credit_head_id=t1.wms_cre_credit_head_id limit 0,1) is null)
			</if>
			<if test="idList ==null">
				 and ( t1.bill_status  in ('E','M')	and t1.version_number!=2 and t1.is_workflow=0 and (SELECT wms_cre_housing_approval_info from wms_cre_housing_approval_info where  approval_task_type="他项" and enable_flag=1 and wms_cre_credit_head_id=t1.wms_cre_credit_head_id limit 0,1) is null)
			</if>
			<if test="bill_code!=null">
				and t1.bill_code like #{bill_code}
			</if>
			<if test="create_timestamp!=null and create_timestamp1!=null">
				and t1.create_timestamp between #{create_timestamp} and
				#{create_timestamp1}
			</if>
			<if test="salesman_name!=null or salesmam_shortcode !=null">
				and (t1.salesman_name like#{salesman_name} or
				t1.salesman_shortcode like #{salesman_shortcode})
			</if>
			<if test="id_card!=null">
				and t2.id_card =#{id_card}
			</if>
		</where>
		<if test="sortname != '' and sortorder !=''">
			ORDER BY ${sortname} ${sortorder}
		</if>
		<if test="offset != null and pagesize !=null">
			LIMIT ${offset} , ${pagesize}
		</if>
	</select>
	<!-- 他项列表信息导出 -->
	<select id="getOthersListWithoutPaging" parameterType="map"
		resultType="java.util.HashMap">
		select
		t1.wms_cre_credit_head_id,
		t1.bill_code,
		t1.credit_purpose,
		t1.max_repayment_limit_per_month,
		t1.credit_limit,
		t1.max_repayment_time_limit,
		t1.enter_file_way,
		t1.payroll_payment_way,
		t1.data_type,
		t1.is_complete,
		t1.reference_type,
		t1.is_other_corporation_done,
		t1.is_to_public_stream,
		t1.is_house_certificate_original,
		t1.is_check,
		t1.person_condition,
		t1.salesman_id,
		t1.salesman_code,
		t1.salesman_name,
		t1.city,
		t1.cre_type,
		(case t1.cre_type when '1' then '信贷产品' when '2' then '房贷产品' end)as
		cre_type_name,
		t1.bill_status,
		(select value_meaning from wms_sys_dict_data where value_code =
		t1.bill_status and wms_sys_dict_id = 24)as bill_status_name,
		t1.water_appro_user_id,
		t1.water_appro_user_name,
		date_format(water_appro_timestamp,'%Y-%m-%d %H:%i:%s') as water_appro_timestamp_str,
		t1.water_appro_timestamp,
		t1.water_appro_result,
		(case t1.water_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略' else
		'待审批' end)as water_appro_result_name,
		t1.info_appro_user_id,
		t1.info_appro_user_name,
		date_format(info_appro_timestamp,'%Y-%m-%d %H:%i:%s') as info_appro_timestamp_str,
		t1.info_appro_timestamp,
		t1.info_appro_result,
		t1.phone_appro_user_id,
		t1.phone_appro_user_name,
		date_format(t1.phone_appro_timestamp,'%Y-%m-%d %H:%i:%s') as phone_appro_timestamp_str,
		t1.phone_appro_timestamp,
		t1.phone_appro_result,
		t1.certificate_appro_user_id,
		t1.certificate_appro_user_name,
		date_format(t1.certificate_appro_timestamp,'%Y-%m-%d %H:%i:%s') as certificate_appro_timestamp_str,
		t1.certificate_appro_timestamp,
		t1.certificate_appro_result,
		t1.create_user_id,
		t1.create_user_name,
<!-- 		date_format(t1.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp_str, -->
		date_format(t1.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t1.create_timestamp,
		t1.last_update_user_id,
		date_format(t1.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp_str,
		t1.last_update_timestamp,
		t1.enable_flag,
		t1.protocol_amount,
		t1.is_link_repeat,
		t1.profession_type,
		t1.is_verify,
		t1.is_guarantee,
		t1.house_appro_user_id,
		t1.house_appro_user_name,
		date_format(t1.house_appro_timestamp,'%Y-%m-%d %H:%i:%s') as house_appro_timestamp_str,
		t1.house_appro_timestamp,
		t1.house_appro_result,
		t2.wms_cre_credit_line_customer_change_head_id,
		t2.wms_cre_credit_head_id,
		t2.wms_cus_customer_head_id,
		t2.customer_code,
		t2.customer_name,
		t2.customer_ever_name,
		t2.customer_category,
		t2.gender,
		t2.max_degree,
		date_format(t2.birthday,'%Y-%m-%d') as birthday,
		t2.id_card,
		t2.province,
		t2.city,
		t2.district,
		t2.address_more,
		t2.has_children,
		t2.children_name,
		t2.children_address,
		t2.children_telephone,
		t2.has_married,
		t2.has_house,
		t2.current_address_province,
		t2.current_address_city,
		t2.current_address_district,
		t2.current_address_more,
		t2.post_code,
		t2.fixed_telephone,
		t2.mobile_telephone1,
		t2.service_password1,
		t2.mobile_telephone2,
		t2.service_password2,
		t2.personal_year_income,
		t2.customer_email,
		t2.credit_card_limit,
		t2.common_occupants,
		t2.status,
		t2.create_user_id,
		t2.create_user_name,
		date_format(t2.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t2.last_update_user_id,
		date_format(t2.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
		t2.enable_flag,
		t1.salesman_shortcode,
		t1.create_user_city_code,
		CONCAT(t1.salesman_name,"/",t1.salesman_shortcode) as salesman_name_str
		from wms_cre_credit_head
		t1,wms_cre_credit_line_customer_change_head t2
		<where>
			t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id and
			t1.enable_flag=1 and t2.is_major=1
			and t1.create_user_city_code =
			#{create_user_city_code}
			<if test="idList !=null">
				and (t1.wms_cre_credit_head_id in
				<foreach collection="idList" index="index" item="wms_cre_credit_head_id"
					open="(" separator="," close=")">
					#{wms_cre_credit_head_id}
				</foreach>
				or   t1.bill_status  in ('E','M') and t1.version_number!=2	and t1.is_workflow=0 and (SELECT wms_cre_housing_approval_info from wms_cre_housing_approval_info where  approval_task_type="他项" and enable_flag=1 and wms_cre_credit_head_id=t1.wms_cre_credit_head_id limit 0,1) is null)
			</if>
			<if test="idList ==null">
				  and ( t1.bill_status  in ('E','M') and t1.version_number!=2	and t1.is_workflow=0 and (SELECT wms_cre_housing_approval_info from wms_cre_housing_approval_info where  approval_task_type="他项" and enable_flag=1 and wms_cre_credit_head_id=t1.wms_cre_credit_head_id limit 0,1) is null)
			</if>
			<if test="bill_code!=null">
				and t1.bill_code like #{bill_code}
			</if>
			<if test="create_timestamp!=null and create_timestamp1!=null">
				and t1.create_timestamp between #{create_timestamp} and
				#{create_timestamp1}
			</if>
			<if test="salesman_name!=null or salesman_shortcode !=null">
				and (t1.salesman_name like#{salesman_name} or
				t1.salesman_shortcode like #{salesman_shortcode})
			</if>
			<if test="id_card!=null">
				and t2.id_card =#{id_card}
			</if>
		</where>
		<if test="sortname != '' and sortorder !=''">
			ORDER BY ${sortname} ${sortorder}
		</if>
		<if test="offset != null and pagesize !=null">
			LIMIT ${offset} , ${pagesize}
		</if>
	</select>
	<!-- 他项列表总记录 -->
	<select id="getOthersCount" parameterType="map" resultType="int">
		select count(t1.wms_cre_credit_head_id) as count
		from
		wms_cre_credit_head t1 ,wms_cre_credit_line_customer_change_head t2
		<where>
			t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id and
			t1.enable_flag=1 and t2.is_major=1
			and t1.create_user_city_code = #{create_user_city_code}
			<if test="idList !=null">
				and (t1.wms_cre_credit_head_id in
				<foreach collection="idList" index="index" item="wms_cre_credit_head_id"
					open="(" separator="," close=")">
					#{wms_cre_credit_head_id}
				</foreach>
				or   t1.bill_status  in ('E','M') and t1.version_number!=2	and t1.is_workflow=0 and (SELECT wms_cre_housing_approval_info from wms_cre_housing_approval_info where  approval_task_type="他项" and enable_flag=1 and wms_cre_credit_head_id=t1.wms_cre_credit_head_id limit 0,1) is null)
			</if>
			<if test="idList ==null">
				 and ( t1.bill_status  in ('E','M')	and t1.version_number!=2 and t1.is_workflow=0  and (SELECT wms_cre_housing_approval_info from wms_cre_housing_approval_info where  approval_task_type="他项" and enable_flag=1 and wms_cre_credit_head_id=t1.wms_cre_credit_head_id limit 0,1) is null)
			</if>
			<if test="bill_code!=null">
				and t1.bill_code like #{bill_code}
			</if>
			<if test="create_timestamp!=null and create_timestamp1!=null">
				and t1.create_timestamp between #{create_timestamp} and
				#{create_timestamp1}
			</if>
			<if test="salesman_name!=null or salesman_shortcode !=null">
				and (t1.salesman_name like#{salesman_name} or
				t1.salesman_shortcode like #{salesman_shortcode})
			</if>
			<if test="id_card!=null">
				and t2.id_card =#{id_card}
			</if>
		</where>
	</select>
	<!-- list 房贷终审列表 -->
	<select id="searchforhouse" parameterType="map" resultType="java.util.HashMap">
		select
		t1.wms_cre_credit_head_id,
		t1.bill_code,
		t1.credit_purpose,
		t1.max_repayment_limit_per_month,
		t1.credit_limit,
		t1.appro_limit,
		t1.visa_limit,
		t1.max_repayment_time_limit,
		t1.enter_file_way,
		t1.payroll_payment_way,
		t1.data_type,
		t1.is_complete,
		t1.reference_type,
		t1.is_other_corporation_done,
		t1.is_to_public_stream,
		t1.is_house_certificate_original,
		t1.is_check,
		t1.person_condition,
		t1.salesman_id,
		t1.salesman_code,
		t1.salesman_name,
		t1.city,
		t1.cre_type,
		t1.bill_status,
		(select value_meaning from wms_sys_dict_data where value_code =
		t1.bill_status and wms_sys_dict_id = 131)as bill_status_name,
		t1.water_appro_user_id,
		t1.water_appro_user_name,
		date_format(water_appro_timestamp,'%Y-%m-%d %H:%i:%s') as water_appro_timestamp_str,
		t1.water_appro_timestamp,
		t1.water_appro_result,
		(case t1.water_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略' else
		'待审批' end)as water_appro_result_name,
		t1.info_appro_user_id,
		t1.info_appro_user_name,
		date_format(info_appro_timestamp,'%Y-%m-%d %H:%i:%s') as info_appro_timestamp_str,
		t1.info_appro_timestamp,
		t1.info_appro_result,
		(case t1.info_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略' else
		'待审批' end)as info_appro_result_name,
		t1.phone_appro_user_id,
		t1.phone_appro_user_name,
		date_format(t1.phone_appro_timestamp,'%Y-%m-%d %H:%i:%s') as phone_appro_timestamp_str,
		t1.phone_appro_timestamp,
		t1.phone_appro_result,
		(case t1.phone_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略' else
		'待审批' end)as phone_appro_result_name,
		t1.certificate_appro_user_id,
		t1.certificate_appro_user_name,
		date_format(t1.certificate_appro_timestamp,'%Y-%m-%d %H:%i:%s') as certificate_appro_timestamp_str,
		t1.certificate_appro_timestamp,
		t1.certificate_appro_result,
		(case t1.certificate_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略'
		else '待审批' end)as certificate_appro_result_name,
		t1.create_user_id,
		t1.create_user_name,
		date_format(t1.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp_str,
		<!--  t1.create_timestamp,-->
		t1.last_update_user_id,
		date_format(t1.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp_str,
		t1.last_update_timestamp,
		t1.enable_flag,
		t1.protocol_amount,
		t1.is_link_repeat,
		t1.profession_type,
		t1.is_verify,
		t1.is_guarantee,
		t1.house_appro_user_id,
		t1.house_appro_user_name,
		date_format(t1.house_appro_timestamp,'%Y-%m-%d %H:%i:%s') as house_appro_timestamp_str,
		t1.house_appro_timestamp,
		t1.house_appro_result,
		(case t1.house_appro_result when '0' then '不符合' when '1' then '符合' else
		'待审批' end)as house_appro_result_name,
		t1.cre_loan_type,
		t1.model_one_amount,
		t1.model_two_amount,
		t1.model_three_amount,
		t1.model_four_amount,
		t1.version_number,
		t1.assessment_id,
		t1.assessment_datetime,
		t1.assessment_result,
		(case t1.assessment_result when '1' then '通过' when '2' then '退件' when '3' then '拒件'when '4' then '直接验房' else
		'待审批' end)as assessment_result_name,
		t1.assessment_advice,
		t1.assessment_result_page,
		t2.wms_cre_credit_line_customer_change_head_id,
		t2.wms_cre_credit_head_id,
		t2.wms_cus_customer_head_id,
		t2.customer_code,
		t2.customer_name,
		t2.customer_ever_name,
		t2.customer_category,
		t2.gender,
		t2.max_degree,
		date_format(t2.birthday,'%Y-%m-%d') as birthday,
		t2.id_card,
		t2.province,
		t2.city,
		t2.district,
		t2.address_more,
		t2.has_children,
		t2.children_name,
		t2.children_address,
		t2.children_telephone,
		t2.has_married,
		t2.has_house,
		t2.current_address_province,
		t2.current_address_city,
		t2.current_address_district,
		t2.current_address_more,
		t2.post_code,
		t2.fixed_telephone,
		t2.mobile_telephone1,
		t2.service_password1,
		t2.mobile_telephone2,
		t2.service_password2,
		t2.personal_year_income,
		t2.customer_email,
		t2.credit_card_limit,
		t2.common_occupants,
		t2.status,
		t2.create_user_id,
		t2.create_user_name,
		date_format(t2.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t2.last_update_user_id,
		date_format(t2.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
		t2.enable_flag,
		t1.salesman_shortcode,
		t1.salesman_city_code,
		t1.create_user_city_code,
		(case when t1.create_timestamp &lt; #{hprocess_time} then '1' else '2' end) as edition_num, 
		CONCAT(t1.salesman_name,"/",t1.salesman_shortcode) as salesman_name_str,
		t3.credit_confirm_result,
		t4.vehicle_evaluation_price
		from wms_cre_credit_head
		t1,wms_cre_credit_line_customer_change_head t2
		LEFT JOIN wms_cre_housing_credit_confirm t3 ON t2.wms_cre_credit_head_id=t3.wms_cre_credit_head_id 
		and t3.enable_flag='1'
		LEFT JOIN wms_cre_housing_trial_assessment t4 ON t2.wms_cre_credit_head_id=t4.wms_cre_credit_head_id 
		and t4.enable_flag='1'
		<where>
			t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id and
			t1.enable_flag=1 and t2.is_major=1 and t1.cre_type='2'
			and t1.bill_status in ('E','EH')
			and t1.version_number='3'
			<if test="idList !=null">
				and t1.wms_cre_credit_head_id in
				<foreach collection="idList" index="index" item="wms_cre_credit_head_id"
					open="(" separator="," close=")">
					#{wms_cre_credit_head_id}
				</foreach>
			</if>
			<if test="bill_code!=null">
				and t1.bill_code like #{bill_code}
			</if>
			<if test="create_timestamp!=null and create_timestamp1!=null">
				and t1.create_timestamp between #{create_timestamp} and
				#{create_timestamp1}
			</if>
			<if test="salesman_name!=null or salesman_shortcode !=null">
				and (t1.salesman_name like#{salesman_name} or
				t1.salesman_shortcode like #{salesman_shortcode})
			</if>
			<if test="customer_name != null">
				and t2.customer_name like '${customer_name}'
			</if>
			<if test="id_card!=null">
				and t2.id_card =#{id_card}
			</if>
			<if test="salesman_city_code != null">
                and t1.salesman_city_code = #{salesman_city_code}
            </if>
            <if test="bill_status != null">
                and t1.bill_status = #{bill_status}
            </if>
             <!-- 权限控制 -->
			<if test="childrendept != null">
				and (FIND_IN_SET(t1.salesman_dept_id, #{childrendept}) > 0)
			</if>
		</where>
		<if test="sortname != '' and sortorder !=''">
			ORDER BY ${sortname} ${sortorder}
		</if>
		<if test="offset != null and pagesize !=null">
			LIMIT ${offset} , ${pagesize}
		</if>
	</select>


	<!-- list 房贷终审列表 总数 -->
	<select id="findCountforhouse" parameterType="map" resultType="int">
		select count(t1.wms_cre_credit_head_id) as count
		from wms_cre_credit_head
		t1,wms_cre_credit_line_customer_change_head t2
		LEFT JOIN wms_cre_housing_credit_confirm t3 ON t2.wms_cre_credit_head_id=t3.wms_cre_credit_head_id 
		and t3.enable_flag='1'
		<where>
			t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id and
			t1.enable_flag=1 and t2.is_major=1 and t1.cre_type='2'
			and t1.bill_status in ('E','EH')
			and t1.version_number='3'
			<if test="idList !=null">
				and t1.wms_cre_credit_head_id in
				<foreach collection="idList" index="index" item="wms_cre_credit_head_id"
					open="(" separator="," close=")">
					#{wms_cre_credit_head_id}
				</foreach>
			</if>
			<if test="bill_code!=null">
				and t1.bill_code like #{bill_code}
			</if>
			<if test="create_timestamp!=null and create_timestamp1!=null">
				and t1.create_timestamp between #{create_timestamp} and
				#{create_timestamp1}
			</if>
			<if test="salesman_name!=null">
				and t1.salesman_name like#{salesman_name}
			</if>
			<if test="customer_name != null">
				and t2.customer_name like '${customer_name}'
			</if>
			<if test="id_card!=null">
				and t2.id_card =#{id_card}
			</if>
			<if test="salesman_city_code != null">
                and t1.salesman_city_code = #{salesman_city_code}
            </if>
            <if test="bill_status != null">
                and t1.bill_status = #{bill_status}
            </if>
            <!-- 权限控制 -->
			<if test="childrendept != null">
				and (FIND_IN_SET(t1.salesman_dept_id, #{childrendept}) > 0)
			</if>
		</where>
	</select>
	<!-- 房贷放款申请列表数据导出 -->
	<select id="getHousingMakeLoansListWithoutPaging" parameterType="map"
		resultType="java.util.HashMap">
		select
		t1.wms_cre_credit_head_id,
		t1.bill_code,
		t1.credit_purpose,
		t1.max_repayment_limit_per_month,
		t1.credit_limit,
		t1.max_repayment_time_limit,
		t1.enter_file_way,
		t1.payroll_payment_way,
		t1.data_type,
		t1.is_complete,
		t1.reference_type,
		t1.is_other_corporation_done,
		t1.is_to_public_stream,
		t1.is_house_certificate_original,
		t1.is_check,
		t1.person_condition,
		t1.salesman_id,
		t1.salesman_code,
		t1.salesman_name,
		t1.city,
		t1.cre_type,
		(case t1.cre_type when '1' then '信贷产品' when '2' then '房贷产品' end)as
		cre_type_name,
		(select value_meaning from wms_sys_dict_data where value_code =
		ifnull(t2.cre_loan_type, t1.cre_loan_type) and wms_sys_dict_id = 102) as cre_loan_type_name,
		t1.bill_status,
		(select value_meaning from wms_sys_dict_data where value_code =
		t1.bill_status and wms_sys_dict_id = 24)as bill_status_name,
		t1.water_appro_user_id,
		t1.water_appro_user_name,
		t1.water_appro_timestamp,
		date_format(t1.water_appro_timestamp,'%Y-%m -%d %H:%i:%s') as water_appro_timestamp,
		t1.water_appro_result,
		(case t1.water_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略' else
		'待审批' end)as water_appro_result_name,
		t1.info_appro_user_id,
		t1.info_appro_user_name,
		t1.info_appro_timestamp,
		date_format(t1.info_appro_timestamp,'%Y-%m -%d %H:%i:%s') as info_appro_timestamp,
		t1.info_appro_result,
		(case t1.info_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略' else
		'待审批' end) as info_appro_result_name,
		t1.phone_appro_user_id,
		t1.phone_appro_user_name,
		t1.phone_appro_timestamp,
		date_format(t1.phone_appro_timestamp,'%Y-%m -%d %H:%i:%s') as phone_appro_timestamp,
		t1.phone_appro_result,
		(case t1.phone_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略' else
		'待审批' end)as phone_appro_result_name,
		t1.certificate_appro_user_id,
		t1.certificate_appro_user_name,
		t1.certificate_appro_timestamp,
		date_format(t1.certificate_appro_timestamp,'%Y-%m -%d %H:%i:%s') as certificate_appro_timestamp,
		t1.certificate_appro_result,
		(case t1.certificate_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略'
		else '待审批' end)as certificate_appro_result_name,
		t1.create_user_id,
		t1.create_user_name,
		t1.create_timestamp,
		date_format(t1.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t1.last_update_user_id,
		t1.last_update_timestamp,
		date_format(t1.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
		t1.enable_flag,
		t1.protocol_amount,
		t1.is_link_repeat,
		t1.profession_type,
		t1.is_verify,
		t2.wms_cre_appro_id,
		t2.protocol_id_year,
		t2.protocol_id_num,
		t2.protocol_id_year_num,
		t2.protocol_date,
		t2.creditor_name,
		t2.creditor_identity_id,
		t2.debtor_name,
		t2.debtor_identity_id,
		t2.creditor_address,
		t2.debtor_address,
		t2.creditor_tel,
		t2.debtor_tel,
		t2.debtor_fixed_line,
		t2.principal_caps,
		t2.principal_lower,
		t2.borrow_deadline,
		t2.borrow_begin_date,
		t2.borrow_end_date,
		t2.borrow_purpose,
		t2.borrow_interest,
		t2.refund_bank,
		t2.refund_number,
		t2.refund_name,
		t2.refund_limit_month,
		t2.refund_day,
		t2.liquidated_damages,
		t2.wms_cre_credit_head_id,
		t2.create_user_id,
		t2.create_user_name,
		t2.create_timestamp,
		t2.last_update_user_id,
		t2.last_update_timestamp,
		t2.enable_flag,
		t1.salesman_shortcode,
		CONCAT(t1.salesman_name,"/",t1.salesman_shortcode) as salesman_name_str,
		(select ifnull(a.bill_code_group, '') from wms_cre_credit_group a where t1.wms_cre_credit_group_id = a.wms_cre_credit_group_id) as bill_code_group
		from wms_cre_credit_head t1
		,wms_cre_appro_borrow_protocol t2
		<where>
			t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id and
			t1.enable_flag=1 and t1.cre_type=2
		    and t1.version_number='3'
			<if test="idList !=null">
				and t1.wms_cre_credit_head_id in
				<foreach collection="idList" index="index" item="wms_cre_credit_head_id"
					open="(" separator="," close=")">
					#{wms_cre_credit_head_id}
				</foreach>
			</if>
			<if test="salesman_name!=null or salesman_shortcode !=null">
				and (t1.salesman_name like#{salesman_name} or t1.salesman_shortcode
				like #{salesman_shortcode})
			</if>
			<if test="create_user_city_code != null">
                and t1.create_user_city_code = #{create_user_city_code}
            </if>
			<if test="protocol_id_year_num!=null">
				and t2.protocol_id_year_num like'${protocol_id_year_num}'
			</if>
			<if test="debtor_name!=null">
				and t2.debtor_name like '${debtor_name}'
			</if>
			<if test="debtor_tel!=null">
				and t2.debtor_tel like '${debtor_tel}'
			</if>
			<if test="salesman_city_code != null">
			    and t1.salesman_city_code = ${salesman_city_code}
			</if>
			<if test="bill_status != null">
                and t1.bill_status = #{bill_status}
            </if>
            <if test="bill_code != null">
                and t1.bill_code like '${bill_code}'
            </if>
            <if test="protocol_date_begin != null">
                and t2.protocol_date &gt;= #{protocol_date_begin}
            </if>
            <if test="protocol_date_end != null">
                and t2.protocol_date &lt;= #{protocol_date_end}
            </if>
             <!-- 权限控制 -->
			<if test="childrendept != null">
				and (FIND_IN_SET(t1.salesman_dept_id, #{childrendept}) > 0)
			</if>
		</where>
		<if test="sortname!=null and sortorder!=null">
			order by ${sortname} ${sortorder}
		</if>
	</select>
	<!-- 房贷放款申请审核信息列表分页 -->
	<select id="getHousingMakeLoansListWithPaging" parameterType="map"
		resultType="java.util.HashMap">
		select
		t1.wms_cre_credit_head_id,
		t1.bill_code,
		t1.credit_purpose,
		t1.max_repayment_limit_per_month,
		t1.credit_limit,
		t1.max_repayment_time_limit,
		t1.enter_file_way,
		t1.payroll_payment_way,
		t1.data_type,
		t1.is_complete,
		t1.reference_type,
		t1.is_other_corporation_done,
		t1.is_to_public_stream,
		t1.is_house_certificate_original,
		t1.is_check,
		t1.person_condition,
		t1.salesman_id,
		t1.salesman_code,
		t1.salesman_name,
		t1.city,
		t1.cre_type,
		(case t1.cre_type when '1' then '信贷产品' when '2' then '房贷产品' end)as
		cre_type_name,
		t1.bill_status,
		(select value_meaning from wms_sys_dict_data where value_code =
		t1.bill_status and wms_sys_dict_id = 131)as bill_status_name,
		t1.water_appro_user_id,
		t1.water_appro_user_name,
		t1.water_appro_timestamp,
		IFNULL(t2.cre_loan_type, t1.cre_loan_type) as cre_loan_type,
		(select value_meaning from wms_sys_dict_data where value_code =
		ifnull(t2.cre_loan_type, t1.cre_loan_type) and wms_sys_dict_id = 102) as cre_loan_type_name,
		date_format(t1.water_appro_timestamp,'%Y-%m -%d %H:%i:%s') as water_appro_timestamp,
		t1.water_appro_result,
		(case t1.water_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略' else
		'待审批' end)as water_appro_result_name,
		t1.info_appro_user_id,
		t1.info_appro_user_name,
		t1.info_appro_timestamp,
		date_format(t1.info_appro_timestamp,'%Y-%m -%d %H:%i:%s') as info_appro_timestamp,
		t1.info_appro_result,
		(case t1.info_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略' else
		'待审批' end) as info_appro_result_name,
		t1.phone_appro_user_id,
		t1.phone_appro_user_name,
		t1.phone_appro_timestamp,
		date_format(t1.phone_appro_timestamp,'%Y-%m -%d %H:%i:%s') as phone_appro_timestamp,
		t1.phone_appro_result,
		(case t1.phone_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略' else
		'待审批' end)as phone_appro_result_name,
		t1.certificate_appro_user_id,
		t1.certificate_appro_user_name,
		t1.certificate_appro_timestamp,
		date_format(t1.certificate_appro_timestamp,'%Y-%m -%d %H:%i:%s') as certificate_appro_timestamp,
		t1.certificate_appro_result,
		(case t1.certificate_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略'
		else '待审批' end)as certificate_appro_result_name,
		t1.create_user_id,
		t1.create_user_name,
		t1.create_timestamp,
		date_format(t1.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t1.last_update_user_id,
		t1.last_update_timestamp,
		date_format(t1.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
		t1.enable_flag,
		t1.protocol_amount,
		t1.is_link_repeat,
		t1.profession_type,
		t1.is_verify,
		t1.version_number,
	    t1.is_workflow,
		t2.wms_cre_appro_id,
		t2.protocol_id_year,
		t2.protocol_id_num,
		t2.protocol_id_year_num,
		t2.protocol_date,
		t2.creditor_name,
		t2.creditor_identity_id,
		IFNULL(t2.debtor_name,t3.customer_name) as debtor_name,
		t2.debtor_identity_id,
		t2.creditor_address,
		t2.debtor_address,
		t2.creditor_tel,
		IFNULL(t2.debtor_tel,t3.mobile_telephone1) as debtor_tel,
		t2.debtor_fixed_line,
		t2.principal_caps,
		t2.principal_lower,
		t2.borrow_deadline,
		t2.borrow_begin_date,
		t2.borrow_end_date,
		t2.borrow_purpose,
		t2.borrow_interest,
		t2.refund_bank,
		t2.refund_number,
		t2.refund_name,
		t2.refund_limit_month,
		t2.refund_day,
		t2.liquidated_damages,
		t2.wms_cre_credit_head_id,
		t2.create_user_id,
		t2.create_user_name,
		t2.create_timestamp,
		t2.last_update_user_id,
		t2.last_update_timestamp,
		t2.protocol_type,
		t2.enable_flag,
		t2.loan_amount,
		t1.salesman_shortcode,
		t2.it_cost_fee,
		t2.expedited_fee,
		CONCAT(t1.salesman_name,"/",t1.salesman_shortcode) as salesman_name_str,
		ifnull(t1.wms_cre_credit_group_id, '') as wms_cre_credit_group_id,
		ifnull(t4.bill_code_group, '') as bill_code_group
		from wms_cre_credit_head t1
		left join wms_cre_appro_borrow_protocol t2 on t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id and t2.enable_flag=1
		left JOIN wms_cre_credit_line_customer_change_head t3 on t3.wms_cre_credit_head_id=t1.wms_cre_credit_head_id  and t3.enable_flag=1
		left join wms_cre_credit_group t4 on t1.wms_cre_credit_group_id = t4.wms_cre_credit_group_id
		<where>
			t1.enable_flag=1 and t1.cre_type=2
			and t3.is_major=1
			and t1.version_number='3'
			<if test="idList !=null">
				and t1.wms_cre_credit_head_id in
				<foreach collection="idList" index="index" item="wms_cre_credit_head_id"
					open="(" separator="," close=")">
					#{wms_cre_credit_head_id}
				</foreach>
			</if>
			<if test="create_user_city_code != null">
                and t1.create_user_city_code = #{create_user_city_code}
            </if>
			<if test="salesman_name!=null or salesman_shortcode !=null">
				and (t1.salesman_name like#{salesman_name} or t1.salesman_shortcode
				like #{salesman_shortcode})
			</if>
			<if test="protocol_id_year_num!=null">
				and t2.protocol_id_year_num like'${protocol_id_year_num}'
			</if>
			<if test="debtor_name!=null">
				and IFNULL(t2.debtor_name,t3.customer_name) like #{debtor_name}
			</if>
			<if test="debtor_tel!=null">
				and IFNULL(t2.debtor_tel,t3.mobile_telephone1) like #{debtor_tel}
			</if>
			<if test="salesman_city_code != null">
                and t1.salesman_city_code = ${salesman_city_code}
            </if>
            <if test="bill_status != null">
                and t1.bill_status = #{bill_status}
            </if>
            <if test="bill_code != null">
                and t1.bill_code like '${bill_code}'
            </if>
            <if test="protocol_date_begin != null">
                and t2.protocol_date &gt;= #{protocol_date_begin}
            </if>
            <if test="protocol_date_end != null">
                and t2.protocol_date &lt;= #{protocol_date_end}
            </if>
             <!-- 权限控制 -->
			<if test="childrendept != null">
				and (FIND_IN_SET(t1.salesman_dept_id, #{childrendept}) > 0)
			</if>
		</where>
		<if test="sortname!=null and sortorder!=null">
			order by ${sortname} ${sortorder}
		</if>
		<if test="offset!=null and pagesize!=null">
			limit ${offset},${pagesize}
		</if>
	</select>
	<!-- 房贷放款申请审核总记录 -->
	<select id="getHousingMakeLoansCount" parameterType="map"
		resultType="int">
		select count(t1.wms_cre_credit_head_id) as count
		from
		wms_cre_credit_head t1 ,wms_cre_appro_borrow_protocol t2
		<where>
			t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id and
			t1.enable_flag=1 and t1.cre_type=2
			and t1.version_number='3'
			<if test="idList !=null">
				and t1.wms_cre_credit_head_id in
				<foreach collection="idList" index="index" item="wms_cre_credit_head_id"
					open="(" separator="," close=")">
					#{wms_cre_credit_head_id}
				</foreach>
			</if>
			<if test="create_user_city_code != null">
                and t1.create_user_city_code = #{create_user_city_code}
            </if>
			<if test="salesman_name!=null or salesman_shortcode !=null">
				and (t1.salesman_name like#{salesman_name} or t1.salesman_shortcode
				like #{salesman_shortcode})
			</if>
			<if test="protocol_id_year_num!=null">
				and t2.protocol_id_year_num like'${protocol_id_year_num}'
			</if>
			<if test="debtor_name!=null">
				and t2.debtor_name like '${debtor_name}'
			</if>
			<if test="debtor_tel!=null">
				and t2.debtor_tel like '${debtor_tel}'
			</if>
			<if test="salesman_city_code != null">
                and t1.salesman_city_code = ${salesman_city_code}
            </if>
            <if test="bill_status != null">
                and t1.bill_status = #{bill_status}
            </if>
            <if test="bill_code != null">
                and t1.bill_code like '${bill_code}'
            </if>
            <if test="protocol_date_begin != null">
                and t2.protocol_date &gt;= #{protocol_date_begin}
            </if>
            <if test="protocol_date_end != null">
                and t2.protocol_date &lt;= #{protocol_date_end}
            </if>
             <!-- 权限控制 -->
			<if test="childrendept != null">
				and (FIND_IN_SET(t1.salesman_dept_id, #{childrendept}) > 0)
			</if>
		</where>
	</select>

	<!-- 他项列表信息导出 -->
	<select id="getWmsFinaCreLoanAppByEntity" parameterType="WmsFinaCreLoanApp"
		resultType="java.util.HashMap">
		select *
		from wms_fina_cre_loan_app
		<where>
			enable_flag = '1'
			<if test="wms_cre_credit_head_id!=null">
				and wms_cre_credit_head_id =#{wms_cre_credit_head_id}
			</if>
		</where>
	</select>

	<!-- 实现信贷复议申请信息列表显示getLoanReviewRevision -->
	<select id="getLoanReviewRevision" parameterType="map"
		resultType="java.util.HashMap">
		select
		t1.wms_cre_credit_head_id,
		t1.bill_code,
		t1.credit_purpose,
		t1.max_repayment_limit_per_month,
		t1.credit_limit,
		t1.max_repayment_time_limit,
		t1.enter_file_way,
		t1.payroll_payment_way,
		t1.data_type,
		t1.is_complete,
		t1.reference_type,
		t1.is_other_corporation_done,
		t1.is_to_public_stream,
		t1.is_house_certificate_original,
		t1.is_check,
		t1.person_condition,
		t1.salesman_id,
		t1.salesman_code,
		t1.salesman_name,
		t1.city,
		t1.cre_type,
		(case t1.cre_type when '1' then '信贷产品' when '2' then '房贷产品' end)as
		cre_type_name,
		t1.bill_status,
		(select value_meaning from wms_sys_dict_data where value_code =
		t1.bill_status and wms_sys_dict_id = 24)as bill_status_name,
		t1.water_appro_user_id,
		t1.water_appro_user_name,
		date_format(t1.water_appro_timestamp,'%Y-%m -%d %H:%i:%s') as water_appro_timestamp,
		t1.water_appro_result,
		t1.info_appro_user_id,
		t1.info_appro_user_name,
		date_format(t1.info_appro_timestamp,'%Y-%m -%d %H:%i:%s') as info_appro_timestamp,
		t1.info_appro_result,
		t1.phone_appro_user_id,
		t1.phone_appro_user_name,
		date_format(t1.phone_appro_timestamp,'%Y -%m -%d %H:%i:%s')as phone_appro_timestamp,
		t1.phone_appro_result,
		t1.certificate_appro_user_id,
		t1.certificate_appro_user_name,

		date_format(t1.certificate_appro_timestamp,'%Y -%m -%d %H:%i:%s') as certificate_appro_timestamp,
		t1.certificate_appro_result,

		t1.create_user_id,
		t1.create_user_name,
		date_format(t1.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t1.last_update_user_id,
		date_format(t1.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
		t1.enable_flag,
		t1.model_one_amount,
		t1.model_two_amount,
		t1.model_three_amount,
		t1.model_four_amount,
		t2.wms_cre_credit_line_customer_change_head_id,
		t2.wms_cre_credit_head_id,
		t2.wms_cus_customer_head_id,
		t2.customer_code,
		t2.customer_name,
		t2.customer_ever_name,
		t2.customer_category,
		t2.gender,
		t2.max_degree,
		date_format(t2.birthday,'%Y-%m-%d') as birthday,
		t2.id_card,
		t2.province,
		t2.city,
		t2.district,
		t2.address_more,
		t2.has_children,
		t2.children_name,
		t2.children_address,
		t2.children_telephone,
		t2.has_married,
		t2.has_house,
		t2.current_address_province,
		t2.current_address_city,
		t2.current_address_district,
		t2.current_address_more,
		t2.post_code,
		t2.fixed_telephone,
		t2.mobile_telephone1,
		t2.service_password1,
		t2.mobile_telephone2,
		t2.service_password2,
		t2.personal_year_income,
		t2.customer_email,
		t2.credit_card_limit,
		t2.common_occupants,
		t2.status,
		t2.create_user_id,
		t2.create_user_name,
		date_format(t2.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t2.last_update_user_id,
		date_format(t2.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
		t2.enable_flag,
		t1.inspection_appro_user_id,
		t1.inspection_appro_user_name,
		t1.inspection_appro_timestamp,
		t1.inspection_appro_result,
		t1.inspection_appro_advice,
		t1.inspection_appro_result_page,
		t1.cre_loan_type,
		t1.salesman_shortcode,
		CONCAT(t1.salesman_name,"/",t1.salesman_shortcode) as salesman_name_str,
		t1.trial_interview_uid,
		t1.trial_interview_uname,
		t1.trial_interview_timestamp,
		t1.trial_interview_result,
		t1.trial_interview_advice
		from wms_cre_credit_head t1,wms_cre_credit_line_customer_change_head
		t2
		<where>
			t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id and
			t1.enable_flag=1 and t1.bill_status in(9) and t2.is_major='1'

			<if test="bill_code!=null">
				and t1.bill_code like #{bill_code}
			</if>
			<if test="create_timestamp!=null and create_timestamp1!=null">
				and t1.create_timestamp between #{create_timestamp} and
				#{create_timestamp1}
			</if>
			<if test="salesman_name!=null or salesman_shortcode !=null">
				and (t1.salesman_name like#{salesman_name} or
				t1.salesman_shortcode like #{salesman_shortcode})
			</if>
			<if test="id_card!=null">
				and t2.id_card =#{id_card}
			</if>
		</where>
		<if test="sortname!=null and sortorder!=null">
			order by ${sortname} ${sortorder}
		</if>
		<if test="offset!=null and pagesize!=null">
			limit ${offset},${pagesize}
		</if>
	</select>
	<!-- 实现信贷复议申请信息数 -->
	<select id="getLoanReviewRevisionCount" parameterType="map"
		resultType="int">
		select count(t1.wms_cre_credit_head_id) as count
		from
		wms_cre_credit_head t1 ,wms_cre_credit_line_customer_change_head t2
		<where>
			t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id and
			t1.enable_flag=1 and t1.bill_status in (9) and t2.is_major='1'
			<if test="bill_code!=null">
				and t1.bill_code like #{bill_code}
			</if>
			<if test="create_timestamp!=null and create_timestamp1!=null">
				and t1.create_timestamp between #{create_timestamp} and
				#{create_timestamp1}
			</if>
			<if test="salesman_name!=null or salesman_shortcode !=null">
				and (t1.salesman_name like#{salesman_name} or
				t1.salesman_shortcode like #{salesman_shortcode})
			</if>
			<if test="id_card!=null">
				and t2.id_card =#{id_card}
			</if>
		</where>
	</select>

	<!-- 终审信贷复议申请数据导出 -->
	<select id="getLoanReviewRevisionWithOutPagingList"
		parameterType="map" resultType="java.util.HashMap">
		select
		t1.wms_cre_credit_head_id,
		t1.bill_code,
		t1.credit_purpose,
		t1.max_repayment_limit_per_month,
		t1.credit_limit,
		t1.max_repayment_time_limit,
		t1.enter_file_way,
		t1.payroll_payment_way,
		t1.data_type,
		t1.is_complete,
		t1.reference_type,
		t1.is_other_corporation_done,
		t1.is_to_public_stream,
		t1.is_house_certificate_original,
		t1.is_check,
		t1.person_condition,
		t1.salesman_id,
		t1.salesman_code,
		t1.salesman_name,
		t1.city,
		t1.cre_type,
		(case t1.cre_type when '1' then '信贷产品' when '2' then '房贷产品' end)as
		cre_type_name,
		t1.bill_status,
		(select value_meaning from wms_sys_dict_data where value_code =
		t1.bill_status and wms_sys_dict_id = 24)as bill_status_name,
		t1.water_appro_user_id,
		t1.water_appro_user_name,
		date_format(t1.water_appro_timestamp,'%Y-%m -%d %H:%i:%s') as water_appro_timestamp,
		t1.water_appro_result,
		(case t1.water_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略' else
		'待审批' end)as water_appro_result_name,
		t1.info_appro_user_id,
		t1.info_appro_user_name,
		date_format(t1.info_appro_timestamp,'%Y-%m -%d %H:%i:%s') as info_appro_timestamp,
		t1.info_appro_result,
		(case t1.info_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略' else
		'待审批' end) as info_appro_result_name,
		t1.phone_appro_user_id,
		t1.phone_appro_user_name,
		date_format(t1.phone_appro_timestamp,'%Y -%m -%d %H:%i:%s')as phone_appro_timestamp,
		t1.phone_appro_result,
		(case t1.phone_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略' else
		'待审批' end)as phone_appro_result_name,
		t1.certificate_appro_user_id,
		t1.certificate_appro_user_name,
		date_format(t1.certificate_appro_timestamp,'%Y -%m -%d %H:%i:%s') as certificate_appro_timestamp,
		t1.certificate_appro_result,
		(case t1.certificate_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略'
		else '待审批' end)as certificate_appro_result_name,
		t1.create_user_id,
		t1.create_user_name,
		date_format(t1.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t1.last_update_user_id,
		date_format(t1.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
		t1.enable_flag,
		t2.wms_cre_credit_line_customer_change_head_id,
		t2.wms_cre_credit_head_id,
		t2.wms_cus_customer_head_id,
		t2.customer_code,
		t2.customer_name,
		t2.customer_ever_name,
		t2.customer_category,
		t2.gender,
		t2.max_degree,
		date_format(t2.birthday,'%Y-%m-%d') as birthday,
		t2.id_card,
		t2.province,
		t2.city,
		t2.district,
		t2.address_more,
		t2.has_children,
		t2.children_name,
		t2.children_address,
		t2.children_telephone,
		t2.has_married,
		t2.has_house,
		t2.current_address_province,
		t2.current_address_city,
		t2.current_address_district,
		t2.current_address_more,
		t2.post_code,
		t2.fixed_telephone,
		t2.mobile_telephone1,
		t2.service_password1,
		t2.mobile_telephone2,
		t2.service_password2,
		t2.personal_year_income,
		t2.customer_email,
		t2.credit_card_limit,
		t2.common_occupants,
		t2.status,
		t2.create_user_id,
		t2.create_user_name,
		date_format(t2.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t2.last_update_user_id,
		date_format(t2.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
		t2.enable_flag,
		t1.inspection_appro_user_id,
		t1.inspection_appro_user_name,
		t1.inspection_appro_timestamp,
		t1.inspection_appro_result,
		(case
		when t1.trial_interview_result=1 and t1.credit_limit>=20 and
		t1.cre_loan_type=283 and t1.inspection_appro_result='0' then '未通过'
		when t1.trial_interview_result=1 and t1.credit_limit>=20 and
		t1.cre_loan_type=283 and t1.inspection_appro_result='1' then '通过'
		when t1.trial_interview_result=1 and t1.credit_limit>=20 and
		t1.cre_loan_type=283 and ISNULL(t1.inspection_appro_result) then '待审批'
		when t1.trial_interview_result=1 and t1.cre_loan_type=113 and
		t1.inspection_appro_result='0' then '未通过'
		when t1.trial_interview_result=1 and t1.cre_loan_type=113 and
		t1.inspection_appro_result='1' then '通过'
		when t1.trial_interview_result=1 and t1.cre_loan_type=113 and
		ISNULL(t1.inspection_appro_result) then '待审批'
		END) as inspection_appro_result_name,
		t1.inspection_appro_advice,
		t1.inspection_appro_result_page,
		t1.salesman_shortcode,
		CONCAT(t1.salesman_name,"/",t1.salesman_shortcode) as salesman_name_str
		from wms_cre_credit_head
		t1,wms_cre_credit_line_customer_change_head t2
		<where>
			t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id and
			t1.enable_flag=1 and t1.bill_status in (9) and t2.is_major='1'
			<if test="bill_code!=null">
				and t1.bill_code like #{bill_code}
			</if>
			<if test="create_timestamp!=null and create_timestamp1!=null">
				and t1.create_timestamp between #{create_timestamp} and
				#{create_timestamp1}
			</if>
			<if test="salesman_name!=null or salesman_shortcode !=null">
				and (t1.salesman_name like#{salesman_name} or
				t1.salesman_shortcode like #{salesman_shortcode})
			</if>
			<if test="id_card!=null">
				and t2.id_card =#{id_card}
			</if>
		</where>
		<if test="sortname!=null and sortorder!=null">
			order by ${sortname} ${sortorder}
		</if>
	</select>
	<!-- 合同列表 -->
	<select id="searchforhouseprotocol" parameterType="map"
		resultType="java.util.HashMap">
		select
		t1.wms_cre_credit_head_id,
		t1.bill_code,
		t1.credit_purpose,
		t1.max_repayment_limit_per_month,
		t1.credit_limit,
		t1.appro_limit,
		t1.visa_limit,
		t1.max_repayment_time_limit,
		t1.enter_file_way,
		t1.payroll_payment_way,
		t1.data_type,
		t1.is_complete,
		t1.reference_type,
		t1.is_other_corporation_done,
		t1.is_to_public_stream,
		t1.is_house_certificate_original,
		t1.is_check,
		t1.person_condition,
		t1.salesman_id,
		t1.salesman_code,
		t1.salesman_name,
		t1.city,
		t1.cre_type,
		(case t1.cre_type when '1' then '信贷产品' when '2' then '房贷产品' end)as
		cre_type_name,
		t1.bill_status,
		(select value_meaning from wms_sys_dict_data where value_code =
		t1.bill_status and wms_sys_dict_id = 131)as bill_status_name,
		t1.water_appro_user_id,
		t1.water_appro_user_name,
		date_format(water_appro_timestamp,'%Y-%m-%d %H:%i:%s') as water_appro_timestamp_str,
		t1.water_appro_timestamp,
		t1.water_appro_result,
		(case t1.water_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略' else
		'待审批' end)as water_appro_result_name,
		t1.info_appro_user_id,
		t1.info_appro_user_name,
		date_format(info_appro_timestamp,'%Y-%m-%d %H:%i:%s') as info_appro_timestamp_str,
		t1.info_appro_timestamp,
		t1.info_appro_result,
		(case t1.info_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略' else
		'待审批' end)as info_appro_result_name,
		t1.phone_appro_user_id,
		t1.phone_appro_user_name,
		date_format(t1.phone_appro_timestamp,'%Y-%m-%d %H:%i:%s') as phone_appro_timestamp_str,
		t1.phone_appro_timestamp,
		t1.phone_appro_result,
		(case t1.phone_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略' else
		'待审批' end)as phone_appro_result_name,
		t1.certificate_appro_user_id,
		t1.certificate_appro_user_name,
		date_format(t1.certificate_appro_timestamp,'%Y-%m-%d %H:%i:%s') as certificate_appro_timestamp_str,
		t1.certificate_appro_timestamp,
		t1.certificate_appro_result,
		(case t1.certificate_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略'
		else '待审批' end)as certificate_appro_result_name,
		t1.create_user_id,
		t1.create_user_name,
		date_format(t1.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp_str,
		t1.create_timestamp,
		t1.last_update_user_id,
		date_format(t1.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp_str,
		t1.last_update_timestamp,
		t1.enable_flag,
		t1.protocol_amount,
		t1.is_link_repeat,
		t1.profession_type,
		t1.is_verify,
		t1.is_guarantee,
		t1.house_appro_user_id,
		t1.house_appro_user_name,
		date_format(t1.house_appro_timestamp,'%Y-%m-%d %H:%i:%s') as house_appro_timestamp_str,
		t1.house_appro_timestamp,
		t1.house_appro_result,
		(case t1.house_appro_result when '0' then '未通过' when '1' then '通过' else
		'待审批' end)as house_appro_result_name,
		t1.cre_loan_type,
		t1.model_one_amount,
		t1.model_two_amount,
		t1.model_three_amount,
		t1.model_four_amount,
		t1.version_number,
		t1.wms_cre_credit_group_id,
		t2.wms_cre_credit_line_customer_change_head_id,
		t2.wms_cre_credit_head_id,
		t2.wms_cus_customer_head_id,
		t2.customer_code,
		t2.customer_name,
		t2.customer_ever_name,
		t2.customer_category,
		t2.gender,
		t2.max_degree,
		date_format(t2.birthday,'%Y-%m-%d') as birthday,
		t2.id_card,
		t2.province,
		t2.city,
		t2.district,
		t2.address_more,
		t2.has_children,
		t2.children_name,
		t2.children_address,
		t2.children_telephone,
		t2.has_married,
		t2.has_house,
		t2.current_address_province,
		t2.current_address_city,
		t2.current_address_district,
		t2.current_address_more,
		t2.post_code,
		t2.fixed_telephone,
		t2.mobile_telephone1,
		t2.service_password1,
		t2.mobile_telephone2,
		t2.service_password2,
		t2.personal_year_income,
		t2.customer_email,
		t2.credit_card_limit,
		t2.common_occupants,
		t2.status,
		t2.create_user_id,
		t2.create_user_name,
		date_format(t2.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t2.last_update_user_id,
		date_format(t2.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
		t2.enable_flag,
		t1.salesman_shortcode,
		t1.salesman_city_code,
		t1.create_user_city_code,
		t1.is_guarantee,
		t1.bill_type,
		(case when t1.create_timestamp &lt; #{hprocess_time} then '1' else '2' end) as edition_num, 
		CONCAT(t1.salesman_name,"/",t1.salesman_shortcode) as salesman_name_str,
		(select ifnull(a.bill_code_group, '') from wms_cre_credit_group a where t1.wms_cre_credit_group_id = a.wms_cre_credit_group_id) as bill_code_group
		from wms_cre_credit_head
		t1,wms_cre_credit_line_customer_change_head t2
		<where>
			t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id and
			t1.enable_flag=1 and t2.is_major=1
			and t1.bill_status in ('H','I','KT') 
			and t1.version_number='3'
			and t1.bill_type='01'
			<if test="bill_code != null">
				and (t1.bill_code like #{bill_code} or (select ifnull(bill_code_group, '') from wms_cre_credit_group  where t1.wms_cre_credit_group_id = wms_cre_credit_group_id)  like #{bill_code})
			</if>
 			<if test="create_timestamp_begin != null">
				and date_format(t1.create_timestamp,'%Y-%m-%d') &gt;= #{create_timestamp_begin}
			</if>
			<if test="create_timestamp_end != null">
				and date_format(t1.create_timestamp,'%Y-%m-%d') &lt;= #{create_timestamp_end}
			</if>
			<if test="salesman_name!=null or salesman_shortcode !=null">
				and (t1.salesman_name like#{salesman_name} or
				t1.salesman_shortcode like #{salesman_shortcode})
			</if>
			<if test="id_card!=null">
				and t2.id_card like #{id_card}
			</if>
			<if test="customer_name != null">
				and t2.customer_name like #{customer_name}
			</if>
			 <!-- 权限控制 -->
			<if test="childrendept != null">
				and (FIND_IN_SET(t1.salesman_dept_id, #{childrendept}) > 0)
			</if>
		</where>
		<if test="sortname != '' and sortorder !=''">
			ORDER BY ${sortname} ${sortorder}
		</if>
		<if test="offset != null and pagesize !=null">
			LIMIT ${offset} , ${pagesize}
		</if>
	</select>


	<!-- list 房贷合同列表 总数 -->
	<select id="findCountforhouseProtocol" parameterType="map"
		resultType="int">
		select count(t1.wms_cre_credit_head_id) as count
		from
		wms_cre_credit_head t1 ,wms_cre_credit_line_customer_change_head t2
		<where>
			t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id and
			t1.enable_flag=1 and t2.is_major=1
			and t1.bill_status in ('H','I','KT') 
			and t1.version_number='3'
			and t1.bill_type='01'
			<if test="idList !=null">
				and t1.wms_cre_credit_head_id in
				<foreach collection="idList" index="index" item="wms_cre_credit_head_id"
					open="(" separator="," close=")">
					#{wms_cre_credit_head_id}
				</foreach>
			</if>
			<if test="bill_code != null">
				and (t1.bill_code like #{bill_code} or (select ifnull(bill_code_group, '') from wms_cre_credit_group  where t1.wms_cre_credit_group_id = wms_cre_credit_group_id)  like #{bill_code})
			</if>
			<if test="create_timestamp!=null and create_timestamp1!=null">
				and t1.create_timestamp between #{create_timestamp} and
				#{create_timestamp1}
			</if>
			<if test="salesman_name!=null">
				and t1.salesman_name like#{salesman_name}
			</if>
			<if test="id_card!=null">
				and t2.id_card like #{id_card}
			</if>
			<if test="customer_name != null">
				and t2.customer_name like #{customer_name}
			</if>
			<!-- 权限控制 -->
			<if test="childrendept != null">
				and (FIND_IN_SET(t1.salesman_dept_id, #{childrendept}) > 0)
			</if>
		</where>
	</select>

	<!-- 实现 信贷终审 初审面签列表显示功能 -->
	<select id="searchForcsyd" parameterType="map" resultType="java.util.HashMap">
		select
		t1.wms_cre_credit_head_id,
		t1.bill_code,
		t1.credit_purpose,
		t1.max_repayment_limit_per_month,
		t1.credit_limit,
		t1.max_repayment_time_limit,
		t1.enter_file_way,
		t1.payroll_payment_way,
		t1.data_type,
		t1.is_complete,
		t1.reference_type,
		t1.is_other_corporation_done,
		t1.is_to_public_stream,
		t1.is_house_certificate_original,
		t1.is_check,
		t1.person_condition,
		t1.salesman_id,
		t1.salesman_code,
		t1.salesman_name,
		t1.city,
		t1.cre_type,
		(case t1.cre_type when '1' then '信贷产品' when '2' then '房贷产品' end)as
		cre_type_name,
		t1.bill_status,
		(select value_meaning from wms_sys_dict_data where value_code =
		t1.bill_status and wms_sys_dict_id = 24)as bill_status_name,
		t1.water_appro_user_id,
		t1.water_appro_user_name,
		date_format(t1.water_appro_timestamp,'%Y-%m -%d %H:%i:%s') as water_appro_timestamp,
		t1.water_appro_result,
		t1.water_appro_result_page,
		t1.info_appro_user_id,
		t1.info_appro_user_name,
		date_format(t1.info_appro_timestamp,'%Y-%m -%d %H:%i:%s') as info_appro_timestamp,
		t1.info_appro_result,
		t1.info_appro_result_page,
		t1.phone_appro_user_id,
		t1.phone_appro_user_name,
		date_format(t1.phone_appro_timestamp,'%Y -%m -%d %H:%i:%s')as phone_appro_timestamp,
		t1.phone_appro_result,
		t1.phone_appro_result_page,
		t1.certificate_appro_user_id,
		t1.certificate_appro_user_name,
		date_format(t1.certificate_appro_timestamp,'%Y -%m -%d %H:%i:%s') as certificate_appro_timestamp,
		t1.certificate_appro_result,
		t1.certificate_appro_result_page,
		t1.create_user_id,
		t1.create_user_name,
		date_format(t1.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t1.last_update_user_id,
		date_format(t1.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
		t1.enable_flag,
		t1.model_one_amount,
		t1.model_two_amount,
		t1.model_three_amount,
		t1.model_four_amount,
		t2.wms_cre_credit_line_customer_change_head_id,
		t2.wms_cre_credit_head_id,
		t2.wms_cus_customer_head_id,
		t2.customer_code,
		t2.customer_name,
		t2.customer_ever_name,
		t2.customer_category,
		t2.gender,
		t2.max_degree,
		date_format(t2.birthday,'%Y-%m-%d') as birthday,
		t2.id_card,
		t2.province,
		t2.city,
		t2.district,
		t2.address_more,
		t2.has_children,
		t2.children_name,
		t2.children_address,
		t2.children_telephone,
		t2.has_married,
		t2.has_house,
		t2.current_address_province,
		t2.current_address_city,
		t2.current_address_district,
		t2.current_address_more,
		t2.post_code,
		t2.fixed_telephone,
		t2.mobile_telephone1,
		t2.service_password1,
		t2.mobile_telephone2,
		t2.service_password2,
		t2.personal_year_income,
		t2.customer_email,
		t2.credit_card_limit,
		t2.common_occupants,
		t2.status,
		t2.create_user_id,
		t2.create_user_name,
		date_format(t2.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t2.last_update_user_id,
		date_format(t2.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
		t2.enable_flag,
		t1.inspection_appro_user_id,
		t1.inspection_appro_user_name,
		t1.inspection_appro_timestamp,
		t1.inspection_appro_result,
		(case
		when t1.credit_limit>=20 and t1.cre_loan_type=283 and
		t1.inspection_appro_result='0' then '未通过'
		when t1.credit_limit>=20 and t1.cre_loan_type=283 and
		t1.inspection_appro_result='1' then '通过'
		when t1.credit_limit>=20 and t1.cre_loan_type=283 and
		ISNULL(t1.inspection_appro_result) then '待审批'
		when t1.cre_loan_type=113 and t1.inspection_appro_result='0' then '未通过'
		when t1.cre_loan_type=113 and t1.inspection_appro_result='1' then '通过'
		when t1.cre_loan_type=113 and ISNULL(t1.inspection_appro_result) then
		'待审批'
		end) as inspection_appro_result_name,
		t1.inspection_appro_advice,
		t1.inspection_appro_result_page,
		t1.cre_loan_type,
		t1.salesman_shortcode,
		CONCAT(t1.salesman_name,"/",t1.salesman_shortcode) as salesman_name_str,
		t1.trial_interview_uid,
		t1.trial_interview_uname,
		t1.trial_interview_timestamp,
		date_format(t1.trial_interview_timestamp,'%Y-%m-%d %H:%i:%s') as trial_interview_timestamp,
		t1.trial_interview_result,
		t1.trial_interview_advice,
		t1.documentary_opinion
		from wms_cre_credit_head t1,wms_cre_credit_line_customer_change_head
		t2
		<where>
			t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id and
			t1.enable_flag=1 and t1.bill_status='2' and t2.is_major='1' and
			(ISNULL(t1.trial_interview_result) or t1.trial_interview_result='')
			<if test="idList !=null">
				and t1.wms_cre_credit_head_id in
				<foreach collection="idList" index="index" item="wms_cre_credit_head_id"
					open="(" separator="," close=")">
					#{wms_cre_credit_head_id}
				</foreach>
			</if>
			<if test="bill_code!=null">
				and t1.bill_code like #{bill_code}
			</if>
			<if test="create_timestamp!=null and create_timestamp1!=null">
				and t1.create_timestamp between #{create_timestamp} and
				#{create_timestamp1}
			</if>
			<if test="salesman_name!=null or salesman_shortcode !=null">
				and (t1.salesman_name like#{salesman_name} or
				t1.salesman_shortcode like #{salesman_shortcode})
			</if>
			<if test="id_card!=null">
				and t2.id_card =#{id_card}
			</if>
		</where>
		<if test="sortname!=null and sortorder!=null">
			order by ${sortname} ${sortorder}
		</if>
		<if test="offset!=null and pagesize!=null">
			limit ${offset},${pagesize}
		</if>
	</select>
	<!-- 实现终审管理>信贷终审>初审面签数据总数 -->
	<select id="findCountForcsyd" parameterType="map" resultType="int">
		select count(t1.wms_cre_credit_head_id) as count
		from
		wms_cre_credit_head t1 ,wms_cre_credit_line_customer_change_head t2
		<where>
			t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id
			and t1.enable_flag=1 and t1.bill_status=2 and t2.is_major='1' and
			(ISNULL(t1.trial_interview_result) or t1.trial_interview_result='')
			<if test="idList !=null">
				and t1.wms_cre_credit_head_id in
				<foreach collection="idList" index="index" item="wms_cre_credit_head_id"
					open="(" separator="," close=")">
					#{wms_cre_credit_head_id}
				</foreach>
			</if>
			<if test="bill_code!=null">
				and t1.bill_code like #{bill_code}
			</if>
			<if test="create_timestamp!=null and create_timestamp1!=null">
				and t1.create_timestamp between #{create_timestamp} and
				#{create_timestamp1}
			</if>
			<if test="salesman_name!=null">
				and t1.salesman_name like#{salesman_name}
			</if>
			<if test="id_card!=null">
				and t2.id_card =#{id_card}
			</if>
		</where>
	</select>
	<!-- 实现信贷终审 初审面签导出功能 -->
	<select id="getLoanApproInitialInterViewWithoutPagingList"
		parameterType="map" resultType="java.util.HashMap">
		select
		t1.wms_cre_credit_head_id,
		t1.bill_code,
		t1.credit_purpose,
		t1.max_repayment_limit_per_month,
		t1.credit_limit,
		t1.max_repayment_time_limit,
		t1.enter_file_way,
		t1.payroll_payment_way,
		t1.data_type,
		t1.is_complete,
		t1.reference_type,
		t1.is_other_corporation_done,
		t1.is_to_public_stream,
		t1.is_house_certificate_original,
		t1.is_check,
		t1.person_condition,
		t1.salesman_id,
		t1.salesman_code,
		t1.salesman_name,
		t1.city,
		t1.cre_type,
		(case t1.cre_type when '1' then '信贷产品' when '2' then '房贷产品' end)as
		cre_type_name,
		t1.bill_status,
		(select value_meaning from wms_sys_dict_data where value_code =
		t1.bill_status and wms_sys_dict_id = 24)as bill_status_name,
		t1.water_appro_user_id,
		t1.water_appro_user_name,
		date_format(t1.water_appro_timestamp,'%Y-%m -%d %H:%i:%s') as water_appro_timestamp,
		t1.water_appro_result,
		(case t1.water_appro_result_page when '0' then '未通过' when '1' then '通过' when '3' then '已忽略' else
		'待审批' end)as water_appro_result_name,
		t1.info_appro_user_id,
		t1.info_appro_user_name,
		date_format(t1.info_appro_timestamp,'%Y-%m -%d %H:%i:%s') as info_appro_timestamp,
		t1.info_appro_result,
		(case t1.info_appro_result_page when '0' then '未通过' when '1' then '通过' when '3' then '已忽略' else
		'待审批' end) as info_appro_result_name,
		t1.phone_appro_user_id,
		t1.phone_appro_user_name,
		date_format(t1.phone_appro_timestamp,'%Y -%m -%d %H:%i:%s')as phone_appro_timestamp,
		t1.phone_appro_result,
		(case t1.phone_appro_result_page when '0' then '未通过' when '1' then '通过' when '3' then '已忽略' else
		'待审批' end)as phone_appro_result_name,
		t1.certificate_appro_user_id,
		t1.certificate_appro_user_name,
		date_format(t1.certificate_appro_timestamp,'%Y -%m -%d %H:%i:%s') as certificate_appro_timestamp,
		t1.certificate_appro_result,
		(case t1.certificate_appro_result_page when '0' then '未通过' when '1' then '通过' when '3' then '已忽略'
		else '待审批' end)as certificate_appro_result_name,
		t1.create_user_id,
		t1.create_user_name,
		date_format(t1.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t1.last_update_user_id,
		date_format(t1.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
		t1.enable_flag,
		t2.wms_cre_credit_line_customer_change_head_id,
		t2.wms_cre_credit_head_id,
		t2.wms_cus_customer_head_id,
		t2.customer_code,
		t2.customer_name,
		t2.customer_ever_name,
		t2.customer_category,
		t2.gender,
		t2.max_degree,
		date_format(t2.birthday,'%Y-%m-%d') as birthday,
		t2.id_card,
		t2.province,
		t2.city,
		t2.district,
		t2.address_more,
		t2.has_children,
		t2.children_name,
		t2.children_address,
		t2.children_telephone,
		t2.has_married,
		t2.has_house,
		t2.current_address_province,
		t2.current_address_city,
		t2.current_address_district,
		t2.current_address_more,
		t2.post_code,
		t2.fixed_telephone,
		t2.mobile_telephone1,
		t2.service_password1,
		t2.mobile_telephone2,
		t2.service_password2,
		t2.personal_year_income,
		t2.customer_email,
		t2.credit_card_limit,
		t2.common_occupants,
		t2.status,
		t2.create_user_id,
		t2.create_user_name,
		date_format(t2.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t2.last_update_user_id,
		date_format(t2.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
		t2.enable_flag,
		t1.inspection_appro_user_id,
		t1.inspection_appro_user_name,
		t1.inspection_appro_timestamp,
		t1.inspection_appro_result,
		(case
		when t1.credit_limit>=20 and t1.cre_loan_type=283 and t1.inspection_appro_result_page='0' then '未通过'
		when t1.credit_limit>=20 and t1.cre_loan_type=283 and t1.inspection_appro_result_page='1' then '通过'
		when t1.credit_limit>=20 and t1.cre_loan_type=283 and ISNULL(t1.inspection_appro_result_page) then '待审批'
		when t1.cre_loan_type=113 and t1.inspection_appro_result_page='0' then '未通过'
		when t1.cre_loan_type=113 and t1.inspection_appro_result_page='1' then '通过'
		when t1.cre_loan_type=113 and ISNULL(t1.inspection_appro_result_page) then '待审批'
		end) as inspection_appro_result_name,
		t1.inspection_appro_advice,
		t1.inspection_appro_result_page,
		t1.salesman_shortcode,
		CONCAT(t1.salesman_name,"/",t1.salesman_shortcode) as salesman_name_str,
		t1.trial_interview_uid,
		t1.trial_interview_uname,
		t1.trial_interview_timestamp,
		date_format(t1.trial_interview_timestamp,'%Y-%m-%d %H:%i:%s') as trial_interview_timestamp,
		t1.trial_interview_result,
		t1.trial_interview_advice
		from wms_cre_credit_head t1,wms_cre_credit_line_customer_change_head
		t2
		<where>
			t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id and
			t1.enable_flag=1 and t1.bill_status='2' and t2.is_major='1' and
			(ISNULL(t1.trial_interview_result) or t1.trial_interview_result='')
			<if test="idList !=null">
				and t1.wms_cre_credit_head_id in
				<foreach collection="idList" index="index" item="wms_cre_credit_head_id"
					open="(" separator="," close=")">
					#{wms_cre_credit_head_id}
				</foreach>
			</if>
			<if test="bill_code!=null">
				and t1.bill_code like #{bill_code}
			</if>
			<if test="create_timestamp!=null and create_timestamp1!=null">
				and t1.create_timestamp between #{create_timestamp} and
				#{create_timestamp1}
			</if>
			<if test="salesman_name!=null or salesman_shortcode !=null">
				and (t1.salesman_name like#{salesman_name} or
				t1.salesman_shortcode like #{salesman_shortcode})
			</if>
			<if test="id_card!=null">
				and t2.id_card =#{id_card}
			</if>
		</where>
		<if test="sortname!=null and sortorder!=null">
			order by ${sortname} ${sortorder}
		</if>
	</select>
	<!-- list 车贷终审列表 -->
	<select id="searchforcar" parameterType="map" resultType="java.util.HashMap">
		select
		t1.wms_cre_credit_head_id,
		t1.bill_code,
		t1.credit_purpose,
		t1.max_repayment_limit_per_month,
		t1.credit_limit,
		t1.appro_limit,
		t1.visa_limit,
		t1.max_repayment_time_limit,
		t1.enter_file_way,
		t1.payroll_payment_way,
		t1.data_type,
		t1.is_complete,
		t1.reference_type,
		t1.is_other_corporation_done,
		t1.is_to_public_stream,
		t1.is_house_certificate_original,
		t1.is_check,
		t1.person_condition,
		t1.salesman_id,
		t1.salesman_code,
		t1.salesman_name,
		t1.city,
		t1.cre_type,
		t1.bill_status,
		(select value_meaning from wms_sys_dict_data where value_code =
		t1.bill_status and wms_sys_dict_id = 24)as bill_status_name,
		t1.water_appro_user_id,
		t1.water_appro_user_name,
		date_format(water_appro_timestamp,'%Y-%m-%d %H:%i:%s') as water_appro_timestamp_str,
		t1.water_appro_timestamp,
		t1.water_appro_result,
		(case t1.water_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略' else
		'待审批' end)as water_appro_result_name,
		t1.info_appro_user_id,
		t1.info_appro_user_name,
		date_format(info_appro_timestamp,'%Y-%m-%d %H:%i:%s') as info_appro_timestamp_str,
		t1.info_appro_timestamp,
		t1.info_appro_result,
		(case t1.info_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略' else
		'待审批' end)as info_appro_result_name,
		t1.phone_appro_user_id,
		t1.phone_appro_user_name,
		date_format(t1.phone_appro_timestamp,'%Y-%m-%d %H:%i:%s') as phone_appro_timestamp_str,
		t1.phone_appro_timestamp,
		t1.phone_appro_result,
		(case t1.phone_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略' else
		'待审批' end)as phone_appro_result_name,
		t1.certificate_appro_user_id,
		t1.certificate_appro_user_name,
		date_format(t1.certificate_appro_timestamp,'%Y-%m-%d %H:%i:%s') as certificate_appro_timestamp_str,
		t1.certificate_appro_timestamp,
		t1.certificate_appro_result,
		(case t1.certificate_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略'
		else '待审批' end)as certificate_appro_result_name,
		(case t1.assessment_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略'
		else '待审批' end)as assessment_result_name,
		t1.create_user_id,
		t1.create_user_name,
		date_format(t1.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp_str,
		t1.create_timestamp,
		t1.last_update_user_id,
		date_format(t1.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp_str,
		t1.last_update_timestamp,
		t1.enable_flag,
		t1.protocol_amount,
		t1.is_link_repeat,
		t1.profession_type,
		t1.is_verify,
		t1.is_guarantee,
		t1.assessment_result,
		t1.house_appro_user_id,
		t1.house_appro_user_name,
		date_format(t1.house_appro_timestamp,'%Y-%m-%d %H:%i:%s') as house_appro_timestamp_str,
		t1.house_appro_timestamp,
		t1.house_appro_result,
		(case t1.house_appro_result when '0' then '未通过' when '1' then '通过' else
		'待审批' end)as house_appro_result_name,
		t1.cre_loan_type,
		t1.model_one_amount,
		t1.model_two_amount,
		t1.model_three_amount,
		t1.model_four_amount,
		t2.wms_cre_credit_line_customer_change_head_id,
		t2.wms_cre_credit_head_id,
		t2.wms_cus_customer_head_id,
		t2.customer_code,
		t2.customer_name,
		t2.customer_ever_name,
		t2.customer_category,
		t2.gender,
		t2.max_degree,
		date_format(t2.birthday,'%Y-%m-%d') as birthday,
		t2.id_card,
		t2.province,
		t2.city,
		t2.district,
		t2.address_more,
		t2.has_children,
		t2.children_name,
		t2.children_address,
		t2.children_telephone,
		t2.has_married,
		t2.has_house,
		t2.current_address_province,
		t2.current_address_city,
		t2.current_address_district,
		t2.current_address_more,
		t2.post_code,
		t2.fixed_telephone,
		t2.mobile_telephone1,
		t2.service_password1,
		t2.mobile_telephone2,
		t2.service_password2,
		t2.personal_year_income,
		t2.customer_email,
		t2.credit_card_limit,
		t2.common_occupants,
		t2.status,
		t2.create_user_id,
		t2.create_user_name,
		date_format(t2.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t2.last_update_user_id,
		date_format(t2.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
		t2.enable_flag,
		t1.salesman_shortcode,
		t1.salesman_city_code,
		t1.create_user_city_code,
		CONCAT(t1.salesman_name,"/",t1.salesman_shortcode) as salesman_name_str,
		(SELECT vehicle_evaluation_price from wms_cre_carp_assessment WHERE wms_cre_credit_head_id=t1.wms_cre_credit_head_id) as  vehicle_evaluation_price
		from wms_cre_credit_head
		t1,wms_cre_credit_line_customer_change_head t2
		<where>
			t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id and
			t1.enable_flag=1 and t2.is_major=1 and t1.cre_type='3'
			<if test="idList !=null">
				and t1.wms_cre_credit_head_id in
				<foreach collection="idList" index="index" item="wms_cre_credit_head_id"
					open="(" separator="," close=")">
					#{wms_cre_credit_head_id}
				</foreach>
			</if>
			<if test="bill_code!=null">
				and t1.bill_code like #{bill_code}
			</if>
			<if test="create_timestamp!=null and create_timestamp1!=null">
				and t1.create_timestamp between #{create_timestamp} and
				#{create_timestamp1}
			</if>
			<if test="salesman_name!=null or salesman_shortcode !=null">
				and (t1.salesman_name like#{salesman_name} or
				t1.salesman_shortcode like #{salesman_shortcode})
			</if>
			<if test="id_card!=null">
				and t2.id_card =#{id_card}
			</if>
		</where>
		<if test="sortname != '' and sortorder !=''">
			ORDER BY ${sortname} ${sortorder}
		</if>
		<if test="offset != null and pagesize !=null">
			LIMIT ${offset} , ${pagesize}
		</if>
	</select>
	<!-- list 车贷终审列表 总数 -->
	<select id="findCountforcar" parameterType="map" resultType="int">
		select count(t1.wms_cre_credit_head_id) as count
		from
		wms_cre_credit_head t1 ,wms_cre_credit_line_customer_change_head t2
		<where>
			t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id and
			t1.enable_flag=1 and t2.is_major=1 and t1.cre_type='3'
			<if test="idList !=null">
				and t1.wms_cre_credit_head_id in
				<foreach collection="idList" index="index" item="wms_cre_credit_head_id"
					open="(" separator="," close=")">
					#{wms_cre_credit_head_id}
				</foreach>
			</if>
			<if test="bill_code!=null">
				and t1.bill_code like #{bill_code}
			</if>
			<if test="create_timestamp!=null and create_timestamp1!=null">
				and t1.create_timestamp between #{create_timestamp} and
				#{create_timestamp1}
			</if>
			<if test="salesman_name!=null">
				and t1.salesman_name like#{salesman_name}
			</if>
			<if test="id_card!=null">
				and t2.id_card =#{id_card}
			</if>
		</where>
	</select>
	<!--车贷 合同列表 -->
	<select id="searchforcarprotocol" parameterType="map"
		resultType="java.util.HashMap">
		select
		t1.wms_cre_credit_head_id,
		t1.bill_code,
		t1.credit_purpose,
		t1.max_repayment_limit_per_month,
		t1.credit_limit,
		t1.appro_limit,
		t1.visa_limit,
		t1.max_repayment_time_limit,
		t1.enter_file_way,
		t1.payroll_payment_way,
		t1.data_type,
		t1.is_complete,
		t1.reference_type,
		t1.is_other_corporation_done,
		t1.is_to_public_stream,
		t1.is_house_certificate_original,
		t1.is_check,
		t1.person_condition,
		t1.salesman_id,
		t1.salesman_code,
		t1.salesman_name,
		t1.city,
		t1.cre_type,
		t1.bill_status,
		(select value_meaning from wms_sys_dict_data where value_code =
		t1.bill_status and wms_sys_dict_id = 24)as bill_status_name,
		t1.water_appro_user_id,
		t1.water_appro_user_name,
		date_format(water_appro_timestamp,'%Y-%m-%d %H:%i:%s') as water_appro_timestamp_str,
		t1.water_appro_timestamp,
		t1.water_appro_result,
		(case t1.water_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略' else
		'待审批' end)as water_appro_result_name,
		t1.info_appro_user_id,
		t1.info_appro_user_name,
		date_format(info_appro_timestamp,'%Y-%m-%d %H:%i:%s') as info_appro_timestamp_str,
		t1.info_appro_timestamp,
		t1.info_appro_result,
		(case t1.info_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略' else
		'待审批' end)as info_appro_result_name,
		t1.phone_appro_user_id,
		t1.phone_appro_user_name,
		date_format(t1.phone_appro_timestamp,'%Y-%m-%d %H:%i:%s') as phone_appro_timestamp_str,
		t1.phone_appro_timestamp,
		t1.phone_appro_result,
		(case t1.phone_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略' else
		'待审批' end)as phone_appro_result_name,
		t1.certificate_appro_user_id,
		t1.certificate_appro_user_name,
		date_format(t1.certificate_appro_timestamp,'%Y-%m-%d %H:%i:%s') as certificate_appro_timestamp_str,
		t1.certificate_appro_timestamp,
		t1.certificate_appro_result,
		(case t1.certificate_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略'
		else '待审批' end)as certificate_appro_result_name,
		t1.create_user_id,
		t1.create_user_name,
		date_format(t1.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp_str,
		t1.create_timestamp,
		t1.last_update_user_id,
		date_format(t1.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp_str,
		t1.last_update_timestamp,
		t1.enable_flag,
		t1.protocol_amount,
		t1.is_link_repeat,
		t1.profession_type,
		t1.is_verify,
		t1.is_guarantee,
		t1.house_appro_user_id,
		t1.house_appro_user_name,
		date_format(t1.house_appro_timestamp,'%Y-%m-%d %H:%i:%s') as house_appro_timestamp_str,
		t1.house_appro_timestamp,
		t1.house_appro_result,
		(case t1.house_appro_result when '0' then '未通过' when '1' then '通过' else
		'待审批' end)as house_appro_result_name,
		t1.cre_loan_type,
		t1.model_one_amount,
		t1.model_two_amount,
		t1.model_three_amount,
		t1.model_four_amount,
		t1.assessment_result,
			(case t1.assessment_result when '0' then '未通过' when '1' then '通过' else
		'待审批' end)as assessment_result_name,
		t2.wms_cre_credit_line_customer_change_head_id,
		t2.wms_cre_credit_head_id,
		t2.wms_cus_customer_head_id,
		t2.customer_code,
		t2.customer_name,
		t2.customer_ever_name,
		t2.customer_category,
		t2.gender,
		t2.max_degree,
		date_format(t2.birthday,'%Y-%m-%d') as birthday,
		t2.id_card,
		t2.province,
		t2.city,
		t2.district,
		t2.address_more,
		t2.has_children,
		t2.children_name,
		t2.children_address,
		t2.children_telephone,
		t2.has_married,
		t2.has_house,
		t2.current_address_province,
		t2.current_address_city,
		t2.current_address_district,
		t2.current_address_more,
		t2.post_code,
		t2.fixed_telephone,
		t2.mobile_telephone1,
		t2.service_password1,
		t2.mobile_telephone2,
		t2.service_password2,
		t2.personal_year_income,
		t2.customer_email,
		t2.credit_card_limit,
		t2.common_occupants,
		t2.status,
		t2.create_user_id,
		t2.create_user_name,
		date_format(t2.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t2.last_update_user_id,
		date_format(t2.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
		t2.enable_flag,
		t1.salesman_shortcode,
		t1.salesman_city_code,
		t1.create_user_city_code,
		CONCAT(t1.salesman_name,"/",t1.salesman_shortcode) as salesman_name_str
		from wms_cre_credit_head
		t1,wms_cre_credit_line_customer_change_head t2
		<where>
			t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id and
			t1.enable_flag=1 and t2.is_major=1
			and t1.create_user_city_code =
			#{create_user_city_code}
			<if test="idList !=null">
				and t1.wms_cre_credit_head_id in
				<foreach collection="idList" index="index" item="wms_cre_credit_head_id"
					open="(" separator="," close=")">
					#{wms_cre_credit_head_id}
				</foreach>
			</if>
			<if test="bill_code!=null">
				and t1.bill_code like #{bill_code}
			</if>
			<if test="create_timestamp!=null and create_timestamp1!=null">
				and t1.create_timestamp between #{create_timestamp} and
				#{create_timestamp1}
			</if>
			<if test="salesman_name!=null or salesman_shortcode !=null">
				and (t1.salesman_name like#{salesman_name} or
				t1.salesman_shortcode like #{salesman_shortcode})
			</if>
			<if test="id_card!=null">
				and t2.id_card =#{id_card}
			</if>
		</where>
		<if test="sortname != '' and sortorder !=''">
			ORDER BY ${sortname} ${sortorder}
		</if>
		<if test="offset != null and pagesize !=null">
			LIMIT ${offset} , ${pagesize}
		</if>
	</select>


	<!-- list 车贷合同列表 总数 -->
	<select id="findCountforcarProtocol" parameterType="map"
		resultType="int">
		select count(t1.wms_cre_credit_head_id) as count
		from
		wms_cre_credit_head t1 ,wms_cre_credit_line_customer_change_head t2
		<where>
			t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id and
			t1.enable_flag=1 and t2.is_major=1
			and t1.create_user_city_code =
			#{create_user_city_code}
			<if test="idList !=null">
				and t1.wms_cre_credit_head_id in
				<foreach collection="idList" index="index" item="wms_cre_credit_head_id"
					open="(" separator="," close=")">
					#{wms_cre_credit_head_id}
				</foreach>
			</if>
			<if test="bill_code!=null">
				and t1.bill_code like #{bill_code}
			</if>
			<if test="create_timestamp!=null and create_timestamp1!=null">
				and t1.create_timestamp between #{create_timestamp} and
				#{create_timestamp1}
			</if>
			<if test="salesman_name!=null">
				and t1.salesman_name like#{salesman_name}
			</if>
			<if test="id_card!=null">
				and t2.id_card =#{id_card}
			</if>
		</where>
	</select>
	<!-- 车贷放款申请信息列表分页 -->
	<select id="getCarMakeLoansListWithPaging" parameterType="map"
		resultType="java.util.HashMap">
		select
		t1.wms_cre_credit_head_id,
		t1.bill_code,
		t1.credit_purpose,
		t1.max_repayment_limit_per_month,
		t1.credit_limit,
		t1.max_repayment_time_limit,
		t1.enter_file_way,
		t1.payroll_payment_way,
		t1.data_type,
		t1.is_complete,
		t1.reference_type,
		t1.is_other_corporation_done,
		t1.is_to_public_stream,
		t1.is_house_certificate_original,
		t1.is_check,
		t1.person_condition,
		t1.salesman_id,
		t1.salesman_code,
		t1.salesman_name,
		t1.city,
		t1.cre_type,
		(case t1.cre_type when '1' then '信贷产品' when '2' then '房贷产品' when '3' then '车贷产品' end)as
		cre_type_name,
		t1.bill_status,
		(select value_meaning from wms_sys_dict_data where value_code =
		t1.bill_status and wms_sys_dict_id = 24)as bill_status_name,
		t1.water_appro_user_id,
		t1.water_appro_user_name,
		t1.water_appro_timestamp,
		t1.cre_loan_type,
		date_format(t1.water_appro_timestamp,'%Y-%m -%d %H:%i:%s') as water_appro_timestamp,
		t1.water_appro_result,
		(case t1.water_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略' else
		'待审批' end)as water_appro_result_name,
		t1.info_appro_user_id,
		t1.info_appro_user_name,
		t1.info_appro_timestamp,
		date_format(t1.info_appro_timestamp,'%Y-%m -%d %H:%i:%s') as info_appro_timestamp,
		t1.info_appro_result,
		(case t1.info_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略' else
		'待审批' end) as info_appro_result_name,
		t1.phone_appro_user_id,
		t1.phone_appro_user_name,
		t1.phone_appro_timestamp,
		date_format(t1.phone_appro_timestamp,'%Y-%m -%d %H:%i:%s') as phone_appro_timestamp,
		t1.phone_appro_result,
		(case t1.phone_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略' else
		'待审批' end)as phone_appro_result_name,
		t1.certificate_appro_user_id,
		t1.certificate_appro_user_name,
		t1.certificate_appro_timestamp,
		date_format(t1.certificate_appro_timestamp,'%Y-%m -%d %H:%i:%s') as certificate_appro_timestamp,
		t1.certificate_appro_result,
		(case t1.certificate_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略'
		else '待审批' end)as certificate_appro_result_name,
		t1.create_user_id,
		t1.create_user_name,
		t1.create_timestamp,
		date_format(t1.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t1.last_update_user_id,
		t1.last_update_timestamp,
		date_format(t1.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
		t1.enable_flag,
		t1.protocol_amount,
		t1.is_link_repeat,
		t1.profession_type,
		t1.is_verify,
		t2.wms_cre_appro_id,
		t2.protocol_id_year,
		t2.protocol_id_num,
		t2.protocol_id_year_num,
		t2.protocol_date,
		t2.creditor_name,
		t2.creditor_identity_id,
		t2.debtor_name,
		t2.debtor_identity_id,
		t2.creditor_address,
		t2.debtor_address,
		t2.creditor_tel,
		t2.debtor_tel,
		t2.debtor_fixed_line,
		t2.principal_caps,
		t2.principal_lower,
		t2.borrow_deadline,
		t2.borrow_begin_date,
		t2.borrow_end_date,
		t2.borrow_purpose,
		t2.borrow_interest,
		t2.refund_bank,
		t2.refund_number,
		t2.refund_name,
		t2.refund_limit_month,
		t2.refund_day,
		t2.liquidated_damages,
		t2.wms_cre_credit_head_id,
		t2.create_user_id,
		t2.create_user_name,
		t2.create_timestamp,
		t2.last_update_user_id,
		t2.last_update_timestamp,
		t2.protocol_type,
		t2.enable_flag,
		t2.loan_amount,
		t1.salesman_shortcode,
		CONCAT(t1.salesman_name,"/",t1.salesman_shortcode) as salesman_name_str
		from wms_cre_credit_head t1
		,wms_cre_appro_borrow_protocol t2
		<where>
			t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id and
			t1.enable_flag=1 and t1.cre_type=3
			<if test="idList !=null">
				and t1.wms_cre_credit_head_id in
				<foreach collection="idList" index="index" item="wms_cre_credit_head_id"
					open="(" separator="," close=")">
					#{wms_cre_credit_head_id}
				</foreach>
			</if>
			<if test="salesman_name!=null or salesman_shortcode !=null">
				and (t1.salesman_name like#{salesman_name} or t1.salesman_shortcode
				like #{salesman_shortcode})
			</if>
			<if test="protocol_id_year_num!=null">
				and t2.protocol_id_year_num like'${protocol_id_year_num}'
			</if>
			<if test="debtor_name!=null">
				and t2.debtor_name like '${debtor_name}'
			</if>
			<if test="debtor_tel!=null">
				and t2.debtor_tel like '${debtor_tel}'
			</if>
		</where>
		<if test="sortname!=null and sortorder!=null">
			order by ${sortname} ${sortorder}
		</if>
		<if test="offset!=null and pagesize!=null">
			limit ${offset},${pagesize}
		</if>
	</select>
	<!-- 车贷放款申请总记录 -->
	<select id="getCarMakeLoansCount" parameterType="map"
		resultType="int">
		select count(t1.wms_cre_credit_head_id) as count
		from
		wms_cre_credit_head t1 ,wms_cre_appro_borrow_protocol t2
		<where>
			t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id and
			t1.enable_flag=1 and t1.cre_type=3
			<if test="idList !=null">
				and t1.wms_cre_credit_head_id in
				<foreach collection="idList" index="index" item="wms_cre_credit_head_id"
					open="(" separator="," close=")">
					#{wms_cre_credit_head_id}
				</foreach>
			</if>
			<if test="salesman_name!=null or salesman_shortcode !=null">
				and (t1.salesman_name like#{salesman_name} or t1.salesman_shortcode
				like #{salesman_shortcode})
			</if>
			<if test="protocol_id_year_num!=null">
				and t2.protocol_id_year_num like'${protocol_id_year_num}'
			</if>
			<if test="debtor_name!=null">
				and t2.debtor_name like '${debtor_name}'
			</if>
			<if test="debtor_tel!=null">
				and t2.debtor_tel like '${debtor_tel}'
			</if>
		</where>
	</select>
	<!-- 车贷放款申请列表数据导出 -->
	<select id="getCarMakeLoansListWithoutPaging" parameterType="map"
		resultType="java.util.HashMap">
		select
		t1.wms_cre_credit_head_id,
		t1.bill_code,
		t1.credit_purpose,
		t1.max_repayment_limit_per_month,
		t1.credit_limit,
		t1.max_repayment_time_limit,
		t1.enter_file_way,
		t1.payroll_payment_way,
		t1.data_type,
		t1.is_complete,
		t1.reference_type,
		t1.is_other_corporation_done,
		t1.is_to_public_stream,
		t1.is_house_certificate_original,
		t1.is_check,
		t1.person_condition,
		t1.salesman_id,
		t1.salesman_code,
		t1.salesman_name,
		t1.city,
		t1.cre_type,
		(case t1.cre_type when '1' then '信贷产品' when '2' then '房贷产品' when '3' then '车贷产品' end)as
		cre_type_name,
		t1.bill_status,
		(select value_meaning from wms_sys_dict_data where value_code =
		t1.bill_status and wms_sys_dict_id = 24)as bill_status_name,
		t1.water_appro_user_id,
		t1.water_appro_user_name,
		t1.water_appro_timestamp,
		date_format(t1.water_appro_timestamp,'%Y-%m -%d %H:%i:%s') as water_appro_timestamp,
		t1.water_appro_result,
		(case t1.water_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略' else
		'待审批' end)as water_appro_result_name,
		t1.info_appro_user_id,
		t1.info_appro_user_name,
		t1.info_appro_timestamp,
		date_format(t1.info_appro_timestamp,'%Y-%m -%d %H:%i:%s') as info_appro_timestamp,
		t1.info_appro_result,
		(case t1.info_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略' else
		'待审批' end) as info_appro_result_name,
		t1.phone_appro_user_id,
		t1.phone_appro_user_name,
		t1.phone_appro_timestamp,
		date_format(t1.phone_appro_timestamp,'%Y-%m -%d %H:%i:%s') as phone_appro_timestamp,
		t1.phone_appro_result,
		(case t1.phone_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略' else
		'待审批' end)as phone_appro_result_name,
		t1.certificate_appro_user_id,
		t1.certificate_appro_user_name,
		t1.certificate_appro_timestamp,
		date_format(t1.certificate_appro_timestamp,'%Y-%m -%d %H:%i:%s') as certificate_appro_timestamp,
		t1.certificate_appro_result,
		(case t1.certificate_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略'
		else '待审批' end)as certificate_appro_result_name,
		t1.create_user_id,
		t1.create_user_name,
		t1.create_timestamp,
		date_format(t1.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t1.last_update_user_id,
		t1.last_update_timestamp,
		date_format(t1.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
		t1.enable_flag,
		t1.protocol_amount,
		t1.is_link_repeat,
		t1.profession_type,
		t1.is_verify,
		t2.wms_cre_appro_id,
		t2.protocol_id_year,
		t2.protocol_id_num,
		t2.protocol_id_year_num,
		t2.protocol_date,
		t2.creditor_name,
		t2.creditor_identity_id,
		t2.debtor_name,
		t2.debtor_identity_id,
		t2.creditor_address,
		t2.debtor_address,
		t2.creditor_tel,
		t2.debtor_tel,
		t2.debtor_fixed_line,
		t2.principal_caps,
		t2.principal_lower,
		t2.borrow_deadline,
		t2.borrow_begin_date,
		t2.borrow_end_date,
		t2.borrow_purpose,
		t2.borrow_interest,
		t2.refund_bank,
		t2.refund_number,
		t2.refund_name,
		t2.refund_limit_month,
		t2.refund_day,
		t2.liquidated_damages,
		t2.wms_cre_credit_head_id,
		t2.create_user_id,
		t2.create_user_name,
		t2.create_timestamp,
		t2.last_update_user_id,
		t2.last_update_timestamp,
		t2.enable_flag,
		t1.salesman_shortcode,
		CONCAT(t1.salesman_name,"/",t1.salesman_shortcode) as salesman_name_str
		from wms_cre_credit_head t1
		,wms_cre_appro_borrow_protocol t2
		<where>
			t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id and
			t1.enable_flag=1 and t1.cre_type=3
			<if test="idList !=null">
				and t1.wms_cre_credit_head_id in
				<foreach collection="idList" index="index" item="wms_cre_credit_head_id"
					open="(" separator="," close=")">
					#{wms_cre_credit_head_id}
				</foreach>
			</if>
			<if test="salesman_name!=null or salesman_shortcode !=null">
				and (t1.salesman_name like#{salesman_name} or t1.salesman_shortcode
				like #{salesman_shortcode})
			</if>
			<if test="protocol_id_year_num!=null">
				and t2.protocol_id_year_num like'${protocol_id_year_num}'
			</if>
			<if test="debtor_name!=null">
				and t2.debtor_name like '${debtor_name}'
			</if>
			<if test="debtor_tel!=null">
				and t2.debtor_tel like '${debtor_tel}'
			</if>
		</where>
		<if test="sortname!=null and sortorder!=null">
			order by ${sortname} ${sortorder}
		</if>
	</select>
	<!-- 车贷放款申请信息列表分页 -->
	<select id="getCaringMakeLoansListWithPaging" parameterType="map"
		resultType="java.util.HashMap">
		select
		t1.wms_cre_credit_head_id,
		t1.bill_code,
		t1.credit_purpose,
		t1.max_repayment_limit_per_month,
		t1.credit_limit,
		t1.max_repayment_time_limit,
		t1.enter_file_way,
		t1.payroll_payment_way,
		t1.data_type,
		t1.is_complete,
		t1.reference_type,
		t1.is_other_corporation_done,
		t1.is_to_public_stream,
		t1.is_house_certificate_original,
		t1.is_check,
		t1.person_condition,
		t1.salesman_id,
		t1.salesman_code,
		t1.salesman_name,
		t1.city,
		t1.cre_type,
		(case t1.cre_type when '1' then '信贷产品' when '2' then '房贷产品' when '3' then '车贷产品'  end)as
		cre_type_name,
		t1.bill_status,
		(select value_meaning from wms_sys_dict_data where value_code =
		t1.bill_status and wms_sys_dict_id = 24)as bill_status_name,
		t1.water_appro_user_id,
		t1.water_appro_user_name,
		t1.water_appro_timestamp,
		t1.cre_loan_type,
		date_format(t1.water_appro_timestamp,'%Y-%m -%d %H:%i:%s') as water_appro_timestamp,
		t1.water_appro_result,
		(case t1.water_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略' else
		'待审批' end)as water_appro_result_name,
		t1.info_appro_user_id,
		t1.info_appro_user_name,
		t1.info_appro_timestamp,
		date_format(t1.info_appro_timestamp,'%Y-%m -%d %H:%i:%s') as info_appro_timestamp,
		t1.info_appro_result,
		(case t1.info_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略' else
		'待审批' end) as info_appro_result_name,
		t1.phone_appro_user_id,
		t1.phone_appro_user_name,
		t1.phone_appro_timestamp,
		date_format(t1.phone_appro_timestamp,'%Y-%m -%d %H:%i:%s') as phone_appro_timestamp,
		t1.phone_appro_result,
		(case t1.phone_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略' else
		'待审批' end)as phone_appro_result_name,
		t1.certificate_appro_user_id,
		t1.certificate_appro_user_name,
		t1.certificate_appro_timestamp,
		date_format(t1.certificate_appro_timestamp,'%Y-%m -%d %H:%i:%s') as certificate_appro_timestamp,
		t1.certificate_appro_result,
		(case t1.certificate_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略'
		else '待审批' end)as certificate_appro_result_name,
		t1.create_user_id,
		t1.create_user_name,
		t1.create_timestamp,
		date_format(t1.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t1.last_update_user_id,
		t1.last_update_timestamp,
		date_format(t1.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
		t1.enable_flag,
		t1.protocol_amount,
		t1.is_link_repeat,
		t1.profession_type,
		t1.is_verify,
		t2.wms_cre_appro_id,
		t2.protocol_id_year,
		t2.protocol_id_num,
		t2.protocol_id_year_num,
		t2.protocol_date,
		t2.creditor_name,
		t2.creditor_identity_id,
		t2.debtor_name,
		t2.debtor_identity_id,
		t2.creditor_address,
		t2.debtor_address,
		t2.creditor_tel,
		t2.debtor_tel,
		t2.debtor_fixed_line,
		t2.principal_caps,
		t2.principal_lower,
		t2.borrow_deadline,
		t2.borrow_begin_date,
		t2.borrow_end_date,
		t2.borrow_purpose,
		t2.borrow_interest,
		t2.refund_bank,
		t2.refund_number,
		t2.refund_name,
		t2.refund_limit_month,
		t2.refund_day,
		t2.liquidated_damages,
		t2.wms_cre_credit_head_id,
		t2.create_user_id,
		t2.create_user_name,
		t2.create_timestamp,
		t2.last_update_user_id,
		t2.last_update_timestamp,
		t2.protocol_type,
		t2.enable_flag,
		t2.loan_amount,
		t1.salesman_shortcode,
		CONCAT(t1.salesman_name,"/",t1.salesman_shortcode) as salesman_name_str
		from wms_cre_credit_head t1
		,wms_cre_appro_borrow_protocol t2
		<where>
			t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id and
			t1.enable_flag=1 and t1.cre_type=3
			<if test="idList !=null">
				and t1.wms_cre_credit_head_id in
				<foreach collection="idList" index="index" item="wms_cre_credit_head_id"
					open="(" separator="," close=")">
					#{wms_cre_credit_head_id}
				</foreach>
			</if>
			<if test="salesman_name!=null or salesman_shortcode !=null">
				and (t1.salesman_name like#{salesman_name} or t1.salesman_shortcode
				like #{salesman_shortcode})
			</if>
			<if test="protocol_id_year_num!=null">
				and t2.protocol_id_year_num like'${protocol_id_year_num}'
			</if>
			<if test="debtor_name!=null">
				and t2.debtor_name like '${debtor_name}'
			</if>
			<if test="debtor_tel!=null">
				and t2.debtor_tel like '${debtor_tel}'
			</if>
		</where>
		<if test="sortname!=null and sortorder!=null">
			order by ${sortname} ${sortorder}
		</if>
		<if test="offset!=null and pagesize!=null">
			limit ${offset},${pagesize}
		</if>
	</select>
	<!-- 车贷放款申请总记录 -->
	<select id="getCaringMakeLoansCount" parameterType="map"
		resultType="int">
		select count(t1.wms_cre_credit_head_id) as count
		from
		wms_cre_credit_head t1 ,wms_cre_appro_borrow_protocol t2
		<where>
			t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id and
			t1.enable_flag=1 and t1.cre_type=3
			<if test="idList !=null">
				and t1.wms_cre_credit_head_id in
				<foreach collection="idList" index="index" item="wms_cre_credit_head_id"
					open="(" separator="," close=")">
					#{wms_cre_credit_head_id}
				</foreach>
			</if>
			<if test="salesman_name!=null or salesman_shortcode !=null">
				and (t1.salesman_name like#{salesman_name} or t1.salesman_shortcode
				like #{salesman_shortcode})
			</if>
			<if test="protocol_id_year_num!=null">
				and t2.protocol_id_year_num like'${protocol_id_year_num}'
			</if>
			<if test="debtor_name!=null">
				and t2.debtor_name like '${debtor_name}'
			</if>
			<if test="debtor_tel!=null">
				and t2.debtor_tel like '${debtor_tel}'
			</if>
		</where>
	</select>
	<!-- 车贷放款申请列表数据导出 -->
	<select id="getCaringMakeLoansListWithoutPaging" parameterType="map"
		resultType="java.util.HashMap">
		select
		t1.wms_cre_credit_head_id,
		t1.bill_code,
		t1.credit_purpose,
		t1.max_repayment_limit_per_month,
		t1.credit_limit,
		t1.max_repayment_time_limit,
		t1.enter_file_way,
		t1.payroll_payment_way,
		t1.data_type,
		t1.is_complete,
		t1.reference_type,
		t1.is_other_corporation_done,
		t1.is_to_public_stream,
		t1.is_house_certificate_original,
		t1.is_check,
		t1.person_condition,
		t1.salesman_id,
		t1.salesman_code,
		t1.salesman_name,
		t1.city,
		t1.cre_type,
		(case t1.cre_type when '1' then '信贷产品' when '2' then '房贷产品' when '3' then '车贷产品'  end)as
		cre_type_name,
		t1.bill_status,
		(select value_meaning from wms_sys_dict_data where value_code =
		t1.bill_status and wms_sys_dict_id = 24)as bill_status_name,
		t1.water_appro_user_id,
		t1.water_appro_user_name,
		t1.water_appro_timestamp,
		date_format(t1.water_appro_timestamp,'%Y-%m -%d %H:%i:%s') as water_appro_timestamp,
		t1.water_appro_result,
		(case t1.water_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略' else
		'待审批' end)as water_appro_result_name,
		t1.info_appro_user_id,
		t1.info_appro_user_name,
		t1.info_appro_timestamp,
		date_format(t1.info_appro_timestamp,'%Y-%m -%d %H:%i:%s') as info_appro_timestamp,
		t1.info_appro_result,
		(case t1.info_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略' else
		'待审批' end) as info_appro_result_name,
		t1.phone_appro_user_id,
		t1.phone_appro_user_name,
		t1.phone_appro_timestamp,
		date_format(t1.phone_appro_timestamp,'%Y-%m -%d %H:%i:%s') as phone_appro_timestamp,
		t1.phone_appro_result,
		(case t1.phone_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略' else
		'待审批' end)as phone_appro_result_name,
		t1.certificate_appro_user_id,
		t1.certificate_appro_user_name,
		t1.certificate_appro_timestamp,
		date_format(t1.certificate_appro_timestamp,'%Y-%m -%d %H:%i:%s') as certificate_appro_timestamp,
		t1.certificate_appro_result,
		(case t1.certificate_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略'
		else '待审批' end)as certificate_appro_result_name,
		t1.create_user_id,
		t1.create_user_name,
		t1.create_timestamp,
		date_format(t1.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t1.last_update_user_id,
		t1.last_update_timestamp,
		date_format(t1.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
		t1.enable_flag,
		t1.protocol_amount,
		t1.is_link_repeat,
		t1.profession_type,
		t1.is_verify,
		t2.wms_cre_appro_id,
		t2.protocol_id_year,
		t2.protocol_id_num,
		t2.protocol_id_year_num,
		t2.protocol_date,
		t2.creditor_name,
		t2.creditor_identity_id,
		t2.debtor_name,
		t2.debtor_identity_id,
		t2.creditor_address,
		t2.debtor_address,
		t2.creditor_tel,
		t2.debtor_tel,
		t2.debtor_fixed_line,
		t2.principal_caps,
		t2.principal_lower,
		t2.borrow_deadline,
		t2.borrow_begin_date,
		t2.borrow_end_date,
		t2.borrow_purpose,
		t2.borrow_interest,
		t2.refund_bank,
		t2.refund_number,
		t2.refund_name,
		t2.refund_limit_month,
		t2.refund_day,
		t2.liquidated_damages,
		t2.wms_cre_credit_head_id,
		t2.create_user_id,
		t2.create_user_name,
		t2.create_timestamp,
		t2.last_update_user_id,
		t2.last_update_timestamp,
		t2.enable_flag,
		t1.salesman_shortcode,
		CONCAT(t1.salesman_name,"/",t1.salesman_shortcode) as salesman_name_str
		from wms_cre_credit_head t1
		,wms_cre_appro_borrow_protocol t2
		<where>
			t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id and
			t1.enable_flag=1 and t1.cre_type=3
			<if test="idList !=null">
				and t1.wms_cre_credit_head_id in
				<foreach collection="idList" index="index" item="wms_cre_credit_head_id"
					open="(" separator="," close=")">
					#{wms_cre_credit_head_id}
				</foreach>
			</if>
			<if test="salesman_name!=null or salesman_shortcode !=null">
				and (t1.salesman_name like#{salesman_name} or t1.salesman_shortcode
				like #{salesman_shortcode})
			</if>
			<if test="protocol_id_year_num!=null">
				and t2.protocol_id_year_num like'${protocol_id_year_num}'
			</if>
			<if test="debtor_name!=null">
				and t2.debtor_name like '${debtor_name}'
			</if>
			<if test="debtor_tel!=null">
				and t2.debtor_tel like '${debtor_tel}'
			</if>
		</where>
		<if test="sortname!=null and sortorder!=null">
			order by ${sortname} ${sortorder}
		</if>
	</select>
	<!--实现WMS贷款客户信息包含电话1传递PTP实现注册功能  -->
	<select id="getNameAndPhone1" resultType="java.util.HashMap" parameterType="map">
		select 
		mobile_telephone1,
		id_card,
		customer_name 
		from wms_cre_credit_line_customer_change_head 
		where wms_cre_credit_head_id=${wms_cre_credit_head_id}
		<!-- select 
		w1.customer_name,
		w1.is_major,
		w1.mobile_telephone1,
		w1.mobile_telephone2,
		w1.id_card,
		w2.customer_name as '联系人姓名',
		w2.contact_mobile_phone
		FROM wms_cre_credit_line_customer_change_head w1 
		INNER JOIN wms_cre_customer_change_line_contact w2
		WHERE w1.wms_cre_credit_line_customer_change_head_id=
		w2.wms_cre_credit_line_customer_change_head_id 
		and w1.wms_cre_credit_head_id=${wms_cre_credit_head_id} -->
	</select>
	<!--实现WMS贷款客户信息包含电话2传递PTP实现注册功能  -->
	<select id="getNameAndPhone2" resultType="java.util.HashMap" parameterType="map">
		select 
		mobile_telephone2,
		customer_name 
		from wms_cre_credit_line_customer_change_head 
		where wms_cre_credit_head_id=${wms_cre_credit_head_id}
	</select>
	<!--实现WMS贷款客户联系人信息传递PTP实现注册功能  -->
	<select id="getNameAndPhone3" resultType="java.util.HashMap" parameterType="map">
		select 
		contact_mobile_phone,
		contact_name 
		from wms_cre_customer_change_line_contact 
		where wms_cre_credit_head_id=${wms_cre_credit_head_id}
	</select>
	
	<!-- 补充合同列表 -->
<!-- 	 显示F待放款审核  G待放款 K待审批  H已完成 -->
	<select id="searchforhouseprotocolList" parameterType="map"
		resultType="java.util.HashMap">
		select
		t1.wms_cre_credit_head_id,
		t1.bill_code,
		t1.credit_purpose,
		t1.max_repayment_limit_per_month,
		t1.credit_limit,
		t1.appro_limit,
		t1.visa_limit,
		t1.max_repayment_time_limit,
		t1.enter_file_way,
		t1.payroll_payment_way,
		t1.data_type,
		t1.is_complete,
		t1.reference_type,
		t1.is_other_corporation_done,
		t1.is_to_public_stream,
		t1.is_house_certificate_original,
		t1.is_check,
		t1.person_condition,
		t1.salesman_id,
		t1.salesman_code,
		t1.salesman_name,
		t1.city,
		t1.cre_type,
		(case t1.cre_type when '1' then '信贷产品' when '2' then '房贷产品' end)as
		cre_type_name,
		t1.bill_status,
		(select value_meaning from wms_sys_dict_data where value_code =
		t1.bill_status and wms_sys_dict_id = 24)as bill_status_name,
		t1.water_appro_user_id,
		t1.water_appro_user_name,
		date_format(water_appro_timestamp,'%Y-%m-%d %H:%i:%s') as water_appro_timestamp_str,
		t1.water_appro_timestamp,
		t1.water_appro_result,
		(case t1.water_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略' else
		'待审批' end)as water_appro_result_name,
		t1.info_appro_user_id,
		t1.info_appro_user_name,
		date_format(info_appro_timestamp,'%Y-%m-%d %H:%i:%s') as info_appro_timestamp_str,
		t1.info_appro_timestamp,
		t1.info_appro_result,
		(case t1.info_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略' else
		'待审批' end)as info_appro_result_name,
		t1.phone_appro_user_id,
		t1.phone_appro_user_name,
		date_format(t1.phone_appro_timestamp,'%Y-%m-%d %H:%i:%s') as phone_appro_timestamp_str,
		t1.phone_appro_timestamp,
		t1.phone_appro_result,
		(case t1.phone_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略' else
		'待审批' end)as phone_appro_result_name,
		t1.certificate_appro_user_id,
		t1.certificate_appro_user_name,
		date_format(t1.certificate_appro_timestamp,'%Y-%m-%d %H:%i:%s') as certificate_appro_timestamp_str,
		t1.certificate_appro_timestamp,
		t1.certificate_appro_result,
		(case t1.certificate_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略'
		else '待审批' end)as certificate_appro_result_name,
		t1.create_user_id,
		t1.create_user_name,
		date_format(t1.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp_str,
		t1.create_timestamp,
		t1.last_update_user_id,
		date_format(t1.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp_str,
		t1.last_update_timestamp,
		t1.enable_flag,
		t1.protocol_amount,
		t1.is_link_repeat,
		t1.profession_type,
		t1.is_verify,
		t1.is_guarantee,
		t1.house_appro_user_id,
		t1.house_appro_user_name,
		date_format(t1.house_appro_timestamp,'%Y-%m-%d %H:%i:%s') as house_appro_timestamp_str,
		t1.house_appro_timestamp,
		t1.house_appro_result,
		(case t1.house_appro_result when '0' then '未通过' when '1' then '通过' else
		'待审批' end)as house_appro_result_name,
		t1.cre_loan_type,
		t1.model_one_amount,
		t1.model_two_amount,
		t1.model_three_amount,
		t1.model_four_amount,
		t2.wms_cre_credit_line_customer_change_head_id,
		t2.wms_cre_credit_head_id,
		t2.wms_cus_customer_head_id,
		t2.customer_code,
		t2.customer_name,
		t2.customer_ever_name,
		t2.customer_category,
		t2.gender,
		t2.max_degree,
		date_format(t2.birthday,'%Y-%m-%d') as birthday,
		t2.id_card,
		t2.province,
		t2.city,
		t2.district,
		t2.address_more,
		t2.has_children,
		t2.children_name,
		t2.children_address,
		t2.children_telephone,
		t2.has_married,
		t2.has_house,
		t2.current_address_province,
		t2.current_address_city,
		t2.current_address_district,
		t2.current_address_more,
		t2.post_code,
		t2.fixed_telephone,
		t2.mobile_telephone1,
		t2.service_password1,
		t2.mobile_telephone2,
		t2.service_password2,
		t2.personal_year_income,
		t2.customer_email,
		t2.credit_card_limit,
		t2.common_occupants,
		t2.status,
		t2.create_user_id,
		t2.create_user_name,
		date_format(t2.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t2.last_update_user_id,
		date_format(t2.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
		t2.enable_flag,
		t1.salesman_shortcode,
		t1.salesman_city_code,
		t1.create_user_city_code,
		CONCAT(t1.salesman_name,"/",t1.salesman_shortcode) as salesman_name_str,
		(select ifnull(a.bill_code_group, '') from wms_cre_credit_group a where t1.wms_cre_credit_group_id = a.wms_cre_credit_group_id) as bill_code_group
		from wms_cre_credit_head
		t1,wms_cre_credit_line_customer_change_head t2
		<where>
			t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id and
			t1.enable_flag=1 and t2.is_major=1
			and t1.bill_status in ('H','I','KT')
			and t1.version_number='3'
			<if test="create_user_city_code != null">
                and t1.create_user_city_code = #{create_user_city_code}
            </if>
			<if test="bill_code!=null">
				and (t1.bill_code like #{bill_code} or (select ifnull(a.bill_code_group, '') from wms_cre_credit_group a where t1.wms_cre_credit_group_id = a.wms_cre_credit_group_id) like #{bill_code})
			</if>
			<if test="create_timestamp!=null and create_timestamp1!=null">
				and t1.create_timestamp between #{create_timestamp} and
				#{create_timestamp1}
			</if>
			<if test="salesman_name!=null or salesman_shortcode !=null">
				and (t1.salesman_name like#{salesman_name} or
				t1.salesman_shortcode like #{salesman_shortcode})
			</if>
			<if test="id_card!=null">
				and t2.id_card =#{id_card}
			</if>
			 <!-- 权限控制 -->
			<if test="childrendept != null">
				and (FIND_IN_SET(t1.salesman_dept_id, #{childrendept}) > 0)
			</if>
		</where>
		<if test="sortname != '' and sortorder !=''">
			ORDER BY ${sortname} ${sortorder}
		</if>
		<if test="offset != null and pagesize !=null">
			LIMIT ${offset} , ${pagesize}
		</if>
	</select>
	<!-- list 房贷合同补充列表 总数 -->
	<select id="findCountforhouseprotocolList" parameterType="map"
		resultType="int">
		select count(t1.wms_cre_credit_head_id) as count
		from
		wms_cre_credit_head t1 ,wms_cre_credit_line_customer_change_head t2
		<where>
			t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id and
			t1.enable_flag=1 and t2.is_major=1
			and t1.create_user_city_code =#{create_user_city_code}
			and t1.version_number ='2'
			and t1.bill_status in ('F','G','K')
			<if test="create_user_city_code != null">
                and t1.create_user_city_code = #{create_user_city_code}
            </if>
			<if test="bill_code!=null">
					and (t1.bill_code like #{bill_code} or (select ifnull(a.bill_code_group, '') from wms_cre_credit_group a where t1.wms_cre_credit_group_id = a.wms_cre_credit_group_id) like #{bill_code})
			</if>
			<if test="create_timestamp!=null and create_timestamp1!=null">
				and t1.create_timestamp between #{create_timestamp} and
				#{create_timestamp1}
			</if>
			<if test="salesman_name!=null">
				and t1.salesman_name like#{salesman_name}
			</if>
			<if test="id_card!=null">
				and t2.id_card like #{id_card}
			</if>
		</where>
	</select>
		<!-- 补充合同导出 -->
<!-- 	 显示F待放款审核  G待放款 K待审批  H已完成 -->
	<select id="searchforhouseprotocolPageOut" parameterType="map"
		resultType="java.util.HashMap">
		select
		t1.wms_cre_credit_head_id,
		t1.bill_code,
		t1.credit_purpose,
		t1.max_repayment_limit_per_month,
		t1.credit_limit,
		t1.appro_limit,
		t1.visa_limit,
		t1.max_repayment_time_limit,
		t1.enter_file_way,
		t1.payroll_payment_way,
		t1.data_type,
		t1.is_complete,
		t1.reference_type,
		t1.is_other_corporation_done,
		t1.is_to_public_stream,
		t1.is_house_certificate_original,
		t1.is_check,
		t1.person_condition,
		t1.salesman_id,
		t1.salesman_code,
		t1.salesman_name,
		t1.city,
		t1.cre_type,
		(case t1.cre_type when '1' then '信贷产品' when '2' then '房贷产品' end)as
		cre_type_name,
		t1.bill_status,
		(select value_meaning from wms_sys_dict_data where value_code =
		t1.bill_status and wms_sys_dict_id = 24)as bill_status_name,
		t1.water_appro_user_id,
		t1.water_appro_user_name,
		date_format(water_appro_timestamp,'%Y-%m-%d %H:%i:%s') as water_appro_timestamp_str,
		t1.water_appro_timestamp,
		t1.water_appro_result,
		(case t1.water_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略' else
		'待审批' end)as water_appro_result_name,
		t1.info_appro_user_id,
		t1.info_appro_user_name,
		date_format(info_appro_timestamp,'%Y-%m-%d %H:%i:%s') as info_appro_timestamp_str,
		t1.info_appro_timestamp,
		t1.info_appro_result,
		(case t1.info_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略' else
		'待审批' end)as info_appro_result_name,
		t1.phone_appro_user_id,
		t1.phone_appro_user_name,
		date_format(t1.phone_appro_timestamp,'%Y-%m-%d %H:%i:%s') as phone_appro_timestamp_str,
		t1.phone_appro_timestamp,
		t1.phone_appro_result,
		(case t1.phone_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略' else
		'待审批' end)as phone_appro_result_name,
		t1.certificate_appro_user_id,
		t1.certificate_appro_user_name,
		date_format(t1.certificate_appro_timestamp,'%Y-%m-%d %H:%i:%s') as certificate_appro_timestamp_str,
		t1.certificate_appro_timestamp,
		t1.certificate_appro_result,
		(case t1.certificate_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略'
		else '待审批' end)as certificate_appro_result_name,
		t1.create_user_id,
		t1.create_user_name,
		date_format(t1.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp_str,
		t1.create_timestamp,
		t1.last_update_user_id,
		date_format(t1.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp_str,
		t1.last_update_timestamp,
		t1.enable_flag,
		t1.protocol_amount,
		t1.is_link_repeat,
		t1.profession_type,
		t1.is_verify,
		t1.is_guarantee,
		t1.house_appro_user_id,
		t1.house_appro_user_name,
		date_format(t1.house_appro_timestamp,'%Y-%m-%d %H:%i:%s') as house_appro_timestamp_str,
		t1.house_appro_timestamp,
		t1.house_appro_result,
		(case t1.house_appro_result when '0' then '未通过' when '1' then '通过' else
		'待审批' end)as house_appro_result_name,
		t1.cre_loan_type,
		t1.model_one_amount,
		t1.model_two_amount,
		t1.model_three_amount,
		t1.model_four_amount,
		t2.wms_cre_credit_line_customer_change_head_id,
		t2.wms_cre_credit_head_id,
		t2.wms_cus_customer_head_id,
		t2.customer_code,
		t2.customer_name,
		t2.customer_ever_name,
		t2.customer_category,
		t2.gender,
		t2.max_degree,
		date_format(t2.birthday,'%Y-%m-%d') as birthday,
		t2.id_card,
		t2.province,
		t2.city,
		t2.district,
		t2.address_more,
		t2.has_children,
		t2.children_name,
		t2.children_address,
		t2.children_telephone,
		t2.has_married,
		t2.has_house,
		t2.current_address_province,
		t2.current_address_city,
		t2.current_address_district,
		t2.current_address_more,
		t2.post_code,
		t2.fixed_telephone,
		t2.mobile_telephone1,
		t2.service_password1,
		t2.mobile_telephone2,
		t2.service_password2,
		t2.personal_year_income,
		t2.customer_email,
		t2.credit_card_limit,
		t2.common_occupants,
		t2.status,
		t2.create_user_id,
		t2.create_user_name,
		date_format(t2.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t2.last_update_user_id,
		date_format(t2.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
		t2.enable_flag,
		t1.salesman_shortcode,
		t1.salesman_city_code,
		t1.create_user_city_code,
		(case when t1.create_timestamp &lt; #{hprocess_time} then '1' else '2' end) as edition_num, 
		CONCAT(t1.salesman_name,"/",t1.salesman_shortcode) as salesman_name_str
		from wms_cre_credit_head
		t1,wms_cre_credit_line_customer_change_head t2
		<where>
			t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id and
			t1.enable_flag=1 and t2.is_major=1
			and t1.create_user_city_code =
			#{create_user_city_code}
			and t1.version_number ='2'
			and t1.bill_status in ('F','G','K','H')
			<if test="create_user_city_code != null">
                and t1.create_user_city_code = #{create_user_city_code}
            </if>
			<if test="bill_code!=null">
				and t1.bill_code like #{bill_code}
			</if>
			<if test="create_timestamp!=null and create_timestamp1!=null">
				and t1.create_timestamp between #{create_timestamp} and
				#{create_timestamp1}
			</if>
			<if test="salesman_name!=null or salesman_shortcode !=null">
				and (t1.salesman_name like#{salesman_name} or
				t1.salesman_shortcode like #{salesman_shortcode})
			</if>
			<if test="id_card!=null">
				and t2.id_card =#{id_card}
			</if>
		</where>
		<if test="sortname != '' and sortorder !=''">
			ORDER BY ${sortname} ${sortorder}
		</if>
	</select>

	<select id="getcombinedLoanList" parameterType="map" resultType="java.util.HashMap">
	    select
		t1.wms_cre_credit_head_id,
		t1.bill_code,
		t1.credit_purpose,
		t1.max_repayment_limit_per_month,
		t1.credit_limit,
		t1.visa_limit,
		t1.enter_file_way,
		t1.payroll_payment_way,
		t1.data_type,
		t1.is_complete,
		t1.reference_type,
		t1.is_other_corporation_done,
		t1.is_to_public_stream,
		t1.is_house_certificate_original,
		t1.is_check,
		t1.person_condition,
		t1.salesman_id,
		t1.salesman_code,
		t1.salesman_name,
		t1.city,
		t1.cre_type,
		(case t1.cre_type when '1' then '信贷产品' when '2' then '房贷产品' end)as
		cre_type_name,
		t1.bill_status,
		(select value_meaning from wms_sys_dict_data where value_code =
		t1.bill_status and wms_sys_dict_id = 24)as bill_status_name,
		t1.water_appro_user_id,
		t1.water_appro_user_name,
		date_format(water_appro_timestamp,'%Y-%m-%d %H:%i:%s') as water_appro_timestamp_str,
		t1.water_appro_timestamp,
		t1.water_appro_result,
		(case t1.water_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略' else
		'待审批' end)as water_appro_result_name,
		t1.info_appro_user_id,
		t1.info_appro_user_name,
		date_format(info_appro_timestamp,'%Y-%m-%d %H:%i:%s') as info_appro_timestamp_str,
		t1.info_appro_timestamp,
		t1.info_appro_result,
		(case t1.info_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略' else
		'待审批' end)as info_appro_result_name,
		t1.phone_appro_user_id,
		t1.phone_appro_user_name,
		date_format(t1.phone_appro_timestamp,'%Y-%m-%d %H:%i:%s') as phone_appro_timestamp_str,
		t1.phone_appro_timestamp,
		t1.phone_appro_result,
		(case t1.phone_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略' else
		'待审批' end)as phone_appro_result_name,
		t1.certificate_appro_user_id,
		t1.certificate_appro_user_name,
		date_format(t1.certificate_appro_timestamp,'%Y-%m-%d %H:%i:%s') as certificate_appro_timestamp_str,
		t1.certificate_appro_timestamp,
		t1.certificate_appro_result,
		(case t1.certificate_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略'
		else '待审批' end)as certificate_appro_result_name,
		t1.create_user_id,
		t1.create_user_name,
		date_format(t1.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp_str,
		t1.create_timestamp,
		t1.last_update_user_id,
		date_format(t1.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp_str,
		t1.last_update_timestamp,
		t1.enable_flag,
		t1.protocol_amount,
		t1.is_link_repeat,
		t1.profession_type,
		t1.is_verify,
		t1.is_guarantee,
		t1.house_appro_user_id,
		t1.house_appro_user_name,
		date_format(t1.house_appro_timestamp,'%Y-%m-%d %H:%i:%s') as house_appro_timestamp_str,
		t1.house_appro_timestamp,
		t1.house_appro_result,
		(case t1.house_appro_result when '0' then '未通过' when '1' then '通过' else
		'待审批' end)as house_appro_result_name,
		t1.model_one_amount,
		t1.model_two_amount,
		t1.model_three_amount,
		t1.model_four_amount,
		t1.version_number,
		t1.city,
		t1.salesman_shortcode,
		t1.salesman_city_code,
		t1.create_user_city_code,
		CONCAT(t1.salesman_name,"/",t1.salesman_shortcode) as salesman_name_str,
		
		(case  when t2.appro_limit is null then t1.appro_limit else t2.appro_limit/10000 end )as appro_limit,
		t2.borrow_deadline as max_repayment_time_limit,
		 ifnull(
				t2.cre_loan_type,
				t1.cre_loan_type
			) as cre_loan_type,
		(select value_meaning from wms_sys_dict_data where value_code =
		ifnull(t2.cre_loan_type,t1.cre_loan_type) and wms_sys_dict_id = 102)as cre_loan_type_name,
		t2.debtor_name as customer_name,
		t2.debtor_identity_id as id_card,
		date_format(t2.protocol_date,'%Y-%m-%d') as protocol_creat_date,
		
		date_format(t2.borrow_end_date,'%Y-%m-%d') as repay_end_date,
		
		
		t3.bill_code_group,
		t3. appro_limit_group,
		t3.group_date
		from wms_cre_credit_head t1
		JOIN wms_cre_appro_borrow_protocol t2 
		ON 	t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id and t1.enable_flag=1 and t2.enable_flag=1	and t1.bill_status in ('M','F','G','H','K')
		JOIN wms_cre_credit_group t3 
		on t3.wms_cre_credit_group_id = t1.wms_cre_credit_group_id and t3.enable_flag=1
		left JOIN wms_fina_cre_repay t4
		on t4.wms_cre_credit_head_id=t1.wms_cre_credit_head_id and t4.enable_flag=1
	
		<where>
		    t1.create_user_city_code = #{create_user_city_code}
		    and  t1.version_number is not null
		    and (t4.repay_status!=3 or  t4.repay_status is null)
			<if test="customer_name_history != null">
				and t2.debtor_name like #{customer_name_history}
			</if>
			<if test="id_card_history != null">
				and t2.debtor_identity_id like #{id_card_history}
			</if>
			 <if test="begin_time != null">
                and t1.create_timestamp &gt;= #{begin_time}
            </if>
            <if test="end_time != null">
                and t1.create_timestamp &lt;= #{end_time}
            </if>
		</where>
		<if test="sortname != '' and sortorder !=''">
			ORDER BY ${sortname} ${sortorder}
		</if>
		<if test="offset != null and pagesize !=null">
			LIMIT ${offset} , ${pagesize}
		</if>
	</select>
	
	<select id="findCountforgetcombinedLoan" parameterType="map" resultType="int">
	    select
		count(t1.wms_cre_credit_head_id)
		from wms_cre_credit_head t1
		JOIN wms_cre_appro_borrow_protocol t2 
		ON 	t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id and t1.enable_flag=1 and t2.enable_flag=1	and t1.bill_status in ('M','F','G','H','K')
		JOIN wms_cre_credit_group t3 
		on t3.wms_cre_credit_group_id = t1.wms_cre_credit_group_id and t3.enable_flag=1
		left JOIN wms_fina_cre_repay t4
		on t4.wms_cre_credit_head_id=t1.wms_cre_credit_head_id  and t4.enable_flag=1
		<where>
		    t1.create_user_city_code = #{create_user_city_code}
		     and  t1.version_number is not null
		     and (t4.repay_status!=3 or  t4.repay_status is null)
			<if test="customer_name_history != null">
				and t2.debtor_name like #{customer_name_history}
			</if>
			<if test="id_card_history != null">
				and t2.debtor_identity_id like #{id_card_history}
			</if>
			 <if test="begin_time != null">
                and t1.create_timestamp &gt;= #{begin_time}
            </if>
            <if test="end_time != null">
                and t1.create_timestamp &lt;= #{end_time}
            </if>
		</where>
	</select>
	
	<select id="getcombinedLoanListAll" parameterType="map" resultType="java.util.HashMap">
	   select
		t1.wms_cre_credit_head_id,
		t1.bill_code,
		t1.credit_purpose,
		t1.max_repayment_limit_per_month,
		t1.credit_limit,
		t1.visa_limit,
		t1.enter_file_way,
		t1.payroll_payment_way,
		t1.data_type,
		t1.is_complete,
		t1.reference_type,
		t1.is_other_corporation_done,
		t1.is_to_public_stream,
		t1.is_house_certificate_original,
		t1.is_check,
		t1.person_condition,
		t1.salesman_id,
		t1.salesman_code,
		t1.salesman_name,
		t1.city,
		t1.cre_type,
		(case t1.cre_type when '1' then '信贷产品' when '2' then '房贷产品' end)as
		cre_type_name,
		t1.bill_status,
		(select value_meaning from wms_sys_dict_data where value_code =
		t1.bill_status and wms_sys_dict_id = 24)as bill_status_name,
		t1.water_appro_user_id,
		t1.water_appro_user_name,
		date_format(water_appro_timestamp,'%Y-%m-%d %H:%i:%s') as water_appro_timestamp_str,
		t1.water_appro_timestamp,
		t1.water_appro_result,
		(case t1.water_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略' else
		'待审批' end)as water_appro_result_name,
		t1.info_appro_user_id,
		t1.info_appro_user_name,
		date_format(info_appro_timestamp,'%Y-%m-%d %H:%i:%s') as info_appro_timestamp_str,
		t1.info_appro_timestamp,
		t1.info_appro_result,
		(case t1.info_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略' else
		'待审批' end)as info_appro_result_name,
		t1.phone_appro_user_id,
		t1.phone_appro_user_name,
		date_format(t1.phone_appro_timestamp,'%Y-%m-%d %H:%i:%s') as phone_appro_timestamp_str,
		t1.phone_appro_timestamp,
		t1.phone_appro_result,
		(case t1.phone_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略' else
		'待审批' end)as phone_appro_result_name,
		t1.certificate_appro_user_id,
		t1.certificate_appro_user_name,
		date_format(t1.certificate_appro_timestamp,'%Y-%m-%d %H:%i:%s') as certificate_appro_timestamp_str,
		t1.certificate_appro_timestamp,
		t1.certificate_appro_result,
		(case t1.certificate_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略'
		else '待审批' end)as certificate_appro_result_name,
		t1.create_user_id,
		t1.create_user_name,
		date_format(t1.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp_str,
		t1.create_timestamp,
		t1.last_update_user_id,
		date_format(t1.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp_str,
		t1.last_update_timestamp,
		t1.enable_flag,
		t1.protocol_amount,
		t1.is_link_repeat,
		t1.profession_type,
		t1.is_verify,
		t1.is_guarantee,
		t1.house_appro_user_id,
		t1.house_appro_user_name,
		date_format(t1.house_appro_timestamp,'%Y-%m-%d %H:%i:%s') as house_appro_timestamp_str,
		t1.house_appro_timestamp,
		t1.house_appro_result,
		(case t1.house_appro_result when '0' then '未通过' when '1' then '通过' else
		'待审批' end)as house_appro_result_name,
		t1.model_one_amount,
		t1.model_two_amount,
		t1.model_three_amount,
		t1.model_four_amount,
		t1.version_number,
		t1.city,
		t1.salesman_shortcode,
		t1.salesman_city_code,
		t1.create_user_city_code,
		(case when t1.create_timestamp &lt; #{hprocess_time} then '1' else '2' end) as edition_num, 
		CONCAT(t1.salesman_name,"/",t1.salesman_shortcode) as salesman_name_str,
		
		(case  when t2.appro_limit is null then t1.appro_limit else t2.appro_limit/10000 end )as appro_limit,
		t2.borrow_deadline as max_repayment_time_limit,
		 ifnull(
				t2.cre_loan_type,
				t1.cre_loan_type
			) as cre_loan_type,
		(select value_meaning from wms_sys_dict_data where value_code =
		ifnull(t2.cre_loan_type,t1.cre_loan_type) and wms_sys_dict_id = 102)as cre_loan_type_name,
		t2.debtor_name as customer_name,
		t2.debtor_identity_id as id_card,
		date_format(t2.protocol_date,'%Y-%m-%d') as protocol_creat_date,
		
		date_format(t2.borrow_end_date,'%Y-%m-%d') as repay_end_date,
		
		
		t3.bill_code_group,
		t3. appro_limit_group,
		t3.group_date
		from wms_cre_credit_head t1
		JOIN wms_cre_appro_borrow_protocol t2 
		ON 	t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id and t1.enable_flag=1 and t2.enable_flag=1	and t1.bill_status in ('M','F','G','H','K')
		JOIN wms_cre_credit_group t3 
		on t3.wms_cre_credit_group_id = t1.wms_cre_credit_group_id and t3.enable_flag=1
		left JOIN wms_fina_cre_repay t4
		on t4.wms_cre_credit_head_id=t1.wms_cre_credit_head_id 
		where t1.create_user_city_code = #{create_user_city_code}
		 and (t4.repay_status!=3 or  t4.repay_status is null)
	</select>
	
	
	<select id="findCountforgetcombinedLoanAll" parameterType="map" resultType="int">
	    select
		count(t1.wms_cre_credit_head_id)
			from wms_cre_credit_head t1
		JOIN wms_cre_appro_borrow_protocol t2 
		ON 	t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id and t1.enable_flag=1 and t2.enable_flag=1	and t1.bill_status in ('M','F','G','H','K')
		JOIN wms_cre_credit_group t3 
		on t3.wms_cre_credit_group_id = t1.wms_cre_credit_group_id and t3.enable_flag=1
		left JOIN wms_fina_cre_repay t4
		on t4.wms_cre_credit_head_id=t1.wms_cre_credit_head_id 
		where t1.create_user_city_code = #{create_user_city_code}
		 and (t4.repay_status!=3 or  t4.repay_status is null)
	</select>
<!-- 	根据身份证号获取组合贷列表信息 -->
	<select id="getcombinedLoanListForIdCard" parameterType="map" resultType="java.util.HashMap">
		  select
		t1.wms_cre_credit_head_id,
		t1.bill_code,
		t1.credit_purpose,
		t1.max_repayment_limit_per_month,
		t1.credit_limit,
		t1.appro_limit,
		t1.visa_limit,
		t1.max_repayment_time_limit,
		t1.enter_file_way,
		t1.payroll_payment_way,
		t1.data_type,
		t1.is_complete,
		t1.reference_type,
		t1.is_other_corporation_done,
		t1.is_to_public_stream,
		t1.is_house_certificate_original,
		t1.is_check,
		t1.person_condition,
		t1.salesman_id,
		t1.salesman_code,
		t1.salesman_name,
		t1.city,
		t1.cre_type,
		(case t1.cre_type when '1' then '信贷产品' when '2' then '房贷产品' end)as
		cre_type_name,
		t1.bill_status,
		(select value_meaning from wms_sys_dict_data where value_code =
		t1.bill_status and wms_sys_dict_id = 24)as bill_status_name,
		t1.water_appro_user_id,
		t1.water_appro_user_name,
		date_format(water_appro_timestamp,'%Y-%m-%d %H:%i:%s') as water_appro_timestamp_str,
		t1.water_appro_timestamp,
		t1.water_appro_result,
		(case t1.water_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略' else
		'待审批' end)as water_appro_result_name,
		t1.info_appro_user_id,
		t1.info_appro_user_name,
		date_format(info_appro_timestamp,'%Y-%m-%d %H:%i:%s') as info_appro_timestamp_str,
		t1.info_appro_timestamp,
		t1.info_appro_result,
		(case t1.info_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略' else
		'待审批' end)as info_appro_result_name,
		t1.phone_appro_user_id,
		t1.phone_appro_user_name,
		date_format(t1.phone_appro_timestamp,'%Y-%m-%d %H:%i:%s') as phone_appro_timestamp_str,
		t1.phone_appro_timestamp,
		t1.phone_appro_result,
		(case t1.phone_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略' else
		'待审批' end)as phone_appro_result_name,
		t1.certificate_appro_user_id,
		t1.certificate_appro_user_name,
		date_format(t1.certificate_appro_timestamp,'%Y-%m-%d %H:%i:%s') as certificate_appro_timestamp_str,
		t1.certificate_appro_timestamp,
		t1.certificate_appro_result,
		(case t1.certificate_appro_result when '0' then '未通过' when '1' then '通过' when '3' then '已忽略'
		else '待审批' end)as certificate_appro_result_name,
		t1.create_user_id,
		t1.create_user_name,
		date_format(t1.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp_str,
		t1.create_timestamp,
		t1.last_update_user_id,
		date_format(t1.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp_str,
		t1.last_update_timestamp,
		t1.enable_flag,
		t1.protocol_amount,
		t1.is_link_repeat,
		t1.profession_type,
		t1.is_verify,
		t1.is_guarantee,
		t1.house_appro_user_id,
		t1.house_appro_user_name,
		date_format(t1.house_appro_timestamp,'%Y-%m-%d %H:%i:%s') as house_appro_timestamp_str,
		t1.house_appro_timestamp,
		t1.house_appro_result,
		(case t1.house_appro_result when '0' then '未通过' when '1' then '通过' else
		'待审批' end)as house_appro_result_name,
		t1.cre_loan_type,
		(select value_meaning from wms_sys_dict_data where value_code =
		t1.cre_loan_type and wms_sys_dict_id = 102)as cre_loan_type_name,
		t1.model_one_amount,
		t1.model_two_amount,
		t1.model_three_amount,
		t1.model_four_amount,
		t1.version_number,
		t2.wms_cre_credit_line_customer_change_head_id,
		t2.wms_cre_credit_head_id,
		t2.wms_cus_customer_head_id,
		t2.customer_code,
		t2.customer_name,
		t2.customer_ever_name,
		t2.customer_category,
		t2.gender,
		t2.max_degree,
		date_format(t2.birthday,'%Y-%m-%d') as birthday,
		t2.id_card,
		t2.province,
		t2.city,
		t2.district,
		t2.address_more,
		t2.has_children,
		t2.children_name,
		t2.children_address,
		t2.children_telephone,
		t2.has_married,
		t2.has_house,
		t2.current_address_province,
		t2.current_address_city,
		t2.current_address_district,
		t2.current_address_more,
		t2.post_code,
		t2.fixed_telephone,
		t2.mobile_telephone1,
		t2.service_password1,
		t2.mobile_telephone2,
		t2.service_password2,
		t2.personal_year_income,
		t2.customer_email,
		t2.credit_card_limit,
		t2.common_occupants,
		t2.status,
		t2.create_user_id,
		t2.create_user_name,
		date_format(t2.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t2.last_update_user_id,
		date_format(t2.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
		t2.enable_flag,
		t1.salesman_shortcode,
		t1.salesman_city_code,
		t1.create_user_city_code,
		(case when t1.create_timestamp &lt; #{hprocess_time} then '1' else '2' end) as edition_num, 
		CONCAT(t1.salesman_name,"/",t1.salesman_shortcode) as salesman_name_str,
		t4.protocol_creat_date,
		t4.repay_end_date
		from (wms_cre_credit_head
		t1,wms_cre_credit_line_customer_change_head t2)
		left JOIN wms_fina_cre_repay t4
		on  t4.wms_cre_credit_head_id=t1.wms_cre_credit_head_id 
		<where>
			t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id
			and t1.enable_flag=1 and t2.is_major=1
			and t1.bill_status in ('E')
			and t1.wms_cre_credit_group_id is null
			and t1.create_user_city_code =
			#{create_user_city_code}
			and t1.version_number is not null
			<if test="bill_code_search !=null">
				and t1.bill_code != #{bill_code_search}
			</if>
			<if test="customer_name_history !=null">
				and t2.customer_name like #{customer_name_history}
			</if>
			<if test="id_card_history !=null">
				and t2.id_card like #{id_card_history}
			</if>
			 <if test="begin_time != null">
                and t1.create_timestamp &gt;= #{begin_time}
            </if>
            <if test="end_time != null">
                and t1.create_timestamp &lt;= #{end_time}
            </if>
		</where>
		<if test="sortname != '' and sortorder !=''">
			ORDER BY ${sortname} ${sortorder}
		</if>
		<if test="offset != null and pagesize !=null">
			LIMIT ${offset} , ${pagesize}
		</if>
	</select>
	
	<select id="findCountForGetCombinedLoanListForIdCard" parameterType="map" resultType="int">
		select
		count(t1.wms_cre_credit_head_id)
		from (wms_cre_credit_head
		t1,wms_cre_credit_line_customer_change_head t2)
		left JOIN wms_fina_cre_repay t4
		on  t4.wms_cre_credit_head_id=t1.wms_cre_credit_head_id 
		<where>
			t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id
			and t1.enable_flag=1 and t2.is_major=1
			and t1.bill_status in ('E')
			and t1.wms_cre_credit_group_id is null
			and t1.create_user_city_code =
			#{create_user_city_code}
			and t1.version_number is not null
			<if test="bill_code_search !=null">
				and t1.bill_code != #{bill_code_search}
			</if>
			<if test="customer_name_history != null">
				and t2.customer_name like #{customer_name_history}
			</if>
			<if test="id_card_history != null">
				and t2.id_card = #{id_card_history}
			</if>
			 <if test="begin_time != null">
                and t1.create_timestamp &gt;= #{begin_time}
            </if>
            <if test="end_time != null">
                and t1.create_timestamp &lt;= #{end_time}
            </if>
		</where>
	</select>
	<!-- list 房贷终审面签列表 -->
	<select id="searchforhousevisa" parameterType="map" resultType="java.util.HashMap">
		select
		t1.wms_cre_credit_head_id,
		t1.bill_code,
		t1.credit_purpose,
		t1.max_repayment_limit_per_month,
		t1.credit_limit,
		t1.appro_limit,
		t1.visa_limit,
		t1.max_repayment_time_limit,
		t1.enter_file_way,
		t1.payroll_payment_way,
		t1.data_type,
		t1.is_complete,
		t1.reference_type,
		t1.is_other_corporation_done,
		t1.is_to_public_stream,
		t1.is_house_certificate_original,
		t1.is_check,
		t1.person_condition,
		t1.salesman_id,
		t1.salesman_code,
		t1.salesman_name,
		t1.city,
		t1.cre_type,
		t1.bill_status,
		(select value_meaning from wms_sys_dict_data where value_code =
		t1.bill_status and wms_sys_dict_id = 131)as bill_status_name,
		t1.water_appro_user_id,
		t1.water_appro_user_name,
		date_format(water_appro_timestamp,'%Y-%m-%d %H:%i:%s') as water_appro_timestamp_str,
		date_format(t1.phone_appro_timestamp,'%Y-%m-%d %H:%i:%s') as phone_appro_timestamp_str,

		t1.certificate_appro_user_id,
		t1.certificate_appro_user_name,
		date_format(t1.certificate_appro_timestamp,'%Y-%m-%d %H:%i:%s') as certificate_appro_timestamp_str,	
		t1.create_user_id,
		t1.create_user_name,
		date_format(t1.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp_str,
		<!--  t1.create_timestamp,-->
		t1.last_update_user_id,
		date_format(t1.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp_str,
		t1.last_update_timestamp,
		t1.enable_flag,
		t1.protocol_amount,
		t1.is_link_repeat,
		t1.profession_type,
		t1.is_verify,
		t1.is_guarantee,
		t1.house_appro_user_id,
		t1.house_appro_user_name,
		date_format(t1.house_appro_timestamp,'%Y-%m-%d %H:%i:%s') as house_appro_timestamp_str,
		t1.house_appro_timestamp,
		t1.house_appro_result,
		(case t1.house_appro_result when '0' then '不符合' when '1' then '符合' else
		'待审批' end)as house_appro_result_name,
		t1.cre_loan_type,
		t1.model_one_amount,
		t1.model_two_amount,
		t1.model_three_amount,
		t1.model_four_amount,
		t1.version_number,
		t1.assessment_id,
		t1.assessment_datetime,
		t1.assessment_result,
		(case t1.assessment_result when '1' then '通过' when '2' then '退件' when '3' then '拒件' when '4' then '直接验房' else
		'待审批' end)as assessment_result_name,
		t1.assessment_advice,
		t1.assessment_result_page,
		t2.wms_cre_credit_line_customer_change_head_id,
		t2.wms_cre_credit_head_id,
		t2.wms_cus_customer_head_id,
		t2.customer_code,
		t2.customer_name,
		t2.customer_ever_name,
		t2.customer_category,
		t2.gender,
		t2.max_degree,
		date_format(t2.birthday,'%Y-%m-%d') as birthday,
		t2.id_card,
		t2.province,
		t2.city,
		t2.district,
		t2.address_more,
		t2.has_children,
		t2.children_name,
		t2.children_address,
		t2.children_telephone,
		t2.has_married,
		t2.has_house,
		t2.current_address_province,
		t2.current_address_city,
		t2.current_address_district,
		t2.current_address_more,
		t2.post_code,
		t2.fixed_telephone,
		t2.mobile_telephone1,
		t2.service_password1,
		t2.mobile_telephone2,
		t2.service_password2,
		t2.personal_year_income,
		t2.customer_email,
		t2.credit_card_limit,
		t2.common_occupants,
		t2.status,
		t2.create_user_id,
		t2.create_user_name,
		date_format(t2.create_timestamp,'%Y-%m-%d %H:%i:%s') as create_timestamp,
		t2.last_update_user_id,
		date_format(t2.last_update_timestamp,'%Y-%m-%d %H:%i:%s') as last_update_timestamp,
		t2.enable_flag,
		t1.salesman_shortcode,
		t1.salesman_city_code,
		t1.create_user_city_code,
		CONCAT(t1.salesman_name,"/",t1.salesman_shortcode) as salesman_name_str,
		(case t5.approval_result when 'false' then '拒贷' when 'true' then '通过' else
		'待审批' end)as final_result_name,
		t5.approval_result as final_result,
		ifnull(t4.vehicle_evaluation_price, '') as vehicle_evaluation_price
		from wms_cre_credit_head
		t1,wms_cre_credit_line_customer_change_head t2
        LEFT JOIN  (SELECT a.approval_result, 
                           a.wms_cre_credit_head_id,
        			       a.wms_cre_housing_approval_info 
        			  FROM wms_cre_housing_approval_info a,
        			       (select max(wms_cre_housing_approval_info) AS wms_cre_housing_approval_info 
        			          from wms_cre_housing_approval_info
        			         where enable_flag = '1' 
        			           and approval_task_code = "ZSSP" 
        		          GROUP BY wms_cre_credit_head_id) b WHERE a.wms_cre_housing_approval_info = b.wms_cre_housing_approval_info
        		    ) t5  ON t2.wms_cre_credit_head_id = t5.wms_cre_credit_head_id
		left join wms_cre_housing_trial_assessment t4 on t2.wms_cre_credit_head_id = t4.wms_cre_credit_head_id
		<where>
			t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id and
			t1.enable_flag=1 and t2.is_major=1 and t1.cre_type='2'
			and t1.version_number='3'
			and t1.wms_cre_credit_group_id is null
			and t4.enable_flag = 1
			<if test="idList !=null">
				and t1.wms_cre_credit_head_id in
				<foreach collection="idList" index="index" item="wms_cre_credit_head_id"
					open="(" separator="," close=")">
					#{wms_cre_credit_head_id}
				</foreach>
			</if>
			<if test="bill_code!=null">
				and t1.bill_code like #{bill_code}
			</if>
			<if test="create_timestamp!=null and create_timestamp1!=null">
				and t1.create_timestamp between #{create_timestamp} and
				#{create_timestamp1}
			</if>
			<if test="salesman_name!=null or salesman_shortcode !=null">
				and (t1.salesman_name like#{salesman_name} or
				t1.salesman_shortcode like #{salesman_shortcode})
			</if>
			<if test="customer_name != null">
				and t2.customer_name like '${customer_name}'
			</if>
			<if test="id_card!=null">
				and t2.id_card =#{id_card}
			</if>
			<if test="salesman_city_code != null">
                and t1.salesman_city_code = #{salesman_city_code}
            </if>
            <if test="bill_status != null">
                and t1.bill_status = #{bill_status}
            </if>
             <!-- 权限控制 -->
			<if test="childrendept != null">
				and (FIND_IN_SET(t1.salesman_dept_id, #{childrendept}) > 0)
			</if>
		</where>
		<if test="sortname != '' and sortorder !=''">
			ORDER BY ${sortname} ${sortorder}
		</if>
		<if test="offset != null and pagesize !=null">
			LIMIT ${offset} , ${pagesize}
		</if>
	</select>



	<!-- list 房贷终审面签列表 总数 -->
	<select id="findCountforhousevisa" parameterType="map" resultType="int">
		select count(t1.wms_cre_credit_head_id) as count
		from wms_cre_credit_head
		t1,wms_cre_credit_line_customer_change_head t2
		<where>
			t1.wms_cre_credit_head_id=t2.wms_cre_credit_head_id and
			t1.enable_flag=1 and t2.is_major=1 and t1.cre_type='2'
			and t1.version_number='3'
			and t1.wms_cre_credit_group_id is null
			<if test="idList !=null">
				and t1.wms_cre_credit_head_id in
				<foreach collection="idList" index="index" item="wms_cre_credit_head_id"
					open="(" separator="," close=")">
					#{wms_cre_credit_head_id}
				</foreach>
			</if>
			<if test="bill_code!=null">
				and t1.bill_code like #{bill_code}
			</if>
			<if test="create_timestamp!=null and create_timestamp1!=null">
				and t1.create_timestamp between #{create_timestamp} and
				#{create_timestamp1}
			</if>
			<if test="salesman_name!=null">
				and t1.salesman_name like#{salesman_name}
			</if>
			<if test="customer_name != null">
				and t2.customer_name like '${customer_name}'
			</if>
			<if test="id_card!=null">
				and t2.id_card =#{id_card}
			</if>
			<if test="salesman_city_code != null">
                and t1.salesman_city_code = #{salesman_city_code}
            </if>
            <if test="bill_status != null">
                and t1.bill_status = #{bill_status}
            </if>
            <!-- 权限控制 -->
			<if test="childrendept != null">
				and (FIND_IN_SET(t1.salesman_dept_id, #{childrendept}) > 0)
			</if>
		</where>
	</select>
</mapper> 
