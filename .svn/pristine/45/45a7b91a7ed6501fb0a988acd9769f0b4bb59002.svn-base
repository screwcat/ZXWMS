<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>放款确认</title>
<link href="../../css/app.css" type="text/css" rel="stylesheet" />
<link href="../../css/zx-all.css" rel="stylesheet" type="text/css" />
<script language="Javascript" src="../../js/zx-all.js"> </script>
<script src="../../js/ajaxfileupload.js" type="text/javascript"></script>
<script src="../../js/ligerui.all.js" type="text/javascript"></script>

<style type="text/css">
.textright {
	text-align: right;
}

.textleft {
	text-align: left;
}
/*input_tb css*/
.input_tb_new {
	/*border:1px solid #dfdfdf;*/
	width: 100%;
	margin-bottom: 10px;
}

.input_tb_new a {
	color: #056aff;
	text-decoration: none;
	font-weight: normal;
}

.input_tb_new td {
	height: 35px;
	line-height: 25px;
	/*border-bottom:1px dashed #d5d5d5;*/
	padding-top: 3px;
}

.input_tb_new .tr_title td {
	background-color: #f5f8ff;
	padding-left: 16px;
	font-weight: bold;
	height: 30px;
	line-height: 30px;
	/*border-bottom:1px solid #dfdfdf;*/
}

.input_tb_new .tr_last td {
	border-bottom: 0;
}

.input_tb_new .title {
	text-align: right;
}

.input_tb_new .subtitle {
	text-align: left;
	background-color: #d2e1fd;
	border-top: 1px solid #fff;
	/*border-left:1px solid #fff;*/
}

.input_tb_new .tr_btn_input td {
	background-color: #fbfbfb;
	/*border-top:1px solid #dbdbdb;*/
	/*height:40px;*/
}

.title_tb {
	background-color: #f5f8ff;
	padding-left: 16px;
	font-weight: bold;
	height: 30px;
	line-height: 30px;
	height: 35px;
	line-height: 25px;
	padding-top: 3px;
}

.data_tb td {
	height: 30px;
	line-height: 24px;
	padding-left: 10px;
	border-bottom: 1px dashed #e3e4e6;
	text-align: left;
}
</style>
</head>
<body>
	<div class="tab_titleT">
		<!--查询条件  begin-->
		<table width="100%" border="0" cellspacing="0" cellpadding="0">
			<tr valign="bottom" id='trtab1'>
				<td class="tabbody1" id="tabbody1" onclick="changeTab('transfer');"><div
						align="center">转账单</div></td>
				<td class="tabbody2" id="tabbody2" onclick="changeTab('workflow');"><div
						align="center">流程历程</div></td>
			</tr>
		</table>
	</div>
	<div class="pop-center overflow-au" style="top: 30px;">
		<div id="transfer" class="pop-formDiv clearfix"
			style="margin: 5px; margin-top: 5px;">
			<div class="float-l">
				<div class="pop-form-title">客户姓名：</div>
				<div class="pop-form-item">
					<input type="text" id="debtor_name" style="width: 150px;"
						readonly="readonly" />
				</div>
			</div>
			<div class="float-l">
				<div class="pop-form-title">合同编号：</div>
				<div class="pop-form-item">
					<input type="text" id="protocol_id_year_num" style="width: 150px;"
						readonly="readonly" />
				</div>
			</div>
			<div class="float-l">
				<div class="pop-form-title">合同日期：</div>
				<div class="pop-form-item">
					<input type="text" id="protocol_date" style="width: 150px;"
						readonly="readonly" />
				</div>
			</div>
			<div class="float-l">
				<div class="pop-form-title">合同金额：</div>
				<div class="pop-form-item">
					<input type="text" id="principal_lower" style="width: 134px;"
						readonly="readonly" />&nbsp;元
				</div>
			</div>
			<div class="float-l">
				<div class="pop-form-title">公证费：</div>
				<div class="pop-form-item">
					<input type="text" id="notarial_fee" style="width: 134px;"
						readonly="readonly" />&nbsp;元
				</div>
			</div>
			<div class="float-l">
				<div class="pop-form-title">平台费：</div>
				<div class="pop-form-item">
					<input type="text" id="platform_fee" style="width: 135px;"
						readonly="readonly" />&nbsp;元
				</div>
			</div>
			<div class="float-l">
				<div class="pop-form-title">利率：</div>
				<div class="pop-form-item">
					<input type="text" id="borrow_interest" style="width: 134px;"
						readonly="readonly" />&nbsp;%
				</div>
			</div>
			<div class="float-l">
				<div class="pop-form-title">转账金额：</div>
				<div class="pop-form-item">
					<input type="text" id="loan_amount" style="width: 134px;"
						readonly="readonly" value=" " />&nbsp;元
				</div>
			</div>
			<div class="float-l">
				<div class="pop-form-title"></div>
				<div class="pop-form-item"></div>
			</div>
			<div class="float-l">
				<div class="pop-form-title">银行：</div>
				<div class="pop-form-item">
					<input type="text" id="receive_bank" style="width: 150px;"
						readonly="readonly" />
				</div>
			</div>
			<div class="float-l">
				<div class="pop-form-title">开户行：</div>
				<div class="pop-form-item">
					<input type="text" id="bank_of_deposit" style="width: 150px;"
						readonly="readonly" />
				</div>
			</div>
			<div class="float-l">
				<div class="pop-form-title">卡号：</div>
				<div class="pop-form-item">
					<input type="text" id="card_no" style="width: 150px;"
						readonly="readonly" />
				</div>
			</div>
			<div class="float-l">
				<div class="pop-form-title">备注：</div>
				<div class="pop-form-item">
					<textarea id="remark" name="remark" rows="35" cols="100"
						style="width: 698px; height: 80px;" readonly="readonly"></textarea>
				</div>
			</div>
			<div class="float-l  clearboth">
				<div class="pop-form-title"></div>
				<div class="pop-form-item"></div>
			</div>
			<div class="float-l  clearboth">
				<div class="pop-form-title"></div>
				<div class="pop-form-item"></div>
			</div>
			<div class="float-l  clearboth" style="display: none">
				<div class="pop-form-title">放款日期</div>
				<div class="pop-form-item">
					<input type="text" id="loan_date" style="width: 300px;"
						readonly="readonly" />
				</div>
			</div>
			<!-- 添加的虚线 -->
			<div class="line clearboth"></div>
			<div style="margin-top: 7px">
				<div
					style="float: left; width: 70px; margin-left: 23px; margin-right: 10px">
					身份证附件：</div>
				<div style="float: left">
					<div id="showIdImage"></div>
					<div id="upload_id"></div>
				</div>
			</div>
			<!-- 添加的虚线 -->
			<div class="line clearboth"></div>
			<div style="margin-top: 7px">
				<div
					style="float: left; width: 70px; margin-left: 23px; margin-right: 10px">
					银行卡附件：</div>
				<div style="float: left">
					<div id="showAmountImage"></div>
					<div id="upload_amount"></div>
				</div>
			</div>
		</div>
		<div id="workflow" class="pop-formDiv clearfix"
			style="margin: 5px; margin-top: 5px; display: none;">

			<div class="float-l clearboth" style="height: 10px;"></div>
			<div class="center-content clearboth" style="min-width: 500px;">
				<div class="center-title">流程历程</div>
				<div class="center-txt" style="margin-bottom: 10px;">
					<div id="grid"></div>
				</div>
			</div>
		</div>
	</div>

	<!-- 提交功能按钮区 -->
	<div class="pop-footer5 clearboth" style="bottom: 1px;" id="tb_btn">
		<input id="tjbtn" onclick="sp()" class="btn-saveT"
			onmouseover="this.className='btn-saveT-over'"
			onmouseout="this.className='btn-saveT'"
			onmousedown="this.className='btn-saveT-down'" type="button"
			style="align: right" /> <input id="cancelBtnId" class="btn-cancel"
			onmouseover="this.className='btn-cancel-over'"
			onmouseout="this.className='btn-cancel'"
			onmousedown="this.className='btn-cancel-down'" type="button"
			onclick="closePage();" />
	</div>

	<script type="text/javascript">
   //获取paymentConfirmationList传递过来的主表单ID
	var wms_cre_credit_head_id = $.query.get("wms_cre_credit_head_id");
   	var taskId = $.query.get("taskId");
	$(function(){
		lookpage();
		initForm();
		initGrid();
		search();		
	});
	function lookpage(){
		$("input[type=text]").attr({
			"disabled" : "disabled"
		});
		$("textarea").attr({
			"disabled":"disabled"
		});		
	}	
	function initForm(){
		$.getJSON(globalUtil.getTimestampUrl('/loanfina/borrowandloanappbypk.do'),
				{
					"wms_cre_credit_head_id" : wms_cre_credit_head_id
				},
				function(json) {					
					globalUtil.setFormVal("transfer", json);
					$("#upload_id").html('');
					$("#uploan_amount").html('');
					var fjList=globalUtil.syncGetJson('/loanfina/wmsfinacreloanappattwithoutpaginglist.do',{
					"wms_fina_cre_loan_app_id": json.wms_fina_cre_loan_app,//期还款台账id
			        },'POST');
					var idHtml='';
					var amountHtml='';
					for (var i = 0; i < fjList.Rows.length; i++) {
						if(fjList.Rows[i].data_type==1 || fjList.Rows[i].data_type == null){
							idHtml +='<div style="margin-bottom:8px;" id="delUploadDivId'+fjList.Rows[i].attachment_new_name+'">';
							idHtml += '<a  target="_blank"  href="'+global_param.upload_file_url+fjList.Rows[i].attachment_address+'">'+'<img style="width:700px;height:auto;" src="'+global_param.upload_file_url+fjList.Rows[i].attachment_address+'" /></a>';
							idHtml += '</div>'
						}else if(fjList.Rows[i].data_type==2){
							amountHtml +='<div style="margin-bottom:8px;" id="delUploadDivId'+fjList.Rows[i].attachment_new_name+'">';
							amountHtml += '<a  target="_blank"  href="'+global_param.upload_file_url+fjList.Rows[i].attachment_address+'">'+'<img style="width:700px;height:auto;" src="'+global_param.upload_file_url+fjList.Rows[i].attachment_address+'" /></a>';
							amountHtml += '</div>'
						}
					}
					$("#showIdImage").html(idHtml);	
					$("#showAmountImage").html(amountHtml);
					$('#borrow_interest').val(parseFloat($('#borrow_interest').val())+parseFloat(json.service_cost_month));
		});		
	}
	//切换tab页
    function changeTab(id) {
		var transfer = document.getElementById("transfer"); //客户资料tab
		var workflow = document.getElementById("workflow"); //工作流历程显示
		if (id == 'transfer') {
			document.getElementById("tabbody1").className = "tabbody1";
			document.getElementById("tabbody2").className = "tabbody2";
			transfer.style.display = '';
			workflow.style.display = 'none';
		} else if (id == 'workflow') {
			document.getElementById("tabbody1").className = "tabbody2";
			document.getElementById("tabbody2").className = "tabbody1";
			transfer.style.display = 'none';
			workflow.style.display = '';
		}
	}
	
	//初始化流程历程
    function initGrid() {
    	var columns_top = [{
            display: '节点名称',
            name: 'taskName',
            width: 100,
            minWidth: 100,
            render: function (rowdata, rowindex, value) { 
				if(rowdata.taskName == '证信审批'){
					return  '征信审批';
				}else if(rowdata.taskName == '信息审批'){
					return  '信息调查';
				}
				return value;
    		}
        }, {
            display: '审批人',
            name: 'approvers',
            width: 120,
            minWidth: 120
        },{
            display: '审批人部门',
            name: 'personnel_deptName',
            width: 130,
            minWidth: 130
        },{
            display: '职务',
            name: 'personnel_postName',
            width: 100,
            minWidth: 100	
        },{
            display: '操作',
            name: 'approveResult',
            width: 100,
            minWidth: 100
        },{
            display: '审批结果',
            name: 'approveResult',
            width: 100,
            minWidth: 100
        },{
            display: '审批意见',
            name: 'approveAdvice',
            width: 135,
            minWidth: 135
        },{
            display: '审批时间',
            name: 'approveTime',
            width: 130,
            minWidth: 130
        }];
    	var url =global_param.context_name + '/cremanage/approvalProcessView.do?wms_cre_credit_head_id='+wms_cre_credit_head_id;    		
        gridTop = $("#grid").ligerGrid({
    		columns: columns_top,
    		url:url ,
    		rownumbers: true,
    		allowUnSelectRow: true,
    		usePager: false,
    		width: '100%',
    		height: '60%',
    		heightDiff: -4,
    		parms: {
    			_filterParms: -1
    		}
        });
      }
  	//查询
	function search() {
		global_ligerui_extend.search(gridTop);
	}
  	//弹出审批页面
	function sp(){
		var url = globalUtil.getHtml("spapprove.html?wms_cre_credit_head_id="+wms_cre_credit_head_id);
		dialog=$.ligerDialog.open({
			url:url,
			title: '审批',
	        width: 870,
	        height: globalUtil.setDialogHeight(600),
	        onHiddenOrClose: function(){
	    	},
	        isResize: false
		});  
	}
  	//保存
    function save(pass,advice){
  		var params = {};
  		params.pass = pass;
  		params.advice = advice;  	
  		params.taskId = taskId;
		$.post(globalUtil.getTimestampUrl("/loanappro/makeloanapprovalsave.do?wms_cre_credit_head_id="+wms_cre_credit_head_id), params,
		function(data) {
        	if (data === 'success') {
            	 globalUtil.successMsg(globalErrorMsg['100002'],
            		function(){            		 		
            		   refreshAndClosePage();
            	 });//保存成功
            }else {
                globalUtil.errorMsg(globalErrorMsg['100012']); //保存失败
            }
        });
    }

 	//关闭本页并刷新查询页面
    function refreshAndClosePage(){   
    	window.parent.search();
    	closePage();
    }
 	//关闭页面
    function closePage(){
    	window.parent.dialog.hide();
    }
 
	</script>
</body>
</html>
