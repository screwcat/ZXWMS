<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>业务管理>理财管理>理财上单</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link href="../../css/app.css" type="text/css" rel="stylesheet" />
<link href="../../css/zx-all.css" rel="stylesheet" type="text/css" />
<script src="../../js/zx-all.js" type="text/javascript"></script>
<style type="text/css">
#lcsqxxtable td {
	padding: 7px;
}
</style>
</head>
<body>
	<div style="margin-bottom: 1px">
		<div class="tab_titleT">
			<table width="100%" border="0" cellspacing="0" cellpadding="0">
				<tr valign="bottom">
					<td class="tabbody1" id="tabbody1" onclick="changeTab('khxx');">
						<div align="center" id="khxxtabdiv" class="tab_step tab_step101">开户信息</div>
					</td>
					<!--  <td style="display: none" class="tabbody2" id="tabbody2" onclick="changeTab('zqxx');"><div align="center" id="zqxxtabdiv" class="tab_step tab_step202">债权信息</div></td>-->
					<td style="display: none" class="tabbody2" id="tabbody3" onclick="changeTab('syxx');">
						<div align="center" id="syxxtabdiv" class="tab_step tab_step202">收益信息</div>
					</td>
					<td style="display: none" class="tabbody2" id="tabbody4" onclick="changeTab('rzxx');">
						<div align="center" id="rzxxtabdiv" class="tab_step tab_step302">交易详情</div>
					</td>
				</tr>
			</table>
		</div>
		<div  class="pop-center overflow-au" style="top: 30px">
			<div id="khxx" class="center-content" style="min-width: 600px; height: auto">
					<table width="40%" border="0" cellspacing="0" cellpadding="0">
						<tr>
							<td width="10%" class="tabbody01" id="tabbody01" onclick="changeTab02('khd');"><div
								align="center" id="khdtabdiv" class="tab_step tab_step101">开户单</div>
							</td>
							<td  width="10%" class="tabbody02" id="tabbody02" onclick="changeTab02('khzl');"><div
								align="center" id="khzltabdiv" class="tab_step tab_step202">客户资料</div>
							</td>
							<td  width="10%" style="display: none" class="tabbody02" id="tabbody03" onclick="changeTab02('zfxq');"><div
								align="center" id="zfxqtabdiv" class="tab_step tab_step202">支付详情</div>
							</td>
							<td  width="10%" style="display: none;" class="tabbody02" id="tabbody04" onclick="changeTab02('zqxx');">
								<div align="center" id="zqxxtabdiv" class="tab_step tab_step202">债权信息</div>
							</td>
						</tr>
					</table>
			<div class="pop-center overflow-au" style="top: 40px">
				<div id="khd">
					<div class="center-title">
						客户基本信息
						<label class="btxts">（</label>
						<label class="btxts" style="color: red">*为必填项</label>
						<label class="btxts">）</label>
					</div>
					<div id="searchTJ" class="searchTJ">
						<!--查询条件 -->
						<div class="float-l commonstyle clearboth" style="margin-top: 5px;margin-left: 6px">
							<div class="pop-form-title2">
								 联系电话：
							</div>
							<div class="pop-form-item">
								<input type="text" name="mobile_phone_search" id="mobile_phone_search" style="width: 196px"  onkeyup="deleteChang(0)"/>
							</div>
						</div>
						<div class="float-l commonstyle"  style="margin-top: 5px">
							<div class="pop-form-title2">
								有效证件：
							</div>
							<div class="pop-form-item">
								<input type="text" name="id_card_search" style="width: 196px" maxlength="18" id="id_card_search"  onkeyup="deleteChang(1)"/>
							</div>
						</div>
						<!--查询button -->
						<div class="float-l commonstyle"  style="margin-top: 5px">
							<div style="margin-bottom: 6px;">
								<input id="cxbtn" onclick="searchInfo();" class="btn-search" type="button" style="margin-right: 7px;" id='search_btn'/>
							</div>
						</div>
<!-- 						清空button -->
<!-- 						<div class="float-l commonstyle"  style="margin-top: 5px"> -->
<!-- 							<div style="margin-bottom: 6px;"> -->
<!-- 								<input id="qkbtn" onclick="clearInfo();" class="btn-search" -->
<!-- 									 type="button" -->
<!-- 									style="margin-right: 7px;" id='search_btn'/> -->
<!-- 							</div> -->
<!-- 						</div> -->
						
<!-- 							分割线 -->
						<div class="float-l commonstyle clearboth">
							<div style="width:1000px;height:8px;border-bottom:1px dashed #999; margin-left: 50px"></div>
						</div>
					</div>
<!-- 					查询条件end -->
				<div class="center-txt clearfix" style="margin-bottom: 5px;padding: 5px; border: 1px solid #BFBFBF; height: auto;">
						<div class="float-l commonstyle clearboth" style="margin-top: 5px">
							<div class="pop-form-title2">
								<span class="redstar">*</span>客户来源：
							</div>
							<div class="pop-form-item">
								<input type="text" name="customer_source" id="customer_source" class="bitian" onchange="change_customer_source();"/>
							</div>
						</div>
						<div class="float-l commonstyle" style="margin-top: 5px">
							<div class="pop-form-title2">
								 <span class="redstar">*</span>联系电话：
							</div>
							<div class="pop-form-item">
								<input type="text" name="mobile_phone" class="bitian" id="mobile_phone" style="width: 196px"/>
							</div>
						</div>
						<div class="float-l commonstyle clearboth">
							<div class="pop-form-title2">
								<span class="redstar">*</span>
								<span id="certificate_type_name">有效证件</span>：
							</div>
							<div class="pop-form-item">
								<input type="text" name="id_card" class="bitian" style="width: 196px" maxlength="18" id="id_card" onchange="setbirthday();"/>
								<input type="hidden" name="certificate_type" style="width: 196px" id="certificate_type"/>
							</div>
						</div> 
						<div class="float-l commonstyle">
							<div class="pop-form-title2">
								<span class="redstar">*</span>客户姓名：
							</div>
							<div class="pop-form-item">
								<input type="text" name="cus_name" id="cus_name" class="bitian" style="width: 196px" maxlength="50"/>
							</div>
						</div>
						<div class="float-l commonstyle" style="margin-left: -24px">
							<div class="pop-form-title2">
								<span class="redstar">*</span>性别：
							</div>
							<div class="pop-form-item">
								<input type="radio" name="cus_gender" value="1" class="radio3" />
								男 
								<input type="radio" name="cus_gender" value="0" class="radio3" />
								女
							</div>
						</div>
						<div class="float-l clearboth commonstyle">
							<div class="pop-form-title2">出生日期：</div>
							<div class="pop-form-item">
								<input type="text" name="cus_birthday" id="cus_birthday" style="width: 196px" maxlength="25" readonly="readonly" />
							</div>
						</div>
						<div class="float-l commonstyle " style="display: none;">
							<div class="pop-form-title2">邮编：</div>
							<div class="pop-form-item">
								<input type="text" name="post_code" id='post_code' style="width: 196px" maxlength="6" />
							</div>
						</div>
						<div class="float-l commonstyle clearboth" style="display: none;">
							<div class="pop-form-title2">居住电话：</div>
							<div class="pop-form-item">
								<input type="text" name="address_phone" id="address_phone" style="width: 196px" maxlength="25" />
							</div>
						</div>
						<div class="float-l commonstyle "  style="display: none;">
							<div class="pop-form-title2">居住地址：</div>
							<div class="pop-form-item">
								<input type="text" name="cus_address" style="width: 544px;" id="cus_address" maxlength="250" />
							</div>
						</div>
						
						<div class="float-l commonstyle clearboth"  style="display: none;">
							<div class="pop-form-title2">办公室电话：</div>
							<div class="pop-form-item">
								<input type="text" name="work_phone" style="width: 196px" id="work_phone" maxlength="25" />
							</div>
						</div>
						<div class="float-l commonstyle">
							<div class="pop-form-title2">通讯地址：</div>
							<div class="pop-form-item">
								<input type="text" name="contact_address" id="contact_address" style="width: 544px;" maxlength="250" />
							</div>
						</div>
						<div class="float-l commonstyle clearboth"  style="display: none;">
							<div class="pop-form-title2">传真号码：</div>
							<div class="pop-form-item">
								<input type="text" name="cus_fax" id="cus_fax" style="width: 196px" maxlength="25" />
							</div>
						</div>
						<div class="float-l commonstyle">
							<div class="pop-form-title2">电邮地址：</div>
							<div class="pop-form-item">
								<input type="text" name="customer_email" id="customer_email" style="width: 544px;" maxlength="50" />
							</div>
						</div>
<!-- 						<div class="float-l commonstyle clearboth clearfix" -->
<!-- 							style="height: auto"> -->
<!-- 							<div class="pop-form-title2"> -->
<!-- 								客户资料： -->
<!-- 							</div> -->
<!-- 							<div class="pop-form-item"> -->
<!-- 								<input id="uploadButton" class="btn-uploadF" -->
<!-- 									onmouseover="this.className='btn-uploadF-over'" -->
<!-- 									onmouseout="this.className='btn-uploadF'" -->
<!-- 									onmousedown="this.className='btn-uploadF-down'" type="button" -->
<!-- 									style="margin-right: 7px;" onclick="openAddAttDialog()" /> -->
<!-- 							</div> -->
<!-- 							<div class="pop-form-item clearfix" id="fileinfo" -->
<!-- 								style="height: auto"></div> -->
<!-- 						</div> -->
					</div>
<!-- 				</div> -->
<!-- 				<div  id="lcsqxxdiv"> -->
					<div class="center-title">
						理财申请信息
						<label class="btxts">（</label>
						<label class="btxts" style="color: red">*为必填项</label>
						<label class="btxts">）</label>
					</div>
					<div id="lcsqxxdiv" class="center-txt clearfix" style="margin-bottom: 5px; padding: 5px; border: 1px solid #BFBFBF; height: auto">
						<div class="float-l commonstyle" style="height: 35px; margin-left: 14px" id="sxtj">
							<!-- 
							<div class="pop-form-title2">热销产品：</div>
							<div class="pop-form-item" id="hotProduct">
								<a href="#" onclick="setHotProduct();">顶置第二行</a>
							</div>
							 -->
							<div class="pop-form-title2 clearboth">理财产品：</div>
							<div class="pop-form-item">
								<input type="text" id="searchProduct" /> 
								<a href="#" onclick="searchProduct();">查询</a> 
								<a href="#" onclick="clearSearchProduct();">清空</a>
							</div>
							<div class="pop-form-title2">理财产品发布平台：</div>
							<div class="pop-form-item">
								<input type="text" id="searchPlatform" /> 
								<a href="#" onclick="searchPlatform();">查询</a> 
								<a href="#" onclick="clearSearchPlatform();">清空</a>
							</div>
						</div>
						<div class="float-l commonstyle clearboth">
							<table id="lcsqxxtable" border="1" bordercolor="#BFBFBF" style="text-align: center; margin-left: 55px; margin-bottom: 5px; margin-top: 3px">
								<tr class="lcsqxxtr" style="background-color: #676b73; color: white" id="headtr">
									<td width="120px" class="title"><span class="redstar">*</span>产品选择</td>
									<td width="80px" class="title">产品发布平台</td>
									<td width="50px" class="title">理财期限</td>
									<td width="70px" class="title">年化利率(%)</td>
									<td width="320px" class="title">奖励利率(%)</td>
									<td width="80px" class="title">产品类型</td>
									<td width="130px" class="title">产品最大限制金额(万元)</td>
									<td width="106px" class="title">上单最小金额(万元)</td>
									<td width="106px" class="title">上单最大金额(万元)</td>
									<td width="106px" class="title">追单最小金额(万元)</td>
									<td width="106px" class="title">追单最大金额(万元)</td>
									<td width="120px" class="title"><span class="redstar">*</span>上单/追单金额(万元)</td>
									<td width="70px" class="title">预计收益(元)</td>
								</tr>
								<tr class="endtr" style="background: #F5F9FF">
									<td colspan="11" align="right">
										合计投资金额：小写 
									   <input id="product_total_count_lower" type="text" name="product_total_count_lower" style="width: 130px" maxlength="25" readonly="readonly" /> 
										万元，大写 
										<input type="text" id="product_total_count_upper" name="product_total_count_upper" style="width: 150px" maxlength="25" readonly="readonly" /> 万元
									</td>
								</tr>
							</table>
						</div>
						<div class="float-l commonstyle clearboth" style="margin-left: 10px;">
							<div class="pop-form-title">
								<span class="redstar">*</span>业务员姓名：
							</div>
							<div class="pop-form-item">
								<input id="salesman_name" type="text" style="width: 140px" readonly="readonly" /> 
									<a href="#" onclick="searchPersonnel(this)" id="searchPersonnel_href">
										<span style="display: none;">选择</span>
									</a> 
									<input id="salesman_id" type="hidden" /> 
									<input id="salesman_city_code" type="hidden" />
									<input id="salesman_dept_id" type="hidden" />
									<input id="salesman_city" type="hidden" /> 
							</div>
						</div>
						<div class="float-l commonstyle">
							<div class="pop-form-title">
								<span class="redstar">*</span>部门经理：
							</div>
							<div class="pop-form-item">
								    <input id="department_manager_name" type="text" style="width: 140px" readonly="readonly" />
								    <a href="#" onclick="searchPersonnel(this)" class="searchPersonnel_jl" style="display: none;">选择</a> 
									<input id="department_manager_id" type="hidden" /> 
									<input id="department_manager_city_code" type="hidden" />
									<input id="department_manager_dept_id" type="hidden" />
									<input id="department_manager_city" type="hidden" />  
							</div>
						</div>
						<div class="float-l commonstyle">
							<div class="pop-form-title">
								<span class="redstar">*</span>中分总：
							</div>
							<div class="pop-form-item">
								    <input id="center_manager_name" type="text" style="width: 140px" readonly="readonly" />
								    <a href="#" onclick="searchPersonnel(this)" class="searchPersonnel_jl" style="display: none;">选择</a> 
									<input id="center_manager_id" type="hidden" /> 
									<input id="center_manager_dept_id" type="hidden" />
							</div>
						</div>
						<div class="float-l commonstyle">
							<div class="pop-form-title">
								<span class="redstar">*</span>副总经理：
							</div>
							<div class="pop-form-item">
								   <input id="vice_general_manager_name" type="text" style="width: 140px" readonly="readonly" /> 
								   <a href="#" onclick="searchPersonnel(this)" class="searchPersonnel_jl" style="display: none;">选择</a> 
									<input id="vice_general_manager_id" type="hidden" /> 
									<input id="vice_general_manager_city_code" type="hidden" />
									<input id="vice_general_manager_dept_id" type="hidden" />
									<input id="vice_general_manager_city" type="hidden" /> 
							</div>
						</div>
						<div class="float-l commonstyle">
							<div class="pop-form-title">
								<span class="redstar">*</span>总经理：
							</div>
							<div class="pop-form-item">
								    <input id="general_manager_name" type="text" style="width: 140px" readonly="readonly" />  
								    <a href="#" onclick="searchPersonnel(this)" class="searchPersonnel_jl" style="display: none;">选择</a> 
									<input id="general_manager_id" type="hidden" /> 
									<input id="general_manager_city_code" type="hidden" />
									<input id="general_manager_dept_id" type="hidden" />
									<input id="general_manager_city" type="hidden" />
							</div>
						</div>
						
						<!-- 单据归属信息 -->
						<div id="bel_inve_transa_div_id" style="display: none;">
							<div class="float-l commonstyle clearboth" style="margin-left: 10px;">
								<div class="pop-form-title">
									<span class="redstar">*</span>归属业务员：
								</div>
								<div class="pop-form-item">
									<input id="bel_salesman_name" type="text" style="width: 140px" readonly="readonly" /> 
								</div>
							</div>
							<div class="float-l commonstyle">
								<div class="pop-form-title">
									<span class="redstar">*</span>归属部门经理：
								</div>
								<div class="pop-form-item">
									<input id="bel_department_manager_name" type="text" style="width: 140px" readonly="readonly" />
								</div>
							</div>
							<div class="float-l commonstyle">
								<div class="pop-form-title">
									<span class="redstar">*</span>归属中分总：
								</div>
								<div class="pop-form-item">
									<input id="bel_center_manager_name" type="text" style="width: 140px" readonly="readonly" />
								</div>
							</div>
							<div class="float-l commonstyle">
								<div class="pop-form-title">
									<span class="redstar">*</span>归属副总经理：
								</div>
								<div class="pop-form-item">
									<input id="bel_vice_general_manager_name" type="text" style="width: 140px" readonly="readonly" /> 
								</div>
							</div>
							<div class="float-l commonstyle">
								<div class="pop-form-title">
									<span class="redstar">*</span>归属总经理：
								</div>
								<div class="pop-form-item">
									<input id="bel_general_manager_name" type="text" style="width: 140px" readonly="readonly" />  
								</div>
							</div>
						</div>
						<!-- 单据归属信息结束 -->
						<input type="hidden" id="bel_salesman_id_id" name="bel_salesman_id_id"></input>
						<input type="hidden" id="bel_salesman_dept_id" name="bel_salesman_dept_id"></input>
						<input type="hidden" id="bel_department_manager_id" name="bel_department_manager_id"></input>
						<input type="hidden" id="bel_department_manager_dept_id" name="bel_department_manager_dept_id"></input>
						<input type="hidden" id="bel_vice_general_manager_id" name="bel_vice_general_manager_id"></input>
						<input type="hidden" id="bel_vice_general_manager_dept_id" name="bel_vice_general_manager_dept_id"></input>
						<input type="hidden" id="bel_general_manager_id" name="bel_general_manager_id"></input>
						<input type="hidden" id="bel_general_manager_dept_id" name="bel_general_manager_dept_id"></input>
						<input type="hidden" id="bel_center_manager_id" name="bel_center_manager_id"></input>
						<input type="hidden" id="bel_center_manager_dept_id" name="bel_center_manager_dept_id"></input>
						
						
						<div class="float-l commonstyle clearboth" style="margin-left: 10px">
							<div class="pop-form-title2" style="width: 400px;">
								<span class="redstar">*</span>合同编号：
								<input id="financial_bill_code" type="text" style="width: 140px"></input>
								&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
								<span class="redstar">*</span>所有账单默认发送地址：
							</div>
							<div class="pop-form-item">
								<input type="radio" name="bill_send_mode" value="1" class="radio3" /> 
								电邮地址 
								<input type="radio" name="bill_send_mode" value="3" class="radio3" />
								通讯地址
							</div>
						</div>
					</div>
					
					<!-- 收益卡信息 -->
					<div class="center-title" style="margin-top: 20px;display: none;" id="customer_income_card_title">
			                                        客户收益卡信息
			             &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  
			             <span id="bank_info_title" style="display: none;">                
			          	      <input type="radio" name="is_bank_card" value='1' class="radio5" onchange="changeRadio(this);">全新银行卡</input>
			                  &nbsp;&nbsp;&nbsp; 
			                  <input type="radio" name="is_bank_card" value='2' class="radio5" onchange="changeRadio(this);">已使用银行卡</input>
			                  &nbsp;
			                  <select id="bank_info" onchange="changeOption(this);" style="width: 200px;"></select>
			             </span>
			        </div>
			        <div class="center-content2 clearboth" style="min-width: 500px;display: none;" id="customer_income_card_content">
			           	 <div class="l-panel-search-cond clearfix" id='main_s' style="padding-top: 2px; height: 100px;">
			               	  <div class="float-l clearboth">
			                   	   <div class="l-panel-search-title">
			                       		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;卡主姓名:
			                   		</div>
			                   		<div class="l-panel-search-item">
			                       		<input type="text" id="card_owner_name" style="width: 200px" isRequired="1" />
			                   		</div>
			                  </div>
					          <div class="float-l ">
					               <div class="l-panel-search-title">
					                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;银行卡号:
					               </div>
					               <div class="l-panel-search-item">
					                    <input type="hidden" id="card_no_copy" style="width: 200px" isRequired="1" />
					                    <input type="text" id="card_no" style="width: 200px" isRequired="1" onkeyup="init_card_no()"/>
					               </div>
					          </div>
					          <div class="float-l clearboth">
					               <div class="l-panel-search-title">
					                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;省:
					               </div>
					               <div class="l-panel-search-item">
					                    <input type="text" id="bank_of_deposit_pro" style="width: 200px" isRequired="1" />
					               </div>
					          </div>
					          <div class="float-l" style="margin-left: 66px">
					               <div class="l-panel-search-title">
					                    	市:
					               </div>
					               <div class="l-panel-search-item">
					                    <input type="text" id="bank_of_deposit_city" style="width: 200px" isRequired="1" />
					               </div>
					          </div>
					          <div class="float-l clearboth">
					               <div class="l-panel-search-title">
					                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;开户行:
					               </div>
					               <div class="l-panel-search-item">
					                    <input type="text" id="bank_of_deposit" style="width: 200px" isRequired="1" onchange="verifyName(this);"/>
					               </div>
					          </div>
					          <div class="float-l">
					               <div class="l-panel-search-title">
					                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;支行:
					               </div>
					               <div class="l-panel-search-item">
					                    <input type="text" id="bank_branch" style="width: 200px" isRequired="1" />
					                    <input type="hidden" id="wms_inve_customer_card_id"></input>
					               </div>
					          </div>
				         </div>
			       </div>
				</div>
<!-- 				客户资料 -->
				<div id="khzl" style="margin-left: 300px; margin-top: 60px;display: none;">
					<table cellspacing="1" cellpadding="1" class="input_tb" id="att_tb" style="margin-left: -155px">
						<tr >
							<td colspan="3" align="left" id="SCtitle">客户资料上传：</td>
							<td align="right"><div id='plswpic'></div></td>
						</tr>
					</table>
<!-- 					<div class="float-l commonstyle clearboth clearfix" -->
<!-- 							style="height: auto;top: 40px" > -->
<!-- 							<div class="pop-form-title2"> -->
<!-- 								<span style="font-size: 15px">客户资料上传：</span> -->
<!-- 							</div> -->
<!-- 					</div>	 -->
<!-- 					<div class="float-l commonstyle clearboth clearfix" -->
<!-- 							style="margin-top: 80px; margin-left: 80px" > -->
<!-- 						<div class="pop-form-title2"> -->
<!-- 							开户信息表： -->
<!-- 						</div> -->
<!-- 						<div class="pop-form-item" style="margin-left: 200px"> -->
<!-- 							<input id="uploadButton" class="btn-uploadF" -->
<!-- 								onmouseover="this.className='btn-uploadF-over'" -->
<!-- 								onmouseout="this.className='btn-uploadF'" -->
<!-- 								onmousedown="this.className='btn-uploadF-down'" type="button" -->
<!-- 								style="margin-right: 7px;" onclick="openAddAttDialog()" /> -->
<!-- 						</div> -->
<!-- 						<div class="pop-form-item clearfix" id="fileinfo" -->
<!-- 							style="height: auto"></div> -->
<!-- 					</div>			 -->
<!-- 					<div class="float-l commonstyle clearboth clearfix" -->
<!-- 						style="margin-top: 80px; margin-left: 80px" > -->
<!-- 						<div class="pop-form-title2"> -->
<!-- 							客户身份证： -->
<!-- 						</div> -->
<!-- 						<div class="pop-form-item" style="margin-left: 200px"> -->
<!-- 							<input id="uploadButton" class="btn-uploadF" -->
<!-- 								onmouseover="this.className='btn-uploadF-over'" -->
<!-- 								onmouseout="this.className='btn-uploadF'" -->
<!-- 								onmousedown="this.className='btn-uploadF-down'" type="button" -->
<!-- 								style="margin-right: 7px;" onclick="openAddAttDialog()" /> -->
<!-- 						</div> -->
<!-- 						<div class="pop-form-item clearfix" id="fileinfo" -->
<!-- 							style="height: auto"></div> -->
<!-- 					</div>			 -->
<!-- 					<div class="float-l commonstyle clearboth clearfix" -->
<!-- 						style="margin-top: 80px; margin-left: 80px" > -->
<!-- 						<div class="pop-form-title2"> -->
<!-- 							客户银行卡： -->
<!-- 						</div> -->
<!-- 						<div class="pop-form-item" style="margin-left: 200px"> -->
<!-- 							<input id="uploadButton" class="btn-uploadF" -->
<!-- 								onmouseover="this.className='btn-uploadF-over'" -->
<!-- 								onmouseout="this.className='btn-uploadF'" -->
<!-- 								onmousedown="this.className='btn-uploadF-down'" type="button" -->
<!-- 								style="margin-right: 7px;" onclick="openAddAttDialog()" /> -->
<!-- 						</div> -->
<!-- 						<div class="pop-form-item clearfix" id="fileinfo" -->
<!-- 							style="height: auto"></div> -->
<!-- 					</div>				 -->
				</div>
					<!--支付详情 -->
					<div id="zfxq" style="display: none; width: 100%; height: 100%">
						<iframe id="zfxqiframe" name="zfxqiframe" align="center" width="100%" height="92%" src="" frameborder="no" border="0" marginwidth="0" marginheight="0" scrolling="yes"></iframe>
					</div>
					
					<!-- 债权信息 -->
					<div id="zqxx" style="margin-top: 60px;display: none;">
						<div id="zqxx_grid_data"></div>
					</div>
			</div>
				
			</div>
			<div id="zqxx" style="display: none; width: 100%; height: 100%">
				<iframe id="zqxxiframe" align="center" width="100%" height="92%" src="" frameborder="no" border="0" marginwidth="0" marginheight="0" scrolling="yes"></iframe>
			</div>
			<div id="syxx" style="display: none; width: 100%; height: 100%">
				<div class="pop-center overflow-au" style="bottom: 7px">
					<div class="float-l clearboth" style="height: 5px;"></div>
					<div class="center-content clearboth" style="min-width: 700px;">
						<div class="center-title">收益信息</div>
						<div class="center-txt" style="margin-bottom: 5px;">
							<div id="grid-syxx"></div>
						</div>
					</div>
				</div>
			</div>
			<div id="rzxx" style="display: none; width: 100%; height: 100%">
				<div class="pop-center overflow-au" style="bottom: 7px">
					<div class="float-l clearboth" style="height: 5px;"></div>
					<div class="center-content clearboth" style="min-width: 700px;">
						<div class="center-title">交易详情</div>
						<div class="center-txt" style="margin-bottom: 5px;">
							<div id="grid-rzxx"></div>
						</div>
					</div>
					<div class="float-l clearboth" style="margin-top: -15px; margin-left: 10px; text-align: left">
						说明：<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"+"表示财富管理系统平台收取金额<br />
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"-&nbsp;"表示财富管理系统平台支出金额
					</div>
				</div>
			</div>
		</div>
		<input type="hidden" id="wms_inve_transa_id" /> 
		<input type="hidden" id="wms_inve_transa_prod_id" />
		<input type="hidden" id="customer_num" />
		<!-- 提交功能按钮区 -->
		<div style="margin-bottom: 6px;" class="pop-footer5 clearboth" id="tb_btn">
			<input id="zcbtn" 
				class="btn-saveZ"
				onmouseover="this.className='btn-saveZ-over'"
				onmouseout="this.className='btn-saveZ'"
				onmousedown="this.className='btn-saveZ-down'" 
				type="button"
				style="margin-right: 7px;" onclick="save(0)" /> 
			<input id="tjbtn"
				onclick="save(1);" 
				class="btn-saveT"
				onmouseover="this.className='btn-saveT-over'"
				onmouseout="this.className='btn-saveT'"
				onmousedown="this.className='btn-saveT-down'" 
				type="button"
				style="margin-right: 7px;" id='saveT_btn'/> 
				
			<!--复核提交button -->
			<input id="fhbtn"
				onclick="openFHPang();" 
				class="btn-saveT"
				onmouseover="this.className='btn-saveT-over'"
				onmouseout="this.className='btn-saveT'"
				onmousedown="this.className='btn-saveT-down'" 
				type="button"
				style="margin-right: 7px; display: none"/>

			<!--取消button -->
			<input id="cancelBtnId"
				class="btn-cancel" 
				onmouseover="this.className='btn-cancel-over'"
				onmouseout="this.className='btn-cancel'"
				onmousedown="this.className='btn-cancel-down'" 
				type="button"
				onclick="closeTab();" style="display: none" />
		</div>
	</div>
	<script type="text/javascript">
var fileArr = [];//上传附件列表
var update = $.query.get('update');//进行理财暂存状态
var wms_inve_transa_id = $.query.get('wms_inve_transa_id');
var wms_inve_clerk_protocol_id = $.query.get('wms_inve_clerk_protocol_id');
var wms_inve_transa_prod_id = $.query.get('wms_inve_transa_prod_id');
var wms_inve_pruduct_category_id = $.query.get('wms_inve_pruduct_category_id');
var cktype = $.query.get('cktype');
var fhtype = $.query.get('fhtype');//控制审核时提交按钮的显示（跟上单提交按钮不同）
var zftype = $.query.get('zftype');//控制支付tab页面的显示
var user_id = $.query.get('user_id');
var LCtype =  $.query.get('LCtype');//判断是符合退回还是支付退回（用于流程区分）
var zctype = $.query.get('zctype');
var tabId = $.query.get('tabId');
var isShowIncomeCard = $.query.get('isShowIncomeCard');//是否显示收益卡信息1表示显示,0或者为空表示不显示

var product_interest_map = {};//存储理财产品年化利率
var reward_interest_map = {};//存储理财产品奖励利率
var reward_interest_map2 = {};
var columns_syxx;
var grid_syxx;
var columns_rzxx;
var grid_rzxx;
var costomer_id;//CRM客户主键
var productCkd; //选择的理财产品
var salesmanStatus;//业务员目前状态（兼职:jz、在职:zz、离职:lz）
var dialog;

var p_wms_sys_dict_id = 84;//大类ID
var wms_sys_dict_id = 85;//小类ID


//定义上单信息对象
var wms_inve_transa_data;
//定义上单产品表信息对象
var this_inve_transa_prod_data;
//定义客户收益卡信息对象
var bankCardInfos;
//定义收益卡信息json
var incomeCardJson;

//CRM客户信息
var cos;
var certificate_type_val=1142;//身份证类型
var taskId = $.query.get('taskId');
//实现屏蔽债权信息显示身份证号
var inkey = $.query.get('inkey');
if(null == inkey || '' == inkey) {
	//若未传过来标示则实时查询是否为特批人
	$.ajax({ 
        type: "POST", 
        url: global_param.context_name + "/sysmanage/isSpecialUser.do",
        async: false,
        dataType: "json",
        data: { 
            
        }, 
        success: function(data){
        	if(!data || data == 'false') {
	        	inkey = '0';
        	}
        }
    });
}

$(function() {
	
	//初始化客户收益卡信息
	initCustomerIncomeCard();
	
	if(zftype == 'zf'){
		$('#zfxqtabdiv').show();
		$('#zfxqiframe').attr('src',"newAmountPayPage.html?wms_inve_transa_id="+wms_inve_transa_id+"&wms_inve_transa_prod_id="+wms_inve_transa_prod_id + "&cktype="+cktype+"&update="+update);
		$('#tabbody03').show();
		$('#tabbody04').show();
	}
	if(cktype == 'ck'){
		$('#zqxxiframe').attr('src','inveTransaMatch.html?showGrid=1&cktype=ck&wms_inve_transa_prod_id='+wms_inve_transa_prod_id+"&inkey="+inkey);
		$('.btxts').css('display','none');
		$('#sxtj').hide();
		$("#bel_inve_transa_div_id").css('display','');
		initLcsqxx('ck');
		initZqxxGrid();
	}else{
		initLcsqxx(null,null,wms_inve_pruduct_category_id);
		init_customer_source();
	}
	if(update != 1){
		//如果不是查看、修改。那么初始化页面所有input变为只读
		if(cktype == '' && fhtype == '' && zftype ==''){
			inputreadonly();
		}
	}
	
	changeTab02("khd");
	init_att();
});

/***************************客户收益卡相关内容****************************************/
/*
 * 当财务上单审核的时候显示客户收益卡信息
 */
function initCustomerIncomeCard()
{
	
	//根据上单表主键进行获取对应的上单信息
	var resMap = globalUtil.syncGetJson('/inve/wmsinvetransainfo.do',{'wms_inve_transa_id':wms_inve_transa_id},'GET');
	
	//从获取到的数据中取出上单信息表的信息并且赋值给全局变量wms_inve_transa_data方便其它函数使用
	wms_inve_transa_data = resMap.wmsInveTransa;
	
	//根据上单表主键获取对应的上单产品表信息
	this_inve_transa_prod_data = globalUtil.syncGetJson('/inve/wmsinvetransaprodinfobypkforjegl.do',{'wms_inve_transa_id':wms_inve_transa_id},'GET');
	
	//获取收益卡信息
    incomeCardJson = globalUtil.syncGetJson('/inve/getinvetransaprodbyid.do',{wms_inve_transa_prod_id: wms_inve_transa_prod_id,sortname: 'sort_order',sortorder: 'asc'},'POST');
	
	//判断客户收益卡信息 初始化/有值不可编辑处理
    if(incomeCardJson.wmsInveTransaProd.bank_of_deposit_pro != null && incomeCardJson.wmsInveTransaProd.bank_of_deposit_city != null) 
    {
        init_bank_of_deposit_pro(incomeCardJson.wmsInveTransaProd);
    } 
    else 
    {
        init_bank_of_deposit_pro();
    }
	
	//初始化市下拉列表
    initIncomerCardForm(incomeCardJson);
	
  	//绑定该id对应的下拉列表改变事件
	$('#bank_of_deposit_pro').bind('change',function(){
		getCityData1();
	});
	
	//上单信息对象是否为空
	if(wms_inve_transa_data != null)
	{
		//判断单据状态是否为待审核状态,如果是待审核状态则需要显示客户收益卡信息
		if(isShowIncomeCard == '1' && wms_inve_transa_data.data_status == 11)
		{
			//待审核状态的单据需要显示客户收益卡信息
			$("#customer_income_card_title").css("display", "");
			$("#customer_income_card_content").css("display", "");
			
			//初始化客户收益卡信息
			initBankCardInfo();
		}
		
	}
}

/*
 * 初始化客户收益卡信息
 */
function initBankCardInfo()
{
	var params = {
		cus_name:wms_inve_transa_data.cus_name,
		id_card:wms_inve_transa_data.id_card
	}
		 
	$.post(globalUtil.getTimestampUrl("/inve/getHistoryCustomerBankInfo.do"),params, function(json,status){
		//将获取到的客户收益卡信息赋值给全局变量,方便其它函数使用
		bankCardInfos = json;
		
		//判断获取的客户收益卡信息是否为空,如果信息不为空则设置对应的收益卡信息不可编辑,否则可编辑(只有银行和支行是可以编辑的)
		if(json != null && json != "" && json.length > 1){
			$("input[name='is_bank_card']").eq(0).removeAttr("checked","checked"); 
			$("input[name='is_bank_card']").eq(1).attr("checked","checked");
			$("#card_owner_name").attr("readonly","readonly");
			$("#card_no").attr("readonly","readonly");
			$.ligerui.get("bank_of_deposit_pro").set('disabled', true);
			$.ligerui.get("bank_of_deposit_city").set('disabled', true);
			$("#bank_of_deposit").removeAttr("readonly");
			$("#bank_branch").removeAttr("readonly");
		}else{
			$("input[name='is_bank_card']").eq(0).attr("checked","checked");
			$("input[name='is_bank_card']").eq(1).removeAttr("checked","checked");
		}
		
		
		for(var i = 0; i < json.length; i++){
			if(this_inve_transa_prod_data.card_owner_name == json[i].card_owner_name 
					&& this_inve_transa_prod_data.bank_of_deposit == json[i].bank_of_deposit
		               && this_inve_transa_prod_data.bank_branch == json[i].bank_branch
						  && this_inve_transa_prod_data.bank_of_deposit_pro == json[i].bank_of_deposit_pro
							 && this_inve_transa_prod_data.bank_of_deposit_city == json[i].bank_of_deposit_city
							    && this_inve_transa_prod_data.card_no == json[i].card_no)
			{
				$("#bank_info").append("<option value='" + json[i].card_no +"' selected='selected'>" +json[i].bank_card_info +"</option>");	
			}
			else
			{
				$("#bank_info").append("<option value='" + json[i].card_no +"'>" +json[i].bank_card_info +"</option>");
			}
		}
	},"json"); 
}


/*
 * 客户收益卡信息-初始化省
 */
function init_bank_of_deposit_pro(json){
   var bank_of_deposit_pro_params ={
       dest_url:'/sysmanage/wmssysdictdatabydictidempty.do?isEmpty=true&wms_sys_dict_id=72',
       t_col_name:'bank_of_deposit_pro',
       valueField:'value_code',   //下拉框value对应的值，默认为id
       textField:'value_meaning',    //下拉框text对应的值，默认为text
       input_width:200,
       def_val:'first'
   };
   
   global_ligerui_extend.initCombox("bank_of_deposit_pro",null,bank_of_deposit_pro_params);
   
   if(json)
   {
        //把值装载设定
        global_ligerui_extend.syncRequestInitComboxData(json,"bank_of_deposit_pro");
        //让其不可编辑
        //global_ligerui_extend.disabledCombox("bank_of_deposit_pro");
    }else{
        global_ligerui_extend.initComboxDefVal("bank_of_deposit_pro");
    }
}

/*
 * 客户收益卡信息-当点击省的时候,加载市
 */
function getCityData1(){
   var jsondata0;
   if(incomeCardJson.wmsInveTransaProd.bank_of_deposit_pro != null && incomeCardJson.wmsInveTransaProd.bank_of_deposit_city != null) {
        jsondata0 = incomeCardJson.wmsInveTransaProd;
   }
   init_bank_of_deposit_city($("#bank_of_deposit_pro_hidden").val(), jsondata0)
}
/*
 * 客户收益卡信息-获取市
 */
function init_bank_of_deposit_city(p_wms_sys_dict_data_id, json){
	p_wms_sys_dict_data_id = p_wms_sys_dict_data_id == null || p_wms_sys_dict_data_id==""?-1:p_wms_sys_dict_data_id;
    var bank_of_deposit_city_params ={
            dest_url:'/sysmanage/wmssysdictdatabydictidemptyc.do?isEmpty=true&wms_sys_dict_id=73&p_wms_sys_dict_data_id='+p_wms_sys_dict_data_id,
            t_col_name:'bank_of_deposit_city',
            valueField:'value_code',   //下拉框value对应的值，默认为id
            textField:'value_meaning',    //下拉框text对应的值，默认为text
            input_width:200,//下拉框长度
            def_val:'first'
            };
    
    global_ligerui_extend.initCombox("bank_of_deposit_city",null,bank_of_deposit_city_params);
    
    if(json){
        //把值装载设定
        global_ligerui_extend.syncRequestInitComboxData(json,"bank_of_deposit_city");
        //让其不可编辑
        //global_ligerui_extend.disabledCombox("bank_of_deposit_city");
    }else{     
        global_ligerui_extend.initComboxDefVal("bank_of_deposit_city");
    }
}

//判断选择全新银行卡和已使用银行卡按钮
function changeRadio(obj){
	
	if(obj.value == 1){
		$("#card_owner_name").val("");
		$("#card_no").val("");
		global_ligerui_extend.setComboxVal("bank_of_deposit_pro", -1);
		init_bank_of_deposit_city(-1, true);
		global_ligerui_extend.setComboxVal("bank_of_deposit_city", -1);
		$("#bank_of_deposit").val("");
		$("#bank_branch").val("");
		$("#bank_info").val("-1");
		$("#bank_info").attr("disabled", "disabled");
		$("#card_owner_name").removeAttr("readonly");
		$("#card_no").removeAttr("readonly");
		$.ligerui.get("bank_of_deposit_pro").set('disabled', false);
		$.ligerui.get("bank_of_deposit_city").set('disabled', false);
		$("#bank_of_deposit").removeAttr("readonly");
		$("#bank_branch").removeAttr("readonly");
		$("#wms_inve_customer_card_id").val("");
	}
	if(obj.value==2){
		$("#bank_info").removeAttr("disabled");
		$("#card_owner_name").attr("readonly","readonly");
		$("#card_no").attr("readonly","readonly");
		$.ligerui.get("bank_of_deposit_pro").set('disabled', true);
		$.ligerui.get("bank_of_deposit_city").set('disabled', true);
	}
	
}


/*
 * 验证开户行输入的银行是否是邮政储蓄
 */
function verifyName(obj)
{
	var name = obj.value;
	if(name.indexOf("邮政储蓄") >= 0)
	{
		$("#bank_of_deposit").val("");
		$("#bank_of_deposit").focus();
		globalUtil.errorMsg("暂不支持邮政储蓄银行卡,请更换其它银行卡");
		return;
	}
}


/**
 *初始化银行卡号自动四位加空格
 */
function init_card_no(){
    var val=$('#card_no').val();//获取用户输入
    val = val.replace(/\D/g,'');
    $("#card_no_copy").val(val);
    change();
}
/**
 *处理银行卡信息
 */
function change(){
     var card = $('#card_no_copy').val();
     card = card.replace(/\D/g,'')
     var ncard='';
     for(var n=0;n<card.length;n=n+4){
         ncard += card.substring(n,n+4)+" ";
     }
     //console.log(ncard.replace(/(\s*$)/g,""));
     $('#card_no').val(ncard.replace(/(\s*$)/g,""));
 }
 
 
 
/*
 * 获取初始化值
 */
function initIncomerCardForm(json){
	globalUtil.setFormVal("main_s", json.wmsInveTransaProd);
	$("#wms_inve_customer_card_id").val(json.wmsInveTransaProd.wms_inve_customer_card_id);
	
	init_bank_of_deposit_city(json.wmsInveTransaProd.bank_of_deposit_pro, true);
	global_ligerui_extend.setComboxVal("bank_of_deposit_city", json.wmsInveTransaProd.bank_of_deposit_city);
	
    init_card_no();
}


/*
 * 
 */
function changeOption(obj){
	$("#bank_of_deposit_pro").unbind("change");
	for(var i = 0; i < bankCardInfos.length; i++){
		
		if(bankCardInfos[i].card_no == obj.value){
			$("#card_owner_name").val(bankCardInfos[i].card_owner_name);
			$("#card_no").val(bankCardInfos[i].card_no);
			global_ligerui_extend.setComboxVal("bank_of_deposit_pro", bankCardInfos[i].bank_of_deposit_pro);
			init_bank_of_deposit_city(bankCardInfos[i].bank_of_deposit_pro, true);
			global_ligerui_extend.setComboxVal("bank_of_deposit_city", bankCardInfos[i].bank_of_deposit_city);
			$("#bank_of_deposit").val(bankCardInfos[i].bank_of_deposit);
			$("#bank_branch").val(bankCardInfos[i].bank_branch);
			$("#card_owner_name").attr("readonly","readonly");
			$("#card_no").attr("readonly","readonly");
			$.ligerui.get("bank_of_deposit_pro").set('disabled', true);
			$.ligerui.get("bank_of_deposit_city").set('disabled', true);
			$("#bank_of_deposit").attr("readonly","readonly");
			$("#bank_branch").attr("readonly","readonly");
			$("#wms_inve_customer_card_id").val(bankCardInfos[i].wms_inve_customer_card_id);
		}
		
	}
	
	init_card_no();
	
	$('#bank_of_deposit_pro').bind('change',function(){
		getCityData1();
	});
}

/*******************************************************************************************************/


//打开复核结果页面
function openFHPang(){
	var yjtype;//是否是复核 审核
	if(zftype != null && zftype != undefined && zftype != ""){
		yjtype = "zf";//上单审核
	}else{
		yjtype = "fh";//复核审核
	}
	
	var bankOfDeposit = $("#bank_of_deposit").val();
	var bankBranch = $("#bank_branch").val();
	
	if(bankOfDeposit == "")
	{
		globalUtil.warnMsg("开户行不允许为空!");
		return;
	}
	
	if(bankBranch == "")
	{
		globalUtil.warnMsg("支行不允许为空!");
		return;
	}
	
	var incomeCardParams = {
		wms_inve_customer_card_id:$("#wms_inve_customer_card_id").val(),
		bank_of_deposit:bankOfDeposit,
		bank_branch:bankBranch
	}
	
    var url = globalUtil.getHtml("../inve/singFinancialReturn.html?yjtype="+yjtype+ "&incomeCardParams=" + JSON.stringify(incomeCardParams));
   dialog=$.ligerDialog.open({
			url:url,
			title: '复核结果',
        width: 850,
        height: globalUtil.setDialogHeight(300),
        onHiddenOrClose: function(){
    	},
        	isResize: false
		}); 
   return;	
}
/*
初始化附件信息
*/
function init_att(){
	$.getJSON(globalUtil.getTimestampUrl('/sysmanage/getdictdatatreebean.do?p_wms_sys_dict_id='+p_wms_sys_dict_id+'&wms_sys_dict_id='+wms_sys_dict_id),
			{},
			function(att_json) {
				for(var i=0;i<att_json.length;i++){
					var data = att_json[i]
					var children = data.children;
					var row = document.getElementById("att_tb").insertRow(document.getElementById("att_tb").rows.length);
					var td1 = row.insertCell(0);
					td1.rowSpan = children.length;
					td1.className = 'title textright';
					td1.style.width = '100px';
					SCtitle.innerHTML = data.text;
					var data0 = children[0];
					
					var td2 = row.insertCell(1);
					td2.className = 'textleft';
					td2.style.width = '400px';
					td2.innerHTML = data0.text;
					
					var td3 = row.insertCell(2);
					td3.className = 'textleft';
					td3.style.width = '100px';
					td3.style.height = '100px';
					if(cktype != 'ck'){
						td3.innerHTML = '<input class="btn-uploadF" onmouseover="this.className=\'btn-uploadF-over\'" onmouseout="this.className=\'btn-uploadF\'" onmousedown="this.className=\'btn-uploadF-down\'" type="button" style="margin-right:7px;" onclick="openAddAttDialog('+data.id+','+data0.id+')" style="display:none"/>';
					}
					//td3.innerHTML = '<a href="#" onclick="openAddAttDialog('+data.id+','+data0.id+')" class="btn" style="display:" style="display:none">上传附件</a>';
					
					var td4 = row.insertCell(3);
					td4.className = 'textleft';
					td4.id = data0.id;
					td4.pid = data.id;
// 					document.getElementById("textleft").style.height = '100px';
					for(var j = 1;j < children.length;j++){
						var row_t = document.getElementById("att_tb").insertRow(document.getElementById("att_tb").rows.length);
						var td1_t = row_t.insertCell(0);
						td1_t.className = 'textleft';
						td1_t.style.width = '100px';
						td1_t.innerHTML = children[j].text;
						
						var td3_t = row_t.insertCell(1);
						td3_t.className = 'textleft';
						td3_t.style.width = '30px';
						if(cktype != 'ck'){
							td3_t.innerHTML = '<input class="btn-uploadF" onmouseover="this.className=\'btn-uploadF-over\'" onmouseout="this.className=\'btn-uploadF\'" onmousedown="this.className=\'btn-uploadF-down\'" type="button" style="margin-right:7px;" onclick="openAddAttDialog('+data.id+','+children[j].id+')" style="display:none"/>';
						}
						//td3_t.innerHTML = '<a href="#" onclick="openAddAttDialog('+data.id+','+children[j].id+')" class="btn" style="display:">上传附件</a>';
						td3_t.style.height = '100px';
						var td4_t = row_t.insertCell(2);
						td4_t.className = 'textleft';
						td4_t.id = children[j].id;
						td4_t.pid = data.id;
					}
				}
			});
}

var allCreditPicIDs=[];//所有图片Id 从上至下
//读取上传文件显示上传文件名称
function getdictAtt(code,json){
	var htmlstr = "";
	for(var i = 0 ;i < json.length; i++){
		var data = json[i];
		var data_detail_name = data.data_detail_name;
		if(code == data.data_detail_name){
			if(findPicHZ(data.attachment_type.toLowerCase())==-1){
				htmlstr += '<a  target="_blank"  href="'+global_param.upload_file_url+data.attachment_address+'">'+data.attachment_old_name+'</a>&nbsp;&nbsp;&nbsp;'
			}else{
				htmlstr += '<input type="checkbox" id=cb'+data.wms_cre_credit_line_customer_data_attachment_id+' class="radio3" onclick=onCheckCB('+data.wms_cre_credit_line_customer_data_attachment_id+') style="width: auto"/>&nbsp;&nbsp;<a  target="_blank"  href="'+global_param.upload_file_url+data.attachment_address+'">'+data.attachment_old_name+'</a>&nbsp;&nbsp;&nbsp;'
			}
			allCreditPicIDs.push(data.wms_cre_credit_line_customer_data_attachment_id);
		}
	}
	return htmlstr;
}

var checkedCreditIDs=[];
function onCheckCB(id){
	if($("#cb"+id).is(':checked')){
		addCheckedCredit(id)
	}else{
		removeCheckedCredit(id)
	}
}

// 向checkedCredit中添加id的方法
function addCheckedCredit(id) {
	if (findCheckedCredit(id) == -1) {
		checkedCreditIDs.push(id);
	}
};
// 从checkedCredit中移除id的方法
function removeCheckedCredit(id) {
	var i  = findCheckedCredit(id);
	if (i == -1) {
		return;
	}
	checkedCreditIDs.splice(i, 1);
};

// 在checkedCredit中查找是否已存在id的方法
function findCheckedCredit(id) {
	for(var i = 0; i < checkedCreditIDs.length; i++) {
		if(checkedCreditIDs[i] == id) {
			return i;
		}
	}
	return -1;
};

var checkedPicNms=['jpg','jpeg','bmp','png','gif','tif'];
//检查是否为图片格式
function findPicHZ(name) {
	for(var i = 0; i < checkedPicNms.length; i++) {
		if(checkedPicNms[i] == name) {
			return i;
		}
	}
	return -1;
};

function showAllPic(){
	if(checkedCreditIDs.length==0){
		globalUtil.errorMsg(globalErrorMsg['300108']);
		return;
	}
	var allCheckedCreditPicIDs=[];
	for (var picIds = 0; picIds < allCreditPicIDs.length; picIds++) {
		for (var picIdsChed = 0; picIdsChed < checkedCreditIDs.length; picIdsChed++) {
			if(allCreditPicIDs[picIds]==checkedCreditIDs[picIdsChed]){
				allCheckedCreditPicIDs.push(allCreditPicIDs[picIds]);
				break;
			}
		}
	}
	var iTop=(window.screen.availHeight-30-700)/2
	var iLeft=(window.screen.availWidth-10-1020)/2
	window.open("../creditManage/showUpldPic.html?idsArr="+allCheckedCreditPicIDs, "查看图片",'height=700,innerHeight=700,width=1020,innerWidth=1000,top='+iTop+',left='+iLeft+',toolbar=no,menubar=no,resizeable=yes,location=no,status=no,fullscreen=no,scrollbars=yes')
}
var dialog_att;
/*
打开附件上传页面
*/
function openAddAttDialog(data_type_name,data_detail_name){
	var url = globalUtil.getHtml("../creditManage/addFileForCre.html?data_type_name="+data_type_name+"&data_detail_name="+data_detail_name);
	dialog_att = $.ligerDialog.open({
       url: url,
       title: '上传附件',
       width: 650,
       height: globalUtil.setDialogHeight(250),
       onHiddenOrClose: function(){
       	//alert('关闭或隐藏都调用的事件!');
   	},
       isResize: false
	});
}

function addAttFile(newfileArr,objid){
	fileArr = fileArr.concat(newfileArr);
	var filehtml = $("#"+objid).html();
	for(var i=0;i<newfileArr.length;i++){
		var nnme=newfileArr[i].attachment_new_name.replace('/','thxg1');
		nnme=nnme.replace('/','thxg2');
		filehtml += '<div id="delUploadDivId'+nnme+'">';
		filehtml += '<a  target="_blank"  href="'+global_param.upload_file_url+newfileArr[i].attachment_address+'">'+newfileArr[i].attachment_old_name+'</a>';
		filehtml += '<img src="../../images/icon/icon-close.gif" onclick="deleteFile(\''+nnme+'\')"/>';
		filehtml += '</div>'
	}
	$("#"+objid).html(filehtml);
}

function deleteFile(filename){
  	$.ligerDialog.confirm(globalErrorMsg['100016'],
   function(yes) {
   	if (yes) {
   		$("#delUploadDivId"+filename).remove();
   		filename=filename.replace('thxg1','/');
   		filename=filename.replace('thxg2','/');
   		for(var i=0;i<fileArr.length;i++){
   			if(filename == fileArr[i].attachment_new_name){
   				fileArr.splice(i,1);
   				break;
   			}
   		}
   	}                                            
		});
}
var ismjArr=[{"is_major":'1',"ismjval":"是"},{"is_major":'0',"ismjval":"否"}];





//手动输入身份证号时自动计算生日
function setbirthday(){
	var card = $("#id_card").val();
	//因为rrm身份证号不是必填默认id-card、字段是身份证号类型
	if($("#certificate_type").val()==null||$("#certificate_type").val()==""||$("#certificate_type").val()=="undefined"){
		$("#certificate_type").val(certificate_type_val);
	}
	var certificate_type =  $("#certificate_type").val();
	//校验身份证的格式是否正确
	var reg = /(^\d{18}$)|(^\d{17}(\d|X|x)$)/;
	if(card != "" && certificate_type == certificate_type_val&&reg.test(card)){
		$('[name=cus_birthday]').val($(id_card).val().substring(6,10)+'-'+$(id_card).val().substring(10,12)+'-'+$(id_card).val().substring(12,14));
	}else{
		$("#cus_birthday").val("");
	}
	
}
function initGrid() {
	columns_syxx = [{
        display: '协议收益日期',
        name: 'return_date',
        width: 300,
        minWidth: 300
    },{
        display: '状态',
        name: 'pay_status',
        width: 200,
        minWidth: 200
    }, {
        display: '收益（正常+公益+奖励）',
        name: 'product_interest_account2',
        width: 300,
        minWidth: 300
    },{
        display: '实际收益日期',
        name: 'act_return_date',
        width: 300,
        minWidth: 300	
    }];
	
	grid_syxx = $("#grid-syxx").ligerGrid({
		columns: columns_syxx,
		url: global_param.context_name + '/inve/wmsinvetransaincomewithoutpaginglist.do?wms_inve_transa_id='+wms_inve_transa_id,
		sortName: 'return_date', // 排序列名
		sortOrder: 'asc', // 排序方式
		rownumbers: true,
		usePager: false, // 是否分页支持，默认为true
		width: '100%',
		height:'auto',
		heightDiff: -4
    });
	
	columns_rzxx = [{
        display: '操作日期',
        name: 'change_date',
        width: 200,
        minWidth: 200
    },{
        display: '操作事项',
        name: 'operate_item',
        width: 200,
        minWidth: 200
    }, {
        display: '本金异动',
        name: 'product_account_str',
        width: 200,
        minWidth: 200
    },{
        display: '收益异动',
        name: 'product_interest_account_str',
        width: 200,
        minWidth: 200	
    },{
        display: '备注',
        name: 'remark',
        width: 500,
        minWidth: 500,
        render: function (rowdata, rowindex, value) {
        	return value;
        	/*var name="";
        	var val="";
        	if(value!=null){
        		name=value.substring(0,value.length-23);
        		val=value.substring(value.length-23,value.length);
        	}
 			//return name+'<a href="javascript:InveWorkFlowProcess('+rowdata.wms_inve_redeem_id+","+rowdata.wms_inve_transa_id+","+rowdata.wms_inve_transa_prod_id+');" style="color:#056AFF;text-decoration: none;">'+val+'</a>';
        	//可以获得协议表主键  上单信息表主键  上单产品表主键   赎回表主键
 			return name+'<a href="javascript:InveWorkFlowProcess('+rowdata.wms_inve_transa_protocol_id+","+rowdata.wms_inve_transa_id+","+rowdata.wms_inve_transa_prod_id+","+rowdata.wms_inve_redeem_id+');" style="color:#056AFF;text-decoration: none;">'+val+'</a>';
       */}
    }];
	
	grid_rzxx = $("#grid-rzxx").ligerGrid({
		columns: columns_rzxx,
		url: global_param.context_name + '/inve/wmsinvetransalogwithoutpaginglist.do?wms_inve_transa_id='+wms_inve_transa_id,
		sortName: 'change_date', // 排序列名
		sortOrder: 'asc', // 排序方式
		rownumbers: true,
		usePager: false, // 是否分页支持，默认为true
		width: '100%',
		height:'auto',
		heightDiff: -4
    });
}
//理财详细信息
function inveTransaInfo(wms_inve_transa_id,wms_inve_transa_prod_id,user_id,inkey){
	var status;
		$.post(globalUtil.getTimestampUrl('/inve/wmsinvetransadSearchStatus.do'), 
				{'wms_inve_transa_id': wms_inve_transa_id},
		function(data) {
			status = data;
			if(status == "1" || status == "2" || status == "7" || status == "9" || status == "10"){
	    		var url = globalUtil.getHtml("inve/addFinancialManagement.html?&user_id="+user_id+"&wms_inve_transa_id="+wms_inve_transa_id+"&wms_inve_transa_prod_id="+wms_inve_transa_prod_id+"&cktype=ck"+"&inkey="+inkey+"&tabId=1011");
	    	}else{
	    		var url = globalUtil.getHtml("inve/addFinancialManagement.html?&zftype=zf&user_id="+user_id+"&wms_inve_transa_id="+wms_inve_transa_id+"&wms_inve_transa_prod_id="+wms_inve_transa_prod_id+"&cktype=ck"+"&inkey="+inkey+"&tabId=1011");
	    	}
			globalUtil.openTab(10011, "理财详细信息", url, false);
		});
	
	
	if(user_id==undefined){
		user_id = 0;
	}
}

//查看赎回单据详细信息
function inveRedeemInfo(wms_inve_redeem_id,wms_inve_transa_id,redeem_date,data_status_name){
	if(redeem_date>=global_param.dis_date){
		//新版本查看赎回详情
		var url = globalUtil.getHtml("redeemInfoNewVersion.html?wms_inve_redeem_id="+wms_inve_redeem_id+"&wms_inve_transa_id="+wms_inve_transa_id+"&data_status_name="+data_status_name+"&cktype=ckxq");
		dialog = $.ligerDialog.open({
	        url: url,
	        title: '赎回客户信息明细',
	        width: 1000,
	        height: globalUtil.setDialogHeight(800),
	        onHiddenOrClose: function(){
	    	},
	        isResize: false
    	}); 
	}else{
		var url = globalUtil.getHtml("inve/redeemInfo.html?wms_inve_redeem_id="+wms_inve_redeem_id+"&cktype=ck&tabId=1011");
        globalUtil.openTab(10011, "赎回客户信息明细", url, false);
	}          
}


function InveWorkFlowProcess(wms_inve_transa_protocol_id,wms_inve_transa_id,wms_inve_transa_prod_id,wms_inve_redeem_id){
	var json = globalUtil.syncGetJson("/inve/wmsinvetransaprodinfobypk.do?wms_inve_transa_prod_id="+wms_inve_transa_prod_id);//同步获取需要导出的数据内容
	/*if(json.category_type=='2'||json.category_type=='3'){
		window.open("financingProtocolhouse.html?wms_inve_transa_protocol_id="+wms_inve_transa_protocol_id+"&wms_inve_transa_id="+wms_inve_transa_id+"&wms_inve_transa_prod_id="+wms_inve_transa_prod_id+"&wms_inve_redeem_id="+wms_inve_redeem_id+"&isCk="+"isCk");
	}else{
	   //window.open("financingProtocol.html?wms_inve_transa_id="+wms_inve_transa_id+"&wms_inve_transa_prod_id="+wms_inve_transa_prod_id+"&wms_inve_redeem_id="+wms_inve_redeem_id+"&isCk=isCk");
	   window.open("financingProtocol.html?wms_inve_transa_protocol_id="+wms_inve_transa_protocol_id+"&wms_inve_transa_id="+wms_inve_transa_id+"&wms_inve_transa_prod_id="+wms_inve_transa_prod_id+"&wms_inve_redeem_id="+wms_inve_redeem_id+"&isCk="+"isCk");
	}*/
	
	if(json.wms_inve_pruduct_category_id==global_param.category_id2||json.wms_inve_pruduct_category_id==global_param.category_id3){//row.wms_inve_pruduct_category_id//产品id
			window.open("financingProtocolhouse.html?wms_inve_transa_protocol_id="+wms_inve_transa_protocol_id+"&wms_inve_transa_id="+wms_inve_transa_id+"&wms_inve_transa_prod_id="+wms_inve_transa_prod_id+"&wms_inve_redeem_id="+wms_inve_redeem_id+"&isCk="+"isCk");
	}else if(json.wms_inve_pruduct_category_id==global_param.category_id1){
		window.open("financingProtocol.html?wms_inve_transa_protocol_id="+wms_inve_transa_protocol_id+"&wms_inve_transa_id="+wms_inve_transa_id+"&wms_inve_transa_prod_id="+wms_inve_transa_prod_id+"&wms_inve_redeem_id="+wms_inve_redeem_id+"&isCk="+"isCk");
	}else {//category_interest_pay_method 付息方式:  1 月付  2 年付   category_type产品类型:  1:信用类产品  2：房贷抵押类产品  3：车贷抵押类产品
		if(json.category_interest_pay_method=="2"&&(json.category_type==2||json.category_type==3)){
			window.open("financingProtocolLCSupplement.html?wms_inve_transa_protocol_id="+wms_inve_transa_protocol_id+"&wms_inve_transa_id="+wms_inve_transa_id+"&wms_inve_transa_prod_id="+wms_inve_transa_prod_id+"&category_interest_pay_method="+ json.category_interest_pay_method+"&wms_inve_redeem_id="+wms_inve_redeem_id+"&isCk="+"isCk");
		}else{
			window.open("financingProtocolLC.html?wms_inve_transa_protocol_id="+wms_inve_transa_protocol_id+"&wms_inve_transa_id="+wms_inve_transa_id+"&wms_inve_transa_prod_id="+wms_inve_transa_prod_id+"&category_interest_pay_method="+ json.category_interest_pay_method+"&wms_inve_redeem_id="+wms_inve_redeem_id+"&isCk="+"isCk");
		}
	}
}

function setHotProduct() {
	//测试：将表格第2行数据顶置
	$('.lcsqxxtr:first').after($('.lcsqxxtr:eq(2)'));
}
var product_data=[];//记录产品信息
//初始化理财申请信息
function initLcsqxx(cktype, param, wms_inve_pruduct_category_id,platform_user){
	$.post(globalUtil.getTimestampUrl('/inve/getallwmsinvepruductcategorywithoutpaginglist.do'),
			{
				"cktype" : cktype,
				"category_name" : param,
				"platform_user" : platform_user,
				"wms_inve_pruduct_category_id" : wms_inve_pruduct_category_id
			},
			function(data) {
			product_data=data;//记录产品信息
			var flag=true;
			
			$('.lcsqxxtr:not(:first)').remove();//重置表格
			//$('#hotProduct').html('');//重置热销产品
			
			//setHotProduct(data);
			$.each(data,function(i,product){
				
				//年化利率
				var productInterest;
				//年化利率和（计算收益）
				var productInterestToltal;
				//是否是特殊情况（年付特）
				var isNft = "0";
				
				if(!$.isEmptyObject(product.nft)) {
					if(product.nft.second_year_interest_rate != null) {
                        productInterest = product.nft.first_year_interest_rate + "/" + product.nft.second_year_interest_rate;
                    }else{
                        productInterest = product.nft.first_year_interest_rate;
                    }
                    productInterestToltal = product.nft.first_year_interest_rate +　product.nft.second_year_interest_rate;
                    isNft = "1";
				} else {
					productInterest = product.category_return_rate;
					productInterestToltal = product.category_return_rate;
				}
				
				//奖励利率
				var rewardInterest = "";
				var rewardInterestTotal = 0;
				//根据返利方式判断奖励利率
				if(product.category_rebate_way == "1") { //满足月
					$.each(product.jllls, function(m, obj) {
						if(m > 0) {
							rewardInterest += "<br/>";
						}
						rewardInterest += "满足" + obj.full_month + "个月，奖励利率" + obj.bonus_rate + "%";
						rewardInterestTotal += obj.bonus_rate;
					});
				} else if(product.category_rebate_way == "2") { //累计存量
					$.each(product.jllls, function(m, obj) {
						if(m > 0) {
							rewardInterest += "<br/>";
						}
						rewardInterest += "客户存量满" + obj.customer_stock_begin + "万至" + obj.customer_stock_end + "万并且存满" + obj.full_month + "个月，奖励利率" + obj.bonus_rate + "%";
						rewardInterestTotal += obj.bonus_rate;
					});
				} else {
					rewardInterest = "0";
				}
				
				var trEle = '<tr class="lcsqxxtr">';
				trEle += '<td><input type="radio" class="mainradio" style="width:15px" onclick="changeStatus(this)" name="category_name" value="'+product.category_name+'" /><input type="hidden" name="wms_inve_pruduct_category_id" value="'+product.wms_inve_pruduct_category_id+'" /><label style="vertical-align:top">'+product.category_name+'</label></td>';
				trEle += '<td><div style="text-align:left;margin-left:3px"><input type="hidden" style="width:15px" name="platform_user" value="'+tranceNull(product.platform_user)+'" /><label style="vertical-align:top">'+tranceNull(product.platform_user)+'</label></div></td>';	
				trEle += '<td><div style="text-align:left;margin-left:3px"><input type="hidden" style="width:15px" name="product_deadline" value="'+tranceNull(product.category_deadline)+'" /><label style="vertical-align:top">'+tranceNull(product.category_deadline)+'</label></div></td>';	
				trEle += '<td><span style="display: none;" class="isNft">'+isNft+'</span><span style="display: none;" class="productInterest">' + tranceNaN(productInterestToltal) + '</span><input type="hidden" name="product_interest" value="'+productInterest+'" /><label class="product_interest_label">' + tranceNull(productInterest) +'</label></td>';
				trEle += '<td><span style="display: none;" class="rewardInterest">' + tranceNaN(rewardInterestTotal) + '</span><input type="hidden" name="reward_interest" value="'+tranceNaN(rewardInterestTotal)+'" /><label class="reward_interest_label">' + rewardInterest + '</label></td>';
				trEle += '<td><input type="hidden" name="category_type" value="'+(globalUtil.isEmpty(product.category_type)? '' : product.category_type)+'" /> '+(globalUtil.isEmpty(product.category_type_name)? '' : product.category_type_name)+'</td>';
				trEle += '<td><input type="hidden" name="category_maximum_amount" value="'+(globalUtil.isEmpty(product.category_maximum_amount)? '' : product.category_maximum_amount)+'" /> '+(globalUtil.isEmpty(product.category_maximum_amount)? '无上限' : product.category_maximum_amount)+'</td>';
				trEle += '<td><input type="hidden" name="category_investment_money_min" value="'+product.category_investment_money_min+'" /> '+(globalUtil.isEmpty(product.category_investment_money_min)? '0':product.category_investment_money_min)+'</td>';
				trEle += '<td><input type="hidden" name="category_investment_money_max" value="'+(globalUtil.isEmpty(product.category_investment_money_max)? '' : product.category_investment_money_max)+'" /> '+(globalUtil.isEmpty(product.category_investment_money_max)? '无上限' : product.category_investment_money_max)+'</td>';
				trEle += '<td><input type="hidden" name="category_additional_monery_min" value="'+product.category_additional_monery_min+'" /> '+(globalUtil.isEmpty(product.category_additional_monery_min)? '0':product.category_additional_monery_min)+'</td>';
				trEle += '<td><input type="hidden" name="category_additional_monery_max" value="'+(globalUtil.isEmpty(product.category_additional_monery_max)? '' : product.category_additional_monery_max)+'" /> '+(globalUtil.isEmpty(product.category_additional_monery_max)? '无上限' : product.category_additional_monery_max)+'</td>';
				trEle += '<td><input type="text" name="product_account" class="bitian" maxlength="4" style="width:120px" onkeyup="generateUpperCase(this)" onblur="valiSdje(this)"/></td>';
				trEle += '<td><input type="hidden" name="expect_interest_account" value="'+product.expect_interest_account+'" /><label class="expect_interest_account_label"></label></td>';
				trEle += '</tr>';
				$('.lcsqxxtr:last').after(trEle);
			});	
			if(cktype != 'ck'){
				$('[name=product_account]').attr('disabled','disabled');
			}
			if(wms_inve_transa_id != '' && wms_inve_transa_prod_id != ''){
				initForm();	
				if(cktype != 'ck'){
					$('#wms_inve_transa_id').val(wms_inve_transa_id);
					$('#wms_inve_transa_prod_id').val(wms_inve_transa_prod_id);			
				}		
			}	
	},'json');
}
//非数字的值置零
function tranceNaN(val) {
	if(isNaN(val)) {
		return 0;
	}
	return val;
}

//空值处理
function tranceNull(val) {
	if(val == null) {
		return "";
	}
	return val;
}

//初始化表单
function initForm(){
	$.getJSON(globalUtil.getTimestampUrl('/inve/getsdlcxx.do'),
			{
				"wms_inve_transa_id" : wms_inve_transa_id,
				"wms_inve_transa_prod_id" : wms_inve_transa_prod_id,
			},
			function(json) {
				if(json.wmsInveCustomer!=null){
					init_customer_source(json.wmsInveCustomer);
					$("#customer_num").val(json.wmsInveCustomer.customer_num);//客户编号
				}else{
					init_customer_source(json.wmsInveTransa);
					$("#customer_num").val(json.wmsInveTransa.customer_num);//客户编号
				}
				if(json!=null &&json.wmsInveCustomer!=null){
					//$("#certificate_type_name").val(json.wmsInveTransa.certificate_type_name);
					setCertificate_type_name(json.wmsInveCustomer.certificate_type);//初始化证件类型
				}
				
				// 如果是PTP单据,修改开户单-理财申请信息中产品的年华利率
				if(json.wmsInveTransa.transa_type == "2")
				{
					var round_product_interest = tranceNull(json.wmsInveTransaProd.product_interest);
					round_product_interest = round_product_interest.indexOf(".") >-1 ? round_product_interest.substring(0,round_product_interest.indexOf(".")+3) : round_product_interest;
					round_product_interest = round_product_interest.indexOf(".") >-1 
												&& round_product_interest.substring(round_product_interest.indexOf(".")+1,round_product_interest.indexOf(".")+3) == "00" ? round_product_interest.substring(0,round_product_interest.indexOf(".")) : round_product_interest;
					$("label.product_interest_label").text(round_product_interest);
				}
				
				costomer_id=json.wmsInveTransa.costomer_id;//CRM关联信息表主键
				setFormVal("khd", json.wmsInveTransa);
				if(json.cus_birthday != null) {
					$("input[name=cus_birthday]").val(json.cus_birthday_str);
		   		}
				setFormVal("lcsqxxdiv", json.wmsInveTransa);
				setSdxxOtherVal(json.wmsInveTransa);
				setSdcpxxOtherVal(json.wmsInveTransaProd);
				//设置归属单据信息
				setBelInFo(json.wmsInveTransa);
				fileArr = json.wmsInveTransaAttList;
				if(inkey=='0'&& update != 1){
					if(json.wmsInveTransa.mobile_phone.length == 11){
						var mobile_phone = json.wmsInveTransa.mobile_phone.substring(0,3) + '******' + json.wmsInveTransa.mobile_phone.substring(7);
						$('#khd').find('[name=mobile_phone]').val(mobile_phone);
					}else{
						var mobile_phone = '******';
						$('#khd').find('[name=mobile_phone]').val(mobile_phone);
					}
					if(json.wmsInveTransa.id_card!=null&&json.wmsInveTransa.id_card!="undefined"&&json.wmsInveTransa.id_card!=""){
						var id_card;
						if(json.wmsInveTransa.id_card.length == 18)
						{
							id_card = json.wmsInveTransa.id_card.substring(0,4) + '**********' + json.wmsInveTransa.id_card.substring(14);	
						}
						else if(json.wmsInveTransa.id_card.length == 8)
						{
							id_card = json.wmsInveTransa.id_card.substring(0,4) + '**********' + json.wmsInveTransa.id_card.substring(4, json.wmsInveTransa.id_card.length);
						}
						else
						{
							id_card = "********";
						}
						
						$('#khd').find('[name=id_card]').val(id_card);
					}
				}else{
					var mobile_phone = json.wmsInveTransa.mobile_phone;
					$('#khd').find('[name=mobile_phone]').val(mobile_phone);
					var id_card = json.wmsInveTransa.id_card;
					$('#khd').find('[name=id_card]').val(id_card);
				}
				if(fhtype == 'fhxg'){
					$("#cancelBtnId").css("display","");
				}
				if(cktype=='ck' && update != 1){
					if(fhtype == 'fh'){
						$("#fhbtn").css("display","");
					}
					//当user_id不等于0时，该用户的角色是业务部主管
					//判断用户是否为该单据的业务员
					if(user_id != 0 && user_id != json.wmsInveTransa.salesman_id){
						if(json.wmsInveTransa.mobile_phone){
							var mobile_phone = json.wmsInveTransa.mobile_phone.substring(0,3)
								+ '****' + json.wmsInveTransa.mobile_phone.substring(7);
							$('#khd').find('[name=mobile_phone]').val(mobile_phone);
						}
						if(json.wmsInveTransa.id_card!=null&&json.wmsInveTransa.id_card!="undefined"&&json.wmsInveTransa.id_card!=""){
							var id_card = json.wmsInveTransa.id_card.substring(0,4) 
								+ '**********' + json.wmsInveTransa.id_card.substring(14);
							$('#khd').find('[name=id_card]').val(id_card);
						}
					}
					setReadOnly();
					if($('[name=category_name]:checked').length == 0){
						$('.lcsqxxtr:not(:first)').hide();
					}else{
						$('[name=category_name]:checked').parent().parent().siblings(':not(.endtr,#headtr)').hide();//隐藏其它产品
					}
					//显示查看附件（展开显示）
					var fjList = globalUtil.syncGetJson('/inve/wmspaginglist.do',{
						"wms_inve_transa_prod_id": wms_inve_transa_prod_id,
				        },'POST');
						var idHtml='';
						var amountHtml='';
						for (var i = 0; i < fjList.Rows.length; i++) {
							    idHtml = '';
								idHtml +='<div style="margin-bottom:8px;" id="delUploadDivId'+fjList.Rows[i].attachment_new_name+'">';
								idHtml += '<a  target="_blank"  href="'+global_param.upload_file_url+fjList.Rows[i].attachment_address+'">'+'<img style="width:700px;height:auto;" src="'+global_param.upload_file_url+fjList.Rows[i].attachment_address+'" /></a>';
								idHtml += '</div>'
							$('#' + fjList.Rows[i].data_detail_name).append(idHtml);
						}
				}
				
	});
}
//设置归属人员信息
function setBelInFo(json){
	var obj = json.belListRY;
	if(obj.belMapYeWuYuan==null){
		$("#bel_salesman_name").attr("value","无");
	}else{
		$("#bel_salesman_name").attr("value",obj.belMapYeWuYuan.personnel_name+"/"+obj.belMapYeWuYuan.personnel_shortCode);
	}
	if(obj.belBuMenJingLi==null){
		$("#bel_department_manager_name").attr("value","无");
	}else{
		$("#bel_department_manager_name").attr("value",obj.belBuMenJingLi.personnel_name+"/"+obj.belBuMenJingLi.personnel_shortcode);
	}
	if(obj.belZhongFenZong==null){
		$("#bel_center_manager_name").attr("value","无");
	}else{
		$("#bel_center_manager_name").attr("value",obj.belZhongFenZong.personnel_name+"/"+obj.belZhongFenZong.personnel_shortcode);
	}
	if(obj.belFuZhong==null){
		$("#bel_vice_general_manager_name").attr("value","无");
	}else{
		$("#bel_vice_general_manager_name").attr("value",obj.belFuZhong.personnel_name+"/"+obj.belFuZhong.personnel_shortcode);
	}
	if(obj.belzong==null){
		$("#bel_general_manager_name").attr("value","无");
	}else{
		$("#bel_general_manager_name").attr("value",obj.belzong.personnel_name+"/"+obj.belzong.personnel_shortcode);
	}
}

//设置上单信息中控件的值
function setSdxxOtherVal(wmsInveTransa){
	setRadioVal('cus_gender',wmsInveTransa.cus_gender);
	setRadioVal('bill_send_mode',wmsInveTransa.bill_send_mode);
	if(wmsInveTransa.product_total_count_lower != null && $('#product_total_count_lower').val() != ''){
		$('#product_total_count_lower').val(''+(parseFloat(wmsInveTransa.product_total_count_lower)/10000));
	}	
	$('#product_total_count_upper').val(wmsInveTransa.product_total_count_upper);
	//判断理财上单业务员姓名或者业务员编号是否存在 执行 否者不执行
	if(wmsInveTransa.salesman_name!=null || wmsInveTransa.salesman_shortcode!=null){
		$('#salesman_name').val(wmsInveTransa.salesman_name+"/"+wmsInveTransa.salesman_shortcode);	
	}
	$('#salesman_id').val(wmsInveTransa.salesman_id);
	$('#salesman_city_code').val(wmsInveTransa.salesman_city_code);
	$('#salesman_dept_id').val(wmsInveTransa.salesman_dept_id);
	
	salesmanStatus = wmsInveTransa.salesman_status;
  	/*
	if(salesmanStatus == "zz") {
  		$("#searchPersonnel_href").hide();
  	}
	*/
	setJLVal(wmsInveTransa);
}
//设置上单产品信息中控件的值
function setSdcpxxOtherVal(wmsInveTransaProd){
	$("input[name=wms_inve_pruduct_category_id]").each(function() {
		if ($(this).val() == wmsInveTransaProd.wms_inve_pruduct_category_id) {
			$(this).siblings('input[name=category_name]').attr('checked', 'checked');
			
			var $thisTr = $(this).closest('tr');
			//判断如果是上单修改
			if(update == 1){
				$thisTr.find('[name=product_account]').removeAttr('disabled');
				$thisTr.siblings('[name=product_account]').attr('disabled','disabled');
				//显示查看附件（展开显示）
				var fjList = globalUtil.syncGetJson('/inve/wmspaginglist.do',{
					"wms_inve_transa_prod_id": wms_inve_transa_prod_id,
			        },'POST');
					var idHtml='';
					var amountHtml='';
					var filehtml = '';
					for (var i = 0; i < fjList.Rows.length; i++) {
// 					    idHtml = '';
// 						idHtml +='<div style="margin-bottom:8px;" id="delUploadDivId'+fjList.Rows[i].attachment_new_name+'">';
// 						idHtml += '<a  target="_blank"  href="'+global_param.upload_file_url+fjList.Rows[i].attachment_address+'">'+'<img style="width:700px;height:auto;" src="'+global_param.upload_file_url+fjList.Rows[i].attachment_address+'" /></a>';
// 						idHtml += '</div>';
// 						$('#' + fjList.Rows[i].data_detail_name).append(idHtml);
// 						init_attr(0);	
					    filehtml = '';
						var nnme = fjList.Rows[i].attachment_new_name.replace('/','thxg1');
						nnme = nnme.replace('/','thxg2');
									
						if(cktype == 'ck'){
							filehtml += '<div id="delUploadDivId' + nnme + '">';
							filehtml += '<a  target="_blank"  href="'+global_param.upload_file_url+fjList.Rows[i].attachment_address + '">' + 
											'<img style="width:700px;height:auto;" src="'+global_param.upload_file_url+fjList.Rows[i].attachment_address+'" />' +
										'</a>';
						}else{
							filehtml += '<div id="delUploadDivId' + nnme + '">';
							filehtml += '<a  target="_blank"  href="'+global_param.upload_file_url+fjList.Rows[i].attachment_address + '">' + 
								 			fjList.Rows[i].attachment_old_name +
										'</a>';
							filehtml += '<img src="../../images/icon/icon-close.gif" onclick="deleteFile(\'' + nnme + '\')"/>';
						}			
						
						filehtml += '</div>';
						$('#' + fjList.Rows[i].data_detail_name).append(filehtml);
					}
			}
			
			if(wmsInveTransaProd.org_product_account != null) {
				$thisTr.find('[name=product_account]').val(""+(parseFloat(wmsInveTransaProd.org_product_account)/10000));
				$("#product_total_count_lower").val(""+(parseFloat(wmsInveTransaProd.org_product_account)/10000));//初始化上单金额 此金额需要减去赎回金额  获取的是上单产品信息表中的理财金额
				$("#product_total_count_upper").val(convertCurrency((parseFloat(wmsInveTransaProd.org_product_account)/10000)));//小写转大写--上单金额
			}
			
			if(wmsInveTransaProd.expect_interest_account != null){
				if(("" + wmsInveTransaProd.expect_interest_account).indexOf('.') > 0){
					$thisTr.find('[name=expect_interest_account]').val(wmsInveTransaProd.expect_interest_account.toFixed(2));
					$thisTr.find('.expect_interest_account_label').text(wmsInveTransaProd.expect_interest_account.toFixed(2));
				}else{
					$thisTr.find('[name=expect_interest_account]').val(wmsInveTransaProd.expect_interest_account);
					$thisTr.find('.expect_interest_account_label').text(wmsInveTransaProd.expect_interest_account);
				}				
			} 
			
			return false;
		}
	});
}
//设置Radio控件的值
function setRadioVal(nameVal,valFromDb){
	$("input[name='"+nameVal+"']").each(function() {
		if ($(this).val() == valFromDb) {
			$(this).attr('checked', 'checked');
			return false;
		}
	});
}
//开户信息二级tab页切换
function changeTab02(id){    
	var khd = document.getElementById("khd"); //客户基本信息
	var khzl = document.getElementById("khzl"); //客户资料
	var zfxq = document.getElementById("zfxq"); //支付详情
	var zqxx = document.getElementById("zqxx"); //债权信息

	if(id == 'khd') {
		document.getElementById("tabbody01").className = "tabbody1";
		document.getElementById("tabbody02").className = "tabbody2";	
		document.getElementById("tabbody03").className = "tabbody2";
		document.getElementById("tabbody04").className = "tabbody2";
		document.getElementById("khdtabdiv").className = "tab_step tab_step101";
		document.getElementById("khzltabdiv").className = "tab_step tab_step202";
		document.getElementById("zfxqtabdiv").className = "tab_step tab_step302";
		document.getElementById("zqxxtabdiv").className = "tab_step tab_step402";
		khd.style.display = '';
		khzl.style.display = 'none';
		zfxq.style.display = 'none';
		zqxx.style.display = 'none';
	}else if(id == 'khzl'){
		document.getElementById("tabbody01").className = "tabbody2";
		document.getElementById("tabbody02").className = "tabbody1";
		document.getElementById("tabbody03").className = "tabbody2";	
		document.getElementById("tabbody04").className = "tabbody2";
		document.getElementById("khdtabdiv").className = "tab_step tab_step102";
		document.getElementById("khzltabdiv").className = "tab_step tab_step201";
		document.getElementById("zfxqtabdiv").className = "tab_step tab_step302";
		document.getElementById("zqxxtabdiv").className = "tab_step tab_step402";
		khd.style.display = 'none';
		khzl.style.display = '';
		zfxq.style.display = 'none';
		zqxx.style.display = 'none';
	}else if(id == 'zfxq'){
		document.getElementById("tabbody01").className = "tabbody2";
		document.getElementById("tabbody02").className = "tabbody2";
		document.getElementById("tabbody03").className = "tabbody1";
		document.getElementById("tabbody04").className = "tabbody2";
		document.getElementById("khdtabdiv").className = "tab_step tab_step102";
		document.getElementById("khzltabdiv").className = "tab_step tab_step202";
		document.getElementById("zfxqtabdiv").className = "tab_step tab_step301";
		document.getElementById("zqxxtabdiv").className = "tab_step tab_step402";
		khd.style.display = 'none';
		khzl.style.display = 'none';
		zfxq.style.display = '';
		zqxx.style.display = 'none';
	}else if(id == 'zqxx'){
		document.getElementById("tabbody01").className = "tabbody2";
		document.getElementById("tabbody02").className = "tabbody2";
		document.getElementById("tabbody03").className = "tabbody2";
		document.getElementById("tabbody04").className = "tabbody1";
		document.getElementById("khdtabdiv").className = "tab_step tab_step102";
		document.getElementById("khzltabdiv").className = "tab_step tab_step202";
		document.getElementById("zfxqtabdiv").className = "tab_step tab_step302";
		document.getElementById("zqxxtabdiv").className = "tab_step tab_step401";
		khd.style.display = 'none';
		khzl.style.display = 'none';
		zfxq.style.display = 'none';
		zqxx.style.display = '';
	}
	
}

//Tab页切换
function changeTab(id) {
	if(cktype == 'ck'){
		var khinfo = document.getElementById("khxx"); //开户信息
		//var zqinfo = document.getElementById("zqxx"); //债权信息
		var syinfo = document.getElementById("syxx"); //收益信息
		var rzinfo = document.getElementById("rzxx"); //交易详情
		if(id == 'khxx') {
			document.getElementById("tabbody1").className = "tabbody1";
			//document.getElementById("tabbody2").className = "tabbody2";		
			document.getElementById("tabbody3").className = "tabbody2";		
			document.getElementById("tabbody4").className = "tabbody2";		
			document.getElementById("khxxtabdiv").className = "tab_step tab_step101";
			//document.getElementById("zqxxtabdiv").className = "tab_step tab_step202";	
			document.getElementById("syxxtabdiv").className = "tab_step tab_step202";		
			document.getElementById("rzxxtabdiv").className = "tab_step tab_step302";		
			khinfo.style.display = '';
			//zqinfo.style.display = 'none';
			syinfo.style.display = 'none';
			rzinfo.style.display = 'none';
		}
		/*else if (id == 'zqxx') {
			document.getElementById("tabbody1").className = "tabbody2";
			document.getElementById("tabbody2").className = "tabbody1";	
			document.getElementById("tabbody3").className = "tabbody2";		
			document.getElementById("tabbody4").className = "tabbody2";		
			document.getElementById("khxxtabdiv").className = "tab_step tab_step102";
			document.getElementById("zqxxtabdiv").className = "tab_step tab_step201";	
			document.getElementById("syxxtabdiv").className = "tab_step tab_step302";	
			document.getElementById("rzxxtabdiv").className = "tab_step tab_step402";	
			khinfo.style.display = 'none';
			zqinfo.style.display = '';
			syinfo.style.display = 'none';
			rzinfo.style.display = 'none';
		}*/
		else if (id == 'syxx') {
			document.getElementById("tabbody1").className = "tabbody2";
			//document.getElementById("tabbody2").className = "tabbody2";		
			document.getElementById("tabbody3").className = "tabbody1";		
			document.getElementById("tabbody4").className = "tabbody2";		
			document.getElementById("khxxtabdiv").className = "tab_step tab_step102";
			//document.getElementById("zqxxtabdiv").className = "tab_step tab_step202";	
			document.getElementById("syxxtabdiv").className = "tab_step tab_step201";		
			document.getElementById("rzxxtabdiv").className = "tab_step tab_step302";		
			khinfo.style.display = 'none';
			//zqinfo.style.display = 'none';
			syinfo.style.display = '';
			rzinfo.style.display = 'none';
		}
		else if (id == 'rzxx') {
			document.getElementById("tabbody1").className = "tabbody2";
			//document.getElementById("tabbody2").className = "tabbody2";		
			document.getElementById("tabbody3").className = "tabbody2";		
			document.getElementById("tabbody4").className = "tabbody1";		
			document.getElementById("khxxtabdiv").className = "tab_step tab_step102";
			//document.getElementById("zqxxtabdiv").className = "tab_step tab_step202";	
			document.getElementById("syxxtabdiv").className = "tab_step tab_step202";		
			document.getElementById("rzxxtabdiv").className = "tab_step tab_step301";		
			khinfo.style.display = 'none';
			//zqinfo.style.display = 'none';
			syinfo.style.display = 'none';
			rzinfo.style.display = '';
		}
	}	
}
//删除上传文件的信息链接
function deleteFile(filename){
   	$.ligerDialog.confirm(globalErrorMsg['100016'],
    function(yes) {
    	if (yes) {   
    		$("#delUploadDivId"+filename).remove();
    		filename=filename.replace('thxg1','/');
    		filename=filename.replace('thxg2','/');
    		for(var i=0;i<fileArr.length;i++){
    			if(filename == fileArr[i].attachment_new_name){
    				fileArr.splice(i,1);
    				break;
    			}
    		}
    	}                                            
	});
}
//设置为只读模式
function setReadOnly(){
	$("input[type=text]").attr({
		"disabled" : "disabled"
	});
	$("input[type=radio]").attr({
		"disabled" : "disabled"
	});	
	$('#sxtj').hide();
	$("#uploadButton").css({
		"display" : "none"
	});
	$('#searchPersonnel_href').css('display','none');
	$('.searchPersonnel_jl').hide();
	$('#cxbtn').css('display','none');
	$('#qkbtn').css('display','none');
	$('#tjbtn').css('display','none');
	$('#zcbtn').css('display','none');	
	$('#cancelBtnId').css('display','inline');
	$('#tabbody2').show();
	$('#tabbody3').show();
	$('#tabbody4').show();
	$('.redstar').css('display','none');
	
	//盘上上单对象信息不为空,并且单据状态为待审核的时候,设置银行和支行为可编辑状态
	if(wms_inve_transa_data != undefined && wms_inve_transa_data != null && wms_inve_transa_data.data_status == "11")
	{
		$("#bank_of_deposit").removeAttr("readonly");
		$("#bank_branch").removeAttr("readonly");
		$("#bank_of_deposit").removeAttr("disabled");
		$("#bank_branch").removeAttr("disabled");
// 		$("input[name='is_bank_card']").eq(0).removeAttr("disabled"); 
// 		$("input[name='is_bank_card']").eq(1).removeAttr("disabled");
		$("#bank_info").attr("disabled", "disabled");
	}
	
// 	document.getElementById("searchTJ").style.visibility="hidden";//隐藏查询条件
	initGrid();
}
//选择业务员
function searchPersonnel(obj){
	var header = $(obj).siblings("input:first").attr("id").replace("_name","");
	var url = globalUtil.getHtml("../creditManage/searchPersonnelForCredit.html?header=" + header);
	spfcDialog = $.ligerDialog.open({
        url: url,
        title: '选择业务员',
        width: 1000,
        height: globalUtil.setDialogHeight(600),
        isResize: false
	});
}

//导入业务员信息
function getCheckedPersonnelAll(data1, header){
	var dept_id = 0;
	if(data1.personnel_deptid != null){
		dept_id = data1.personnel_deptid;
	}
	$.ajax({
		url : global_param.context_name + "/inve/wmsfindpersonnelinformation.do",
		dataType:"json",
		data : {personne_id:data1.personnel_id, concurrent_post_deptid:dept_id},
		success:function(data){
			/* if(data[0].yeWuYuan.personnel_name==null){
				$("#"+header+"_name").attr("value","无");
			}else{ 
				*/
				$("#bel_salesman_id_id").attr("value", "");
				$("#bel_salesman_dept_id").attr("value", "");
				$("#bel_department_manager_id").attr("value", "");
				$("#bel_department_manager_dept_id").attr("value", "");
				$("#bel_vice_general_manager_id").attr("value", "");
				$("#bel_vice_general_manager_dept_id").attr("value", "");
				$("#bel_general_manager_id").attr("value", "");
				$("#bel_general_manager_dept_id").attr("value", "");
				$("#bel_center_manager_id").attr("value", "");
				$("#bel_center_manager_dept_id").attr("value", "");
				
				$("#salesman_name").attr("value",data.yeWuYuan.personnel_name+"/"+data.yeWuYuan.personnel_shortCode);
				$("#salesman_id").attr("value",data.yeWuYuan.personnel_id);
				$("#salesman_city_code").attr("value",data.yeWuYuan.personnel_regionnumber);	
				$("#salesman_dept_id").attr("value",data.yeWuYuan.personnel_deptId);
				$("#bel_salesman_id_id").attr("value", data.yeWuYuan.personnel_id);
				$("#bel_salesman_dept_id").attr("value", data.yeWuYuan.personnel_deptId);
				
			//}
			if(data.buMenJingLi==null){
				$("#department_manager_name").attr("value","无");
			}else{
				if(data.buMenJingLi.personnel_name == null && data.buMenJingLi.personnel_shortcode==null){
					$("#department_manager_name").attr("value","无");
				}else{
					$("#department_manager_name").attr("value",data.buMenJingLi.personnel_name + "/" + data.buMenJingLi.personnel_shortcode);
				}
				$("#department_manager_id").attr("value", data.buMenJingLi.personnel_id);
				$("#department_manager_city_code").attr("value", data.buMenJingLi.personnel_regionnumber);
				$("#department_manager_dept_id").attr("value", data.buMenJingLi.personnel_deptid);
				$("#bel_department_manager_id").attr("value",data.buMenJingLi.personnel_id);
				$("#bel_department_manager_dept_id").attr("value", data.buMenJingLi.personnel_deptid);
			}
			
			if(data.zhongFenZong==null){
				$("#center_manager_name").attr("value","无");
			}else{
				if(data.zhongFenZong.personnel_name == null && data.zhongFenZong.personnel_shortcode==null){
					$("#center_manager_name").attr("value","无");
				}else{
					$("#center_manager_name").attr("value",data.zhongFenZong.personnel_name + "/" + data.zhongFenZong.personnel_shortcode);
				}
				$("#center_manager_id").attr("value", data.zhongFenZong.personnel_id);
				$("#center_manager_dept_id").attr("value",data.zhongFenZong.personnel_deptid);
				$("#bel_center_manager_id").attr("value",data.zhongFenZong.personnel_id);
				$("#bel_center_manager_dept_id").attr("value", data.zhongFenZong.personnel_deptid);
			}
			if(data.fuZhong==null){
				$("#vice_general_manager_name").attr("value","无");
			}else{
				if(data.fuZhong.personnel_name==null && data.fuZhong.personnel_shortcode==null){
					$("#vice_general_manager_name").attr("value","无");
				}else{
					$("#vice_general_manager_name").attr("value",data.fuZhong.personnel_name + "/" + data.fuZhong.personnel_shortcode);
				}
				$("#vice_general_manager_id").attr("value", data.fuZhong.personnel_id);
				$("#vice_general_manager_city_code").attr("value", data.fuZhong.personnel_regionnumber);
				$("#vice_general_manager_dept_id").attr("value", data.fuZhong.personnel_deptid);
				$("#bel_vice_general_manager_id").attr("value", data.fuZhong.personnel_id);
				$("#bel_vice_general_manager_dept_id").attr("value", data.fuZhong.personnel_deptid);
			}
			if(data.zong==null){
				$("#general_manager_name").attr("value","无");
			}else{
				$("#general_manager_name").attr("value",data.zong.personnel_name + "/" + data.zong.personnel_shortcode);
				$("#general_manager_id").attr("value", data.zong.personnel_id);
				$("#general_manager_city_code").attr("value", data.zong.personnel_regionnumber);
				$("#general_manager_dept_id").attr("value", data.zong.personnel_deptid);
				$("#bel_general_manager_id").attr("value", data.zong.personnel_id);
				$("#bel_general_manager_dept_id").attr("value", data.zong.personnel_deptid);
			}
		}
	});
	//salesman_name
	//$("#"+header+"_name").attr("value",data.personnel_name+"/"+data.personnel_shortcode);
	//$("#"+header+"_id").attr("value",data.personnel_id);
	//$("#"+header+"_city_code").attr("value",data.personnel_regionnumber);	
	//$("#"+header+"_dept_id").attr("value",data.personnel_deptid);
	salesmanStatus=data1.salesman_status;
}
//小写金额转大写金额
function convertCurrency(currencyDigits) {  
	var MAXIMUM_NUMBER = 99999999999.99;   
	var CN_ZERO = "零";  
	var CN_ONE = "壹";  
	var CN_TWO = "贰";  
	var CN_THREE = "叁";  
	var CN_FOUR = "肆";  
	var CN_FIVE = "伍";  
	var CN_SIX = "陆";  
	var CN_SEVEN = "柒";  
	var CN_EIGHT = "捌";  
	var CN_NINE = "玖";  
	var CN_TEN = "拾";  
	var CN_HUNDRED = "佰";  
	var CN_THOUSAND = "仟";  
	var CN_TEN_THOUSAND = "万";  
	var CN_HUNDRED_MILLION = "亿";  
	var CN_SYMBOL = "";  
	var CN_DOLLAR = "";  
	var CN_TEN_CENT = "角";  
	var CN_CENT = "分";  
	var CN_INTEGER = "";  
	    
	var integral;   
	var decimal; 
	var outputCharacters; 
	var parts;  
	var digits, radices, bigRadices, decimals;  
	var zeroCount;  
	var i, p, d;  
	var quotient, modulus;  
	  
	currencyDigits = currencyDigits.toString();   
	  
	currencyDigits = currencyDigits.replace(/,/g, ""); 
	currencyDigits = currencyDigits.replace(/^0+/, ""); 
	
	if (Number(currencyDigits) > MAXIMUM_NUMBER) {  
	  globalUtil.warnMsg(globalErrorMsg['100404']);  
	  return "";  
	}		
	parts = currencyDigits.split(".");  
	if (parts.length > 1) {  
	  integral = parts[0];  
	  decimal = parts[1];  
	  decimal = decimal.substr(0, 2);  
	}  
	else {  
	  integral = parts[0];  
	  decimal = "";  
	}  
	digits = new Array(CN_ZERO, CN_ONE, CN_TWO, CN_THREE, CN_FOUR, CN_FIVE, CN_SIX, CN_SEVEN, CN_EIGHT, CN_NINE);  
	radices = new Array("", CN_TEN, CN_HUNDRED, CN_THOUSAND);  
	bigRadices = new Array("", CN_TEN_THOUSAND, CN_HUNDRED_MILLION);  
	decimals = new Array(CN_TEN_CENT, CN_CENT);  
	outputCharacters = "";  
	if (Number(integral) > 0) {  
	  zeroCount = 0;  
	  for (i = 0; i < integral.length; i++) {  
	   p = integral.length - i - 1;  
	   d = integral.substr(i, 1);  
	   quotient = p / 4;  
	   modulus = p % 4;  
	   if (d == "0") {  
	    zeroCount++;  
	   }  
	   else {  
	    if (zeroCount > 0)  
	    {  
	     outputCharacters += digits[0];  
	    }  
	    zeroCount = 0;  
	    outputCharacters += digits[Number(d)] + radices[modulus];  
	  }  
	   if (modulus == 0 && zeroCount < 4) {  
	    outputCharacters += bigRadices[quotient];  
	  }  
	  }  
	  outputCharacters += CN_DOLLAR;  
	}  
	if (decimal != "") {  
	  for (i = 0; i < decimal.length; i++) {  
	   d = decimal.substr(i, 1);  
	   if (d != "0") {  
	    outputCharacters += digits[Number(d)] + decimals[i];  
	   }  
	  }  
	}  
	if (outputCharacters == "") {  
	  outputCharacters = CN_ZERO + CN_DOLLAR;  
	}  
	if (decimal == "") {  
	  outputCharacters += CN_INTEGER;  
	}  
	outputCharacters = CN_SYMBOL + outputCharacters;  
	return outputCharacters;  
} 
//显示合计投资金额小写及大写，并计算预计收益
function generateUpperCase(ele){
	if(globalUtil.isNum($(ele).val())){
		$('#product_total_count_lower').val($(ele).val());
		$('#product_total_count_upper').val(convertCurrency($(ele).val()));
		var yjsy = calculateYjsy(ele);		
		if(yjsy.indexOf('.') > 0){
			var yjsynum = new Number(yjsy);
			$(ele).parent().next().find('[name=expect_interest_account]').val(yjsynum.toFixed(2));//计算预计收益的值
			$(ele).parent().next().find('label').text(yjsynum.toFixed(2));//显示预计收益的值
		}else{
			$(ele).parent().next().find('[name=expect_interest_account]').val(yjsy);//计算预计收益的值
			$(ele).parent().next().find('label').text(yjsy);//显示预计收益的值
		}		
	}else{
		$('#product_total_count_lower').val('');
		$('#product_total_count_upper').val('');
		$(ele).parent().next().find('[name=expect_interest_account]').val('');
		$(ele).parent().next().find('label').text('');
	}	
	try{
		var iframetmp = document.getElementById("zfxqiframe");
		var iframeWindow = iframetmp.contentWindow || iframetmp.contentDocument.parentWindow;
		iframeWindow.this_inve_trance_data.product_total_count_lower=$(ele).val()*10000;
		iframeWindow.setVal($(ele).val());
	}catch(e){
	}
}
//计算预计收益  = 上单/追单金额 * (年化利率 / 12  * 期限时间 + 奖励利率) 
function calculateYjsy(ele){
	var $tr = $(ele).closest('tr');
	var sdje = $(ele).val() * 10000; //上单/追单金额
	var isNft = $tr.find('.isNft').text();//是否是年付特：0:否；1是。
	var nhll = $tr.find('.productInterest').text() * 0.01;//年化利率
	var wms_inve_pruduct_category_id = $tr.find('[name=wms_inve_pruduct_category_id]').val();//理财产品id
	var jlll = $tr.find('.rewardInterest').text() * 0.01;//奖励利率(年付特的为加和后的值)
	jlll =selectjlll(wms_inve_pruduct_category_id,sdje,jlll);//处理存量奖励利率
	$tr.find('[name=reward_interest]').val(jlll*100);//奖励利率--因为 初始化的奖励利率不准确 需要重新计算赋值
	var lcqx = $tr.find('[name=product_deadline]').val();//理财期限

	var expectInterest = 0;
	
	if(isNft == "0") { //正常产品
		expectInterest = sdje * (parseFloat(nhll) / 12 * parseFloat(lcqx) + parseFloat(jlll));
	} else { //年付特产品
		expectInterest = sdje * (parseFloat(nhll) / 12 * parseFloat(lcqx) + 2 * parseFloat(jlll));
	}
	return "" + expectInterest;
	
}
//根据产品主键查找对应的奖励利率  参数1 是产品id  参数2是用户输入的金额
function selectjlll(wms_inve_pruduct_category_id,sdje,jlll){
	$.each(product_data,function(i,product){
		if(product.wms_inve_pruduct_category_id==wms_inve_pruduct_category_id){
			//根据返利方式判断奖励利率
			if(product.category_rebate_way == "2") { //累计存量
				var num=0;
				$.each(product.jllls, function(m, obj) {
					if(parseFloat(sdje/10000)>=parseFloat(obj.customer_stock_begin)&&(parseFloat(sdje/10000)<parseFloat(obj.customer_stock_end))){
						jlll=parseFloat(obj.bonus_rate)*0.01;
						num++;
					}
				});
				if(num==0){//判断是否有符合条件的规则 如果没有则奖励利率为0
					jlll=0;
				}
			}else if(product.category_rebate_way == "1"){//满月
				jlll=jlll;
			}else{
				jlll= 0;
			}
		}
	});
	return jlll;
}
//切换理财产品时所做的处理
function changeStatus(ele){
	
	//获取当前行
	var $tr = $(ele).closest('tr');
	$tr.find('[name=product_account]').removeAttr('disabled');
	$tr.siblings().find('[name=product_account]').attr('disabled','disabled').val('');
	$tr.siblings().find('[name=expect_interest_account]').val('');
	$tr.siblings().find('.expect_interest_account_label').html('');
	
	//当上单/追单金额为空时，清空合计投资金额大小写
	if($tr.find('[name=product_account]').val()==''){
		$('#product_total_count_upper,#product_total_count_lower').val('');
	}
		
}
//切换理财期限时所做的处理
function showNhll(ele){
	//获取当前行
	var $tr = $(ele).closest('tr');
	
	$tr.find('[name=product_account]').removeAttr('disabled');
	//年化利率
	var productInterest = product_interest_map[$tr.find('[name=wms_inve_pruduct_category_id]').val()][$tr.find('[name=product_deadline]').val()];
	//奖励利率
	var rewardInterest = reward_interest_map[$tr.find('[name=wms_inve_pruduct_category_id]').val()][$tr.find('[name=product_deadline]').val()];
	
	$tr.find('[name=product_interest]').val(productInterest);
	$tr.find('[name=product_interest]').next().html(productInterest);
	
	$tr.find('[name=reward_interest]').val(rewardInterest);
	$tr.find('[name=reward_interest]').next().html(rewardInterest);
	
	generateUpperCase($tr.find('[name=product_account]'));
}
//验证提交时必填项
function valiRequired(){
	var flag = false;
	//验证身份证18位的正则表达式
	var reg = /(^\d{18}$)|(^\d{17}(\d|X|x)$)/;
	var card = $("#id_card").val();
	$('.bitian:enabled').each(function(){
        if($(this).val().trim()==''){
            flag = true;
            warnMsg(globalErrorMsg['100118'],this);
            return false;
        }
    });
    if(flag){
    	$('.bitian:enabled').each(function(){
    		$(this).val().trim();
        });
        return true;
    }
    flag = false;
	$('[name=category_name]').each(function(){
		if($(this).attr('checked')){
			flag=true;
		}
	});
	if(!flag){
		globalUtil.warnMsg(globalErrorMsg['800125']);
		return true;
	}
	
	flag = false;
	$('[name=cus_gender]').each(function(){
		if($(this).attr('checked')){
			flag=true;
		}
	});
	if(!flag){
		globalUtil.warnMsg(globalErrorMsg['800120']);
		return true;
	}
	flag = false;
	if($('#salesman_name').val()==''){
		globalUtil.warnMsg(globalErrorMsg['800121']);
		return true;
	}
	$('[name=bill_send_mode]').each(function(){
		if($(this).attr('checked')){
			flag=true;
		}
	});
	if(!flag){
		globalUtil.warnMsg(globalErrorMsg['800122']);
		return true;
	}
	/*if(!reg.test(card)){
		globalUtil.warnMsg(globalErrorMsg['800124']);
		return true ; 
	}*/
	if(card==null||card=="undefined"){
		globalUtil.warnMsg(globalErrorMsg['800124']);
		return true ; 
	}
	/* if(fileArr.length==0){
		globalUtil.warnMsg(globalErrorMsg['800123']);
		return true;
	} */
}

//产品禁用解决方案
function productForbidden(paramJson) {
	var data = globalUtil.syncGetJson('/inve/wmsinvepruductcategorygetproductisforbidden.do',{
		'wms_inve_pruduct_category_id': paramJson.wms_inve_pruduct_category_id // 
    },'GET');
	if(data != null && data.is_forbidden != null) {
		if(data.is_forbidden == "1") {
			globalUtil.warnMsg(globalErrorMsg['800136']); //提示：该产品已经禁用请重新选择!
			initLcsqxx(); //产品禁用重新加载产品列表
			return;
		}
	}
}
var saveIdentification=false;//标记保存是否返回
//数据保存
function save(saveFlag){
	//因为rrm身份证号不是必填默认id-card、字段是身份证号类型
	if($("#certificate_type").val()==null||$("#certificate_type").val()==""||$("#certificate_type").val()=="undefined"){
		$("#certificate_type").val(certificate_type_val);
	}
	if(update!=1){ //非修改状态
		if(costomer_id==null||costomer_id==''){
			globalUtil.warnMsg(globalErrorMsg['100119']); //提示：CRM系统中此客户信息不存在!
			return;
		}
	}
	if(saveFlag==1 &&$("#certificate_type").val()==certificate_type_val && valiRequired()){//判断是否是身份证
		return;
	}
	
	if($("#financial_bill_code").val() == null || $("#financial_bill_code").val()==""){
		globalUtil.warnMsg(globalErrorMsg['1800001']); //提示:合同编号不允许为空 
		return;
	}
	
	/*if($("#id_card").val().trim() != "" && saveFlag==0&&$("#certificate_type").val()==certificate_type_val){
		//暂存时也校验身份证的格式是否正确
		var reg = /(^\d{18}$)|(^\d{17}(\d|X|x)$)/;
		var card = $("#id_card").val().trim();
		if(!reg.test(card)){
			globalUtil.warnMsg(globalErrorMsg['800124']);
			return;
		}
	}*/
	if(saveFlag==0){
		var flag = false;
	    $('[name=category_name]').each(function(){
	        if($(this).attr('checked')){
	            flag=true;
	        }
	    });
	    if(!flag){
	        globalUtil.warnMsg(globalErrorMsg['800125']);
	        return true;
	    }
	    //校验上单金额为必填
	    var radioIndex = $('input[name=category_name]:checked').parent().parent().index();
        if($('input[name=product_account]:eq(' + (radioIndex - 1) + ')').val().trim() == ''){
            warnMsg(globalErrorMsg['100123']);
            return false;
        }
	}
	if(salesmanStatus == "lz") {
		globalUtil.warnMsg(globalErrorMsg['800135']); //提示：该业务员已离职，请重新选择
		return;
  	}
	var paramJson = {};//要传递给后台的参数
	var paramJson = globalUtil.getFormParam('khd');//获取客户基本信息数据
	get_qt_khjbxx(paramJson);//获取客户基本信息其它控件数据
    get_lcsqxx(paramJson);//获取理财申请信息
    paramJson.fileArr = JSON.stringify(fileArr);
    paramJson.saveFlag = saveFlag;
    paramJson.costomer_id=costomer_id;
    paramJson.certificate_type= $("#certificate_type").val();//证件类型
  	//判断产品是否被禁用（修改时不用判断)
    if(wms_inve_pruduct_category_id == null || wms_inve_pruduct_category_id == "") {
		productForbidden(paramJson)
	}
    if(zftype == 'zf'){
	    var iframetmp = document.getElementById("zfxqiframe");
		var iframeWindow = iframetmp.contentWindow || iframetmp.contentDocument.parentWindow;
		if(!iframeWindow.saveupdate(saveFlag)){
			changeTab02('zfxq');
			return;
		}
		setInfo(paramJson,1);
    }
    //判断是否可以点击（点击的提交或者保存的请求是否返回 ）
	if(saveIdentification){
		globalUtil.warnMsg(globalErrorMsg['1111111']); //请不要连续点击！
		return;
	}
    
	saveIdentification=true;
	paramJson.LCtype=LCtype;
	paramJson.taskId=taskId;//流程id
	paramJson.zctype = zctype;
	paramJson.data_type_name='819';//附件表大类id
	var url;
    if(zftype == 'zf'){
    	paramJson.wms_inve_transa_id= wms_inve_transa_id;
    	paramJson.wms_inve_transa_prod_id= wms_inve_transa_prod_id;
    	url='/inve/wmsinvetransasaveupdate.do';
    }else{
    	url='/inve/wmsinvetransasave.do'
    }
	
   	$.post(globalUtil.getTimestampUrl(url), paramJson,
      function(data) {
   		saveIdentification=false;//标记保存是否返回
      	if(data == 'success') {//提交成功
      		if(update==1){
      			globalUtil.successMsg(globalErrorMsg['100002'],
      	           		function(){   
      						closeTabAndRes();
      						window.location.reload();
      			});
      		}else{
      			globalUtil.successMsg(globalErrorMsg['100002'],
      	           		function(){
      	     				window.location.href=global_param.context_name+"/resources/html/inve/addFinancialManagement.html";
      	           	 });
      		}
      	}else if(!isNaN(data.substring(0,1))){//暂存成功
      		if(update==1){
      			globalUtil.successMsg(globalErrorMsg['100032'],
      	           		function(){   
      						closeTabAndRes();
      						window.location.reload();
      			});
      		}else{
	      		var arr = data.split(";");
	      		$('#wms_inve_transa_id').val(arr[0]);
	      		$('#wms_inve_transa_prod_id').val(arr[1]);
	      		globalUtil.successMsg(globalErrorMsg['100032'],function(){
	      			window.location.href=global_param.context_name+"/resources/html/inve/addFinancialManagement.html";
	      		});
	      		
      		}
		}else if(data == 'error1'){
			globalUtil.errorMsg(globalErrorMsg['800127']); //追单金额不能低于最小值	
		}else if(data == 'error2'){
			globalUtil.errorMsg(globalErrorMsg['800128']); //追单金额不能超过最大值		
		}else if(data == 'error3'){
			globalUtil.errorMsg(globalErrorMsg['800129']); //上单金额不能低于最小值		
		}else if(data == 'error4'){
			globalUtil.errorMsg(globalErrorMsg['800130']); //上单金额不能超过最大值	
		}else if(data == 'error5'){
			globalUtil.errorMsg(globalErrorMsg['800131']); //追单金额总和不能超过产品最大持有金额	
		}else if(data == 'error6'){
			globalUtil.errorMsg(globalErrorMsg['800132']); //上单金额不能超过产品最大持有金额
		}else {
            globalUtil.errorMsg(globalErrorMsg['100012']); //保存失败
        }
	});
}
	var jsonStr={};
	//获取支付信息paramJson
	function setInfo(json,val){
		if(val=='0'){
			jsonStr=json;
		}else if(val=='1'){
			json.bank_branch=jsonStr.bank_branch;
			json.bank_of_deposit=jsonStr.bank_of_deposit;
			json.bank_of_deposit_city=jsonStr.bank_of_deposit_city;
			json.bank_of_deposit_pro=jsonStr.bank_of_deposit_pro;
			json.card_no=jsonStr.card_no;
			json.card_owner_name=jsonStr.card_owner_name;
			json.cash_pay_name=jsonStr.cash_pay_name;
			json.flagKey=jsonStr.flagKey;
			json.is_allopatry=jsonStr.is_allopatry;
			json.itcardJSON=jsonStr.itcardJSON;
			json.pay_account=jsonStr.pay_account;
			json.pay_type=jsonStr.pay_type;
			json.should_pay_account=jsonStr.should_pay_account;
			json.wms_inve_transa_id=jsonStr.wms_inve_transa_id;
			json.wms_inve_transa_prod_id=jsonStr.wms_inve_transa_prod_id;
			json.fileArrpay=jsonStr.fileArr;//文件
			json.data_type_name_str=jsonStr.data_type_name;//上传文件大类id
			return jsonStr;
		}
		
	}
//获取理财申请信息
function get_lcsqxx(lcsqxx){
	var checkThisTrEle = $('[name=category_name]:checked').parent().parent().get();
	lcsqxx.category_name = $(checkThisTrEle).find('[name=category_name]').val();
	lcsqxx.wms_inve_pruduct_category_id = $(checkThisTrEle).find('[name=wms_inve_pruduct_category_id]').val();
	lcsqxx.product_deadline = $(checkThisTrEle).find('[name=product_deadline]').val();
	if($(checkThisTrEle).find('[name=product_deadline]').val() != null && $(checkThisTrEle).find('[name=product_deadline]').val() != "") {
		lcsqxx.product_deadline_name = $(checkThisTrEle).find('[name=product_deadline]').val() + "期";
	}
	lcsqxx.product_interest = $(checkThisTrEle).find('[name=product_interest]').val();
	lcsqxx.reward_interest = $(checkThisTrEle).find('[name=reward_interest]').val();
	lcsqxx.category_type = $(checkThisTrEle).find('[name=category_type]').val();
	lcsqxx.category_maximum_amount = $(checkThisTrEle).find('[name=category_maximum_amount]').val();
	lcsqxx.category_investment_money_min = $(checkThisTrEle).find('[name=category_investment_money_min]').val();
	lcsqxx.category_investment_money_max = $(checkThisTrEle).find('[name=category_investment_money_max]').val();
	lcsqxx.category_additional_monery_min = $(checkThisTrEle).find('[name=category_additional_monery_min]').val();
	lcsqxx.category_additional_monery_max = $(checkThisTrEle).find('[name=category_additional_monery_max]').val();
	if(!globalUtil.isEmpty($(checkThisTrEle).find('[name=product_account]').val())){
		lcsqxx.product_account = ''+(parseFloat($(checkThisTrEle).find('[name=product_account]').val())*10000);	
	}
	if($(checkThisTrEle).find('[name=expect_interest_account]').val()!='undefined' && !globalUtil.isEmpty($(checkThisTrEle).find('[name=expect_interest_account]').val())){
		lcsqxx.expect_interest_account = $(checkThisTrEle).find('[name=expect_interest_account]').val();
	}	
	lcsqxx.wms_inve_transa_prod_id = $('#wms_inve_transa_prod_id').val();
}
//获取客户基本信息其它控件数据
function get_qt_khjbxx(khjbxx){
	khjbxx.cus_gender = $('[name=cus_gender]:checked').val();
	if($('#product_total_count_lower').val() != null && $('#product_total_count_lower').val() != ''){
		khjbxx.product_total_count_lower = ''+(parseFloat($('#product_total_count_lower').val())*10000);
	}	
	khjbxx.product_total_count_upper = $('#product_total_count_upper').val();
	khjbxx.bill_send_mode = $('[name=bill_send_mode]:checked').val();
	//判断业务员选项是否为空或者业务员编码
	if($('#salesman_name').val()!=''){
    	khjbxx.salesman_name = $('#salesman_name').val().split("/")[0];
    	khjbxx.salesman_shortcode = $('#salesman_name').val().split("/")[1];		
	}
	//业务员的信息
    khjbxx.salesman_id = $('#salesman_id').val();
    khjbxx.salesman_city_code = $('#salesman_city_code').val();
    khjbxx.salesman_dept_id = $('#salesman_dept_id').val();
    khjbxx.wms_inve_transa_id = $('#wms_inve_transa_id').val();
    khjbxx.bel_salesman_id_id = $('#bel_salesman_id_id').val();
    khjbxx.bel_salesman_dept_id = $('#bel_salesman_dept_id').val();
    //部门经理
    khjbxx.department_manager_id = $('#department_manager_id').val();
    khjbxx.department_manager_city_code = $('#department_manager_city_code').val();
    khjbxx.department_manager_dept_id = $('#department_manager_dept_id').val();
    khjbxx.bel_department_manager_id = $('#bel_department_manager_id').val();
    khjbxx.bel_department_manager_dept_id = $('#bel_department_manager_dept_id').val();
    //中分总
    khjbxx.center_manager_id = $('#center_manager_id').val();
    khjbxx.center_manager_dept_id=$('#center_manager_dept_id').val();
    khjbxx.bel_center_manager_id = $('#bel_center_manager_id').val();
    khjbxx.bel_center_manager_dept_id=$('#bel_center_manager_dept_id').val();
    //副总经理
    khjbxx.vice_general_manager_id = $('#vice_general_manager_id').val();
    khjbxx.vice_general_manager_city_code = $('#vice_general_manager_city_code').val();
    khjbxx.vice_general_manager_dept_id = $('#vice_general_manager_dept_id').val();
    khjbxx.bel_vice_general_manager_id = $('#bel_vice_general_manager_id').val();
    khjbxx.bel_vice_general_manager_dept_id = $('#bel_vice_general_manager_dept_id').val();
    
    //总经理
    khjbxx.general_manager_id = $('#general_manager_id').val();
    khjbxx.general_manager_city_code = $('#general_manager_city_code').val();
    khjbxx.general_manager_dept_id = $('#general_manager_dept_id').val();
    khjbxx.bel_general_manager_id= $('#bel_general_manager_id').val();
    khjbxx.bel_general_manager_dept_id=$('#bel_general_manager_dept_id').val();
    
    khjbxx.customer_num=$("#customer_num").val();
}
//弹出错误提示框
function warnMsg(msg,ele){
	globalUtil.addMask('1');
	var obj = $.ligerDialog.warn(msg, null, null);
	obj.options.onHiddenOrClose = function() {
		$(ele).val('');
		$(ele).focus();
		globalUtil.delMask('1');
    };
}
//根据身份证号带出其它信息
function generateOtherInfo(id_card){
	if($(id_card).val()==''){
		return;
	}
	if(!globalUtil.isIdCard($(id_card).val())){
		warnMsg(globalErrorMsg['800124'],id_card);
		return;
	}
	$('[name=cus_birthday]').val($(id_card).val().substring(6,10)+'-'+$(id_card).val().substring(10,12)+'-'+$(id_card).val().substring(12,14));
	$.getJSON(globalUtil.getTimestampUrl('/inve/getwmsinvecustomerbyentity.do?id_card='+$(id_card).val()),
			function(data) {
					if(data!=null){
						$.getJSON(globalUtil.getTimestampUrl('/sysmanage/getPmPersonnelInfo.do?salesman_id='+data.salesman_id),
							function(pmdata){
							//根据获取数据中的业务员信息
							$("#salesman_name").val(data.salesman_name+"/"+pmdata.Rows[0].personnel_shortcode);
							//设置客户信息
							setCustomer(data);
						});
					}else{
						
					}		
	});
}
//设置身份证带出来的信息以及业务员相关信息
function setCustomer(data){
	globalUtil.setFormVal("khjbxxdiv", data);
	if(data.cus_birthday != null) {
		$("input[name=cus_birthday]").val(data.cus_birthday_str);
	}
	
	setRadioVal('cus_gender',data.cus_gender);
	//设置业务员的id
	$("#salesman_id").attr("value",data.salesman_id);
	//设置业务员城市编码
	$("#salesman_city_code").attr("value",data.salesman_city_code);	
	//设置业务员部门ID
	$("#salesman_dept_id").attr("value",data.salesman_dept_id);
}
//关闭TAB页并且刷新父页面
function closeTabAndRes(){
	try{
		var registFun = parent.window.registFun;
		registFun[0]();//执行前一个页面的注册方法
		globalUtil.closeCurrentTab();//关闭当前TAB页面
	}catch(e){
		window.parent.dialog.hide();
		window.parent.search();
	}
	
}
//关闭本页
function closeTab(){
	try{
		if(tabId!=null && tabId!="")
		{
			globalUtil.removeTabItem(tabId);
			return ;
		}
		globalUtil.closeCurrentTab();//关闭当前TAB页面
	}catch (e){
		if(window.top==window)
		{
			window.close();
		}
		else
		{
			window.parent.closeDialogShow();
		}
	}
}
//校验上单/追单金额
function valiSdje(ele){
	var val = $(ele).val();
	if(val!='' && !globalUtil.isNum(val)){
		warnMsg(globalErrorMsg['800126'],ele);
	}
}

//理财产品条件查询
function searchProduct() {
	$("#product_total_count_lower").val("");
	$("#product_total_count_upper").val("");
	var param = $('#searchProduct').val().trim();
	initLcsqxx(null, param);
}
//理财产品发布平台查询
function searchPlatform(){
	$("#product_total_count_lower").val("");
	$("#product_total_count_upper").val("");
	var platform_user = $('#searchPlatform').val().trim();
	initLcsqxx(null,null,null,platform_user);
}
//清空理财产品条件
function clearSearchProduct() {
	$('#searchProduct').val("");
}
//清空理财产品发布平台查询
function clearSearchPlatform(){
	$('#searchPlatform').val("");
}
    //获取客户来源信息
    function init_customer_source(json){
    	var customer_source_params ={
				dest_url:'/sysmanage/wmssysdictdatabydictidempty.do?wms_sys_dict_id=67',
				t_col_name:'customer_source',
				valueField:'value_code',   //下拉框value对应的值，默认为id
				textField:'value_meaning',    //下拉框text对应的值，默认为text
				input_width:197,
				def_val:'first',
				};
		global_ligerui_extend.initCombox("customer_source",null,customer_source_params);
		if(json){
			//把值装载设定
			global_ligerui_extend.syncRequestInitComboxData(json,"customer_source");
			//让其不可编辑
			global_ligerui_extend.disabledCombox("customer_source");
		}else{			
		    global_ligerui_extend.initComboxDefVal("customer_source");
		}
    }
    //通过改变客户来源状态 进行页面判断
    function change_customer_source(){
		$("#contact_number").val("");	
		$("#customer_num").val("");
		clear();
    }
   	//清空客户基本信息
   	function clear(){
   		$("input[name=id_card]").val("");
   		$("input[name=cus_name]").val("");
   		$("input[name=cus_gender]").each(function() {
   			$(this).removeAttr('checked');
   		});
   		$("input[name=cus_birthday]").val("");
   		$("input[name=post_code]").val("");
   		$("input[name=mobile_phone]").val("");
   		$("input[name=address_phone]").val("");
   		$("input[name=work_phone]").val("");
   		$("input[name=contact_address]").val("");
   		$("input[name=cus_fax]").val("");
  		$("input[name=customer_email]").val("");
  		$("input[name=cus_address]").val("");
  		$('#salesman_name').val("");
	  	$('#salesman_id').val("");
	  	$('#salesman_city_code').val("");
	  	$('#salesman_dept_id').val("");
	  	$('#salesman_city').val("");
	  	$("#searchPersonnel_href").show();
	  	clearJLVal();
   	}
    //清空经理信息
    function clearJLVal() {
        $('#department_manager_name').val("");
        $('#department_manager_id').val("");
        $('#department_manager_dept_id').val("");
        $('#department_manager_city_code').val("");
        
        $('#vice_general_manager_name').val("");
        $('#vice_general_manager_id').val("");
        $('#vice_general_manager_dept_id').val("");
        $('#vice_general_manager_city_code').val("");
        
        $('#general_manager_name').val("");
        $('#general_manager_id').val("");
        $('#general_manager_dept_id').val("");
        $('#general_manager_city_code').val("");
    }
   	//查询结果附值
   	function setVals(json) {
   		globalUtil.setFormVal("khjbxxdiv", json);
   		if(json.cus_birthday_str != null && json.cus_birthday_str != "") {
   			$("input[name=cus_birthday]").val(json.cus_birthday_str);
   		}else{
   			if($('input[name=cus_birthday]').val() != null && $('input[name=cus_birthday]').val() != ""&&json.certificate_type==certificate_type_val){//1139 是身份证证件类型
   			    $('input[name=cus_birthday]').val(
   			    		$('#id_card').val().substring(6, 10) + '-' + 
   			    		$('#id_card').val().substring(10, 12) + '-' + 
   			    		$('#id_card').val().substring(12, 14));
   			}
   		} 		
   		setRadioVal("cus_gender",json.cus_gender);//设置性别
   		$("#customer_num").val(json.customer_num);
   		//$("#contact_number").val(json.mobile_phone);
   		$("#mobile_phone").val(json.mobile_phone);
		costomer_id=json.costomer_id;
  		$('#salesman_name').val(json.salesman_name);
	  	$('#salesman_id').val(json.salesman_id);
	  	$('#salesman_city_code').val(json.salesman_city_code);
	  	$('#salesman_dept_id').val(json.salesman_dept_id);
	  	$('#salesman_city').val(json.salesman_city);
	  	$("#cus_name").val(json.cus_name);
	  	$("#id_card").val(json.id_card);
	  	$("#cus_address").val(json.cus_address);
	  	$("#post_code").val(json.post_code);
	  	$("#address_phone").val(json.address_phone);
	  	$("#work_phone").val(json.work_phone);
	  	$("#contact_address").val(json.contact_address);
	  	$("#cus_fax").val(json.cus_fax);
	  	$("#customer_email").val(json.customer_email);
		//因为rrm身份证号不是必填默认id-card、字段是身份证号类型
		if(json.certificate_type==null||json.certificate_type==""||json.certificate_type=="undefined"){
			json.certificate_type=certificate_type_val;
		}
	  	$("#certificate_type").val(json.certificate_type);
		setCertificate_type_name(json.certificate_type);//初始化证件类型
	  	//业务员目前状态（兼职:jz、在职:zz、离职:lz）
		salesmanStatus = json.salesman_status;
	  	/*if(salesmanStatus == "zz") {
	  		$("#searchPersonnel_href").hide();
	  	}*/
	  	setJLVal(json);
   	}
   	//设置部门经理  副总经理  总经理 信息
   	function setJLVal(json) {
   		
   		$("#bel_salesman_id_id").attr("value", "");
		$("#bel_salesman_dept_id").attr("value", "");
		$("#bel_department_manager_id").attr("value", "");
		$("#bel_department_manager_dept_id").attr("value", "");
		$("#bel_vice_general_manager_id").attr("value", "");
		$("#bel_vice_general_manager_dept_id").attr("value", "");
		$("#bel_general_manager_id").attr("value", "");
		$("#bel_general_manager_dept_id").attr("value", "");
		$("#bel_center_manager_id").attr("value", "");
		$("#bel_center_manager_dept_id").attr("value", "");
		
   		if(json.listRY.yeWuYuan==null){
   			$("#salesman_name").attr("value","无");
   		}else{
   			$("#salesman_name").attr("value",json.listRY.yeWuYuan.personnel_name+"/"+json.listRY.yeWuYuan.personnel_shortCode);
			$("#salesman_id").attr("value",json.listRY.yeWuYuan.personnel_id);
			$("#salesman_city_code").attr("value",json.listRY.yeWuYuan.personnel_regionnumber);	
			$("#salesman_dept_id").attr("value",json.listRY.yeWuYuan.personnel_deptId);
			$("#bel_salesman_id_id").attr("value", json.listRY.yeWuYuan.personnel_id);
			$("#bel_salesman_dept_id").attr("value", json.listRY.yeWuYuan.personnel_deptId);
   		}
   		if(json.listRY.buMenJingLi==null){
			$("#department_manager_name").attr("value","无");
		}else{
			if(json.listRY.buMenJingLi.personnel_name == null && json.listRY.buMenJingLi.personnel_shortcode==null){
				$("#department_manager_name").attr("value","无");
			}else{
				$("#department_manager_name").attr("value",json.listRY.buMenJingLi.personnel_name + "/" + json.listRY.buMenJingLi.personnel_shortcode);
			}
			$("#department_manager_id").attr("value", json.listRY.buMenJingLi.personnel_id);
			$("#department_manager_city_code").attr("value", json.listRY.buMenJingLi.personnel_regionnumber);
			$("#department_manager_dept_id").attr("value", json.listRY.buMenJingLi.personnel_deptid);
			$("#bel_department_manager_id").attr("value",json.listRY.buMenJingLi.personnel_id);
			$("#bel_department_manager_dept_id").attr("value", json.listRY.buMenJingLi.personnel_deptid);
		}
   		if(json.listRY.zhongFenZong==null){
			$("#center_manager_name").attr("value","无");
		}else{
			if(json.listRY.zhongFenZong.personnel_name == null && json.listRY.zhongFenZong.personnel_shortcode==null){
				$("#center_manager_name").attr("value","无");
			}else{
				$("#center_manager_name").attr("value",json.listRY.zhongFenZong.personnel_name + "/" + json.listRY.zhongFenZong.personnel_shortcode);
			}
			$("#center_manager_id").attr("value", json.listRY.zhongFenZong.personnel_id);
			$("#center_manager_dept_id").attr("value",json.listRY.zhongFenZong.personnel_deptid);
			$("#bel_center_manager_id").attr("value",json.listRY.zhongFenZong.personnel_id);
			$("#bel_center_manager_dept_id").attr("value", json.listRY.zhongFenZong.personnel_deptid);
		}
		if(json.listRY.fuZhong==null){
			$("#vice_general_manager_name").attr("value","无");
		}else{
			if(json.listRY.fuZhong.personnel_name == null && json.listRY.fuZhong.personnel_shortcode==null){
				$("#vice_general_manager_name").attr("value","无");
			}else{
				$("#vice_general_manager_name").attr("value",json.listRY.fuZhong.personnel_name + "/" + json.listRY.fuZhong.personnel_shortcode);
			}
			$("#vice_general_manager_id").attr("value", json.listRY.fuZhong.personnel_id);
			$("#vice_general_manager_city_code").attr("value", json.listRY.fuZhong.personnel_regionnumber);
			$("#vice_general_manager_dept_id").attr("value", json.listRY.fuZhong.personnel_deptid);
			$("#bel_vice_general_manager_id").attr("value", json.listRY.fuZhong.personnel_id);
			$("#bel_vice_general_manager_dept_id").attr("value", json.listRY.fuZhong.personnel_deptid);
		}
		if(json.listRY.zong==null){
			$("#general_manager_name").attr("value","无");
		}else{
			$("#general_manager_name").attr("value",json.listRY.zong.personnel_name + "/" + json.listRY.zong.personnel_shortcode);
			$("#general_manager_id").attr("value", json.listRY.zong.personnel_id);
			$("#general_manager_city_code").attr("value", json.listRY.zong.personnel_regionnumber);
			$("#general_manager_dept_id").attr("value", json.listRY.zong.personnel_deptid);
			$("#bel_general_manager_id").attr("value", json.listRY.zong.personnel_id);
			$("#bel_general_manager_dept_id").attr("value", json.listRY.zong.personnel_deptid);
		}
   	}
   	//初始化证件类型
   	function setCertificate_type_name(val){
   		if(val){
			$.getJSON(globalUtil.getTimestampUrl('/sysmanage/getDictDataByCode.do?wms_sys_dict_id=90&value_code='+val),
					{},
					function(data) {
						if(data){
							$("#certificate_type_name").text(data.certificate_type_name);	
						}
					});
   		}
   	}
   	//当CRM数据查询不到时禁用控件 不允许手动填写提交
   	function inputreadonly(){
   		$('input[name=cus_name]').attr('readonly','readonly');
   		$('input[name=cus_gender]').attr('disabled','disabled');
		$("#post_code").attr('readonly','readonly');
		//$('#mobile_phone').attr('readonly','readonly');
		$("#address_phone").attr('readonly','readonly');
		$("#cus_address").attr('readonly','readonly');
		$("#work_phone").attr('readonly','readonly');
		$("input[name=contact_address]").attr('readonly','readonly');
		$("input[name=cus_fax]").attr('readonly','readonly');
		$("input[name=customer_email]").attr('readonly','readonly');
		$("#saveT_btn").attr('readonly','readonly');
		$("#mobile_phone").attr('readonly','readonly');
		$("#id_card").attr('readonly','readonly');
		$("#searchProduct").attr('readonly','readonly');
		$("#searchPlatform").attr('readonly','readonly');
   	}
   	//当CRM数据查询出来时解除禁用
   	function noreadonly(){
   		$('input[name=cus_name]').removeAttr('readonly');
		$('input[name=cus_gender]').removeAttr('disabled');
		$("#post_code").removeAttr('readonly');
		$('#mobile_phone').removeAttr('readonly');
		$("#address_phone").removeAttr('readonly');
		$("#cus_address").removeAttr('readonly');
		$("#work_phone").removeAttr('readonly');
		$("input[name=contact_address]").removeAttr('readonly');
		$("input[name=cus_fax]").removeAttr('readonly');
		$("input[name=customer_email]").removeAttr('readonly');
		$("#saveT_btn").removeAttr('readonly');
		$("#mobile_phone").removeAttr('readonly');
		$("#id_card").removeAttr('readonly');
		$("#searchProduct").removeAttr('readonly');
		$("#searchPlatform").removeAttr('readonly');
   	}
    //通过页面提供的联系电话和身份证号录入，向CRM获取客户信息，并返回相对应的信息
    function searchInfo(){
    	var phone = $('#mobile_phone_search').val().trim();
    	var card = $('#id_card_search').val().trim();
    	var customerInfo={};
    	if(phone != "" && card == ""){
    		customerInfo.contact_number = phone;
//     		$("#id_card_search").attr("disabled","disabled");
    	}
    	else if(phone == "" && card != ""){
    		customerInfo.id_card_number = card;
//     		$("#mobile_phone_search").attr("disabled","disabled");
    	}
    	if(($('#mobile_phone_search').val()==''||$('#mobile_phone_search').val()==null)&&($('#id_card_search').val()==''||$('#id_card_search').val()==null)){
    		globalUtil.warnMsg(globalErrorMsg['100121']);//提示:客户身份证号或联系电话必须选择一项查询!
    		$("#mobile_phone").removeAttr("disabled");
    		$("#id_card").removeAttr("disabled");
    		//clear();
    		return ;
    	}
    	$.getJSON(globalUtil.getTimestampUrl('/sysmanage/getcrmcustomerinfoinfobypk.do'),customerInfo,function(json){
    		if(json!=null&&json.length!=0&&json!=''){
    			for(var i =0;i<json.length;i++){
	    			if(json[i].costomer_id==null||json[i].costomer_id==''){//说明此客户信息不存在
	     			 	  globalUtil.warnMsg(globalErrorMsg['100119']); //提示：CRM系统中此客户信息不存在!
	     			 	  //clear();
	     			 	  inputreadonly();
	     			}else{
	     				cos = json;
	     				var url = globalUtil.getHtml("chooseCrmInfo.html?contact_number="+customerInfo.contact_number+"&id_card="+customerInfo.id_card_number);
	     				dialog=$.ligerDialog.open({
	            			url:url,
	            			title: 'CRM客户选择',
	            			width: 800,
	            	        height: globalUtil.setDialogHeight(500),
	    	 		        onHiddenOrClose: function(){
	    	 		        	
	    	 		    	},
	     		        	isResize: false
	            		});
	            		$("#mobile_phone").removeAttr("disabled");
	            		$("#id_card").removeAttr("disabled");
	            		return ;
	     			}
    			}
    		}else{
    			 globalUtil.warnMsg(globalErrorMsg['100119']); //提示：CRM系统中此客户信息不存在!
    			 inputreadonly();
    			 $("#mobile_phone").removeAttr("disabled");
    	    	 $("#id_card").removeAttr("disabled");
    			 //clear();
    		}
    	});
    }
    //清空事件
    function clearInfo(){
    	$("#mobile_phone_search").removeAttr("disabled");
   	 	$("#id_card_search").removeAttr("disabled");
    	$("#mobile_phone_search").val("");
    	$("#id_card_search").val("");
    }
    function deleteChang(val){
    	var phone = $("#mobile_phone_search").val().trim();
    	var card = $("#id_card_search").val().trim();
    	if(val == 0){
    		if(phone != null && phone != ''){
    			$("#id_card_search").attr("disabled","disabled");
    		}else{
    			$("#id_card_search").removeAttr("disabled");
    		}
    	}
    	else if(val == 1){
    		if(card != null && card != ''){
    			$("#mobile_phone_search").attr("disabled","disabled");
    		}else{
    			$("#mobile_phone_search").removeAttr("disabled");
    		}
    	}
    }
    //获取选择页面带过来的数据信息
    function sumbit(cus){
    	noreadonly();
        setVals(cus);                                 
    }
    /*
     * 指定对象下的所有input、textarea值(除下拉框，下拉框需要单独赋值)
     */
    var setFormVal = function(divid,param){
    	if(param == null || param == ''){
    		return;
    	}
    	var inputlist = $("#"+divid+" input[type=text]");
    	var textarealist = $("#"+divid+" textarea");
    	$.each(inputlist,function(i,obj){
    		var id = obj.id;
    		var name = obj.name;
    		var ligeruiid = obj.attributes.ligeruiid;
    		var val = name ? param[name] : param[id];
    		if(!ligeruiid && val != undefined){//判断param中是否包含文本域所定义的id或name的属性
    			$(obj).val(val);
    		}
    	});
    	$.each(textarealist,function(i,obj){
    		var id = obj.id;
    		var name = obj.name;
    		if(name){
    			$(obj).val(param[name]);
	  		}else{
	  			$(obj).val(param[id]);
	  		}
    	});
    }
    
    /*
     * 债权信息
     */
    function initZqxxGrid()
    {
        
    	var columns = [ {
			display : '债权基本信息',
			columns : [ {
				display : '原始借款人',
				name : 'cre_per_name',
				minWidth : 60,
				width : 130
			}, {
				display : '借款人身份证号码',
				name : 'cre_per_card_id',
				minWidth : 60,
				width : 150
			}, {
				display : '原始债权人',
				name : 'rele_per_name',
				minWidth : 60,
				width : 130
			}, {
				display : '本次转让额度(元)',
				name : 'acl_mon',
				minWidth : 60,
				width : 130
			}, {
				display : '债权转让日期',
				name : 'acl_date',
				minWidth : 60,
				width : 130
			} ]
		}, {
			display : '理想回收情况下的债权收益信息',
			columns : [ {
				display : '起始还款日期',
				name : 'crepg_start_date',
				align : 'left',
				width : 130
			}, {
				display : '终止还款日期',
				name : 'crepg_end_date',
				width : 130,
				align : 'left'
			}, {
				display : '预计债权收益率(年)',
				name : 'product_interest',
				width : 130,
				render: function(rowData, rowIndex, value)
				{
					return rowData.product_interest+"%";
				},
				totalSummary: {
                    type: "sum",
                    render: function(suminf,column,obj) {
                        var total = 0;
                        $.each(obj.Rows, function(i, v) {
                        	total = globalUtil.accAdd(total, v.acl_mon);
                        });
                        return "额度合计："+total;
                    }
                }
			} ]
		} ];
		
		        var zqxx_grid  = $("#zqxx_grid_data").ligerGrid({
		    		columns: columns,
		    		url: global_param.context_name + '/inve/getAllTransaCrepkg.do?transaId='+wms_inve_transa_id+"&protocolId="+wms_inve_clerk_protocol_id,
		    		rownumbers: true,
		    		allowUnSelectRow: true,
		    		usePager: false,
		    		width: '100%',
		    		height: '50%',
		    		heightDiff: -4,
		    		rowAttrRender: function(rowdata, rowindex) {
						
		    		}
		        });
    }
</script>
</body>
</html>