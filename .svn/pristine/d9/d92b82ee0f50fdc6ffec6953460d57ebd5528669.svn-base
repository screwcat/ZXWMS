<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- namespace必须指向Dao接口 -->
<mapper namespace="com.zx.emanage.loanpost.persist.WmsPostDunningHeadDao">
	<!-- get entity by pk -->
	<select id="get" parameterType="int" resultType="WmsPostDunningHead">
		select
        				wms_post_dunning_head_id,
        				wms_fina_cre_pay_id,
        				wms_cre_appro_borrow_protocol_id,
        				wms_cre_credit_head_id,
        				dunning_name,
        				dunning_tel,
        				cre_loan_type,
        				protocol_code,
						date_format(protocol_creat_date,'%Y-%m-%d') as protocol_creat_date_str,
        				protocol_creat_date,
        				protocol_amount,
						date_format(default_date,'%Y-%m-%d') as default_date_str,
        				default_date,
        				repay_period,
        				deadline,
        				un_matching_creditor,
        				liquidated_damages,
        				overdue_day,
        				default_amount,
        				salesman_name,
        				salesman_id,
        				team_manager_id,
        				team_manager_name,
        				refund_bank,
        				refund_number,
        				mortgrage,
        				return_amount,
        				return_ratio,
        				return_ommission,
        				dunning_remark,
        				create_dunning_id,
        				create_dunning_name,
        				create_dunning_deptid,
						date_format(create_dunning_datetime,'%Y-%m-%d %H:%i:%s') as create_dunning_datetime_str,
        				create_dunning_datetime,
        				create_dunning_result,
        				final_dunning_id,
        				final_dunning_name,
        				final_dunning_deptid,
						date_format(final_dunning_datetime,'%Y-%m-%d %H:%i:%s') as final_dunning_datetime_str,
        				final_dunning_datetime,
        				final_dunning_result,
        				home_dunning_status,
        				internal_dunning_result,
        				internal_dunning_advice,
        				outside_dunning_result,
        				outside_dunning_advice,
        				legalappeal_dunning_result,
        				legalappeal_dunning_advice,
        				dunning_status,
        				loansupervisor_id,
        				loansupervisor_name,
        				loansupervisor_deptid,
						date_format(loansupervisor_datetime,'%Y-%m-%d %H:%i:%s') as loansupervisor_datetime_str,
        				loansupervisor_datetime,
        				loansupervisor_result,
        				loansupervisor_advice,
        				enable_flag,
        				(select cre_type from wms_cre_credit_head where wms_cre_credit_head_id=d.wms_cre_credit_head_id) as cre_type,
        				un_pay_principal,
        				un_pay_interest,
        				un_total_pay_late_fee,
        				expect_payment_amount,
        				post_dunning_cj_code
        	from
        		wms_post_dunning_head  d
        	where
        				wms_post_dunning_head_id = #{wms_post_dunning_head_id}
	</select>

	<!-- count num -->
	<select id="findCount" parameterType="map" resultType="int">
		select count(wms_post_dunning_head_id) as count
		from wms_post_dunning_head
		<where>
			<if test="paramname != null">
				<!-- and columnName = #{columnName} -->
			</if>
		</where>
	</select>

	<!-- list -->
	<select id="search" parameterType="map" resultType="java.util.HashMap">
		select 
				wms_post_dunning_head_id,
				wms_fina_cre_pay_id,
				wms_cre_appro_borrow_protocol_id,
				wms_cre_credit_head_id,
				dunning_name,
				dunning_tel,
				cre_loan_type,
				protocol_code,
				date_format(protocol_creat_date,'%Y-%m-%d') as protocol_creat_date_str,
				protocol_creat_date,
				protocol_amount,
				date_format(default_date,'%Y-%m-%d') as default_date_str,
				default_date,
				repay_period,
				deadline,
				un_matching_creditor,
				liquidated_damages,
				overdue_day,
				default_amount,
				salesman_name,
				salesman_id,
				team_manager_id,
				team_manager_name,
				refund_bank,
				refund_number,
				mortgrage,
				return_amount,
				return_ratio,
				return_ommission,
				dunning_remark,
				create_dunning_id,
				create_dunning_name,
				create_dunning_deptid,
				date_format(create_dunning_datetime,'%Y-%m-%d %H:%i:%s') as create_dunning_datetime_str,
				create_dunning_datetime,
				create_dunning_result,
				final_dunning_id,
				final_dunning_name,
				final_dunning_deptid,
				date_format(final_dunning_datetime,'%Y-%m-%d %H:%i:%s') as final_dunning_datetime_str,
				final_dunning_datetime,
				final_dunning_result,
				home_dunning_status,
				internal_dunning_result,
				internal_dunning_advice,
				outside_dunning_result,
				outside_dunning_advice,
				legalappeal_dunning_result,
				legalappeal_dunning_advice,
				dunning_status,
				loansupervisor_id,
				loansupervisor_name,
				loansupervisor_deptid,
				date_format(loansupervisor_datetime,'%Y-%m-%d %H:%i:%s') as loansupervisor_datetime_str,
				loansupervisor_datetime,
				loansupervisor_result,
				loansupervisor_advice,
				enable_flag,
				un_pay_principal,
				un_pay_interest,
				un_total_pay_late_fee,
				expect_payment_amount,
				post_dunning_cj_code
		from wms_post_dunning_head
		<where>
			<if test="paramname != null">
				<!-- and columnName = #{columnName} -->
			</if>
		</where>
		<if test="sortname != '' and sortorder !=''">
			ORDER BY ${sortname} ${sortorder}
		</if>
		<if test="offset != null and pagesize !=null">
			LIMIT ${offset} , ${pagesize}
		</if>
	</select>

	<!-- save -->
	<insert id="save" parameterType="WmsPostDunningHead" useGeneratedKeys="true" keyProperty="wms_post_dunning_head_id">
		INSERT INTO wms_post_dunning_head
		(
				wms_post_dunning_head_id,

				wms_fina_cre_pay_id,

				wms_cre_appro_borrow_protocol_id,

				wms_cre_credit_head_id,

				dunning_name,

				dunning_tel,

				cre_loan_type,

				protocol_code,

				protocol_creat_date,

				protocol_amount,

				default_date,

				repay_period,

				deadline,

				un_matching_creditor,

				liquidated_damages,

				overdue_day,

				default_amount,

				salesman_name,

				salesman_id,

				team_manager_id,

				team_manager_name,

				refund_bank,

				refund_number,

				mortgrage,

				return_amount,

				return_ratio,

				return_ommission,

				dunning_remark,
				
				create_dunning_id,

				create_dunning_name,

				create_dunning_deptid,

				create_dunning_datetime,

				create_dunning_result,

				final_dunning_id,

				final_dunning_name,

				final_dunning_deptid,

				final_dunning_datetime,

				final_dunning_result,

				home_dunning_status,

				internal_dunning_result,

				internal_dunning_advice,

				outside_dunning_result,

				outside_dunning_advice,

				legalappeal_dunning_result,

				legalappeal_dunning_advice,

				dunning_status,

				loansupervisor_id,

				loansupervisor_name,

				loansupervisor_deptid,

				loansupervisor_datetime,

				loansupervisor_result,

				loansupervisor_advice,

				enable_flag,
				
				un_pay_principal,

				un_pay_interest,

				un_total_pay_late_fee,
				
				expect_payment_amount,
				
				visit_dunning_id,
				
				visit_dunning_name,
				
				post_dunning_create_datetime,
				
				post_dunning_update_datetime,
				
				post_dunning_cj_code,
				
				post_dunning_commissioner_time,
				
				post_dunning_supervisor_time
		)
		VALUES
		(
				#{wms_post_dunning_head_id},
				#{wms_fina_cre_pay_id},
				#{wms_cre_appro_borrow_protocol_id},
				#{wms_cre_credit_head_id},
				#{dunning_name},
				#{dunning_tel},
				#{cre_loan_type},
				#{protocol_code},
				#{protocol_creat_date},
				#{protocol_amount},
				#{default_date},
				#{repay_period},
				#{deadline},
				#{un_matching_creditor},
				#{liquidated_damages},
				#{overdue_day},
				#{default_amount},
				#{salesman_name},
				#{salesman_id},
				#{team_manager_id},
				#{team_manager_name},
				#{refund_bank},
				#{refund_number},
				#{mortgrage},
				#{return_amount},
				#{return_ratio},
				#{return_ommission},
				#{dunning_remark},
				#{create_dunning_id},
				#{create_dunning_name},
				#{create_dunning_deptid},
				#{create_dunning_datetime},
				#{create_dunning_result},
				#{final_dunning_id},
				#{final_dunning_name},
				#{final_dunning_deptid},
				#{final_dunning_datetime},
				#{final_dunning_result},
				#{home_dunning_status},
				#{internal_dunning_result},
				#{internal_dunning_advice},
				#{outside_dunning_result},
				#{outside_dunning_advice},
				#{legalappeal_dunning_result},
				#{legalappeal_dunning_advice},
				#{dunning_status},
				#{loansupervisor_id},
				#{loansupervisor_name},
				#{loansupervisor_deptid},
				#{loansupervisor_datetime},
				#{loansupervisor_result},
				#{loansupervisor_advice},
				#{enable_flag},
				#{un_pay_principal},
				#{un_pay_interest},
				#{un_total_pay_late_fee},
				#{expect_payment_amount},
				#{visit_dunning_id},
				#{visit_dunning_name},
				#{post_dunning_create_datetime},
				#{post_dunning_update_datetime},
				#{post_dunning_cj_code},
				#{post_dunning_commissioner_time},
				#{post_dunning_supervisor_time}
		);
	</insert>

	<!-- 更新用户 -->
	<update id="update" parameterType="WmsPostDunningHead">
		update wms_post_dunning_head
		<set>
					<if test="wms_post_dunning_head_id != null">
						 wms_post_dunning_head_id = #{wms_post_dunning_head_id},
					</if>
					<if test="wms_fina_cre_pay_id != null">
						 wms_fina_cre_pay_id = #{wms_fina_cre_pay_id},
					</if>
					<if test="wms_cre_appro_borrow_protocol_id != null">
						 wms_cre_appro_borrow_protocol_id = #{wms_cre_appro_borrow_protocol_id},
					</if>
					<if test="wms_cre_credit_head_id != null">
						 wms_cre_credit_head_id = #{wms_cre_credit_head_id},
					</if>
					<if test="dunning_name != null">
						 dunning_name = #{dunning_name},
					</if>
					<if test="dunning_tel != null">
						 dunning_tel = #{dunning_tel},
					</if>
					<if test="cre_loan_type != null">
						 cre_loan_type = #{cre_loan_type},
					</if>
					<if test="protocol_code != null">
						 protocol_code = #{protocol_code},
					</if>
					<if test="dunning_remark != null">
						 dunning_remark = #{dunning_remark},
					</if>
					<if test="protocol_creat_date != null">
						 protocol_creat_date = #{protocol_creat_date},
					</if>
					<if test="protocol_amount != null">
						 protocol_amount = #{protocol_amount},
					</if>
					<if test="default_date != null">
						 default_date = #{default_date},
					</if>
					<if test="repay_period != null">
						 repay_period = #{repay_period},
					</if>
					<if test="deadline != null">
						 deadline = #{deadline},
					</if>
					<if test="un_matching_creditor != null">
						 un_matching_creditor = #{un_matching_creditor},
					</if>
					<if test="liquidated_damages != null">
						 liquidated_damages = #{liquidated_damages},
					</if>
					<if test="overdue_day != null">
						 overdue_day = #{overdue_day},
					</if>
					<if test="default_amount != null">
						 default_amount = #{default_amount},
					</if>
					<if test="salesman_name != null">
						 salesman_name = #{salesman_name},
					</if>
					<if test="salesman_id != null">
						 salesman_id = #{salesman_id},
					</if>
					<if test="team_manager_id != null">
						 team_manager_id = #{team_manager_id},
					</if>
					<if test="team_manager_name != null">
						 team_manager_name = #{team_manager_name},
					</if>
					<if test="refund_bank != null">
						 refund_bank = #{refund_bank},
					</if>
					<if test="refund_number != null">
						 refund_number = #{refund_number},
					</if>
					<if test="mortgrage != null">
						 mortgrage = #{mortgrage},
					</if>
					<if test="return_amount != null">
						 return_amount = #{return_amount},
					</if>
					<if test="return_ratio != null">
						 return_ratio = #{return_ratio},
					</if>
					<if test="return_ommission != null">
						 return_ommission = #{return_ommission},
					</if>
					<if test="create_dunning_id != null">
						 create_dunning_id = #{create_dunning_id},
					</if>
					<if test="create_dunning_name != null">
						 create_dunning_name = #{create_dunning_name},
					</if>
					<if test="create_dunning_deptid != null">
						 create_dunning_deptid = #{create_dunning_deptid},
					</if>
					<if test="create_dunning_datetime != null">
						 create_dunning_datetime = #{create_dunning_datetime},
					</if>
					<if test="create_dunning_result != null">
						 create_dunning_result = #{create_dunning_result},
					</if>
					<if test="final_dunning_id != null">
						 final_dunning_id = #{final_dunning_id},
					</if>
					<if test="final_dunning_name != null">
						 final_dunning_name = #{final_dunning_name},
					</if>
					<if test="final_dunning_deptid != null">
						 final_dunning_deptid = #{final_dunning_deptid},
					</if>
					<if test="final_dunning_datetime != null">
						 final_dunning_datetime = #{final_dunning_datetime},
					</if>
					<if test="final_dunning_result != null">
						 final_dunning_result = #{final_dunning_result},
					</if>
					<if test="home_dunning_status != null">
						 home_dunning_status = #{home_dunning_status},
					</if>
					<if test="internal_dunning_result != null">
						 internal_dunning_result = #{internal_dunning_result},
					</if>
					<if test="internal_dunning_advice != null">
						 internal_dunning_advice = #{internal_dunning_advice},
					</if>
					<if test="outside_dunning_result != null">
						 outside_dunning_result = #{outside_dunning_result},
					</if>
					<if test="outside_dunning_advice != null">
						 outside_dunning_advice = #{outside_dunning_advice},
					</if>
					<if test="legalappeal_dunning_result != null">
						 legalappeal_dunning_result = #{legalappeal_dunning_result},
					</if>
					<if test="legalappeal_dunning_advice != null">
						 legalappeal_dunning_advice = #{legalappeal_dunning_advice},
					</if>
					<if test="dunning_status != null">
						 dunning_status = #{dunning_status},
					</if>
					<if test="loansupervisor_id != null">
						 loansupervisor_id = #{loansupervisor_id},
					</if>
					<if test="loansupervisor_name != null">
						 loansupervisor_name = #{loansupervisor_name},
					</if>
					<if test="loansupervisor_deptid != null">
						 loansupervisor_deptid = #{loansupervisor_deptid},
					</if>
					<if test="loansupervisor_datetime != null">
						 loansupervisor_datetime = #{loansupervisor_datetime},
					</if>
					<if test="loansupervisor_result != null">
						 loansupervisor_result = #{loansupervisor_result},
					</if>
					<if test="loansupervisor_advice != null">
						 loansupervisor_advice = #{loansupervisor_advice},
					</if>
					<if test="enable_flag != null">
						 enable_flag = #{enable_flag},
					</if>
					<if test="un_pay_principal != null">
						 un_pay_principal = #{un_pay_principal},
					</if>
					<if test="un_pay_interest != null">
						 un_pay_interest = #{un_pay_interest},
					</if>
					<if test="un_total_pay_late_fee != null">
						 un_total_pay_late_fee = #{un_total_pay_late_fee},
					</if>
					<if test="expect_payment_amount != null">
						 expect_payment_amount = #{expect_payment_amount},
					</if>
					<if test="reject_status != null">
						 reject_status = #{reject_status},
					</if>
					<if test="reject_advice != null">
						 reject_advice = #{reject_advice},
					</if>
					<if test="reject_id != null">
						 reject_id = #{reject_id},
					</if>
					<if test="reject_name != null">
						 reject_name = #{reject_name},
					</if>
					<if test="reject_datetime != null">
						 reject_datetime = #{reject_datetime},
					</if>
					<if test="visit_dunning_id != null">
						 visit_dunning_id = #{visit_dunning_id},
					</if>
					<if test="visit_dunning_name != null">
						 visit_dunning_name = #{visit_dunning_name},
					</if>	
					<if test="post_dunning_create_datetime != null">
						 post_dunning_create_datetime = #{post_dunning_create_datetime},
					</if>	
					<if test="post_dunning_update_datetime != null">
						 post_dunning_update_datetime = #{post_dunning_update_datetime},
					</if>	
					<if test="post_dunning_commissioner_time != null">
						 post_dunning_commissioner_time = #{post_dunning_commissioner_time},
					</if>	
					<if test="post_dunning_supervisor_time != null">
						 post_dunning_supervisor_time = #{post_dunning_supervisor_time},
					</if>	
					
	   </set>
		 where 
    				wms_post_dunning_head_id = #{wms_post_dunning_head_id}
	</update>
	<select id="getListByEntity" parameterType="WmsPostDunningHead" resultType="WmsPostDunningHead">
		select 
				wms_post_dunning_head_id,
				wms_fina_cre_pay_id,
				wms_cre_appro_borrow_protocol_id,
				wms_cre_credit_head_id,
				dunning_name,
				dunning_tel,
				cre_loan_type,
				protocol_code,
				date_format(protocol_creat_date,'%Y-%m-%d') as protocol_creat_date_str,
				protocol_creat_date,
				protocol_amount,
				date_format(default_date,'%Y-%m-%d') as default_date_str,
				default_date,
				repay_period,
				deadline,
				un_matching_creditor,
				liquidated_damages,
				overdue_day,
				default_amount,
				salesman_name,
				salesman_id,
				team_manager_id,
				team_manager_name,
				refund_bank,
				refund_number,
				mortgrage,
				return_amount,
				return_ratio,
				return_ommission,
				dunning_remark,
				create_dunning_id,
				create_dunning_name,
				create_dunning_deptid,
				date_format(create_dunning_datetime,'%Y-%m-%d %H:%i:%s') as create_dunning_datetime_str,
				create_dunning_datetime,
				create_dunning_result,
				final_dunning_id,
				final_dunning_name,
				final_dunning_deptid,
				date_format(final_dunning_datetime,'%Y-%m-%d %H:%i:%s') as final_dunning_datetime_str,
				final_dunning_datetime,
				final_dunning_result,
				home_dunning_status,
				internal_dunning_result,
				internal_dunning_advice,
				outside_dunning_result,
				outside_dunning_advice,
				legalappeal_dunning_result,
				legalappeal_dunning_advice,
				dunning_status,
				loansupervisor_id,
				loansupervisor_name,
				loansupervisor_deptid,
				date_format(loansupervisor_datetime,'%Y-%m-%d %H:%i:%s') as loansupervisor_datetime_str,
				loansupervisor_datetime,
				loansupervisor_result,
				loansupervisor_advice,
				enable_flag,
				un_pay_principal,
				un_pay_interest,
				un_total_pay_late_fee,
				expect_payment_amount,
			    visit_dunning_id,
			    visit_dunning_name 

		from
		wms_post_dunning_head
		<where>
					reject_status is null
					<if test="wms_post_dunning_head_id != null">
						and wms_post_dunning_head_id = #{wms_post_dunning_head_id}
					</if>
					<if test="wms_fina_cre_pay_id != null">
						and wms_fina_cre_pay_id = #{wms_fina_cre_pay_id}
					</if>
					<if test="wms_cre_appro_borrow_protocol_id != null">
						and wms_cre_appro_borrow_protocol_id = #{wms_cre_appro_borrow_protocol_id}
					</if>
					<if test="wms_cre_credit_head_id != null">
						and wms_cre_credit_head_id = #{wms_cre_credit_head_id}
					</if>
					<if test="dunning_name != null">
						and dunning_name = #{dunning_name}
					</if>
					<if test="dunning_tel != null">
						and dunning_tel = #{dunning_tel}
					</if>
					<if test="cre_loan_type != null">
						and cre_loan_type = #{cre_loan_type}
					</if>
					<if test="protocol_code != null">
						and protocol_code = #{protocol_code}
					</if>
					<if test="protocol_creat_date != null">
						and protocol_creat_date = #{protocol_creat_date}
					</if>
					<if test="protocol_amount != null">
						and protocol_amount = #{protocol_amount}
					</if>
					<if test="default_date != null">
						and default_date = #{default_date}
					</if>
					<if test="repay_period != null">
						and repay_period = #{repay_period}
					</if>
					<if test="deadline != null">
						and deadline = #{deadline}
					</if>
					<if test="un_matching_creditor != null">
						and un_matching_creditor = #{un_matching_creditor}
					</if>
					<if test="liquidated_damages != null">
						and liquidated_damages = #{liquidated_damages}
					</if>
					<if test="overdue_day != null">
						and overdue_day = #{overdue_day}
					</if>
					<if test="default_amount != null">
						and default_amount = #{default_amount}
					</if>
					<if test="salesman_name != null">
						and salesman_name = #{salesman_name}
					</if>
					<if test="salesman_id != null">
						and salesman_id = #{salesman_id}
					</if>
					<if test="team_manager_id != null">
						and team_manager_id = #{team_manager_id}
					</if>
					<if test="team_manager_name != null">
						and team_manager_name = #{team_manager_name}
					</if>
					<if test="refund_bank != null">
						and refund_bank = #{refund_bank}
					</if>
					<if test="refund_number != null">
						and refund_number = #{refund_number}
					</if>
					<if test="mortgrage != null">
						and mortgrage = #{mortgrage}
					</if>
					<if test="return_amount != null">
						and return_amount = #{return_amount}
					</if>
					<if test="return_ratio != null">
						and return_ratio = #{return_ratio}
					</if>
					<if test="return_ommission != null">
						and return_ommission = #{return_ommission}
					</if>
					<if test="dunning_remark != null">
						and dunning_remark = #{dunning_remark}
					</if>
					<if test="create_dunning_id != null">
						and create_dunning_id = #{create_dunning_id}
					</if>
					<if test="create_dunning_name != null">
						and create_dunning_name = #{create_dunning_name}
					</if>
					<if test="create_dunning_deptid != null">
						and create_dunning_deptid = #{create_dunning_deptid}
					</if>
					<if test="create_dunning_datetime != null">
						and create_dunning_datetime = #{create_dunning_datetime}
					</if>
					<if test="create_dunning_result != null">
						and create_dunning_result = #{create_dunning_result}
					</if>
					<if test="final_dunning_id != null">
						and final_dunning_id = #{final_dunning_id}
					</if>
					<if test="final_dunning_name != null">
						and final_dunning_name = #{final_dunning_name}
					</if>
					<if test="final_dunning_deptid != null">
						and final_dunning_deptid = #{final_dunning_deptid}
					</if>
					<if test="final_dunning_datetime != null">
						and final_dunning_datetime = #{final_dunning_datetime}
					</if>
					<if test="final_dunning_result != null">
						and final_dunning_result = #{final_dunning_result}
					</if>
					<if test="home_dunning_status != null">
						and home_dunning_status = #{home_dunning_status}
					</if>
					<if test="internal_dunning_result != null">
						and internal_dunning_result = #{internal_dunning_result}
					</if>
					<if test="internal_dunning_advice != null">
						and internal_dunning_advice = #{internal_dunning_advice}
					</if>
					<if test="outside_dunning_result != null">
						and outside_dunning_result = #{outside_dunning_result}
					</if>
					<if test="outside_dunning_advice != null">
						and outside_dunning_advice = #{outside_dunning_advice}
					</if>
					<if test="legalappeal_dunning_result != null">
						and legalappeal_dunning_result = #{legalappeal_dunning_result}
					</if>
					<if test="legalappeal_dunning_advice != null">
						and legalappeal_dunning_advice = #{legalappeal_dunning_advice}
					</if>
					<if test="dunning_status != null">
						and dunning_status = #{dunning_status}
					</if>
					<if test="loansupervisor_id != null">
						and loansupervisor_id = #{loansupervisor_id}
					</if>
					<if test="loansupervisor_name != null">
						and loansupervisor_name = #{loansupervisor_name}
					</if>
					<if test="loansupervisor_deptid != null">
						and loansupervisor_deptid = #{loansupervisor_deptid}
					</if>
					<if test="loansupervisor_datetime != null">
						and loansupervisor_datetime = #{loansupervisor_datetime}
					</if>
					<if test="loansupervisor_result != null">
						and loansupervisor_result = #{loansupervisor_result}
					</if>
					<if test="loansupervisor_advice != null">
						and loansupervisor_advice = #{loansupervisor_advice}
					</if>
					<if test="enable_flag != null">
						and enable_flag = #{enable_flag}
					</if>
					<if test="un_pay_principal != null">
						and un_pay_principal = #{un_pay_principal}
					</if>
					<if test="un_pay_interest != null">
						and un_pay_interest = #{un_pay_interest}
					</if>
					<if test="un_total_pay_late_fee != null">
						and un_total_pay_late_fee = #{un_total_pay_late_fee}
					</if>
					<if test="expect_payment_amount != null">
						and expect_payment_amount = #{expect_payment_amount}
					</if>
				 	<if test="isExcludePKFlag != null and isExcludePKFlag == true">
		        		and wms_post_dunning_head_id != #{wms_post_dunning_head_id}
					</if>
					<if test="reject_datetime != null">
						 visit_dunning_id = #{visit_dunning_id},
					</if>
					<if test="reject_datetime != null">
						 visit_dunning_name = #{visit_dunning_name}
					</if>
		</where>
	</select>
	<!-- 获取催缴情况审核列表页面显示 -->
	<select id="searchforDunningReview" parameterType="map" resultType="java.util.HashMap">
	  	select
	  	d.wms_post_dunning_head_id,
	  	d.wms_cre_credit_head_id,
	  	d.wms_fina_cre_pay_id,
	  	d.wms_cre_appro_borrow_protocol_id,
	  	d.wms_cre_credit_head_id,
	  	r.cre_type,
		(select bill_code from wms_cre_credit_head where wms_cre_credit_head_id=r.wms_cre_credit_head_id) as bill_code,
		(select value_meaning from wms_sys_dict_data where value_code=r.cre_type and wms_sys_dict_id=15) as cre_type_name,
		(select value_meaning from wms_sys_dict_data where wms_sys_dict_data_id=(select cre_loan_type from wms_cre_credit_head where wms_cre_credit_head_id=r.wms_cre_credit_head_id)) as cre_loan_type_name,
		CONCAT(
    	(select value_meaning from wms_sys_dict_data where value_code=r.cre_type and wms_sys_dict_id=15),
    	'/',
    	(select value_meaning from wms_sys_dict_data where wms_sys_dict_data_id=(select cre_loan_type from wms_cre_credit_head where wms_cre_credit_head_id=r.wms_cre_credit_head_id))
    	) as type_cre_loan, 
		d.dunning_name,
		d.dunning_tel,
		d.protocol_code,
		d.protocol_creat_date,
		d.protocol_amount,
		r.refund_limit_month,
		d.repay_period,
		(r.un_pay_principal+r.un_pay_interest) as matching_creditor, 
		r.cur_overdue_day,
		r.salesman_name,
		p.debtor_name,
		p.debtor_tel,
		d.default_date,
		d.final_dunning_name,
		d.expect_payment_amount,
		(case when ((<include refid="getHomeSubmitSignCount"></include>)>0) then '1' else '0' end) as home_submit_sign,
		(case when ((<include refid="getHomeSubmitSignCount"></include>)>0) then '已上门催缴' else '未上门催缴' end) as home_submit_sign_name
		from wms_fina_cre_repay r,wms_cre_appro_borrow_protocol p,wms_post_dunning_head d
	    <where>
	    	r.enable_flag='1' and d.enable_flag='1'
			and
			r.wms_cre_appro_borrow_protocol_id=p.wms_cre_appro_id 
			and
			r.wms_fina_cre_pay_id=d.wms_fina_cre_pay_id
			and 
			r.migration_status ='0'
			and
			d.dunning_status=2
			<if test="protocol_code != null">
				 and d.protocol_code like #{protocol_code}
			</if>
			<if test="debtor_name !=null">
				and  d.dunning_name like #{debtor_name}
			</if>
			<if test="debtor_tel !=null">
				and  d.dunning_tel like #{debtor_tel}
			</if>
			<if test="salesman_name !=null">
				and  d.salesman_name like #{salesman_name}
			</if>
			<if test="cre_type !=null">
				and  r.cre_type = #{cre_type}
			</if>
			<if test="final_dunning_name !=null">
				and  d.final_dunning_name like #{final_dunning_name}
			</if>
		</where>
		<if test="sortname != '' and sortorder !=''">
			ORDER BY ${sortname} ${sortorder}
		</if>
		<if test="offset != null and pagesize !=null">
			LIMIT ${offset} , ${pagesize}
		</if>
	</select>
	
	<sql id="getHomeSubmitSignCount">
		select count(*) from wms_post_dunning_head where wms_cre_credit_head_id =r.wms_cre_credit_head_id and dunning_status = '5' and home_dunning_status is not null and post_dunning_commissioner_time = 
		(select min(post_dunning_commissioner_time) from wms_post_dunning_head where wms_cre_credit_head_id =r.wms_cre_credit_head_id and dunning_status = '5' and home_dunning_status is not null)
	</sql>
	<!-- 获取催缴情况审核列表页面数据数 -->
	<select id="findCountDunningReview" parameterType="map" resultType="int">
		select count(wms_post_dunning_head_id) as count
		from wms_fina_cre_repay r,wms_cre_appro_borrow_protocol p,wms_post_dunning_head d
		 <where>
	    	r.enable_flag='1' and d.enable_flag='1'
			and
			r.wms_cre_appro_borrow_protocol_id=p.wms_cre_appro_id 
			and
			r.wms_fina_cre_pay_id=d.wms_fina_cre_pay_id
			and 
			r.migration_status ='0'
			and
			d.dunning_status=2
			<if test="protocol_code != null">
				 and d.protocol_code like #{protocol_code}
			</if>
			<if test="debtor_name !=null">
				and  d.dunning_name like #{debtor_name}
			</if>
			<if test="debtor_tel !=null">
				and  d.dunning_tel like #{debtor_tel}
			</if>
			<if test="salesman_name !=null">
				and  d.salesman_name like #{salesman_name}
			</if>
			<if test="cre_type !=null">
				and  r.cre_type = #{cre_type}
			</if>
			<if test="final_dunning_name !=null">
				and  d.final_dunning_name like #{final_dunning_name}
			</if>
		</where>
	</select>
	<!-- 查询催缴人员和催缴单据数量 -->
	<select id="seachInfoCount" parameterType="map" resultType="java.util.HashMap">
		SELECT l.personnel_id,l.personnel_name,l.personnel_deptId,(SELECT count(r.dunning_id)from wms_fina_cre_repay r where r.dunning_id=l.personnel_id) sumval from pm_personnel l where l.personnel_deptId="120" and l.enable_flag="1" ORDER BY l.personnel_id;
	</select>
	<!-- 查询催缴单据的数量-->
	<select id="seachCount" parameterType="map" resultType="int">
		select 
			count(r.wms_fina_cre_pay_id)  
			from wms_fina_cre_repay r,wms_cre_appro_borrow_protocol p
		where 
			r.enable_flag='1'  
			and r.wms_cre_appro_borrow_protocol_id=p.wms_cre_appro_id 
			and r.migration_status ='0' 
				and ((r.dunning_id is NULL  and r.dunning_name is NULL AND r.dunning_deptId IS null and r.dunning_datetime is NULL)OR r.wms_cre_credit_head_id = (SELECT wms_cre_credit_head_id from wms_post_dunning_head h where h.wms_cre_credit_head_id=r.wms_cre_credit_head_id  and h.dunning_status=3))
		<if test="repay_status !=null">
				and r.repay_status =#{repay_status} 
			</if>
			<if test="protocol_code != null">
				and r.protocol_code like #{protocol_code}
			</if>
			<if test="debtor_name != null">
				and p.debtor_name like #{debtor_name}
			</if>
			<if test="debtor_tel != null">
				and p.debtor_tel like #{debtor_tel}
			</if>
			<if test="salesman_name != null">
				and r.salesman_name like #{salesman_name}
			</if>
			<if test="cre_type != null">
				and r.cre_type = #{cre_type}
			</if>
			<if test="dunning_name != null">
				and r.dunning_name like #{dunning_name}
			</if>
	</select>
		<!-- 查询催缴人的信息-->
	<select id="seachInfo" parameterType="int" resultType="java.util.HashMap">
		SELECT personnel_id,personnel_name,personnel_deptId from pm_personnel  where personnel_id= #{personnel_id} 
	</select>
		<!-- 查询催缴单据的信息-->
	<select id="seachInfobyid" parameterType="int" resultType="java.util.HashMap">
		SELECT * from wms_fina_cre_repay  where wms_fina_cre_pay_id = #{wms_fina_cre_pay_id} 
	</select>
	<!--通过催缴单主键，获取催缴单详细信息-->
	<select id="getWmsPostDunningHeadInfoByPK" parameterType="Integer" resultType="java.util.HashMap">
		select
        				wms_post_dunning_head_id,
        				wms_fina_cre_pay_id,
        				wms_cre_appro_borrow_protocol_id,
        				wms_cre_credit_head_id,
        				dunning_name,
        				dunning_tel,
        				cre_loan_type,
        				(select d.value_meaning from wms_sys_dict_data d where d.wms_sys_dict_data_id = cre_loan_type) as cre_loan_type_name,
        				protocol_code,
						date_format(protocol_creat_date,'%Y-%m-%d') as protocol_creat_date_str,
        				protocol_creat_date,
        				protocol_amount,
						date_format(default_date,'%Y-%m-%d') as default_date_str,
        				default_date,
        				repay_period,
        				deadline,
        				un_matching_creditor,
        				liquidated_damages,
        				overdue_day,
        				default_amount,
        				salesman_name,
        				salesman_id,
        				team_manager_id,
        				team_manager_name,
        				refund_bank,
        				refund_number,
        				mortgrage,
        				(select d.value_meaning from wms_sys_dict_data d where d.wms_sys_dict_id = '65' and d.value_code = mortgrage) as mortgrage_name,
        				return_amount,
        				return_ratio,
        				return_ommission,
        				dunning_remark,
        				create_dunning_id,
        				create_dunning_name,
        				create_dunning_deptid,
						date_format(create_dunning_datetime,'%Y-%m-%d %H:%i:%s') as create_dunning_datetime_str,
        				create_dunning_datetime,
        				create_dunning_result,
        				final_dunning_id,
        				final_dunning_name,
        				final_dunning_deptid,
						date_format(final_dunning_datetime,'%Y-%m-%d %H:%i:%s') as final_dunning_datetime_str,
        				final_dunning_datetime,
        				final_dunning_result,
        				home_dunning_status,
        				internal_dunning_result,
        				internal_dunning_advice,
        				outside_dunning_result,
        				outside_dunning_advice,
        				legalappeal_dunning_result,
        				legalappeal_dunning_advice,
        				dunning_status,
        				loansupervisor_id,
        				loansupervisor_name,
        				loansupervisor_deptid,
						date_format(loansupervisor_datetime,'%Y-%m-%d %H:%i:%s') as loansupervisor_datetime_str,
        				loansupervisor_datetime,
        				loansupervisor_result,
        				loansupervisor_advice,
        				enable_flag,
        				(select cre_type from wms_fina_cre_repay where wms_fina_cre_pay_id=d.wms_fina_cre_pay_id) as cre_type,
        				un_pay_principal,
        				un_pay_interest,
        				un_total_pay_late_fee,
        				expect_payment_amount,
        				visit_dunning_id
        	from
        		wms_post_dunning_head d
        	where
        		enable_flag=1
        		and
        		wms_post_dunning_head_id = #{wms_post_dunning_head_id}
	</select>
	<!--实现催缴单审核页面数据导出-->
	<select id="searchforDunningReviewWithout" parameterType="map" resultType="java.util.HashMap">
	select
	  	d.wms_post_dunning_head_id,
	  	d.wms_cre_credit_head_id,
	  	d.wms_fina_cre_pay_id,
	  	d.wms_cre_appro_borrow_protocol_id,
	  	d.wms_cre_credit_head_id,
	  	r.cre_type,
		(select bill_code from wms_cre_credit_head where wms_cre_credit_head_id=r.wms_cre_credit_head_id) as bill_code,
		(select value_meaning from wms_sys_dict_data where value_code=r.cre_type and wms_sys_dict_id=15) as cre_type_name,
		(select value_meaning from wms_sys_dict_data where wms_sys_dict_data_id=(select cre_loan_type from wms_cre_credit_head where wms_cre_credit_head_id=r.wms_cre_credit_head_id)) as cre_loan_type_name,
		CONCAT(
    	(select value_meaning from wms_sys_dict_data where value_code=r.cre_type and wms_sys_dict_id=15),
    	'/',
    	(select value_meaning from wms_sys_dict_data where wms_sys_dict_data_id=(select cre_loan_type from wms_cre_credit_head where wms_cre_credit_head_id=r.wms_cre_credit_head_id))
    	) as type_cre_loan, 
		d.dunning_name,
		d.dunning_tel,
		d.protocol_code,
		d.protocol_creat_date,
		d.protocol_amount,
		r.refund_limit_month,
		d.repay_period,
		(r.un_pay_principal+r.un_pay_interest) as matching_creditor, 
		r.cur_overdue_day,
		r.salesman_name,
		p.debtor_name,
		p.debtor_tel,
		d.default_date,
		d.final_dunning_name,
		(case when ((<include refid="getHomeSubmitSignCount"></include>)>0) then '已上门催缴' else '未上门催缴' end) as home_submit_sign
		from wms_fina_cre_repay r,wms_cre_appro_borrow_protocol p,wms_post_dunning_head d
	    <where>
	    	r.enable_flag='1' and d.enable_flag='1'
			and
			r.wms_cre_appro_borrow_protocol_id=p.wms_cre_appro_id 
			and
			r.wms_fina_cre_pay_id=d.wms_fina_cre_pay_id
			and 
			r.migration_status ='0'
			and
			d.dunning_status=2
			<if test="idList !=null">
				and d.wms_post_dunning_head_id in
				<foreach collection="idList" item="wms_post_dunning_head_id"
					index="index" open="(" separator="," close=")">
					#{wms_post_dunning_head_id}
				</foreach>
			</if>
			<if test="protocol_code != null">
				 and d.protocol_code like #{protocol_code}
			</if>
			<if test="debtor_name !=null">
				and  d.dunning_name like #{debtor_name}
			</if>
			<if test="debtor_tel !=null">
				and  d.dunning_tel like #{debtor_tel}
			</if>
			<if test="salesman_name !=null">
				and  d.salesman_name like #{salesman_name}
			</if>
			<if test="cre_type !=null">
				and  r.cre_type = #{cre_type}
			</if>
			<if test="final_dunning_name !=null">
				and  d.final_dunning_name like #{final_dunning_name}
			</if>
		</where>
		<if test="sortname != '' and sortorder !=''">
			ORDER BY ${sortname} ${sortorder}
		</if>
	</select>
	<!--实现上门催缴页面数据显示-->
	<select id="searchforDunningHome" parameterType="map" resultType="java.util.HashMap">
		select
	  	d.wms_post_dunning_head_id,
	  	d.wms_cre_credit_head_id,
	  	d.wms_fina_cre_pay_id,
	  	d.wms_cre_appro_borrow_protocol_id,
	  	d.wms_cre_credit_head_id,
	  	r.cre_type,
		(select bill_code from wms_cre_credit_head where wms_cre_credit_head_id=r.wms_cre_credit_head_id) as bill_code,
		(select value_meaning from wms_sys_dict_data where value_code=r.cre_type and wms_sys_dict_id=15) as cre_type_name,
		(select value_meaning from wms_sys_dict_data where wms_sys_dict_data_id=(select cre_loan_type from wms_cre_credit_head where wms_cre_credit_head_id=r.wms_cre_credit_head_id)) as cre_loan_type_name,
		CONCAT(
    	(select value_meaning from wms_sys_dict_data where value_code=r.cre_type and wms_sys_dict_id=15),
    	'/',
    	(select value_meaning from wms_sys_dict_data where wms_sys_dict_data_id=(select cre_loan_type from wms_cre_credit_head where wms_cre_credit_head_id=r.wms_cre_credit_head_id))
    	) as type_cre_loan, 
		d.dunning_name,
		d.dunning_tel,
		d.protocol_code,
		d.protocol_creat_date,
		d.protocol_amount,
		p.protocol_type,
		r.refund_limit_month,
		d.repay_period,
		(r.un_pay_principal+r.un_pay_interest) as matching_creditor, 
		r.cur_overdue_day,
		r.salesman_name,
		p.debtor_name,
		p.debtor_tel,
		d.default_date,
		d.final_dunning_name,
		(case d.home_dunning_status 
		when '1' then '内部催缴' 
		when '2' then '外包催缴' 
		when '3' then '法务催缴' 
		when '4' then '呆账'
		when '2#3' then '外包,法务催缴' 
		end) as home_dunning_status,
		d.internal_dunning_result,
		d.outside_dunning_result,
		d.legalappeal_dunning_result
		from wms_fina_cre_repay r,wms_cre_appro_borrow_protocol p,wms_post_dunning_head d
	    <where>
	    	r.enable_flag='1' and d.enable_flag='1'
			and
			r.wms_cre_appro_borrow_protocol_id=p.wms_cre_appro_id 
			and
			r.wms_fina_cre_pay_id=d.wms_fina_cre_pay_id
			and
			d.dunning_status=4
			<if test="protocol_code != null">
				 and d.protocol_code like #{protocol_code}
			</if>
			<if test="debtor_name !=null">
				and  d.dunning_name like #{debtor_name}
			</if>
			<if test="debtor_tel !=null">
				and  d.dunning_tel like #{debtor_tel}
			</if>
			<if test="salesman_name !=null">
				and  d.salesman_name like #{salesman_name}
			</if>
			<if test="cre_type !=null">
				and  r.cre_type = #{cre_type}
			</if>
			<if test="final_dunning_name !=null">
				and  d.final_dunning_name like #{final_dunning_name}
			</if>
			<if test="home_dunning_status !=null">
				and d.home_dunning_status=#{home_dunning_status}
			</if>
		</where>
		<if test="sortname != '' and sortorder !=''">
			ORDER BY ${sortname} ${sortorder}
		</if>
		<if test="offset != null and pagesize !=null">
			LIMIT ${offset} , ${pagesize}
		</if>
	</select>
	<!-- 获取上门催缴页面显示的数据数 -->
	<select id="findCountDunningHome" parameterType="map" resultType="int">
		select count(wms_post_dunning_head_id) as count
		from wms_fina_cre_repay r,wms_cre_appro_borrow_protocol p,wms_post_dunning_head d
		 <where>
	    	r.enable_flag='1' and d.enable_flag='1'
			and
			r.wms_cre_appro_borrow_protocol_id=p.wms_cre_appro_id 
			and
			r.wms_fina_cre_pay_id=d.wms_fina_cre_pay_id
			and
			d.dunning_status=4 and home_dunning_status in (1,2,3,4)
			<if test="protocol_code != null">
				 and d.protocol_code like #{protocol_code}
			</if>
			<if test="debtor_name !=null">
				and  d.dunning_name like #{debtor_name}
			</if>
			<if test="debtor_tel !=null">
				and  d.dunning_tel like #{debtor_tel}
			</if>
			<if test="salesman_name !=null">
				and  d.salesman_name like #{salesman_name}
			</if>
			<if test="cre_type !=null">
				and  r.cre_type = #{cre_type}
			</if>
			<if test="final_dunning_name !=null">
				and  d.final_dunning_name like #{final_dunning_name}
			</if>
			<if test="home_dunning_status !=null">
				and d.home_dunning_status=#{home_dunning_status}
			</if>
		</where>
	</select>
	<!--实现上门催缴页面数据导出-->
	<select id="searchforDunningHomeWithout" parameterType="map" resultType="java.util.HashMap">
	select
	  	d.wms_post_dunning_head_id,
	  	d.wms_cre_credit_head_id,
	  	d.wms_fina_cre_pay_id,
	  	d.wms_cre_appro_borrow_protocol_id,
	  	d.wms_cre_credit_head_id,
	  	r.cre_type,
		(select bill_code from wms_cre_credit_head where wms_cre_credit_head_id=r.wms_cre_credit_head_id) as bill_code,
		(select value_meaning from wms_sys_dict_data where value_code=r.cre_type and wms_sys_dict_id=15) as cre_type_name,
		(select value_meaning from wms_sys_dict_data where wms_sys_dict_data_id=(select cre_loan_type from wms_cre_credit_head where wms_cre_credit_head_id=r.wms_cre_credit_head_id)) as cre_loan_type_name,
		CONCAT(
    	(select value_meaning from wms_sys_dict_data where value_code=r.cre_type and wms_sys_dict_id=15),
    	'/',
    	(select value_meaning from wms_sys_dict_data where wms_sys_dict_data_id=(select cre_loan_type from wms_cre_credit_head where wms_cre_credit_head_id=r.wms_cre_credit_head_id))
    	) as type_cre_loan, 
		d.dunning_name,
		d.dunning_tel,
		d.protocol_code,
		d.protocol_creat_date,
		d.protocol_amount,
		r.refund_limit_month,
		d.repay_period,
		(r.un_pay_principal+r.un_pay_interest) as matching_creditor, 
		r.cur_overdue_day,
		r.salesman_name,
		p.debtor_name,
		p.debtor_tel,
		d.default_date,
		d.final_dunning_name,
		(case d.home_dunning_status 
		when '1' then '内部催缴' 
		when '2' then '外包催缴' 
		when '3' then '法务催缴' 
		when '4' then '呆账'
		when '2#3' then '外包,法务催缴' 
		end) as home_dunning_status,
		d.internal_dunning_result,
		d.outside_dunning_result,
		d.legalappeal_dunning_result
		from wms_fina_cre_repay r,wms_cre_appro_borrow_protocol p,wms_post_dunning_head d
	    <where>
	    	r.enable_flag='1' and d.enable_flag='1'
			and
			r.wms_cre_appro_borrow_protocol_id=p.wms_cre_appro_id 
			and
			r.wms_fina_cre_pay_id=d.wms_fina_cre_pay_id
			and
			d.dunning_status=4
			<if test="protocol_code != null">
				 and d.protocol_code like #{protocol_code}
			</if>
			<if test="debtor_name !=null">
				and  d.dunning_name like #{debtor_name}
			</if>
			<if test="debtor_tel !=null">
				and  d.dunning_tel like #{debtor_tel}
			</if>
			<if test="salesman_name !=null">
				and  d.salesman_name like #{salesman_name}
			</if>
			<if test="cre_type !=null">
				and  r.cre_type = #{cre_type}
			</if>
			<if test="final_dunning_name !=null">
				and  d.final_dunning_name like #{final_dunning_name}
			</if>
			<if test="home_dunning_status !=null">
				and d.home_dunning_status=#{home_dunning_status}
			</if>
		</where>
		<if test="sortname != '' and sortorder !=''">
			ORDER BY ${sortname} ${sortorder}
		</if>
	</select>
	<update id="updateReocod" parameterType="map">
		update wms_post_dunning_head
		<set>
					<if test="wms_post_dunning_head_id != null">
						 wms_post_dunning_head_id = #{wms_post_dunning_head_id},
					</if>
					<if test="wms_fina_cre_pay_id != null">
						 wms_fina_cre_pay_id = #{wms_fina_cre_pay_id},
					</if>
					<if test="wms_cre_appro_borrow_protocol_id != null">
						 wms_cre_appro_borrow_protocol_id = #{wms_cre_appro_borrow_protocol_id},
					</if>
					<if test="wms_cre_credit_head_id != null">
						 wms_cre_credit_head_id = #{wms_cre_credit_head_id},
					</if>
					<if test="dunning_name != null">
						 dunning_name = #{dunning_name},
					</if>
					<if test="dunning_tel != null">
						 dunning_tel = #{dunning_tel},
					</if>
					<if test="cre_loan_type != null">
						 cre_loan_type = #{cre_loan_type},
					</if>
					<if test="protocol_code != null">
						 protocol_code = #{protocol_code},
					</if>
					<if test="dunning_remark != null">
						 dunning_remark = #{dunning_remark},
					</if>
					<if test="protocol_creat_date != null">
						 protocol_creat_date = #{protocol_creat_date},
					</if>
					<if test="protocol_amount != null">
						 protocol_amount = #{protocol_amount},
					</if>
					<if test="default_date != null">
						 default_date = #{default_date},
					</if>
					<if test="repay_period != null">
						 repay_period = #{repay_period},
					</if>
					<if test="deadline != null">
						 deadline = #{deadline},
					</if>
					<if test="un_matching_creditor != null">
						 un_matching_creditor = #{un_matching_creditor},
					</if>
					<if test="liquidated_damages != null">
						 liquidated_damages = #{liquidated_damages},
					</if>
					<if test="overdue_day != null">
						 overdue_day = #{overdue_day},
					</if>
					<if test="default_amount != null">
						 default_amount = #{default_amount},
					</if>
					<if test="salesman_name != null">
						 salesman_name = #{salesman_name},
					</if>
					<if test="salesman_id != null">
						 salesman_id = #{salesman_id},
					</if>
					<if test="team_manager_id != null">
						 team_manager_id = #{team_manager_id},
					</if>
					<if test="team_manager_name != null">
						 team_manager_name = #{team_manager_name},
					</if>
					<if test="refund_bank != null">
						 refund_bank = #{refund_bank},
					</if>
					<if test="refund_number != null">
						 refund_number = #{refund_number},
					</if>
					<if test="mortgrage != null">
						 mortgrage = #{mortgrage},
					</if>
					<if test="return_amount != null">
						 return_amount = #{return_amount},
					</if>
					<if test="return_ratio != null">
						 return_ratio = #{return_ratio},
					</if>
					<if test="return_ommission != null">
						 return_ommission = #{return_ommission},
					</if>
					<if test="create_dunning_id != null">
						 create_dunning_id = #{create_dunning_id},
					</if>
					<if test="create_dunning_name != null">
						 create_dunning_name = #{create_dunning_name},
					</if>
					<if test="create_dunning_deptid != null">
						 create_dunning_deptid = #{create_dunning_deptid},
					</if>
					<if test="create_dunning_datetime != null">
						 create_dunning_datetime = #{create_dunning_datetime},
					</if>
					<if test="create_dunning_result != null">
						 create_dunning_result = #{create_dunning_result},
					</if>
					<if test="final_dunning_id != null">
						 final_dunning_id = #{final_dunning_id},
					</if>
					<if test="final_dunning_name != null">
						 final_dunning_name = #{final_dunning_name},
					</if>
					<if test="final_dunning_deptid != null">
						 final_dunning_deptid = #{final_dunning_deptid},
					</if>
					<if test="final_dunning_datetime != null">
						 final_dunning_datetime = #{final_dunning_datetime},
					</if>
					<if test="final_dunning_result != null">
						 final_dunning_result = #{final_dunning_result},
					</if>
					<if test="home_dunning_status != null">
						 home_dunning_status = #{home_dunning_status},
					</if>
					<if test="internal_dunning_result != null">
						 internal_dunning_result = #{internal_dunning_result},
					</if>
					<if test="internal_dunning_advice != null">
						 internal_dunning_advice = #{internal_dunning_advice},
					</if>
					<if test="outside_dunning_result != null">
						 outside_dunning_result = #{outside_dunning_result},
					</if>
					<if test="outside_dunning_advice != null">
						 outside_dunning_advice = #{outside_dunning_advice},
					</if>
					<if test="legalappeal_dunning_result != null">
						 legalappeal_dunning_result = #{legalappeal_dunning_result},
					</if>
					<if test="legalappeal_dunning_advice != null">
						 legalappeal_dunning_advice = #{legalappeal_dunning_advice},
					</if>
					<if test="dunning_status != null">
						 dunning_status = #{dunning_status},
					</if>
					<if test="loansupervisor_id != null">
						 loansupervisor_id = #{loansupervisor_id},
					</if>
					<if test="loansupervisor_name != null">
						 loansupervisor_name = #{loansupervisor_name},
					</if>
					<if test="loansupervisor_deptid != null">
						 loansupervisor_deptid = #{loansupervisor_deptid},
					</if>
					<if test="loansupervisor_datetime != null">
						 loansupervisor_datetime = #{loansupervisor_datetime},
					</if>
					<if test="loansupervisor_result != null">
						 loansupervisor_result = #{loansupervisor_result},
					</if>
					<if test="loansupervisor_advice != null">
						 loansupervisor_advice = #{loansupervisor_advice},
					</if>
					<if test="enable_flag != null">
						 enable_flag = #{enable_flag},
					</if>
					<if test="un_pay_principal != null">
						 un_pay_principal = #{un_pay_principal},
					</if>
					<if test="un_pay_interest != null">
						 un_pay_interest = #{un_pay_interest},
					</if>
					<if test="un_total_pay_late_fee != null">
						 un_total_pay_late_fee = #{un_total_pay_late_fee},
					</if>
					<if test="expect_payment_amount != null">
						 expect_payment_amount = #{expect_payment_amount},
					</if>
					<if test="reject_status != null">
						 reject_status = #{reject_status},
					</if>
					<if test="reject_advice != null">
						 reject_advice = #{reject_advice},
					</if>
					<if test="reject_id != null">
						 reject_id = #{reject_id},
					</if>
					<if test="reject_name != null">
						 reject_name = #{reject_name},
					</if>
					<if test="reject_datetime != null">
						 reject_datetime = #{reject_datetime},
					</if>
					<if test="post_dunning_cj_code != null">
						 post_dunning_cj_code = #{post_dunning_cj_code},
					</if>
					<if test="post_dunning_commissioner_time != null">
						 post_dunning_commissioner_time = #{post_dunning_commissioner_time},
					</if>
					<if test="post_dunning_supervisor_time != null">
						 post_dunning_supervisor_time = #{post_dunning_supervisor_time},
					</if>
					<if test="financial_confirmation_reminder_time != null">
						 financial_confirmation_reminder_time = #{financial_confirmation_reminder_time},
					</if>
					<if test="post_dunning_create_datetime != null">
						 post_dunning_create_datetime = #{post_dunning_create_datetime},
					</if>
					<if test="visit_dunning_id != null">
						 visit_dunning_id = #{visit_dunning_id},
					</if>
					<if test="visit_dunning_name != null">
						 visit_dunning_name = #{visit_dunning_name},
					</if>
					
	   </set>
		 where 
    				wms_post_dunning_head_id = #{wms_post_dunning_head_id}
	</update>
	<!-- 服务管理 贷后查询  根据催缴单维度 查询相应数据  xiugaiwei以业务  -->
	<select id="searchforPostLoan" parameterType="map" resultType="java.util.HashMap">
		select 
			r.cre_type,
			r.wms_cre_credit_head_id,
			p.protocol_type,
			(select wms_post_dunning_head_id <include refid="wmsPostDunningHeadForSearchforPostLoan"></include>) as wms_post_dunning_head_id,
			r.wms_cre_credit_head_id,
			(select value_meaning from wms_sys_dict_data where wms_sys_dict_id=15 and value_code=(select cre_type from wms_cre_credit_head where wms_cre_credit_head_id=r.wms_cre_credit_head_id)) as cre_type_name,
			
			(case r.cre_type 
                        when '1' then (select value_meaning from wms_sys_dict_data where wms_sys_dict_data_id=(select cre_loan_type from wms_cre_credit_head where wms_cre_credit_head_id=r.wms_cre_credit_head_id)) 
                        when '2' then (select value_meaning from wms_sys_dict_data where wms_sys_dict_data_id=(select cre_loan_type from wms_cre_credit_head where wms_cre_credit_head_id=r.wms_cre_credit_head_id)) 
						when '3' then (select value_meaning from wms_sys_dict_data where value_code=(select cre_loan_type from wms_cre_credit_head where wms_cre_credit_head_id=r.wms_cre_credit_head_id) and wms_sys_dict_id=75)
            END) as cre_loan_type_name,
			
			(select bill_code from wms_cre_credit_head where wms_cre_credit_head_id=r.wms_cre_credit_head_id) as bill_code,
			
			CONCAT(
	    	(select value_meaning from wms_sys_dict_data where value_code=r.cre_type and wms_sys_dict_id=15),
	    	'/',
		    	(
						  (case r.cre_type 
	            				when '1' then (select value_meaning from wms_sys_dict_data where wms_sys_dict_data_id=(select cre_loan_type from wms_cre_credit_head where wms_cre_credit_head_id=r.wms_cre_credit_head_id)) 
	            				when '2' then (select value_meaning from wms_sys_dict_data where wms_sys_dict_data_id=(select cre_loan_type from wms_cre_credit_head where wms_cre_credit_head_id=r.wms_cre_credit_head_id)) 
								when '3' then (select value_meaning from wms_sys_dict_data where value_code=(select cre_loan_type from wms_cre_credit_head where wms_cre_credit_head_id=r.wms_cre_credit_head_id) and wms_sys_dict_id=75)
							END)
	        	)
	    	) as type_cre_loan, 
	    	 
			r.protocol_code,
			p.debtor_name as dunning_name,
			p.debtor_tel as dunning_tel,
			r.protocol_creat_date,
			r.protocol_amount,
			r.refund_limit_month,
			r.repay_period,
			((r.un_pay_interest + r.un_pay_principal)*(select property_value from wms_sys_property where wms_sys_property_id=23)) as matching_creditor,
			(select DATE_ADD(current_repay_date,INTERVAL 1 DAY) from wms_fina_cre_period_repay where wms_fina_cre_period_pay_id=
			(select min(wms_fina_cre_period_pay_id) from wms_fina_cre_period_repay where ISNULL(repay_date) and wms_cre_credit_head_id=r.wms_cre_credit_head_id) and current_repay_date &lt;CURDATE()
			) as default_date,
			r.cur_overdue_day,
			r.salesman_name,
			(select home_dunning_status <include refid="wmsPostDunningHeadForSearchforPostLoan"></include>) as home_dunning_status,
			(case (select home_dunning_status <include refid="wmsPostDunningHeadForSearchforPostLoan"></include>)
					 when '1' then "内部催缴" 
					 when '2' then "外包催缴" 
					 when '3' then "法务催缴" 
					 when '4' then "呆账" 
					 when '2#3' then "外包,法务催缴"
			END) as home_dunning_status_name,
			r.dunning_name as final_dunning_name
		from wms_fina_cre_repay r, wms_cre_appro_borrow_protocol p
		<where>
			r.wms_cre_appro_borrow_protocol_id = p.wms_cre_appro_id and 
			r.enable_flag='1' and p.enable_flag='1'
			<if test="repay_status !=null">
				and r.repay_status =#{repay_status}
			</if>
			<if test="protocol_code != null">
				and r.protocol_code like #{protocol_code}
			</if>
			<if test="debtor_name != null">
				and p.debtor_name like #{debtor_name}
			</if>
			<if test="debtor_tel != null">
				and p.debtor_tel like #{debtor_tel}
			</if>
			<if test="salesman_name != null">
				and r.salesman_name like #{salesman_name}
			</if>
			<if test="cre_type != null">
				and r.cre_type = #{cre_type}
			</if>
			<if test="home_dunning_status !=null">
				<if test="home_dunning_status==2 or home_dunning_status==3">
				and ((select home_dunning_status <include refid="wmsPostDunningHeadForSearchforPostLoan"></include>)=#{home_dunning_status} 
				or (select home_dunning_status <include refid="wmsPostDunningHeadForSearchforPostLoan"></include>)='2#3')
				</if>
				<if test="home_dunning_status!=2 and home_dunning_status!=3">
				and (select home_dunning_status <include refid="wmsPostDunningHeadForSearchforPostLoan"></include>)=#{home_dunning_status} 
				</if>
			</if>
			<if test="final_dunning_name !=null">
				and r.dunning_name like #{final_dunning_name}
			</if>
		</where> 
		<if test="sortname != null and sortorder !=null">
			ORDER BY ${sortname} ${sortorder}
		</if>
		<if test="offset != null and pagesize !=null">
			LIMIT ${offset} , ${pagesize}
		</if>
	</select>
	<sql id="wmsPostDunningHeadForSearchforPostLoan">
		from wms_post_dunning_head 
		where wms_cre_credit_head_id = r.wms_cre_credit_head_id
			and wms_post_dunning_head_id = (
				select max(wms_post_dunning_head_id) from wms_post_dunning_head where wms_cre_credit_head_id = r.wms_cre_credit_head_id
			)
	</sql>
	<!-- 
	<select id="searchforPostLoan" parameterType="map" resultType="java.util.HashMap">
		select
			(select cre_type from wms_cre_credit_head where wms_cre_credit_head_id=dp.wms_cre_credit_head_id) as cre_type,
			(select protocol_type from wms_cre_appro_borrow_protocol where wms_cre_credit_head_id=dp.wms_cre_credit_head_id) as protocol_type,
			dp.wms_post_dunning_head_id,
			dp.wms_cre_credit_head_id,
			(select value_meaning from wms_sys_dict_data where wms_sys_dict_id=15 and value_code=(select cre_type from wms_cre_credit_head where wms_cre_credit_head_id=dp.wms_cre_credit_head_id)) as cre_type_name,
			(select value_meaning from wms_sys_dict_data where wms_sys_dict_data_id=dp.cre_loan_type) as cre_loan_type_name,
			(select bill_code from wms_cre_credit_head where wms_cre_credit_head_id=dp.wms_cre_credit_head_id) as bill_code,
			dp.protocol_code,
			dp.dunning_name,
			dp.dunning_tel,
			dp.protocol_creat_date,
			dp.protocol_amount,
			(select refund_limit_month from wms_cre_appro_borrow_protocol where wms_cre_credit_head_id=dp.wms_cre_credit_head_id) as refund_limit_month,
			(select repay_period from wms_fina_cre_repay where wms_cre_credit_head_id=dp.wms_cre_credit_head_id) as repay_period,
			(select (un_pay_interest+un_pay_principal)*(select property_value from wms_sys_property where wms_sys_property_id=23) from wms_fina_cre_repay where wms_cre_credit_head_id=dp.wms_cre_credit_head_id) as matching_creditor,
			(select DATE_ADD(current_repay_date,INTERVAL 1 DAY) from wms_fina_cre_period_repay where wms_fina_cre_period_pay_id=
			(select min(wms_fina_cre_period_pay_id) from wms_fina_cre_period_repay where ISNULL(repay_date) and wms_cre_credit_head_id=dp.wms_cre_credit_head_id)
			) as default_date,
			(select cur_overdue_day from wms_fina_cre_repay where wms_cre_credit_head_id=dp.wms_cre_credit_head_id ) as cur_overdue_day,
			dp.create_dunning_name,
			dp.salesman_name,
			dp.home_dunning_status,
			(case dp.home_dunning_status
					 when '1' then "内部催缴" 
					 when '2' then "外包催缴" 
					 when '3' then "法务催缴" 
					 when '4' then "呆账" 
					 when '2#3' then "外包,法务催缴"
			END) as home_dunning_status_name,
			dp.final_dunning_name
			
			from wms_post_dunning_head  dp   
		<where>
			<![CDATA[
				dp.enable_flag='1' and 
				dp.dunning_status<>'0' and 
				dp.home_dunning_status is not null
			]]>
			<if test="repay_status !=null">
				and dp.wms_cre_credit_head_id in (select wms_cre_credit_head_id from wms_fina_cre_repay where  repay_status =#{repay_status}) 
			</if>
			<if test="protocol_code != null">
				and dp.protocol_code like #{protocol_code}
			</if>
			<if test="debtor_name != null">
				and dp.dunning_name like #{debtor_name}
			</if>
			<if test="debtor_tel != null">
				and dp.dunning_tel like #{debtor_tel}
			</if>
			<if test="salesman_name != null">
				and dp.salesman_name like #{salesman_name}
			</if>
			<if test="cre_type != null">
				and dp.wms_fina_cre_pay_id in (select wms_fina_cre_pay_id from wms_fina_cre_repay where cre_type = #{cre_type})
			</if>
			<if test="home_dunning_status !=null or home_dunning_status==2 or home_dunning_status==3">
				and (dp.home_dunning_status=#{home_dunning_status} or dp.home_dunning_status='2#3')
			</if>
			<if test="dunning_status !=null">
				and dunning_status=#{dunning_status}
			</if>
			<if test="final_dunning_name !=null">
				and dp.final_dunning_name like #{final_dunning_name}
			</if>
		</where>
		<if test="sortname != null and sortorder !=null">
			ORDER BY ${sortname} ${sortorder}
		</if>
		<if test="offset != null and pagesize !=null">
			LIMIT ${offset} , ${pagesize}
		</if>
	</select>
	 -->
	
	<!-- 服务管理 贷后查询  根据催缴单维度 查询相应数据 -->
	<select id="findCountforPostLoan" parameterType="map" resultType="int">
		select count(r.wms_cre_appro_borrow_protocol_id) as count
		from wms_fina_cre_repay r, wms_cre_appro_borrow_protocol p
		<where>
			r.wms_cre_appro_borrow_protocol_id = p.wms_cre_appro_id and 
			r.enable_flag='1' and p.enable_flag='1'
			<if test="repay_status !=null">
				and r.repay_status =#{repay_status}
			</if>
			<if test="protocol_code != null">
				and r.protocol_code like #{protocol_code}
			</if>
			<if test="debtor_name != null">
				and p.debtor_name like #{debtor_name}
			</if>
			<if test="debtor_tel != null">
				and p.debtor_tel like #{debtor_tel}
			</if>
			<if test="salesman_name != null">
				and r.salesman_name like #{salesman_name}
			</if>
			<if test="cre_type != null">
				and r.cre_type = #{cre_type}
			</if>
			<if test="home_dunning_status !=null">
				<if test="home_dunning_status==2 or home_dunning_status==3">
				and ((select home_dunning_status <include refid="wmsPostDunningHeadForSearchforPostLoan"></include>)=#{home_dunning_status} 
				or (select home_dunning_status <include refid="wmsPostDunningHeadForSearchforPostLoan"></include>)='2#3')
				</if>
				<if test="home_dunning_status!=2 and home_dunning_status!=3">
				and (select home_dunning_status <include refid="wmsPostDunningHeadForSearchforPostLoan"></include>)=#{home_dunning_status} 
				</if>
			</if>
			<if test="final_dunning_name !=null">
				and (select final_dunning_name <include refid="wmsPostDunningHeadForSearchforPostLoan"></include>) like #{final_dunning_name}
			</if>
		</where> 
	</select>
	<select id="getListById" parameterType="WmsPostDunningHead" resultType="WmsPostDunningHead">
		select 
				wms_post_dunning_head_id,
				wms_fina_cre_pay_id,
				wms_cre_appro_borrow_protocol_id,
				wms_cre_credit_head_id,
				dunning_name,
				dunning_tel,
				cre_loan_type,
				protocol_code,
				date_format(protocol_creat_date,'%Y-%m-%d') as protocol_creat_date_str,
				protocol_creat_date,
				protocol_amount,
				date_format(default_date,'%Y-%m-%d') as default_date_str,
				default_date,
				repay_period,
				deadline,
				un_matching_creditor,
				liquidated_damages,
				overdue_day,
				default_amount,
				salesman_name,
				salesman_id,
				team_manager_id,
				team_manager_name,
				refund_bank,
				refund_number,
				mortgrage,
				return_amount,
				return_ratio,
				return_ommission,
				dunning_remark,
				create_dunning_id,
				create_dunning_name,
				create_dunning_deptid,
				date_format(create_dunning_datetime,'%Y-%m-%d %H:%i:%s') as create_dunning_datetime_str,
				create_dunning_datetime,
				create_dunning_result,
				final_dunning_id,
				final_dunning_name,
				final_dunning_deptid,
				date_format(final_dunning_datetime,'%Y-%m-%d %H:%i:%s') as final_dunning_datetime_str,
				final_dunning_datetime,
				final_dunning_result,
				home_dunning_status,
				internal_dunning_result,
				internal_dunning_advice,
				outside_dunning_result,
				outside_dunning_advice,
				legalappeal_dunning_result,
				legalappeal_dunning_advice,
				dunning_status,
				loansupervisor_id,
				loansupervisor_name,
				loansupervisor_deptid,
				date_format(loansupervisor_datetime,'%Y-%m-%d %H:%i:%s') as loansupervisor_datetime_str,
				loansupervisor_datetime,
				loansupervisor_result,
				loansupervisor_advice,
				enable_flag,
				un_pay_principal,
				un_pay_interest,
				un_total_pay_late_fee,
				expect_payment_amount
		from
		wms_post_dunning_head
		<where>
			1=1
			and (dunning_status !='0' or dunning_status is null)
					<if test="wms_post_dunning_head_id != null">
						and wms_post_dunning_head_id = #{wms_post_dunning_head_id}
					</if>
					<if test="wms_fina_cre_pay_id != null">
						and wms_fina_cre_pay_id = #{wms_fina_cre_pay_id}
					</if>
					<if test="wms_cre_appro_borrow_protocol_id != null">
						and wms_cre_appro_borrow_protocol_id = #{wms_cre_appro_borrow_protocol_id}
					</if>
					<if test="wms_cre_credit_head_id != null">
						and wms_cre_credit_head_id = #{wms_cre_credit_head_id}
					</if>
				 	<if test="isExcludePKFlag != null and isExcludePKFlag == true">
		        		and wms_post_dunning_head_id != #{wms_post_dunning_head_id}
					</if>
		</where>
	</select>
	
	<select id="getReminderSearchListSize" parameterType="map" resultType="int">
		select count(h.wms_post_dunning_head_id)
		from wms_post_dunning_head h, wms_fina_cre_repay r
		<where>
			h.enable_flag = '1' and r.enable_flag = '1' and 
			h.wms_cre_credit_head_id = r.wms_cre_credit_head_id 
			<if test="user_id != null and user_id != ''">
				and h.final_dunning_id = #{user_id}
			</if>
			<if test="post_dunning_cj_code != null and post_dunning_cj_code != ''">
				and h.post_dunning_cj_code like #{post_dunning_cj_code}
			</if>
			<if test="debtor_name != null and debtor_name != ''">
				and h.dunning_name like #{debtor_name}
			</if>
			<if test="debtor_tel != null and debtor_tel != ''">
				and h.dunning_tel = #{debtor_tel}
			</if>
			<if test="salesman_name != null and salesman_name != ''">
				and r.salesman_name like #{salesman_name}
			</if>
			<if test="cre_type != null and cre_type != ''">
				and h.cre_loan_type = #{cre_type}
			</if>
			<if test="repay_status != null and repay_status != ''">
				and r.repay_status = #{repay_status}
			</if>
			<if test="home_dunning_status != null and home_dunning_status != ''">
				and h.home_dunning_status = #{home_dunning_status}
			</if>
			<if test="dunning_status != null and dunning_status != ''">
				and h.dunning_status = #{dunning_status}
			</if>
			<if test="current_repay_date_start != null and current_repay_date_start != ''">
			<![CDATA[
				and (select min(current_repay_date) from wms_fina_cre_period_repay where wms_cre_credit_head_id = h.wms_cre_credit_head_id and repay_date is null) >= #{current_repay_date_start}
			]]>
			</if>
			<if test="current_repay_date_end != null and current_repay_date_end != ''">
			<![CDATA[
				and (select min(current_repay_date) from wms_fina_cre_period_repay where wms_cre_credit_head_id = h.wms_cre_credit_head_id and repay_date is null) <= #{current_repay_date_end}
			]]>
			</if>
		</where>
	</select>
	<!-- 催缴单查询 -->
	<select id="getReminderSearchList" parameterType="map" resultType="java.util.HashMap">
		select 
			h.wms_post_dunning_head_id,
			h.wms_fina_cre_pay_id,
			h.wms_cre_appro_borrow_protocol_id,
			h.wms_cre_credit_head_id,
			h.post_dunning_cj_code,
			h.dunning_name,
			h.dunning_tel,
			h.cre_loan_type,
			CONCAT(
	    	(select value_meaning from wms_sys_dict_data where value_code=r.cre_type and wms_sys_dict_id=15),
	    	'/',
	    	(select value_meaning from wms_sys_dict_data where wms_sys_dict_data_id=(select cre_loan_type from wms_cre_credit_head where wms_cre_credit_head_id=r.wms_cre_credit_head_id))
	    	) as type_cre_loan, 
			h.protocol_creat_date,
			(select min(current_repay_date) from wms_fina_cre_period_repay where wms_cre_credit_head_id = h.wms_cre_credit_head_id and repay_date is null) as current_repay_date,
			h.protocol_amount,
			r.refund_limit_month,
			h.repay_period,
			h.un_matching_creditor,
			h.overdue_day,
			h.default_date,
			h.post_dunning_commissioner_time,
			(case h.dunning_status when '0' then '催缴驳回'
				else (select value_meaning from wms_sys_dict_data where wms_sys_dict_id = '64' and value_code = h.dunning_status) end
			) as dunning_status,
			(case h.dunning_status when '0' then h.loansupervisor_advice else h.reject_advice end) as reject_advice,
			(select value_meaning from wms_sys_dict_data where wms_sys_dict_id = '62' and value_code = h.home_dunning_status) as home_dunning_status,
			r.salesman_name,
			h.expect_payment_amount,
			(select reality_payment_amount from wms_post_dunning_commission where wms_post_dunning_head_id = h.wms_post_dunning_head_id) as reality_payment_amount
		from wms_post_dunning_head h, wms_fina_cre_repay r
		<where>
			h.enable_flag = '1' and r.enable_flag = '1' and 
			h.wms_cre_credit_head_id = r.wms_cre_credit_head_id 
			<if test="user_id != null and user_id != ''">
				and h.final_dunning_id = #{user_id}
			</if>
			<if test="post_dunning_cj_code != null and post_dunning_cj_code != ''">
				and h.post_dunning_cj_code like #{post_dunning_cj_code}
			</if>
			<if test="debtor_name != null and debtor_name != ''">
				and h.dunning_name like #{debtor_name}
			</if>
			<if test="debtor_tel != null and debtor_tel != ''">
				and h.dunning_tel = #{debtor_tel}
			</if>
			<if test="salesman_name != null and salesman_name != ''">
				and r.salesman_name like #{salesman_name}
			</if>
			<if test="cre_type != null and cre_type != ''">
				and r.cre_type = #{cre_type}
			</if>
			<if test="repay_status != null and repay_status != ''">
				and r.repay_status = #{repay_status}
			</if>
			<if test="home_dunning_status != null and home_dunning_status != ''">
				and h.home_dunning_status = #{home_dunning_status}
			</if>
			<if test="dunning_status != null and dunning_status != ''">
				and h.dunning_status = #{dunning_status}
			</if>
			<if test="current_repay_date_start != null and current_repay_date_start != ''">
			<![CDATA[
				and (select min(current_repay_date) from wms_fina_cre_period_repay where wms_cre_credit_head_id = h.wms_cre_credit_head_id and repay_date is null) >= #{current_repay_date_start}
			]]>
			</if>
			<if test="current_repay_date_end != null and current_repay_date_end != ''">
			<![CDATA[
				and (select min(current_repay_date) from wms_fina_cre_period_repay where wms_cre_credit_head_id = h.wms_cre_credit_head_id and repay_date is null) <= #{current_repay_date_end}
			]]>
			</if>
			<if test="sortname != null and sortorder !=null">
				ORDER BY ${sortname} ${sortorder}
			</if>
			<if test="offset != null and pagesize !=null">
				LIMIT ${offset} , ${pagesize}
			</if>
		</where>
	</select>
	
	<!-- 根据催缴单ID获取应还款本金和应还款利息 -->
	<select id="getOrgRepayPrincipalAndInterest" parameterType="int" resultType="java.util.HashMap">
		select org_repay_principal, org_repay_interest
		from wms_fina_cre_period_repay
		where wms_cre_credit_head_id = #{wms_cre_credit_head_id}
			and repay_date is null and current_repay_date = (
				select min(current_repay_date)
				from wms_fina_cre_period_repay
				where wms_cre_credit_head_id = #{wms_cre_credit_head_id}
					and repay_date is null
			)
	</select>
	<!-- 
	<select id="getOrgRepayPrincipalAndInterest" parameterType="int" resultType="java.util.HashMap">
		select r.org_repay_principal, r.org_repay_interest
		from wms_post_dunning_head h, wms_fina_cre_period_repay r
		where h.wms_cre_credit_head_id = r.wms_cre_credit_head_id
			and r.repay_date is null and h.wms_post_dunning_head_id = #{wms_post_dunning_head_id} and 
			r.current_repay_date = (
				select min(r.current_repay_date)
				from wms_post_dunning_head h, wms_fina_cre_period_repay r
				where h.wms_cre_credit_head_id = r.wms_cre_credit_head_id
					and r.repay_date is null and h.wms_post_dunning_head_id = #{wms_post_dunning_head_id}
			)
	</select>
	 -->
	
	<!-- 获取催缴单列表（贷后查询-查看-催缴单列表） -->
	<select id="getReminderListBychid" parameterType="java.lang.Integer" resultType="java.util.HashMap">
		select 
			h.wms_post_dunning_head_id,
			COALESCE(h.post_dunning_cj_code,'') as post_dunning_cj_code,
			h.expect_payment_amount,
			(select reality_payment_amount from wms_post_dunning_commission where wms_post_dunning_head_id = h.wms_post_dunning_head_id and enable_flag = '1') as reality_payment_amount,
			h.post_dunning_commissioner_time,
			(select value_meaning from wms_sys_dict_data where wms_sys_dict_id = '64' and value_code = h.dunning_status) as dunning_status
		from wms_post_dunning_head h
		where h.enable_flag = '1' and
			h.wms_cre_credit_head_id = #{wms_cre_credit_head_id}
	</select>
	
	
	<!-- 查询催缴主表  催缴状态为待上门催缴的4 -->
	<select id="getList4" parameterType="int" resultType="WmsPostDunningHead">
		select
        				wms_post_dunning_head_id,
        				wms_fina_cre_pay_id,
        				wms_cre_appro_borrow_protocol_id,
        				wms_cre_credit_head_id,
        				dunning_name,
        				dunning_tel,
        				cre_loan_type,
        				protocol_code,
						date_format(protocol_creat_date,'%Y-%m-%d') as protocol_creat_date_str,
        				protocol_creat_date,
        				protocol_amount,
						date_format(default_date,'%Y-%m-%d') as default_date_str,
        				default_date,
        				repay_period,
        				deadline,
        				un_matching_creditor,
        				liquidated_damages,
        				overdue_day,
        				default_amount,
        				salesman_name,
        				salesman_id,
        				team_manager_id,
        				team_manager_name,
        				refund_bank,
        				refund_number,
        				mortgrage,
        				return_amount,
        				return_ratio,
        				return_ommission,
        				dunning_remark,
        				create_dunning_id,
        				create_dunning_name,
        				create_dunning_deptid,
						date_format(create_dunning_datetime,'%Y-%m-%d %H:%i:%s') as create_dunning_datetime_str,
        				create_dunning_datetime,
        				create_dunning_result,
        				final_dunning_id,
        				final_dunning_name,
        				final_dunning_deptid,
						date_format(final_dunning_datetime,'%Y-%m-%d %H:%i:%s') as final_dunning_datetime_str,
        				final_dunning_datetime,
        				final_dunning_result,
        				home_dunning_status,
        				internal_dunning_result,
        				internal_dunning_advice,
        				outside_dunning_result,
        				outside_dunning_advice,
        				legalappeal_dunning_result,
        				legalappeal_dunning_advice,
        				dunning_status,
        				loansupervisor_id,
        				loansupervisor_name,
        				loansupervisor_deptid,
						date_format(loansupervisor_datetime,'%Y-%m-%d %H:%i:%s') as loansupervisor_datetime_str,
        				loansupervisor_datetime,
        				loansupervisor_result,
        				loansupervisor_advice,
        				enable_flag,
        				(select cre_type from wms_cre_credit_head where wms_cre_credit_head_id=d.wms_cre_credit_head_id) as cre_type,
        				un_pay_principal,
        				un_pay_interest,
        				un_total_pay_late_fee,
        				expect_payment_amount,
        				post_dunning_cj_code
        	from
        		wms_post_dunning_head  d
        	where
        		wms_post_dunning_head_id in
        		(SELECT wms_post_dunning_head_id
				from 
					wms_post_dunning_head 
				where 
					enable_flag=1 
					and wms_cre_credit_head_id=#{wms_cre_credit_head_id}
					and dunning_status = 4 )
	</select>
</mapper> 
