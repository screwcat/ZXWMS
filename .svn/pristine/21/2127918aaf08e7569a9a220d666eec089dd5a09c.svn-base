<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>房贷放款审核(组合贷)</title>
<link href="../../css/app.css" type="text/css" rel="stylesheet" />
<link href="../../css/zx-all.css" rel="stylesheet" type="text/css" />
<script src="../../js/zx-all.js" type="text/javascript"></script>

<style type="text/css">
.textright {
	text-align: right;
}

.textleft {
	text-align: left;
}

.input_tb_new {
	width: 100%;
	margin-bottom: 10px;
}

.input_tb_new a {
	color: #056aff;
	text-decoration: none;
	font-weight: normal;
}

.input_tb_new td {
	height: 35px;
	line-height: 25px;
	padding-top: 3px;
}

.input_tb_new .tr_title td {
	background-color: #f5f8ff;
	padding-left: 16px;
	font-weight: bold;
	height: 30px;
	line-height: 30px;
}

.input_tb_new .tr_last td {
	border-bottom: 0;
}

.input_tb_new .title {
	text-align: right;
}

.input_tb_new .subtitle {
	text-align: left;
	background-color: #d2e1fd;
	border-top: 1px solid #fff;
}

.input_tb_new .tr_btn_input td {
	background-color: #fbfbfb;
}

.title_tb {
	background-color: #f5f8ff;
	padding-left: 16px;
	font-weight: bold;
	height: 30px;
	line-height: 30px;
	height: 35px;
	line-height: 25px;
	padding-top: 3px;
}

.data_tb td {
	height: 30px;
	line-height: 24px;
	padding-left: 10px;
	border-bottom: 1px dashed #e3e4e6;
	text-align: left;
}
</style>
</head>
<body>
	<div class="tab_titleT">
		<table width="100%" border="0" cellspacing="0" cellpadding="0">
			<tr valign="bottom" id='trtab1'>
				<td class="tabbody1" id="tabbody1" 
					onclick="changeTab('transfer');" tabname='mytab' 
					style="width: 25%">
					<div align="center">转账单</div>
				</td>
				<td class="tabbody2" id="tabbody2"
					onclick="changeTab('borrowList');" tabname='mytab'
					style="width: 25%; display: none;">
					<div align="center">合同清单</div>
				</td>
				<td class="tabbody3" id="tabbody3"
					onclick="changeTab('notarizationAndOthers');" tabname='mytab'
					style="width: 25%; display: none;">
					<div align="center">公证及他项</div>
				</td>
				<td class="tabbody3" id="tabbody4"
					onclick="changeTab('combinedLoan');" tabname='mytab'
					style="width: 25%;">
					<div align="center">组合贷</div>
				</td>
			</tr>
		</table>
	</div>
	<div class="center-content clearboth" style="margin-top: 30px; overflow: auto; height: 455px;" id="all_data">
		<div id="transfer">
			<div class="center-title">基本信息</div>
			<div id="disabled_div" class="center-txt" style="height: 220px;">
				<div class="float-l clearboth">
					<div class="pop-form-title">客户姓名：</div>
					<div class="pop-form-item">
						<input type="text" id="debtor_name" style="width: 150px;" disabled="disabled" />
					</div>
				</div>
				<div class="float-l">
					<div class="pop-form-title">身份证号：</div>
					<div class="pop-form-item">
						<input type="text" id="debtor_identity_id" style="width: 150px;" disabled="disabled" />
					</div>
				</div>
				<div class="float-l">
					<div class="pop-form-title">抵押房面积：</div>
					<div class="pop-form-item">
						<input type="text" id="house_area" style="width: 134px;" disabled="disabled" />&nbsp;㎡
					</div>
				</div>
				<div class="float-l clearboth">
					<div class="pop-form-title">签单日期：</div>
					<div class="pop-form-item">
						<input type="text" id="borrow_begin_date" style="width: 150px;" disabled="disabled" />
					</div>
				</div>
				<div class="float-l">
					<div class="pop-form-title">合同金额：</div>
					<div class="pop-form-item">
						<input type="text" id="principal_lower" style="width: 134px;" disabled="disabled" />&nbsp;元
					</div>
				</div>
				<div class="float-l">
					<div class="pop-form-title">合同金额大写：</div>
					<div class="pop-form-item">
						<input type="text" id="principal_caps" style="width: 150px;" disabled="disabled" />
					</div>
				</div>
				<div class="float-l clearboth">
					<div class="pop-form-title">组合贷编号：</div>
					<div class="pop-form-item">
						<input type="text" id="protocol_id_year_num" style="width: 150px;" disabled="disabled" />
					</div>
				</div>
				<div class="float-l">
					<div class="pop-form-title">转款余额：</div>
					<div class="pop-form-item">
						<input type="text" id="loan_amount" style="width: 134px;" disabled="disabled" />&nbsp;元
					</div>
				</div>
				<div class="float-l">
					<div class="pop-form-title">转款余额大写：</div>
					<div class="pop-form-item">
						<input type="text" id="loan_amount_caps" style="width: 150px;" disabled="disabled" />
					</div>
				</div>
				<div class="float-l clearboth">
					<div class="pop-form-title">每月还款：</div>
					<div class="pop-form-item">
						<input type="text" id="refund_limit_month" style="width: 134px;" disabled="disabled" />&nbsp;元
					</div>
				</div>
				<div class="float-l">
					<div class="pop-form-title">其中利息：</div>
					<div class="pop-form-item">
						<input type="text" id="org_repay_interest" style="width: 134px;" disabled="disabled" />&nbsp;元
					</div>
				</div>
				<div class="float-l">
					<div class="pop-form-title">本金：</div>
					<div class="pop-form-item">
						<input type="text" id="org_repay_principal" style="width: 134px;" disabled="disabled" />&nbsp;元
					</div>
				</div>
				<div class="float-l clearboth">
					<div class="pop-form-title">他项费：</div>
					<div class="pop-form-item">
						<input type="text" id="it_cost_fee" style="width: 134px;" disabled="disabled" />&nbsp;元
					</div>
				</div>
				<div class="float-l">
					<div class="pop-form-title">加急费：</div>
					<div class="pop-form-item">
						<input type="text" id="expedited_fee" style="width: 134px;" disabled="disabled" />&nbsp;元
					</div>
				</div>
				<div class="float-l">
					<div class="pop-form-title">平台服务费：</div>
					<div class="pop-form-item">
						<input type="text" id="platform_fee" style="width: 134px;" disabled="disabled" />&nbsp;元
					</div>
				</div>
				<!-- <div class="float-l clearboth">
					<div class="pop-form-title">还款方式：</div>
					<div class="pop-form-item">
						<input type="text" id="protocol_type_name" style="width: 150px;" disabled="disabled" />
					</div>
				</div>
				<div class="float-l">
					<div class="pop-form-title">贷款期数：</div>
					<div class="pop-form-item">
						<input type="text" id="borrow_deadline" style="width: 150px;" disabled="disabled" />
					</div>
				</div>
				<div class="float-l clearboth">
					<div class="pop-form-title">扣除利息：</div>
					<div class="pop-form-item">
						<input type="text" id="deduction_of_interest" style="width: 134px;" disabled="disabled" />&nbsp;元
					</div>
				</div> -->
				<div class="float-l clearboth">
					<div class="pop-form-title">银行：</div>
					<div class="pop-form-item">
						<input type="text" id="receive_bank" style="width: 407px; margin-left: -1px;" disabled="disabled" />
					</div>
				</div>
				<div class="float-l" style="margin-left: 16px;">
					<div class="pop-form-title">卡号：</div>
					<div class="pop-form-item">
						<input type="text" id="card_no" style="width: 150px;" disabled="disabled" />
					</div>
				</div>
			</div>
			<!-- <div class="float-l">
				<div class="pop-form-title">开户行：</div>
				<div class="pop-form-item">
					<input type="text" id="bank_of_deposit" style="width: 150px;" />
				</div>
			</div> -->
			<div class="line clearboth" id="att_info" style="display: none;"></div>
			<div class="line clearboth" id="info_l3" style="display: none;"></div>
			<div class="center-txt" style="margin-top: 20px; height: 177px; border: 0px;">
				<table align="center" border="1" cellpadding="0" cellspacing="2" width="100%"
					style="border-color: #BFBFBF; font-size: 10.5pt; margin-bottom: -50px;">
					<tr>
						<td class="td_title" width="14%" rowspan="2" align="center">审批意见</td>
						<td>
							<div style="float: left;">
								<input type="radio" id="transition_pass" name="pass" class="radio5" value="true" checked="checked" />通过
								<input type="radio" id="transition_reject" name="pass" class="radio5" value="false" />退件
								<input type="radio" id="transition_nullify" name="pass" class="radio5" value="nullify" />作废
							</div>
						</td>
					</tr>
					<tr>
						<td>
							<textarea id="advice" name="advice" rows="100" style="width: 100%; height: 150px;"></textarea>
						</td>
					</tr>
				</table>
			</div>
		</div>

		<!-- //*********************************************转账单结束********************************** -->
		<!-- //*********************************************合同清单开始********************************** -->
		<div id="borrowList" class="pop-formDiv clearfix"
			style="margin: 5px; margin-top: 5px; display: none">
			<div class="center-txt" style="margin-bottom: 30px;">
				<div id="grid-borrow"></div>
			</div>
		</div>
		<!-- //*********************************************公正及它项开始********************************** -->
		<div id="notarizationAndOthers" class="pop-formDiv clearfix" style="margin: 5px; margin-top: 5px; display: none">
			<div class="center-content clearboth"
				style="min-width: 770px; height: 160px; margin-top: 0px;">
				<div class="center-title">公证信息</div>
				<div style="overflow-y: auto; overflow-x: hidden; height: 160px; min-width: 770px; line-height: 26px; padding-left: 10px; border: #bfbfbf 1px solid;">
					<table>
						<tr>
							<td>
								<div id="showNotarizationImage"></div>
							</td>
							<td id="upload_notarization"></td>
						</tr>
					</table>
				</div>
			</div>
			<br />
			<div class="center-content clearboth"
				style="min-width: 770px; height: 160px; margin-top: 0px">
				<div class="center-title">他项信息</div>
				<div style="overflow-y: auto; overflow-x: hidden; height: 160px; min-width: 770px; line-height: 26px; padding-left: 10px; border: #bfbfbf 1px solid;">
					<table>
						<tr>
							<td>
								<div id="showOthersImage"></div>
							</td>
							<td id="upload_others"></td>
						</tr>
					</table>
				</div>
			</div>
		</div>
		<div id="combinedLoan" class="pop-formDiv clearfix" style="display: none; margin: 5px; margin-top: 5px;">
		</div>
	</div>
	<!-- 提交功能按钮区 -->
	<div class="pop-footer5 clearboth" style="bottom: 1px;" id="tb_btn">
		<input id="tjbtn" onclick="save();" class="btn-saveT"
			onmouseover="this.className='btn-saveT-over'"
			onmouseout="this.className='btn-saveT'"
			onmousedown="this.className='btn-saveT-down'" 
			type="button" />
		<input id="dybtn" onclick="doPrint()" class="btn-print" style="display: none;"
			onmouseover="this.className='btn-print-over'"
			onmouseout="this.className='btn-print'"
			onmousedown="this.className='btn-print-down'" 
			type="button" />
		<input id="cancelBtnId" onclick="closePage();" class="btn-cancel"
			onmouseover="this.className='btn-cancel-over'"
			onmouseout="this.className='btn-cancel'"
			onmousedown="this.className='btn-cancel-down'" 
			type="button" />
	</div>

	<script type="text/javascript">
		var wms_cre_credit_head_id = $.query.get("wms_cre_credit_head_id");
		var protocol_id_year_num = $.query.get("protocol_id_year_num");
		var debtor_name = $.query.get("debtor_name");
		var protocol_date = $.query.get("protocol_date");
		var borrow_interest = $.query.get("borrow_interest");
		var refund_number = $.query.get("refund_number");
		var refund_bank = $.query.get("refund_bank");
		var cre_loan_type = $.query.get("cre_loan_type");
		var bill_status = $.query.get("bill_status");
		var cre_type = $.query.get("cre_type");//贷款类型
		var protocol_type = $.query.get("protocol_type");//合同类型

		var loan_amount = document.getElementById("loan_amount");
		var edition_num = $.query.get('edition_num');//流程版本号
		var version_number = $.query.get('version_number');//数据来源
		
		var it_cost_fee = $.query.get('it_cost_fee');//他项费
		var expedited_fee = $.query.get('expedited_fee');//加急费
		
		var fileArr = [];//上传附件列表
		var isCommit = false;//是否已经按过了提交按钮
		var smjJsonArray = [];
		var loan_amount_val = 0;
		
		var type = $.query.get('type');//1：放款申请 2：放款审批 3：放款确认
		
		$(function() {
			$('#protocol_type_name').val('组合贷');//还款方式改为组合贷
			initForm(); //初始化表单数据
			initCombineLoanInfo();//初始化组合贷数据
			if(type == 1) {
				$('#att_info').append(
					'<div class="float-l">' +
						'<div class="pop-form-title" align="right">身份证附件：</div>' +
						'<div class="pop-form-item" align="right" style="width: 701px">' +
							'<table>' +
								'<tr>' +
									'<td>' +
										'<div style="width: 550px" id="showIdImage"></div>' +
									'</td>' +
									'<td id="upload_id" class="upload_td">' +
									    '<button onclick="openAddAttDialog(1,' + '\'showIdImage\'' + ')" class="btn">上传附件</button>' +
									'</td>' +
								'</tr>' +
							'</table>' +
						'</div>' +
					'</div>' +
					'<div class="float-l clearboth">' +
						'<div class="pop-form-title"></div>' +
						'<div class="pop-form-item"></div>' +
					'</div>' +
					'<div class="float-l clearboth">' +
						'<div class="pop-form-title"></div>' +
						'<div class="pop-form-item"></div>' +
					'</div>' +
					'<div class="float-l clearboth">' +
						'<div class="pop-form-title"></div>' +
					'</div>' +
					'<div class="line clearboth" id="info_l3"></div>' +
					'<div class="float-l">' +
						'<div class="pop-form-title">银行卡附件：</div>' +
						'<div class="pop-form-item" align="right" style="width: 701px">' +
							'<table>' +
								'<tr>' +
									'<td>' +
										'<div style="width: 550px" id="showAmountImage"></div>' +
									'</td>' +
									'<td id="upload_amount">' +
										'<button onclick="openAddAttDialog(2,' + '\'showAmountImage\'' + ')" class="btn">上传附件</button>' +
									'</td>' +
								'</tr>' +
							'</table>' +
						'</div>' +
					'</div>' +
					'<div class="float-l clearboth">' +
						'<div class="pop-form-title"></div>' +
						'<div class="pop-form-item"></div>' +
					'</div>' +
					'<div class="float-l clearboth">' +
						'<div class="pop-form-title"></div>' +
						'<div class="pop-form-item"></div>' +
					'</div>' +
					'<div class="float-l clearboth">' +
						'<div class="pop-form-title"></div>' +
					'</div>' +
					'<div class="line clearboth" id="info_l3"></div>' +
						'<div class="float-l">' +
							'<div class="pop-form-title">转账单附件：</div>' +
							'<div class="pop-form-item" align="right" style="width: 701px">' +
								'<table>' +
									'<tr>' +
										'<td>' +
											'<div style="width: 550px" id="showTransferOrderImage"></div>' +
										'</td>' +
										'<td id="upload_amount">' +
											'<button onclick="openAddAttDialog(3,' + '\'showTransferOrderImage\'' + ')" class="btn">上传附件</button>' +
										'</td>' +
									'</tr>' +
								'</table>' +
							'</div>' +
						'</div>' +
					'<div class="float-l clearboth">' +
						'<div class="pop-form-title"></div>' +
						'<div class="pop-form-item"></div>' +
					'</div>' +
					'<div class="float-l clearboth">' +
						'<div class="pop-form-title"></div>' +
						'<div class="pop-form-item"></div>' +
					'</div>' +
					'<div class="float-l clearboth">' +
						'<div class="pop-form-title"></div>' +
					'</div>' +
					'<div class="line clearboth" id="info_l3"></div>' +
					'<div class="float-l">' +
						'<div class="pop-form-title">合同附件：</div>' +
						'<div class="pop-form-item" align="right" style="width: 701px">' +
							'<table>' +
								'<tr>' +
									'<td>' +
										'<div style="width: 550px" id="showContractImage"></div>' +
									'</td>' +
									'<td id="upload_amount">' +
										'<button onclick="openAddAttDialog(4,' + '\'showContractImage\'' + ')" class="btn">上传附件</button>' +
									'</td>' +
								'</tr>' +
							'</table>' +
						'</div>' +
					'</div>' +
					'<div class="float-l clearboth">' +
						'<div class="pop-form-title"></div>' +
						'<div class="pop-form-item"></div>' +
					'</div>' +
					'<div class="float-l clearboth">' +
						'<div class="pop-form-title"></div>' +
						'<div class="pop-form-item"></div>' +
					'</div>' +
					'<div class="float-l clearboth">' +
						'<div class="pop-form-title"></div>' +
					'</div>'
				);
			}
			if(type == 2 || type == 3) {//放款审批、放款确认
				$('#att_info').append(
					'<div style="margin-top: 7px">' +
						'<div style="float: left; width: 70px; margin-left: 23px; margin-right: 10px">身份证附件：</div>' +
						'<div style="float: left">' +
							'<div id="showIdImage"></div>' +
							'<div id="upload_id"></div>' +
						'</div>' +
					'</div>' +
					'<div class="line clearboth"></div>' +
					'<div style="margin-top: 7px">' +
						'<div style="float: left; width: 70px; margin-left: 23px; margin-right: 10px">银行卡附件：</div>' +
						'<div style="float: left">' +
							'<div id="showAmountImage"></div>' +
							'<div id="upload_amount"></div>' +
						'</div>' +
					'</div>' +
		            '<div class="line clearboth"></div>' +
		            '<div style="margin-top: 7px">' +
		                '<div style="float: left; width: 70px; margin-left: 23px; margin-right: 10px">转账单附件：</div>' +
		                '<div style="float: left">' +
		                    '<div id="showTransferOrderImage"></div>' +
		                    '<div id="upload_transferorder"></div>' +
		                '</div>' +
		            '</div>' +
		            '<div class="line clearboth"></div>' +
		            '<div style="margin-top: 7px">' +
		                '<div style="float: left; width: 70px; margin-left: 23px; margin-right: 10px">合同附件：</div>' +
		                '<div style="float: left">' +
		                    '<div id="showContractImage"></div>' +
		                    '<div id="upload_contract"></div>' +
		                '</div>' +
		            '</div>'	
				);
				if(type == 3) {
					$('#dybtn').show();
				}
				$('#tabbody2,#tabbody3').hide();
			}
			init_notarizationAndOthers_attached();//初始化公证及他项附件 
			initForm2();//回显数据
			init_borrow(); //初始化合同清单
		});
		
		//初始化表单数据
		function initForm() {
			$.ajax({ 
	            type: "POST", 
	            url: global_param.context_name + "/loanappro/wmssyspropertyobjforhouse.do",
	            async: false,
	            dataType: "json",
	            data: {"wms_cre_credit_head_id" : wms_cre_credit_head_id}, 
	            traditional: true,
	            success: function(json) {
	                doFloat(json);
				    globalUtil.setFormVal("transfer", json);
				    $("#bank_of_deposit").val(json.debtor_loan_bank);//开户行(合同表打款银行)
				    $("#card_no").val(json.debtor_loan_number);//卡号(合同表打款账号)
				    initFormOtherVal(json.todayDate);
	            }
			});
		}
		
		//初始化表单数据
		function initForm2() {
			$.ajax({ 
	            type: "POST", 
	            url: global_param.context_name + "/loanappro/wmssyspropertyobjforhouse.do",
	            async: false,
	            dataType: "json",
	            data: {"wms_cre_credit_head_id" : wms_cre_credit_head_id}, 
	            traditional: true,
	            success: function(json) {
	            	$.ajax({ 
	    	            type: "POST", 
	    	            url: global_param.context_name + "/loanappro/getwmsfinacreloanappbyentity.do",
	    	            async: false,
	    	            dataType: "json",
	    	            data: {"wms_cre_credit_head_id" : wms_cre_credit_head_id}, 
	    	            traditional: true,
	    	            success: function(json2) {
	    	            	if (json2 != null) {
								if (JSON.stringify(json2).split(",").length != 1) {
									for (var item in json2) {
										json[item] = json2[item];
									}
									doFloat(json);
									$('#receive_bank').val(json2.receive_bank);
									$('#bank_of_deposit').val(json2.bank_of_deposit);
									$('#card_no').val(json2.card_no);
									
									var fjList = globalUtil.syncGetJson('/loanfina/wmsfinacreloanappattwithoutpaginglist.do',
													{
														"wms_fina_cre_loan_app_id" : json.wms_fina_cre_loan_app,//期还款台账id
													},
												 'POST');
									var idHtml = '';
									var amountHtml = '';
									var showTransferOrderImageHtml = '';
									var showContractImageHtml = '';
									
									if(type == 1) {
										for (var i = 0; i < fjList.Rows.length; i++) {
											fjList.Rows[i].create_timestamp = null;
											fileArr.push(fjList.Rows[i]);
											if (fjList.Rows[i].data_type == 1) {
												var nnme = fjList.Rows[i].attachment_new_name.replace('/', 'thxg1');
												nnme = nnme.replace('/', 'thxg2');
												idHtml += '<div style="margin-bottom:8px;" id="delUploadDivId' + nnme + '">';
												idHtml += '<a  target="_blank"  href="' + global_param.upload_file_url + fjList.Rows[i].attachment_address + '">'
														+ fjList.Rows[i].attachment_old_name
														+ '</a>';
												idHtml += '<img src="../../images/icon/icon-close.gif" onclick="deleteFile(\''
														+ nnme
														+ '\')"/>';
												idHtml += '</div>';
											} else if (fjList.Rows[i].data_type == 2) {
												var nnme = fjList.Rows[i].attachment_new_name.replace('/', 'thxg1');
												nnme = nnme.replace('/', 'thxg2');
												amountHtml += '<div style="margin-bottom:8px;" id="delUploadDivId' + nnme + '">';
												amountHtml += '<a  target="_blank"  href="' + global_param.upload_file_url + fjList.Rows[i].attachment_address + '">'
														+ fjList.Rows[i].attachment_old_name
														+ '</a>';
												amountHtml += '<img src="../../images/icon/icon-close.gif" onclick="deleteFile(\''
														+ nnme
														+ '\')"/>';
												amountHtml += '</div>';
											} else if (fjList.Rows[i].data_type == 3) {
												var nnme = fjList.Rows[i].attachment_new_name.replace('/', 'thxg1');
												nnme = nnme.replace('/', 'thxg2');
												showTransferOrderImageHtml += '<div style="margin-bottom:8px;" id="delUploadDivId' + nnme + '">';
												showTransferOrderImageHtml += '<a  target="_blank"  href="' + global_param.upload_file_url + fjList.Rows[i].attachment_address + '">'
														+ fjList.Rows[i].attachment_old_name
														+ '</a>';
												showTransferOrderImageHtml += '<img src="../../images/icon/icon-close.gif" onclick="deleteFile(\''
														+ nnme
														+ '\')"/>';
												showTransferOrderImageHtml += '</div>';
											} else if (fjList.Rows[i].data_type == 4) {
												var nnme = fjList.Rows[i].attachment_new_name.replace('/', 'thxg1');
												nnme = nnme.replace('/', 'thxg2');
												showContractImageHtml += '<div style="margin-bottom:8px;" id="delUploadDivId' + nnme + '">';
												showContractImageHtml += '<a  target="_blank"  href="' + global_param.upload_file_url + fjList.Rows[i].attachment_address + '">'
														+ fjList.Rows[i].attachment_old_name
														+ '</a>';
												showContractImageHtml += '<img src="../../images/icon/icon-close.gif" onclick="deleteFile(\''
														+ nnme
														+ '\')"/>';
												showContractImageHtml += '</div>';
											}
										}
									} else if(type == 2 || type == 3) {
										for (var i = 0; i < fjList.Rows.length; i++) {
											if(fjList.Rows[i].data_type == 1) {
												idHtml += '<div style="margin-bottom:8px;" id="delUploadDivId' + fjList.Rows[i].attachment_new_name + '">';
												idHtml += '<a target="_blank" href="' + global_param.upload_file_url + fjList.Rows[i].attachment_address + '">' + '<img style="width:700px;height:auto;" src="' + global_param.upload_file_url + fjList.Rows[i].attachment_address + '" /></a>';
												idHtml += '</div>';
											}else if(fjList.Rows[i].data_type == 2) {
												amountHtml +='<div style="margin-bottom:8px;" id="delUploadDivId' + fjList.Rows[i].attachment_new_name + '">';
												amountHtml +='<a  target="_blank" href="'+global_param.upload_file_url + fjList.Rows[i].attachment_address+'">' + '<img style="width:700px;height:auto;" src="' + global_param.upload_file_url + fjList.Rows[i].attachment_address + '" /></a>';
												amountHtml += '</div>';
											}else if(fjList.Rows[i].data_type == 3) {
												showTransferOrderImageHtml += '<div style="margin-bottom:8px;" id="delUploadDivId'+fjList.Rows[i].attachment_new_name + '">';
												showTransferOrderImageHtml +='<a target="_blank" href="' + global_param.upload_file_url + fjList.Rows[i].attachment_address + '">'+'<img style="width:700px;height:auto;" src="' + global_param.upload_file_url + fjList.Rows[i].attachment_address + '" /></a>';
												showTransferOrderImageHtml += '</div>';
			                                }else if(fjList.Rows[i].data_type == 4){
			                                	showContractImageHtml += '<div style="margin-bottom:8px;" id="delUploadDivId' + fjList.Rows[i].attachment_new_name + '">';
			                                	showContractImageHtml += '<a target="_blank" href="' + global_param.upload_file_url + fjList.Rows[i].attachment_address + '">' + '<img style="width:700px;height:auto;" src="' + global_param.upload_file_url + fjList.Rows[i].attachment_address + '" /></a>';
			                                	showContractImageHtml += '</div>';
			                                }
										}
									}
									$("#showIdImage").html(idHtml);
									$("#showAmountImage").html(amountHtml);
									$("#showTransferOrderImage").html(showTransferOrderImageHtml);
									$("#showContractImage").html(showContractImageHtml);
								}
							}
	    	            }
	    			});
	            }
			});
		}
		
		//将小数四舍五入，如果长度过长保留两位小数
		function doFloat(json) {
			var principal_lower_val = json.principal_lower;//合同金额
			var refund_limit_month_val = json.refund_limit_month;//每月还款
			var org_repay_interest_val = json.org_repay_interest;//其中利息		
			var org_repay_principal_val = json.org_repay_principal;//本金
			json.principal_lower = principal_lower_val.toFixed(2);
			if (typeof (json.refund_limit_month) != 'undefined') {
				json.refund_limit_month = refund_limit_month_val.toFixed(2);
			}
			if (typeof (json.org_repay_interest) != 'undefined') {
				json.org_repay_interest = org_repay_interest_val.toFixed(2);
			}
			if (globalUtil.isEmpty(json.org_repay_principal)) {
				json.org_repay_principal = '0';
			} else {
				json.org_repay_principal = json.org_repay_principal.toFixed(2);
			}
		}
		
		//初始化其他字段的值
		function initFormOtherVal(todayDate) {
			var principal_lower = $('#principal_lower').val();//合同金额
			$('#create_date').val(todayDate);//申请日期	
			$('#deduction_of_interest').val('0');//扣除利息
		}
		
		//验证卡号
		function valiCardno() {
			var flag = false;
			var card_no_val = $('#card_no').val();
			if (!/\d+/.test(card_no_val)) {
				flag = true;
				$('#card_no').ligerTip({
					distanceX : -140,
					width : 110,
					content : '此项仅为数字！'
				});
				$('#card_no').bind('click', function() {
					$(this).ligerHideTip();
				});
			}
			return flag;
		}
		
		//小写金额转大写金额
		function convertCurrency(currencyDigits) {
			var MAXIMUM_NUMBER = 99999999999.99;
			var CN_ZERO = "零";
			var CN_ONE = "壹";
			var CN_TWO = "贰";
			var CN_THREE = "叁";
			var CN_FOUR = "肆";
			var CN_FIVE = "伍";
			var CN_SIX = "陆";
			var CN_SEVEN = "柒";
			var CN_EIGHT = "捌";
			var CN_NINE = "玖";
			var CN_TEN = "拾";
			var CN_HUNDRED = "佰";
			var CN_THOUSAND = "仟";
			var CN_TEN_THOUSAND = "万";
			var CN_HUNDRED_MILLION = "亿";
			var CN_SYMBOL = "";
			var CN_DOLLAR = "元";
			var CN_TEN_CENT = "角";
			var CN_CENT = "分";
			var CN_INTEGER = "整";

			var integral;
			var decimal;
			var outputCharacters;
			var parts;
			var digits, radices, bigRadices, decimals;
			var zeroCount;
			var i, p, d;
			var quotient, modulus;

			currencyDigits = currencyDigits.toString();

			currencyDigits = currencyDigits.replace(/,/g, "");
			currencyDigits = currencyDigits.replace(/^0+/, "");

			if (Number(currencyDigits) > MAXIMUM_NUMBER) {
				globalUtil.errorMsg(globalErrorMsg['100404']);
				return "";
			}
			parts = currencyDigits.split(".");
			if (parts.length > 1) {
				integral = parts[0];
				decimal = parts[1];
				decimal = decimal.substr(0, 2);
			} else {
				integral = parts[0];
				decimal = "";
			}
			digits = new Array(CN_ZERO, CN_ONE, CN_TWO, CN_THREE, CN_FOUR,
					CN_FIVE, CN_SIX, CN_SEVEN, CN_EIGHT, CN_NINE);
			radices = new Array("", CN_TEN, CN_HUNDRED, CN_THOUSAND);
			bigRadices = new Array("", CN_TEN_THOUSAND, CN_HUNDRED_MILLION);
			decimals = new Array(CN_TEN_CENT, CN_CENT);
			outputCharacters = "";
			if (Number(integral) > 0) {
				zeroCount = 0;
				for (i = 0; i < integral.length; i++) {
					p = integral.length - i - 1;
					d = integral.substr(i, 1);
					quotient = p / 4;
					modulus = p % 4;
					if (d == "0") {
						zeroCount++;
					} else {
						if (zeroCount > 0) {
							outputCharacters += digits[0];
						}
						zeroCount = 0;
						outputCharacters += digits[Number(d)]
								+ radices[modulus];
					}
					if (modulus == 0 && zeroCount < 4) {
						outputCharacters += bigRadices[quotient];
					}
				}
				outputCharacters += CN_DOLLAR;
			}
			if (decimal != "") {
				for (i = 0; i < decimal.length; i++) {
					d = decimal.substr(i, 1);
					if (d != "0") {
						outputCharacters += digits[Number(d)] + decimals[i];
					}
				}
			}
			if (outputCharacters == "") {
				outputCharacters = CN_ZERO + CN_DOLLAR;
			}
			if (decimal == "") {
				outputCharacters += CN_INTEGER;
			}
			outputCharacters = CN_SYMBOL + outputCharacters;
			return outputCharacters;
		}

		function init_notarizationAndOthers_attached() {
			$("#upload_notarization").html('');
			$("#upload_others").html('');
			var fjList = globalUtil.syncGetJson(
					'/cremanage/wmscrehousingattinfobyfk.do', {
						"wms_cre_credit_head_id" : wms_cre_credit_head_id,//期还款台账id
					}, 'GET');
			var notarizationHtml = '';
			var othersHtml = '';
			for (var i = 0; i < fjList.length; i++) {
				if (fjList[i].data_type == 2) {
					notarizationHtml += '<div id="delUploadDivId' + fjList[i].attachment_new_name + '">';
					notarizationHtml += '<a  target="_blank"  href="' + global_param.upload_file_url + fjList[i].attachment_address + '">' +
							fjList[i].attachment_old_name + '</a>';
					notarizationHtml += '</div>';
				} else if (fjList[i].data_type == 3) {
					othersHtml += '<div id="delUploadDivId' + fjList[i].attachment_new_name+'">';
					othersHtml += '<a  target="_blank" href="'+global_param.upload_file_url+fjList[i].attachment_address + '">' +
							fjList[i].attachment_old_name + '</a>';
					othersHtml += '</div>';
				}
			}
			$("#showNotarizationImage").html(notarizationHtml);
			$("#showOthersImage").html(othersHtml);
		}
		
		//页面切换
		function changeTab(id) {
			var transfer = document.getElementById("transfer"); //转账单
			var borrowList = document.getElementById("borrowList"); //合同清单
			var notarizationAndOthers = document.getElementById("notarizationAndOthers"); //公证及他项
			var combinedLoan = document.getElementById("combinedLoan");//组合贷
			$('#all_data').animate({scrollTop: 0}, 0);//牛姐需求：切换tab页回顶部
			if (id == 'transfer') {
				document.getElementById("tabbody1").className = "tabbody1";
				document.getElementById("tabbody2").className = "tabbody2";
				document.getElementById("tabbody3").className = "tabbody2";
				document.getElementById("tabbody4").className = "tabbody2";
				transfer.style.display = '';
				borrowList.style.display = 'none';
				notarizationAndOthers.style.display = 'none';
				combinedLoan.style.display = 'none';
				globalUtil.clearLigerTip("transfer");
				if (isCommit) {
					globalVali.checkForm("transfer", true);
					valiCardno();
				}
			} else if (id == 'borrowList') {
				document.getElementById("tabbody1").className = "tabbody2";
				document.getElementById("tabbody2").className = "tabbody1";
				document.getElementById("tabbody3").className = "tabbody2";
				document.getElementById("tabbody4").className = "tabbody2";
				transfer.style.display = 'none';
				borrowList.style.display = '';
				notarizationAndOthers.style.display = 'none';
				combinedLoan.style.display = 'none';
				globalUtil.clearLigerTip("transfer");
			} else if (id == 'notarizationAndOthers') {
				document.getElementById("tabbody1").className = "tabbody2";
				document.getElementById("tabbody2").className = "tabbody2";
				document.getElementById("tabbody3").className = "tabbody1";
				document.getElementById("tabbody4").className = "tabbody2";
				transfer.style.display = 'none';
				borrowList.style.display = 'none';
				notarizationAndOthers.style.display = '';
				combinedLoan.style.display = 'none';
				globalUtil.clearLigerTip("transfer");
			} else if (id == 'combinedLoan') {
				document.getElementById("tabbody1").className = "tabbody2";
				document.getElementById("tabbody2").className = "tabbody2";
				document.getElementById("tabbody3").className = "tabbody2";
				document.getElementById("tabbody4").className = "tabbody1";
				transfer.style.display = 'none';
				borrowList.style.display = 'none';
				notarizationAndOthers.style.display = 'none';
				combinedLoan.style.display = '';
				globalUtil.clearLigerTip("transfer");
			}
		}

		//初始化合同清单
		function init_borrow() {
			var column2 = [
				{
					display : '合同名称',
					name : 'borrow_name',
					resizable : false,
					width : 200,
					minWidth : 200
				},
				{
					display : '电子版本合同',
					name : 'borrow_online',
					resizable : false,
					width : 200,
					minWidth : 200,
					render : function(rowdata, rowindex, value) {
						return '<a href="javascript:showEachProtocol(' + 
									rowdata.wms_cre_credit_head_id + 
									');" style="color:#056AFF;text-decoration: none;">' + 
									"查看" + 
								'</a>';
					}
				},
				{
					display : '扫描件',
					name : 'borrow_scanning',
					resizable : false,
					width : 400,
					minWidth : 400,
					render : function(rowdata, rowindex, value) {
						var result = '';
						for (i = 0; i < smjJsonArray.length; i++) {
							if(rowdata.wms_cre_credit_head_id == smjJsonArray[i].wms_cre_credit_head_id) {
								result += '<a  target="_blank"  href="' + global_param.upload_file_url+smjJsonArray[i].attachment_address + '">' + 
								  smjJsonArray[i].attachment_old_name + '</a><br />';
							}
						}
						return result;
					}
				}
			];

			var wms_cre_credit_head_id_arr = [];
			$('.combine_loan_data').each(function(i, o) {
				wms_cre_credit_head_id_arr.push($(o).find('input[name=wms_cre_credit_head_id]').val());
			});
			$.ajax({ 
	            type: "POST", 
	            url: global_param.context_name + "/cremanage/wmscrehousingattwithoutpaginglistforht.do",
	            async: true,
	            dataType: "json",
	            data: {"wms_cre_credit_head_id_arr" : wms_cre_credit_head_id_arr}, 
	            traditional: true,
	            success: function(data) {
	            	smjJsonArray = data.Rows;
	            	
	            	var grid_borrow_data = {};
	    			grid_borrow_data.Rows = function() {
	    				var arr = [];
	    				for(var i = 0; i < wms_cre_credit_head_id_arr.length; i++) {
	    					arr.push({
	    						'borrow_name' : '借款合同',
	    						'borrow_online' : '',
	    						'borrow_scanning' : '',
	    						'wms_cre_credit_head_id' : wms_cre_credit_head_id_arr[i]
	    					});
	    				}
	    				return arr;
	    			}()
	            	
					var grid_borrow = $("#grid-borrow").ligerGrid({
						columns : column2,
						data : grid_borrow_data,
						usePager : false,
						rownumbers : true,
						width : '100%',
						height : 240,
						heightDiff : -4,
						enabledEdit : true
					});
	            }
			});
			
		}

		//打开合同页面
		var showdksq = 1;
		function showEachProtocol(wms_cre_credit_head_id) {
			if (cre_type == '2' && (protocol_type == "" || protocol_type == undefined)) {
				globalUtil.warnMsg(globalErrorMsg['600112']);
				return;
			}
			globalUtil.borrowProtocolInfo(wms_cre_credit_head_id);
		}

		//读取上传文件显示上传文件名称
		function getdictAtt(code, json) {
			var htmlstr = "";
			for (var i = 0; i < json.length; i++) {
				var data = json[i];
				var data_detail_name = data.data_detail_name;
				if (code == data.data_detail_name) {
					if (findPicHZ(data.attachment_type.toLowerCase()) == -1) {
						htmlstr += '<a  target="_blank"  href="' + global_param.upload_file_url+data.attachment_address + '">'
								+ data.attachment_old_name + '</a>';
					} else {
						htmlstr += '<input type="checkbox" id=cb'
								+ data.wms_cre_credit_line_customer_data_attachment_id
								+ ' class="radio3" onclick=onCheckCB('
								+ data.wms_cre_credit_line_customer_data_attachment_id
								+ ') style="width: auto"/>&nbsp;&nbsp;<a target="_blank" href="' + global_param.upload_file_url + data.attachment_address+'">'
								+ data.attachment_old_name + '</a>';
					}
				}
			}
			return htmlstr;
		}

		var dialog_att;
		
		//打开附件上传页面
		function openAddAttDialog(data_type_name, data_detail_name) {
			globalUtil.clearLigerTip("transfer");
			var url = globalUtil.getHtml("../creditManage/addFileForCre.html?data_type_name="
				+ data_type_name
				+ "&data_detail_name="
				+ data_detail_name);
			dialog_att = $.ligerDialog.open({
				url : url,
				title : '上传附件',
				width : 650,
				height : globalUtil.setDialogHeight(250),
				onHiddenOrClose : function() {
					//alert('关闭或隐藏都调用的事件!');
				},
				isResize : false
			});
		}
		
		//上传文件之后显示文件
		function addAttFile(newfileArr, objid) {
			fileArr = fileArr.concat(newfileArr);
			var filehtml = $("#" + objid).html();
			for (var i = 0; i < newfileArr.length; i++) {
				var nnme = newfileArr[i].attachment_new_name.replace('/', 'thxg1');
				nnme = nnme.replace('/', 'thxg2');
				filehtml += '<div id="delUploadDivId'+nnme+'">';
				filehtml += '<a  target="_blank"  href="' + global_param.upload_file_url+newfileArr[i].attachment_address + '">'
						 + newfileArr[i].attachment_old_name + '</a>';
				filehtml += '<img src="../../images/icon/icon-close.gif" onclick="deleteFile(\'' + nnme + '\')"/>';
				filehtml += '</div>';
			}
			$("#" + objid).html(filehtml);
		}
		
		//删除文件
		function deleteFile(filename) {
			$.ligerDialog.confirm(globalErrorMsg['100016'], function(yes) {
				if (yes) {
					$("#delUploadDivId" + filename).remove();
					filename = filename.replace('thxg1', '/');
					filename = filename.replace('thxg2', '/');
					for (var i = 0; i < fileArr.length; i++) {
						if (filename == fileArr[i].attachment_new_name) {
							fileArr.splice(i, 1);
							break;
						}
					}
				}
			});
		}

		var allCreditPicIDs = [];//所有图片Id 从上至下
		//读取上传文件显示上传文件名称
		function getdictAtt(code, json) {
			var htmlstr = "";
			for (var i = 0; i < json.length; i++) {
				var data = json[i];
				var data_detail_name = data.data_detail_name;
				if (code == data.data_detail_name) {
					if (findPicHZ(data.attachment_type.toLowerCase()) == -1) {
						htmlstr += '<a  target="_blank"  href="'+global_param.upload_file_url + data.attachment_address+'">'
								+ data.attachment_old_name + '</a>';
					} else {
						htmlstr += '<input type="checkbox" id=cb'
								+ data.wms_cre_credit_line_customer_data_attachment_id
								+ ' class="radio3" onclick=onCheckCB('
								+ data.wms_cre_credit_line_customer_data_attachment_id
								+ ') style="width: auto"/>&nbsp;&nbsp;<a target="_blank" href="' + global_param.upload_file_url+data.attachment_address + '">'
								+ data.attachment_old_name + '</a>'
					}
					allCreditPicIDs.push(data.wms_cre_credit_line_customer_data_attachment_id);
				}
			}
			return htmlstr;
		}

		var checkedCreditIDs = [];
		function onCheckCB(id) {
			if ($("#cb" + id).is(':checked')) {
				addCheckedCredit(id);
			} else {
				removeCheckedCredit(id);
			}
		}

		// 向checkedCredit中添加id的方法
		function addCheckedCredit(id) {
			if (findCheckedCredit(id) == -1) {
				checkedCreditIDs.push(id);
			}
		};
		
		// 从checkedCredit中移除id的方法
		function removeCheckedCredit(id) {
			var i = findCheckedCredit(id);
			if (i == -1) {
				return;
			}
			checkedCreditIDs.splice(i, 1);
		};

		// 在checkedCredit中查找是否已存在id的方法
		function findCheckedCredit(id) {
			for (var i = 0; i < checkedCreditIDs.length; i++) {
				if (checkedCreditIDs[i] == id) {
					return i;
				}
			}
			return -1;
		};

		var checkedPicNms = ['jpg', 'jpeg', 'bmp', 'png', 'gif'];
		
		//检查是否为图片格式
		function findPicHZ(name) {
			for (var i = 0; i < checkedPicNms.length; i++) {
				if (checkedPicNms[i] == name) {
					return i;
				}
			}
			return -1;
		};
		
		//弹出审批页面
		function sp() {
			if(type == 1 || type == 3) {//放款申请、放款确认
				save();
				return;
			}
			var url = globalUtil.getHtml("houseSpApproval.html?wms_cre_credit_head_id=" + wms_cre_credit_head_id);
			dialog = $.ligerDialog.open({
				url:url,
				title: '审批',
		        width: 870,
		        height: globalUtil.setDialogHeight(600),
		        onHiddenOrClose: function() {
		    	},
		        isResize: false
			});  
		}
		
		//保存
		function save() {
			$('body').startLoading();
			
			if($("input[name='pass']:checked").val() != "true") {
				if(document.getElementById("advice").value == "") {							
					globalUtil.errorMsg("请填写审批意见！"); //提示x
					return;
				}
	    	}
			
			globalUtil.clearLigerTip("transfer");
			var reqVO = globalUtil.getFormParam("transfer");//获取申请信息
			var taskId = $.query.get("taskId");
			reqVO.version_number = version_number;//数据来源
			reqVO.wms_cre_credit_head_id = wms_cre_credit_head_id;
			reqVO.pass = $("input[name='pass']:checked").val();
			reqVO.advice = $('#advice').val();
			for (var i = 0; i < fileArr.length; i++) {
				fileArr[i].date_type = fileArr[i].data_type;
				delete fileArr[i].data_type;
				delete fileArr[i].last_update_timestamp;
				delete fileArr[i].wms_fina_cre_loan_app_att_id;
			}
			reqVO.fileArr = JSON.stringify(fileArr);//附件
			
			//原放款申请id
			var wms_fina_cre_loan_app_arr = [];
			//放款申请信息
			var wms_fina_cre_loan_app_list = [];
			//贷款主表信息
			var wms_cre_credit_head_list = [];
			
			var tmp_obj = {};
			$('.combine_loan_data').each(function(i, o) {
				tmp_obj = {};
				//需要删除的放款申请数据(重新申请的)
				if($(o).find('input[name=wms_fina_cre_loan_app]').val() != '') {
					wms_fina_cre_loan_app_arr.push($(o).find('input[name=wms_fina_cre_loan_app]').val());
				}
				tmp_obj.wms_cre_credit_head_id = $(o).find('input[name=wms_cre_credit_head_id]').val();
				tmp_obj.principal_lower = $(o).find('input[name=principal_lower]').val();
				tmp_obj.refund_limit_month = $(o).find('input[name=refund_limit_month]').val();
				tmp_obj.org_repay_interest = $(o).find('input[name=org_repay_interest]').val();
				tmp_obj.org_repay_principal = $(o).find('input[name=org_repay_principal]').val();
				tmp_obj.deduction_of_interest = $(o).find('input[name=deduction_of_interest]').val();
				tmp_obj.platform_fee = $(o).find('input[name=platform_fee]').val();
				tmp_obj.it_cost_fee = $(o).find('input[name=it_cost_fee]').val();
				tmp_obj.expedited_fee = $(o).find('input[name=expedited_fee]').val();
				tmp_obj.loan_amount = $(o).find('input[name=loan_amount]').val();
				tmp_obj.loan_amount_caps = $(o).find('input[name=loan_amount_caps]').val();
				tmp_obj.remark = $(o).find('[name=remark]').val();
				tmp_obj.house_area = $('#house_area').val();
				tmp_obj.receive_bank = $('#receive_bank').val();
				tmp_obj.bank_of_deposit = $('#bank_of_deposit').val();
				tmp_obj.card_no = $('#card_no').val();
				wms_fina_cre_loan_app_list.push(tmp_obj);
				
				tmp_obj = {};
				tmp_obj.wms_cre_credit_head_id = $(o).find('input[name=wms_cre_credit_head_id]').val();
				tmp_obj.is_workflow = $(o).find('input[name=is_workflow]').val();
				tmp_obj.version_number = $(o).find('input[name=version_number]').val();
				tmp_obj.edition_num = $(o).find('input[name=edition_num]').val();  
				wms_cre_credit_head_list.push(tmp_obj);
			});
			reqVO.wms_fina_cre_loan_app_arr = wms_fina_cre_loan_app_arr;
			reqVO.wms_fina_cre_loan_app_list_json = JSON.stringify(wms_fina_cre_loan_app_list);
			reqVO.wms_cre_credit_head_list_json = JSON.stringify(wms_cre_credit_head_list);

			reqVO.save_type = type;

			$.ajax({ 
	            type: "POST", 
	            url: global_param.context_name + "/loanfina/housingMakeLoansSaveForCobine.do",
	            async: true,
	            dataType: "json",
	            data: reqVO, 
	            traditional: true,
	            success: function(data) {
	            	$('body').stopLoading();
	            	if (data === 'success') {//保存成功
						globalUtil.successMsg(globalErrorMsg['100002'],
							function() {
								window.parent.search();
								closePage();
							}
						);

					} else if (data === 'change') {//单据状态已改变，请重新操作！(并发校验)
						globalUtil.errorMsg(globalErrorMsg['100048'],
							function() {
								window.parent.search();
								closePage();
							}
						);
					} else {
						globalUtil.errorMsg(globalErrorMsg['100012']); //保存失败
					}
	            }
			});
		}
		
		var pre_val = '';
		//计算转账单页面金额实时变化
		$(document).on('keyup', 'input[name=deduction_of_interest],input[name=platform_fee],input[name=it_cost_fee],input[name=expedited_fee]', function(e) {
			var tmp_val = $(this).val();
			if(pre_val != tmp_val) {
				if(tmp_val != '') {
					if(tmp_val.indexOf('.') != -1) {
						var val_arr = tmp_val.split('.');
						$(this).val(val_arr[0].replace(/\D/g, '') + '.' + val_arr[1].replace(/\D/g, ''));
					} else {
						$(this).val(tmp_val.replace(/\D/g, ''));
					}
				}
				setTotalMoney($(this).attr('name'));
			}
		}).on('keydown', 'input[name=deduction_of_interest],input[name=platform_fee],input[name=it_cost_fee],input[name=expedited_fee]', function(e) {
			pre_val = $(this).val();
		});
		
		//计算合计金额
		function setTotalMoney(input_name) {
			var total_money = 0;
			$('input[name=' + input_name + ']').each(function(i, o) {
				if($(this).val() != '') {
					total_money += parseFloat($(this).val());
				}
			});
			$('#' + input_name).val(total_money);
		}
		
		//初始化组合贷信息
		function initCombineLoanInfo() {
			var data = {};
			data.wms_cre_credit_head_id = wms_cre_credit_head_id;
			data.bill_status = bill_status;
			$.ajax({ 
	            type: "POST", 
	            url: global_param.context_name + "/cremanage/initCombineLoanInfo.do",
	            async: false,
	            dataType: "json",
	            data: data, 
	            traditional: true,
	            success: function(data) {
	            	var addHTML = '';
	    			$(data.list).each(function(i, o) {
	    				
	    				$('#protocol_id_year_num').val(o.bill_code_group);//组合贷编号
	    				
	    				addHTML += 
	    				'<div class="combine_loan_data">' +	
	    					'<input type="hidden" name="wms_cre_credit_head_id" value="' + o.wms_cre_credit_head_id + '" />' +
	    					'<input type="hidden" name="wms_fina_cre_loan_app" value="' + o.wms_fina_cre_loan_app + '" />' +
	    					'<input type="hidden" name="is_workflow" value="' + o.is_workflow + '" />' +
	    					'<input type="hidden" name="version_number" value="' + o.version_number + '" />' +
	    					'<input type="hidden" name="edition_num" value="' + o.edition_num + '" />' +
	    					'<div class="float-l clearboth">' +
			    				'<div class="pop-form-title">客户名称：</div>' +
			    				'<div class="pop-form-item">' +
			    					'<input type="text" name="debtor_name" value="' + $('#debtor_name').val() + '" style="width: 150px;" disabled="disabled" />' +
			    				'</div>' +
		    				'</div>' +
		    				'<div class="float-l">' +
			    				'<div class="pop-form-title">身份证号：</div>' +
			    				'<div class="pop-form-item">' +
			    					'<input type="text" name="debtor_identity_id" value="' + $('#debtor_identity_id').val() + '" style="width: 150px;" disabled="disabled" />' +
			    				'</div>' +
		    				'</div>' +
		    				'<div class="float-l">' +
			    				'<div class="pop-form-title">抵押房面积：</div>' +
			    				'<div class="pop-form-item">' +
			    					'<input type="text" name="house_area" value="' + $('#house_area').val() + '" style="width: 134px;" disabled="disabled" />&nbsp;㎡' +
			    				'</div>' +
		    				'</div>' +
		    				'<div class="float-l clearboth">' +
		    					'<div class="pop-form-title">贷款期数：</div>' +
		    					'<div class="pop-form-item">' +
		    						'<input type="text" name="borrow_deadline" value="' + o.borrow_deadline + '" style="width: 150px;" disabled="disabled" />' +
		    					'</div>' +
		    				'</div>' +
		    				'<div class="float-l">' +
		    					'<div class="pop-form-title">还款方式：</div>' +
		    					'<div class="pop-form-item">' +
		    						'<input type="text" name="protocol_type_name" value="' + o.protocol_type_name + '" style="width: 150px;" disabled="disabled" />' +
		    					'</div>' + 
		    				'</div>' +
		    				'<div class="float-l">' +
		    					'<div class="pop-form-title">合同编号：</div>' +
		    					'<div class="pop-form-item">' +
		    						'<input type="text" name="protocol_id_year_num" value="' + o.protocol_id_year_num + '" style="width: 150px;" disabled="disabled" />' +
		    					'</div>' +
		    				'</div>' +
	    					'<div class="float-l clearboth">' +
			    				'<div class="pop-form-title">签单日期：</div>' +
			    				'<div class="pop-form-item">' +
			    					'<input type="text" name="create_date" value="' + o.create_date + '" style="width: 150px;" disabled="disabled" />' +
			    				'</div>' +
		    				'</div>' +
		    				'<div class="float-l">' +
		    					'<div class="pop-form-title">合同金额：</div>' +
		    					'<div class="pop-form-item">' +
		    						'<input type="text" name="principal_lower" value="' + o.principal_lower + '" style="width: 134px;" disabled="disabled" />&nbsp;元' +
		    					'</div>' +
		    				'</div>' +
		    				'<div class="float-l">' +
		    					'<div class="pop-form-title">转款余额：</div>' +
		    					'<div class="pop-form-item">' +
		    						'<input type="text" name="loan_amount" value="' + o.loan_amount + '" style="width: 134px;" disabled="disabled" />&nbsp;元' +
		    					'</div>' +
		    				'</div>' +
		    				'<div class="float-l clearboth">' +
		    					'<div class="pop-form-title">组合贷编号：</div>' +
		    					'<div class="pop-form-item">' +
		    						'<input type="text" name="protocol_id_year_num" value="' + $('#protocol_id_year_num').val() + '" style="width: 150px;" disabled="disabled" />' +
		    					'</div>' +
		    				'</div>' +
		    				'<div class="float-l">' +
		    					'<div class="pop-form-title">大写：</div>' +
		    					'<div class="pop-form-item">' +
		    						'<input type="text" name="principal_caps" value="' + o.principal_caps + '" style="width: 150px;" disabled="disabled" />' +
		    					'</div>' +
		    				'</div>' +
		    				'<div class="float-l">' +
		    					'<div class="pop-form-title">大写：</div>' +
		    					'<div class="pop-form-item">' +
		    						'<input type="text" name="loan_amount_caps" value="' + convertCurrency(o.loan_amount) + '" style="width: 150px;" disabled="disabled" />' +
		    					'</div>' +
		    				'</div>' +
		    				'<div class="float-l clearboth">' +
		    					'<div class="pop-form-title">每月还款：</div>' +
		    					'<div class="pop-form-item">' +
		    						'<input type="text" name="refund_limit_month" value="' + o.refund_limit_month + '" style="width: 134px;" disabled="disabled" />&nbsp;元' +
		    					'</div>' +
		    				'</div>' +
		    				'<div class="float-l">' +
		    					'<div class="pop-form-title">其中利息：</div>' +
		    					'<div class="pop-form-item">' +
		    						'<input type="text" name="org_repay_interest" value="' + o.org_repay_interest + '" style="width: 134px;" disabled="disabled" />&nbsp;元' +
		    					'</div>' +
		    				'</div>' +
		    				'<div class="float-l">' +
		    					'<div class="pop-form-title">本金：</div>' +
		    					'<div class="pop-form-item">' +
		    						'<input type="text" name="org_repay_principal" value="' + o.org_repay_principal + '" style="width: 134px;" disabled="disabled" />&nbsp;元' +
		    					'</div>' +
		    				'</div>' +
// 		    				'<div class="float-l clearboth">' +
// 		    					'<div class="pop-form-title">扣除利息：</div>' +
// 		    					'<div class="pop-form-item">' +
// 		    						'<input type="text" name="deduction_of_interest" value="' + o.deduction_of_interest + '" style="width: 134px;" />&nbsp;元' +
// 		    					'</div>' +
// 		    				'</div>' +
							'<div class="float-l clearboth">' +
		    					'<div class="pop-form-title">他项费：</div>' +
		    					'<div class="pop-form-item">' +
		    						'<input type="text" name="it_cost_fee" value="' + o.it_cost_fee + '" style="width: 134px;" disabled="disabled" />&nbsp;元' +
		    					'</div>' +
		    				'</div>' +
		    				'<div class="float-l">' +
		    					'<div class="pop-form-title">加急费：</div>' +
		    					'<div class="pop-form-item">' +
		    						'<input type="text" name="expedited_fee" value="' + o.expedited_fee + '" style="width: 134px;" disabled="disabled" />&nbsp;元' +
		    					'</div>' +
		    				'</div>' +
		    				'<div class="float-l">' +
		    					'<div class="pop-form-title">平台服务费：</div>' +
		    					'<div class="pop-form-item">' +
		    						'<input type="text" name="platform_fee" value="' + o.platform_fee + '" style="width: 134px;" disabled="disabled" />&nbsp;元' +
		    					'</div>' +
		    				'</div>' +
// 		    				'<div class="float-l">' +
// 		    					'<div class="pop-form-title">平台服务费明细：</div>' +
// 		    					'<div class="pop-form-item">' +
// 		    						'<input type="text" name="fees_detail" value="' + o.fees_detail + '" style="width: 150px;" />' +
// 		    					'</div>' +
// 		    				'</div>' +
// 		    				'<div class="float-l clearboth">' +
// 		    					'<div class="pop-form-title">备注：</div>' +
// 			    				'<div class="pop-form-item" style="height: auto;margin-bottom: 5px;">' +
// 			    					'<textarea name="remark" rows="35" cols="110" style="width: 698px; height: 80px;" maxLen="250">' + o.remark + '</textarea>' +
// 			    				'</div>' +
// 		    				'</div>' +	
		    				'<div class="line clearboth" style="border-top: #ccc 1px solid;"></div>' +
	    				'</div>';
	    			});
	    			$('#combinedLoan').append(addHTML);
	    			setTotalMoney('principal_lower');
	    			setTotalMoney('refund_limit_month');
	    			setTotalMoney('org_repay_interest');
	    			setTotalMoney('org_repay_principal');
	    			setTotalMoney('deduction_of_interest');
	    			setTotalMoney('platform_fee');
	    			setTotalMoney('it_cost_fee');
	    			setTotalMoney('expedited_fee');
	    			setTotalMoney('loan_amount');
	    			$('#loan_amount_caps').val(convertCurrency($('#loan_amount').val()));
	    			$('#principal_caps').val(convertCurrency($('#principal_lower').val()));
	            }
	        });
		}
		
		//实现页面打印页面
	    function doPrint() {
			$('.tab_titleT').hide();
	    	$(".pop-center").attr("class", "pop-center").css('height', 'auto');
	    	document.execCommand("print");
	    	$('.tab_titleT').show();
	    	$(".pop-center").attr("class", "pop-center overflow-au").css('height', '560px');
	    }

		//关闭本页并刷新查询页面
		function refreshAndClosePage() {
			window.parent.location.reload();
			closePage();
		}
		//关闭页面
		function closePage() {
			window.parent.dialog.hide();
		}
		
	</script>
</body>
</html>
