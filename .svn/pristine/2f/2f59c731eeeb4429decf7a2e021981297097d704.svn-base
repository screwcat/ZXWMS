<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>理财管理>审核退回列表>赎回修订</title>
<link href="../../css/app.css" type="text/css" rel="stylesheet" />
<link href="../../css/zx-all.css" rel="stylesheet" type="text/css" />
<script src="../../js/zx-all.js" type="text/javascript"></script>
<style type="text/css">
/*input_tb css*/
.input_tb {
	border: 1px solid #dfdfdf;
	width: 100%;
	margin-bottom: 10px;
}

.input_tb a {
	color: #056aff;
	text-decoration: none;
	font-weight: normal;
}

.input_tb td {
	height: 35px;
	line-height: 25px;
	border-bottom: 1px dashed #d5d5d5;
	padding-top: 3px;
}

.input_tb .tr_title td {
	background-color: #f5f8ff;
	padding-left: 16px;
	font-weight: bold;
	height: 30px;
	line-height: 30px;
	border-bottom: 1px solid #dfdfdf;
}

.input_tb .tr_last td {
	border-bottom: 0;
}

.input_tb .title {
	text-align: right;
}

.input_tb .subtitle {
	text-align: left;
	background-color: #d2e1fd;
	border-top: 1px solid #fff;
	border-left: 1px solid #fff;
}

.input_tb .tr_btn_input td {
	background-color: #fbfbfb;
	/*border-top:1px solid #dbdbdb;*/
	height: 40px;
}

.sqrqkinput {
	width: 190px;
}

.sqrqkdiv { //
	height: 35px;
}
</style>

<script type="text/javascript">		
	var wms_inve_customer_id;//客户表ID
	var wms_inve_transa_id;
	var wms_inve_redeem_id;
	var wms_inve_transa_prod_id;
	var wms_inve_redeem_detail_id;


	var taskId;
	var cxdeptid;//原单据部门ID
	var old_date_of_payment;
	var bill_source;
	var redeem_type_flag;
	var now_date = new Date().format("yyyy-MM-dd");
	var islegal = 1;	//标识位  1代码继续   0代码返回

   	var management_fee = 0; 
	var sum_due_income = 0;	
	var sum_management_fee = 0;	
	var redeem_reality_total_amount = 0;
	var is_over_date = 0;
	
	// 公益
	var days_extend_income = 0;
	var extend_income = 0;
	var extend_income_rate = 0;
	//活期收益
	var days_of_current_income = 0;
	var current_income_rate = 0;
	var current_income = 0;
	// 基本收益信息
	var days_of_basic_income = 0;
	var payable_basic_income = 0;
	var basic_inceom_rate = 0;
	// 奖励收益信息
	var reward_income_rate = 0;
	var payable_reward_income = 0;
	
	var category_interest_pay_method="";
	//赎回详细表增加remark字段 保存赎回说明	
	var remark="";
	//预约赎回状态
	var is_order_redeem = "";
	
	$(function() {	
		wms_inve_redeem_id = $.query.get("wms_inve_redeem_id");
		wms_inve_transa_id=$.query.get('wms_inve_transa_id');
		taskId =  $.query.get("taskId");
		cxdeptid=$.query.get("cxdeptid");
		old_date_of_payment=$.query.get("old_date_of_payment");
		bill_source=$.query.get("bill_source");
		init_redeem_info();
		
	});
	
	//初始化申请数据	
	function init_redeem_info(){
		$.getJSON(globalUtil.getTimestampUrl('/inve/getredeemapplyinfoByPk.do'),
	    		{
	    			"wms_inve_transa_id" : wms_inve_transa_id,
	    			"wms_inve_redeem_id" : wms_inve_redeem_id,
	    			"is_return" : "1"
	    		},
	    		function(json) {
	    			//获取产品支付方式(年付/月付)
	    			category_interest_pay_method = json.redeemApplyInfo[0].category_interest_pay_method;
	    			$('#prompt_date').text(json.prompt_date);
	    			//用于单据编号超链接
	    			wms_inve_transa_prod_id = json.redeemApplyInfo[0].wms_inve_transa_prod_id;	
	    			//赎回基础信息
	    			$('[name=b_name]').val(json.redeemApplyInfo[0].b_name);
	    			$('[name=prot_code]').val(json.redeemApplyInfo[0].bill_code);
	    			$("#prot_code").text(json.redeemApplyInfo[0].bill_code);
	    			$("#financial_bill_code").text(json.redeemApplyInfo[0].financial_bill_code);
	    			$('[name=b_id_card]').val(json.redeemApplyInfo[0].b_id_card);
	    			$('[name=bonus_rate]').val(json.redeemApplyInfo[0].bonus_rate);
	    			$('[name=product_account]').val(parseFloat(json.redeemApplyInfo[0].product_account)/10000);
	    			$('[name=category_name]').val(json.redeemApplyInfo[0].category_name);
	    			$('[name=product_deadline_name]').val(json.redeemApplyInfo[0].product_deadline_name);
	    			$('[name=product_interest]').val(json.redeemApplyInfo[0].product_interest);
	    			$('[name=create_timestamp_str]').val(json.redeemApplyInfo[0].date_of_payment);
	    			$('[name=end_of_date]').val(json.redeemApplyInfo[0].end_of_date);
	    			$('[name=card_no]').val(json.redeemApplyInfo[0].card_no);
	    			$('[name=bank_of_deposit]').val(json.redeemApplyInfo[0].bank_of_deposit+"|"+json.redeemApplyInfo[0].bank_of_deposit_pro+json.redeemApplyInfo[0].bank_of_deposit_city+json.redeemApplyInfo[0].bank_branch);
	    			$('[name=redeem_date]').val(json.redeemDetailInfo[0].redeem_date);
	    			//预约赎回标志
	    			is_order_redeem = json.redeemDetailInfo[0].is_order_redeem;
	    			//活期收益
	    			days_of_current_income = json.redeemDetailInfo[0].days_current_income;
	    			current_income_rate = json.redeemDetailInfo[0].current_income_rate;
	    			current_income = json.redeemDetailInfo[0].current_income;
	    			//初始化赎回申请表
	    			init_redeem_table(json);
	    			
	    			//赎回详细信息
	    			$('[name=management_fee]').val(json.redeemDetailInfo[0].total_management_fee);
	    			$('[name=redeem_company_reason]')[0].value= json.redeemDetailInfo[0].redeem_company_reason;
	    			$("[name='is_take_off_damages'][value="+json.redeemDetailInfo[0].is_take_off_damages+"]").attr("checked",true); 
	    			$('[name=redeem_reason]').val(json.redeemDetailInfo[0].redeem_reason);
	    			$('[name=deduct_money]').val(json.redeemDetailInfo[0].total_deduct_money);
	    			$('[name=deduct_tax_point]').val(json.redeemDetailInfo[0].total_deduct_tax_point);
	    			$('[name=due_income]').val(json.redeemDetailInfo[0].total_due_income);
	    			$('[name=redeem_reality_total_amount]').val(json.redeemDetailInfo[0].redeem_reality_total_amount);
	    			$('[name=redeem_reality_total_amount_upper]').val(json.redeemDetailInfo[0].redeem_reality_total_amount_upper);
	    			$("[name='is_handle_self'][value="+json.redeemDetailInfo[0].is_handle_self+"]").attr("checked",true); 
	    			
	    			//合计
	    			$('[name=sum_redeem_amount]').val(json.redeemDetailInfo[0].redeem_amount/10000);
	    			$('[name=sum_due_basic_income]').val(json.redeemDetailInfo[0].payable_basic_income);
	    			$('[name=sum_due_reward_income]').val(json.redeemDetailInfo[0].payable_reward_income);
	    			$('[name=sum_paid_income]').val(json.redeemDetailInfo[0].paid_income);
	    			$('[name=sum_public_income]').val(json.redeemDetailInfo[0].extend_income);
	    			$('[name=sum_current_income]').val(json.redeemDetailInfo[0].current_income);

	    			wms_inve_transa_prod_id = json.redeemDetailInfo[0].wms_inve_transa_prod_id;
	    			wms_inve_redeem_detail_id = json.redeemDetailInfo[0].wms_inve_redeem_detail_id;
	    			sum_management_fee = json.redeemDetailInfo[0].total_management_fee;
		    		$('[name=sum_management_fee]').val(sum_management_fee);
	    			//初始化单据详情超链接
	    			init_href();
	    			calculateSum(3);
	    		});
    }
	
	//初始化查看单据详情超链接
	function init_href() {
		//单据编号超链接
		var status;
    	$.post(globalUtil.getTimestampUrl('/inve/wmsinvetransadSearchStatus.do'), 
 				{'wms_inve_transa_id': wms_inve_transa_id},
     		function(data) {
     			status = data;
     			if(status == "1" || status == "2" || status == "7" || status == "9" || status == "10"){            	
	    			document.getElementById("prot_code").href="addFinancialManagement.html?wms_inve_transa_id="+wms_inve_transa_id+"&wms_inve_transa_prod_id="+wms_inve_transa_prod_id+"&cktype=ck"
     			}else{
	    			document.getElementById("prot_code").href="addFinancialManagement.html?zftype=zf&wms_inve_transa_id="+wms_inve_transa_id+"&wms_inve_transa_prod_id="+wms_inve_transa_prod_id+"&cktype=ck"
     			}
     		}); 
	}	

	//初始化div结构(单据是否到期)
	function init_redeem_div(flg){
		//flg=0  初始化页面时  需特殊处理赎回事由
		var end_of_date = $('[name=end_of_date]').val();
		var redeem_date = $('[name=redeem_date]').val();
		if(end_of_date != null && end_of_date != ""
		    			&& redeem_date != null && redeem_date != "") {
			//单据到期
			if((old_date_of_payment < '2016-07-01' && end_of_date <= redeem_date) ||
					(old_date_of_payment >= '2016-07-01'&& end_of_date < redeem_date)){
				//到期
				is_over_date = 1;
				$("td[name=is_over_date]").each(function(i){
					 this.style.display = "";	 			 
				});
				$("td[name=isn_over_date]").each(function(i){
					 this.style.display = "none";	 			 
				}); 
								
				//获取到期日期+一个月后的日期
				var end_Date = globalUtil.getNextMonth(end_of_date);
				//到期日+一个月
				var end_Date1 = end_Date;
				end_Date = new Date(end_Date);
				end_Date.setDate(end_Date.getDate()+1);
				//到期日+一个月+一天(2016-7-1之后赎回日无收益 计算活期需要加1天)
				var end_Date2 = end_Date.format('yyyy-MM-dd');
				//赎回日期大于到期日期+一个月 显示活期收益
				if(old_date_of_payment < '2016-07-01' && end_Date1 < redeem_date){
					//初始化活期收益列
					init_current_td(1);
				}else if(old_date_of_payment >= '2016-07-01'&& end_Date2 < redeem_date){
					//初始化活期收益列
					init_current_td(1);
				}else{
					init_current_td(0);
					$("#income_tip").html("合计收益(H)：<br/>(B1+B2)+E-C");
				}
							
				$("#real_income_tip").html("实际回收（小写）：<br/>A+H-D-G");
				$("#title_tip").html("出借人债权转让申请表（到期/超期）");
				//$("#deduct_money_tip").html("其他扣款(F)：");
				$("#tax_point_tip").html("税点(G)：");
				//$("#damages_tip")[0].style.display="none";
				$("#management_fee_tip")[0].style.display="";

				$('[name=redeem_company_reason]')[0].options[3].selected = 'selected';
				$('[name=redeem_company_reason]')[0].options[1].style.display = "none";
				$('[name=redeem_company_reason]')[0].options[2].style.display = "none";
				$('[name=redeem_company_reason]')[0].options[0].style.display = "none";

			}else{
				//未到期
				is_over_date = 0;
				 $("td[name=is_over_date]").each(function(i){
					 this.style.display = "none";	 			 
				}); 
				$("td[name=isn_over_date]").each(function(i){
					 this.style.display = "";	 			 
				});
				//隐藏活期收益列
				init_current_td(0);
				$("#real_income_tip").html("实际回收（小写）：<br/>A+G-D-F");
				$("#income_tip").html("合计收益(G)：<br/>(B1+B2)-C");
				$("#title_tip").html("出借人债权转让申请表（未到期）");
				//$("#deduct_money_tip").html("其他扣款(E)：");
				$("#tax_point_tip").html("税点(F)：");
				//$("#damages_tip")[0].style.display="";
				$("#management_fee_tip")[0].style.display="none";
				
				$('[name=redeem_company_reason]')[0].options[1].style.display = "";
				$('[name=redeem_company_reason]')[0].options[2].style.display = "";
				if(flg!=0){
					$('[name=redeem_company_reason]')[0].options[0].selected = 'selected';
				}
				$('[name=redeem_company_reason]')[0].options[3].style.display = "";	
				var redeem_company_reason = $("select[name='redeem_company_reason'] option:selected").val();
				changeReason(redeem_company_reason);
			}

		} 
	}
	
	
	//初始化赎回申请表
	function init_redeem_table(json){	
		var redeemTr = "";
		for (var i = 0; i < json.redeemPrincipalDetailInfo.length; i++) {
			redeemTr = "";
			redeemTr+="<tr><td width='120px' style='text-align:center;'>"
						+"	<select name='principal_type' style='width: 120px;border:0;' disabled='disabled'>"
						+"		<option value='1'>本金收益全打</option>"
			            +"		<option value='2'>只打收益不打本金</option>"
			            +"	</select>"									
						+"</td>"
						+"<td width='120px' style='text-align:center;' >"
						+"	<input type='text' name='sub_redeem_amount' style='width:120px; border:0px;color:#FF0000;text-align:center' value='"+json.redeemPrincipalDetailInfo[i].principal_amount/10000+"' onchange='calculateIncomeManageFee(this)'/>"
						+"</td>"
						+"<td width='120px' style='text-align:center;' >"
						+"	<input type='text' name='sub_due_basic_income' style='width:120px; border:0px;color:#FF0000;text-align:center' value='"+json.redeemPrincipalDetailInfo[i].income_amount+"' onchange='calculateSum(3)'/>"
						+"</td>"
						+"<td width='120px' style='text-align:center;' >"
						+"	<input type='text' name='sub_due_reward_income' style='width:120px; border:0px;color:#FF0000;text-align:center' value='"+(json.redeemPrincipalDetailInfo[i].reward_income!=undefined?json.redeemPrincipalDetailInfo[i].reward_income:0)+"' onchange='calculateSum(3)'/>"
						+"</td>"																													
						+"<td width='120px' style='text-align:center;' >"
						+"	<input type='text' name='sub_paid_income' style='width:120px; border:0px;color:#FF0000;text-align:center' value='"+json.redeemPrincipalDetailInfo[i].paid_income_amount+"' onchange='calculateSum(3)'/>"
						+"</td>"
						+"<td name='is_over_date' width='120px' style='text-align:center;' >"
						+"	<input type='text' name='sub_public_income' style='width:120px; border:0px;color:#FF0000;text-align:center' value='"+json.redeemPrincipalDetailInfo[i].extend_amount+"' onchange='calculateSum(3)'/>"
						+"</td>"
						+"<td name='is_current' width='120px' style='text-align:center;' >"
						+"	<input type='text' name='sub_current_income' style='width:120px; border:0px;color:#FF0000;text-align:center' value='"+json.redeemPrincipalDetailInfo[i].current_income+"' onchange='calculateSum(3)'/>"
						+"</td>"
						+"<td name='isn_over_date' width='120px' style='text-align:center;'>"
						+"	<input type='text' name='sub_management_fee' style='width:120px; border:0px;color:#FF0000;text-align:center' value='"+json.redeemPrincipalDetailInfo[i].total_management_fee+"' onchange='calculateSum(4)'/>"
						+"</td>"
						if(i==0){
							redeemTr+="<td width='80px' style='text-align:center;' onclick='onAddTR(this);'>"
							+"	<a href='javascript:void(0);' style='color:#004DA9; font-size:12px;'>新增</a>"
							+"</td>";
						}else{
							redeemTr+="<td width='80px' style='text-align:center;' onclick='onDelTR(this);'>"
							+"	<a href='javascript:void(0)' style='color:#FF0000; font-size:12px;'>删除</a>"
							+"</td>";
						}					
						redeemTr+="</tr>";
			$("#redeem_table tr:eq("+(i)+")").after(redeemTr);		
			$('[name=principal_type]')[i].value = json.redeemPrincipalDetailInfo[i].principal_type;	
		}
		init_redeem_div(0);
	}
	
	//初始化活期收益td
	function init_current_td(flag){
		//处于活期标识为1  设置活期td为显示
		if(flag == "1"||current_income>0){
			$("td[name=is_current]").each(function(i){
				 this.style.display = "";	 			 
			});
			$("#current_notice").html("注：当前执行的央行活期利率为"+current_income_rate+"%，持有活期天数为"+days_of_current_income+"天。");
			$("#income_tip").html("合计收益(H)：<br/>(B1+B2)+E+I-C");
		}else{
			//处于活期列设置为不显示
			$("td[name=is_current]").each(function(i){
				 this.style.display = "none";	 			 
			}); 
			$("#current_notice").html("");
		}		
	}
	
	//关闭对话框
	function closeDialog() {
		try{
 			window.parent.dialog.hide();
 		}catch(e){
 			globalUtil.closeCurrentTab();
 		}
	}	
	//关闭本页并刷新查询页面
    function refreshAndClosePage(){   
    	window.parent.search();
    	window.parent.dialog.hide();
    }

	
	/**
	 * 保存
	 */
	function save(){
		var paramJson = {};
		
		//提交标识位
		if(islegal == 0){
			return;
		}
		
		var redeem_date = $('[name=redeem_date]').val();		
		var end_of_date = $('[name=end_of_date]').val();
		//理财到期 全部赎回
		if(end_of_date != null && end_of_date != "" && redeem_date != null && redeem_date != "") {
			if(end_of_date <= redeem_date && parseInt($("[name=sum_redeem_amount]").val()) < parseInt($('[name=product_account]').val())) {    			
				 globalUtil.errorMsg(globalErrorMsg['901129']); 	//理财到期请赎回全部金额！
				 return;
			}
		} 
		
		if($("select[name='redeem_company_reason'] option:selected").val() == 0){
			globalUtil.warnMsg('赎回事由不能为空')
			return false;
		}
		
		var redeemGridData = getRedeemGridData();//赎回申请表
		
		if(redeemGridData=="error"){
			return;
		}
		paramJson.redeemGridData = redeemGridData;
		
		//赎回本金合计
		if(!checkInt($('[name=sum_redeem_amount]').val())){		
			globalUtil.warnMsg('赎回本金合计必须是大于等于0的整数！')
			return false;
		}

		//应得收益合计
		if(!checkFloat($('[name=sum_due_basic_income]').val())){	
			globalUtil.warnMsg('应得基本收益合计必须是大于等于0的小数或整数！')
			return false;
		}

		//应得收益合计
		if(!checkFloat($('[name=sum_due_reward_income]').val())){	
			globalUtil.warnMsg('应得奖励收益合计必须是大于等于0的小数或整数！')
			return false;
		}
		//已付收益合计
		if(!checkFloat($('[name=sum_paid_income]').val())){	
			globalUtil.warnMsg('已付收益合计必须是大于等于0的小数或整数！！')
			return false;
		}

		//已付收益合计
		if(!checkFloat($('[name=sum_public_income]').val())){	
			globalUtil.warnMsg('公益收益合计必须是大于等于0的小数或整数！！')
			return false;
		}
		
		//活期收益合计
		if(!checkFloat($('[name=sum_current_income]').val())){	
			globalUtil.warnMsg('活期收益合计必须是大于等于0的小数或整数！')
			return false;
		}
		
		//管理费
		if(!globalUtil.isFloat($('[name=management_fee]').val())){
			globalUtil.warnMsg('请正确填写管理费')
			return;
		}
		
		//税点		
		if(!globalUtil.isFloat($('[name=deduct_tax_point]').val())){
			globalUtil.warnMsg(globalErrorMsg['900134']);
			return;
		}
		//赎回事由
		if(document.getElementsByName("redeem_reason")[0].value == '' || $("textarea[name=redeem_reason]").val().trim()==''){
            globalUtil.errorMsg(globalErrorMsg['800506']);
            return;
        }
		
		//合计
		paramJson.redeem_amount = $('[name=sum_redeem_amount]').val()*10000;
		paramJson.payable_basic_income = $('[name=sum_due_basic_income]').val();
		paramJson.payable_reward_income = $('[name=sum_due_reward_income]').val();
		paramJson.paid_income = $('[name=sum_paid_income]').val();
		paramJson.extend_income = $('[name=sum_public_income]').val();
		paramJson.current_income = $('[name=sum_current_income]').val();
		
		//赎回事由
		paramJson.redeem_company_reason =$("select[name='redeem_company_reason'] option:selected").val();	
		
		//根据管理费金额判断是否收取
		if($('[name=management_fee]').val()>0){
			paramJson.is_take_off_damages = "1";
		}else{
			paramJson.is_take_off_damages = "0";
		}	
		//管理费
		paramJson.management_fee = $('[name=management_fee]').val();
		//赎回事由补充
		paramJson.redeem_reason = document.getElementsByName("redeem_reason")[0].value;
		//税点
		paramJson.deduct_tax_point = $('[name=deduct_tax_point]').val();						
		//合计收益					
		paramJson.total_due_income = $('[name=due_income]').val();						
		//实际回收			
		paramJson.redeem_reality_total_amount = $('[name=redeem_reality_total_amount]').val();	
		//大写
		paramJson.redeem_reality_total_amount_upper = $('[name=redeem_reality_total_amount_upper]').val();		
		//全部赎回
		var l = $('[name=product_account]').val()-$('[name=sum_redeem_amount]').val();
		paramJson.is_fully_redeemed = l==0?1:0;
		
		//到期时间
		paramJson.end_of_date_org = end_of_date;
		//赎回日期
		paramJson.redeem_date = redeem_date;
		
		paramJson.wms_inve_customer_id = wms_inve_customer_id;
		paramJson.wms_inve_transa_id = wms_inve_transa_id;
		paramJson.wms_inve_redeem_id = wms_inve_redeem_id;
		paramJson.wms_inve_transa_prod_id = wms_inve_transa_prod_id;
		paramJson.wms_inve_redeem_detail_id = wms_inve_redeem_detail_id;
		paramJson.taskId = taskId;
		paramJson.cxdeptid = cxdeptid;
		
		paramJson.cus_name = $('[name=b_name]').val();
		paramJson.category_name = $('[name=category_name]').val();
		paramJson.product_account = $('[name=product_account]').val()*10000;
		paramJson.redeem_product_interest = $('[name=product_interest]').val();
		paramJson.protocol_create_timestamp = $('[name=protocol_create_timestamp]').val();
		
		//公益收益信息
		paramJson.days_extend_income = days_extend_income;
		paramJson.extend_income_rate = extend_income_rate;
		//活期收益信息
		paramJson.days_current_income = days_of_current_income; 
		paramJson.current_income_rate = current_income_rate;
		// 基本收益信息
		paramJson.days_of_basic_income = days_of_basic_income;
		paramJson.basic_inceom_rate = basic_inceom_rate;
		// 奖励收益信息
		paramJson.reward_income_rate = reward_income_rate;
		//预约赎回状态
		paramJson.is_order_redeem = is_order_redeem;
		//赎回明细表备注(当奖励收益大于0,不拼接奖励利率)
		var remark_end="";
		var remark_date = redeem_date.substring(0,4)+"年"+redeem_date.substring(5,7)+"月";
		//说明remark是请求后台之后查回来的
		if($.trim(remark)!=""){
			if($('[name=sum_due_reward_income]').val()!=0){
				remark_end = remark.split(",")[0]+","+remark_date+"应付奖励收益"+$('[name=sum_due_reward_income]').val()+"元";
			}else{
				remark_end = remark.split(",")[0];
			}
		}else{
			//改变应付奖励收益拼接remark(并未请求后台做计算)
			//1月付  2年付
			if(category_interest_pay_method==1){
				remark_end = remark_date+"月客户正常收益";
			}else if(category_interest_pay_method==2){
				remark_end = remark_date+$('[name=category_name]').val()+"收益";
			}			
			if($('[name=sum_due_reward_income]').val()!=0){
				remark_end = remark_end+","+remark_date+"应付奖励收益"+$('[name=sum_due_reward_income]').val()+"元";
			}
		}
		
		paramJson.remark = remark_end;
		//隐藏提交按钮
		$("#tjbtn").css("display","none");
		$.post(globalUtil.getTimestampUrl("/inve/updateWmsInveRedeem.do"), paramJson,
		        function(data) {
		        	if (data === 'success') {
		            	 globalUtil.successMsg(globalErrorMsg['100002'],
		            			function(){            		 		
		                		refreshAndClosePage();
		            	 });//保存成功		            	 
		            }else if (data === 'dateerror') {
		            	  globalUtil.errorMsg(globalErrorMsg['800517']);
		            }else {
		                globalUtil.errorMsg(globalErrorMsg['100012']); //保存失败
		            }
		        	islegal = 1;
		});	
	}

	
	//验证正整数
	 function valiInt(ele){
	 	var val = $(ele).val();
	 	if(val!='' && !(globalUtil.isNum(val))){
	 		errorMsg(globalErrorMsg['400106'],ele);
	 	}
	 }
	
	//验证正小数
	function checkFloat(val){
		if(val!='' && !(globalUtil.isFloat(val) || (globalUtil.isNum(val.substring(0,val.length-2))||val.substring(0,val.length-2)==0) && val.substring(val.length-1)=='.')){
			return false;
	 	}
		return true;
	}
	
	function checkInt(val){
		var res = /^(-?((0|[1-9]+)|([1-9]\d*)))?$/.test(val)
		if (val!='' && !res) {
			return false;
       }
		return true;
	}
	
	//验证赎回时间
		function valiDate2 (){
			var create_date = $('.class_apply:last').find('[name=protocol_create_timestamp]').val();
			var redeem_date = $('.class_apply:last').find('[name=redeem_date]').val();
			if(create_date != null && create_date != ""
			    			&& redeem_date != null && redeem_date != "") {
				if(create_date > redeem_date) {    			
					globalUtil.warnMsg("赎回时间不能早于购买时间");
					$('.class_apply:last').find('[name=redeem_date]').val("");
					islegal = 2;
				}
			} 
		}
	
	//弹出错误提示框
	function errorMsg(msg,ele){
		globalUtil.addMask('1');
		var obj = $.ligerDialog.error(msg, null, null);
		obj.options.onHiddenOrClose = function() {
			$(ele).val('');
			$(ele).focus();
			globalUtil.delMask('1');
	    };
	}
	
	function isPositiveNum(s){//是否为正整数 
		 var re = /^[0-9]*[1-9][0-9]*$/ ; 
		  return re.test(s) 
	} 
	 
	//计算管理费和应得收益
	var redeem_amount;
	function calculateIncomeManageFee(ele){	
			//非选择赎回事由时需要初始化页面（到期/未到期）
			if(ele!="changeReason"){
				init_redeem_div();
			}
			//重复提交 直接 返回
			if(islegal == 0){
				return;
			}
			
			valiDate2();
			if(islegal == 2){
				islegal = 1;
				return;
			}
			
			var redeem_date = $('[name=redeem_date]').val();
			
			var end_of_date = $('[name=end_of_date]').val();
			
			var redeem_amount_grid = getReedemAmountGridData();
			if($.trim(redeem_amount_grid)=="error"){
	        	islegal = 1;
				return;
			}

			if(""==$.trim(redeem_amount_grid) || "" == $.trim(redeem_date)){
				return;
			}
	 		
			if(sum_redeem_amount-$('[name=product_account]').val() > 0){
				if(ele!=undefined){
					ele.value="";
				}
			 	globalUtil.errorMsg(globalErrorMsg['800503']); //赎回金额不能大于投资金额
			 	calculateSum(1);
			 	return;
			}
				
			//设置标志位  
			 islegal = 0;
			//初始化实际回收金额
			 redeem_reality_total_amount = 0;
			
			 $.getJSON(globalUtil.getTimestampUrl('/inve/checkRedeemDate.do'),
			    		{
			    			"redeem_date" : redeem_date
			    		},
			    		function(json) {
			    			if (json === 'dateerror') {
				            	globalUtil.errorMsg(globalErrorMsg['800517']);
				          		$('[name=redeem_date]').val("");
				          		$('[name=management_fee]').val("");			         		 
				          		$('[name=due_income]').val("");
				            	islegal = 1;
				            	return;
				            }else{
				      		  $.getJSON(globalUtil.getTimestampUrl('/inve/getRedeemDueIncome.do'),
				      		    		{
				      		    			"wms_inve_transa_id" : wms_inve_transa_id,
				      		    			"old_date_of_payment": old_date_of_payment,
				      		    			"redeem_amount_grid" : redeem_amount_grid,
				      		    			"redeem_date_str" : redeem_date,
				      		    			"category_name" : $.trim($('[name=category_name]').val()),
				      		    			"bill_source":bill_source
				      		    		},
				      		    		function(json) {
				      		    			for(var i=0 ;i< json.protocolInfo[0].listgridVal.length; i++){
					      		    			$("[name=sub_redeem_amount]:eq("+i+")").val(json.protocolInfo[0].listgridVal[i].principal_amount);
					      		    			$("[name=sub_due_basic_income]:eq("+i+")").val(json.protocolInfo[0].listgridVal[i].payable_basic_income);
					      		    			$("[name=sub_due_reward_income]:eq("+i+")").val(json.protocolInfo[0].listgridVal[i].payable_reward_income);
					      		    			$("[name=sub_public_income]:eq("+i+")").val(json.protocolInfo[0].listgridVal[i].public_amount);
					      		    			$("[name=sub_current_income]:eq("+i+")").val(json.protocolInfo[0].listgridVal[i].current_income);
					      		    			//管理费
					      		    			sub_management_fee = parseFloat(json.protocolInfo[0].listgridVal[i].management_fee!=undefined?json.protocolInfo[0].listgridVal[i].management_fee:0);
					      		    			
					      		    			$("[name=sub_management_fee]:eq("+i+")").val(sub_management_fee);
					      		    			sum_management_fee += sub_management_fee;
				      		    			}
				      		    			var obj = json.protocolInfo[0];
				      		    			
				      		    			is_order_redeem = obj.is_order_redeem;
				      		    			//公益收益信息			      		    			
				      		    			days_extend_income = obj.days_extend_income;
				      		    			//公益利率
				      		    			extend_income_rate = obj.extend_income_rate;
				      		    			//活期收益信息
				      		    			days_of_current_income = obj.days_of_current_income;
				      		    			current_income_rate = obj.current_income_rate;
				      		    			// 基本收益信息
				      		    			days_of_basic_income = obj.days_of_basic_income;
				      		    			
				      		    			//基本利率
				      		    			basic_inceom_rate = obj.basic_inceom_rate;
				      		    			// 奖励收益信息
				      		    			reward_income_rate = obj.reward_income_rate;
				      		    			//赎回说明(赎回明细表中新增)
				      		    			remark = obj.remark;
				      		    			//计算合计
				      		    			calculateSum(1);
				      		    			
				      		    			//赎回事由
			      	    					var redeem_company_reason = $("select[name='redeem_company_reason'] option:selected").val();		
			      	    					if(redeem_company_reason != '1'){
					      	    				$('[name=management_fee]').val(sum_management_fee);
											}
			      	    							      	    					
			      	    					islegal = 1;
			      	    					//非选择赎回事由时需要初始化页面（到期/未到期）
			      	    					if(ele!="changeReason"){
			      	    						init_redeem_div();
			      	    					}
				      		    		});	 
				      		 
				            }
			  });		    			
			
		 }
		
		
		
		//计算资金回收 合计 

		function calculateSum(flg){
			//flg=1  需要重新初始化管理费	
			//flg=3 (说明改变的是赎回信息表   基本收益/奖励收益/公益收益td  管理费不初始化)
			var sum_redeem_amount = 0;			//合计
			sum_due_income = 0;	
			
			var sum_due_basic_income = 0;	
			var sum_due_reward_income = 0;	

			var sum_paid_income = 0;	
			var sum_public_income = 0;
			var sum_current_income = 0;
			//修改赎回事由 或者收取服务费之外 清除管理费变量
			if(flg!=2 && flg!=3 && flg!= undefined){
				sum_management_fee = 0;
			}
			redeem_reality_total_amount=0;

			$("input[name=sub_redeem_amount]").each(function(i){
				var val = this.value;
				if($.trim(val)!=""){
					sum_redeem_amount += parseFloat(val);
				}else{
					//所在行赎回金额为空  清空所在行input
					var trId = $(this).parent().parent().index();
					 $("#redeem_table tr:eq("+trId+")").find("input").each(function (index, domEle){				    		
					    $(domEle).val("");				    	
					}); 
				}			 			 
			}); 
			
			$("[name=sum_redeem_amount]").val(sum_redeem_amount.toFixed(2));
						
			$("input[name=sub_due_basic_income]").each(function(i){
				var val = this.value;
				if($.trim(val)!=""){
					sum_due_basic_income += parseFloat(val);
				}		 			 
			}); 
			$("[name=sum_due_basic_income]").val(sum_due_basic_income.toFixed(2));
			
			$("input[name=sub_due_reward_income]").each(function(i){
				var val = this.value;
				if($.trim(val)!=""){
					sum_due_reward_income += parseFloat(val);
				}		 			 
			}); 
			$("[name=sum_due_reward_income]").val(sum_due_reward_income.toFixed(2));
			
			$("input[name=sub_paid_income]").each(function(i){
				var val = this.value;
				if($.trim(val)!=""){
					sum_paid_income += parseFloat(val);		 			 
				}
			}); 
			$("[name=sum_paid_income]").val(sum_paid_income.toFixed(2));
			
			//公益收益
			$("input[name=sub_public_income]").each(function(i){
				var val = this.value;
				if($.trim(val)!=""){
					sum_public_income += parseFloat(val);		 			 
				}
			}); 
			
			$("[name=sum_public_income]").val(sum_public_income.toFixed(2));
			
			//活期收益
			$("input[name=sub_current_income]").each(function(i){
				var val = this.value;
				if($.trim(val)!=""){
					sum_current_income += parseFloat(val);		 			 
				}
			}); 
			
			$("[name=sum_current_income]").val(sum_current_income.toFixed(2));
			current_income = sum_current_income.toFixed(2);
			//管理费
			if(flg==1||flg==4){
				$("input[name=sub_management_fee]").each(function(i){
					var val = this.value;
					if($.trim(val)!=""){
						sum_management_fee += parseFloat(val);		 			 
					}
				}); 

				if($("select[name='redeem_company_reason'] option:selected").val()==2){
					$("[name=management_fee]").val(sum_management_fee.toFixed(2));
					$("[name=sum_management_fee]").val(sum_management_fee.toFixed(2));
				}else{
					$("[name=management_fee]").val(0);
					$("[name=sum_management_fee]").val(0);
					//sub管理费清0(赎回事由非个人原因)
					$("[name=sub_management_fee]").val(0);
				}			
			}

			if(is_over_date==1){
				//合计收益
				$('[name=due_income]').val((parseFloat($('[name=sum_due_basic_income]').val())+parseFloat($('[name=sum_due_reward_income]').val())+parseFloat($('[name=sum_public_income]').val())+parseFloat($('[name=sum_current_income]').val())-parseFloat($('[name=sum_paid_income]').val())).toFixed(2));
			}else{
				//合计收益
				$('[name=due_income]').val((parseFloat($('[name=sum_due_basic_income]').val())+parseFloat($('[name=sum_due_reward_income]').val())-parseFloat($('[name=sum_paid_income]').val())).toFixed(2));		
			}
			
			//实际回收
			$("input[name=sub_redeem_amount]").each(function(i){
				if($("[name=principal_type]:eq("+i+")").val()==1&&this.value!=""){
					redeem_reality_total_amount+=parseFloat(this.value)*10000;
				}														
			});	
			
			$('[name=redeem_reality_total_amount]').val((redeem_reality_total_amount+parseFloat($('[name=due_income]').val()!=""? $('[name=due_income]').val():0)
						-parseFloat($('[name=management_fee]').val()!=""?$('[name=management_fee]').val():0)
						-parseFloat($('[name=deduct_tax_point]').val()!=""?$('[name=deduct_tax_point]').val():0)).toFixed(2));

			//人民币转大写
			//人民币转大写
			if($('[name=redeem_reality_total_amount]').val().substr(0, 1)=="-"){
				$('[name=redeem_reality_total_amount_upper]').val("负"+globalUtil.convertCurrency($('[name=redeem_reality_total_amount]').val()
																										.substr(1, $('[name=redeem_reality_total_amount]').val().length)));
			}else{
				$('[name=redeem_reality_total_amount_upper]').val(globalUtil.convertCurrency($('[name=redeem_reality_total_amount]').val()));
			}					
		}
		
		//获取资金回收表格回收本金，去除空行 
		function getReedemAmountGridData(){
			var dataJson="";  
		    var redeem_amount = ""; 
		    sum_redeem_amount=0;
			$("input[name=sub_redeem_amount]").each(function(i){
				var redeem_amount = this.value;
				//校验是否为整数或者是小数
				if($.trim(redeem_amount)=="" || !(isPositiveNum(redeem_amount))){
				 	this.value = "";
					globalUtil.errorMsg("赎回本金项必须为大于0的整数");
					$(this).parent().parent().find("input").val("");
					calculateSum(1);
					dataJson = "error";
				 	return false;
				}else if(!$.trim(redeem_amount)==""){
					sum_redeem_amount+=parseFloat(redeem_amount);
					dataJson += "{"+"\"principal_amount\":\""+redeem_amount+"\"},";      	 
				}					 
			}); 
		    
		    if($.trim(dataJson)==""){
		    	dataJson = "";
		    	return dataJson;
		    }
		    if($.trim(dataJson)=="error"){
		    	return dataJson;
		    }
			if (dataJson.lastIndexOf(",")) { 
		        dataJson = dataJson.substring(0,dataJson.length -1);  
		        dataJson ="["+dataJson+"]";  
		    }
			
			return dataJson;
		}

		
		//获取资金回收表格信息，去除空行 
		function getRedeemGridData(){
			var dataJson="";  
		 
		    var principal_type = "";
		    var principal_amount = "";  
		    var basic_income_amount = "";  
		    var reward_income_amount = "";  
		    var paid_income_amount = "";  
		    var extend_amount = "";  
		    var current_income = "";
		    var sub_management_fee = ""

		    $("#redeem_table tr:not(:first):not(:last)").each(function (index, domEle){	
	    		
		    	principal_type = $(domEle).find('[name=principal_type]').val();
		    	$(domEle).find("input").each(function(index,data){
			    	if(index == 0){
			    		principal_amount = $(data).val()*10000;  
			    	}else if(index == 1){  
			    		basic_income_amount = $(data).val()!=""?$(data).val():0;  
			       	}else if(index == 2){  
			       		reward_income_amount = $(data).val()!=""?$(data).val():0;  
			       	}else if(index == 3){
			       		paid_income_amount = $(data).val()!=""?$(data).val():0;  
			       	}else if(index == 4){
			       		extend_amount = $(data).val()!=""?$(data).val():0;  			  
			    	}else if(index == 5){
			       		current_income = $(data).val()!=""?$(data).val():0;  
			       	}else if(index == 6){
			       		sub_management_fee = $(data).val()!=""?$(data).val():0;  
			       	}
			   	}); 
		    	 
				//去重复行 
				if(!$.trim(principal_amount)==""){
					//校验是否为整数
					if(!(isPositiveNum(principal_amount))){
						globalUtil.errorMsg(globalErrorMsg['400106']);
			 			dataJson = "error";
					 	return dataJson; 
					}
					
					//应得基本收益可以是小数
					if(!checkFloat(basic_income_amount)){					
						globalUtil.warnMsg('应得基本收益必须是大于等于0的小数或整数！！')
						dataJson = "error";
					 	return dataJson;
					}
					//应得奖励收益可以是小数
					if(!checkFloat(reward_income_amount)){					
						globalUtil.warnMsg('应得奖励收益必须是大于等于0的小数或整数！！')
						dataJson = "error";
					 	return dataJson;
					}
					
					//已付收益可以是小数
					if(!checkFloat(paid_income_amount)){					
						globalUtil.warnMsg('应得收益必须是大于等于0的小数或整数！！')
						dataJson = "error";
					 	return dataJson;
					}
					
					//公益收益可以是小数
					if(!checkFloat(extend_amount)){					
						globalUtil.warnMsg('公益收益必须是大于等于0的小数或整数！！')
						dataJson = "error";
					 	return dataJson;
					}
					
					//活期收益可以是小数
					if(!checkFloat(current_income)){					
						globalUtil.warnMsg('活期收益必须是大于等于0的小数或整数！！')
						dataJson = "error";
					 	return dataJson;
					}						
					dataJson += "{"+"\"principal_type\":\""+principal_type+"\","+"\"principal_amount\":\""+principal_amount+"\","+"\"income_amount\":\""+basic_income_amount+"\","+"\"reward_income\":\""+reward_income_amount+"\","+"\"paid_income_amount\":\""+paid_income_amount+"\","+"\"extend_amount\":\""+extend_amount+"\","+"\"current_income\":\""+current_income+"\","+"\"total_management_fee\":\""+sub_management_fee+"\"},";               
				}  
		    }); 
		    
		    if($.trim(dataJson)==""){
		    	dataJson = "";
		    	return dataJson;
		    }
		    if($.trim(dataJson)=="error"){
		    	return dataJson;
		    }
			if (dataJson.lastIndexOf(",")) { 
		        dataJson = dataJson.substring(0,dataJson.length -1);  
		        dataJson ="["+dataJson+"]";  
		    }	
			return dataJson;
		
		}
	
	 function changeReason(val){		
			if(val == '1' || val == '3'){
				$('[name=management_fee]').val(0);
				//管理费sum清0
				$('[name=sum_management_fee]').val(0);
			}else if(val == '2'){
				$('[name=management_fee]').val(sum_management_fee);
				$('[name=sum_management_fee]').val(sum_management_fee);
			}else{
				$('[name=management_fee]').val(0);
				$('[name=sum_management_fee]').val(0);
			}
			calculateSum(2);
	}
	 
	function changeFeeDefault(){
		$('[name=management_fee]').val(sum_management_fee);
		calculateSum(2);
	}
	
	function changeFee(){
		$('[name=management_fee]').val(0);
		calculateSum(2);
	}
	
	//动态添加产品限制信息行
	function onAddTR(trObj)
	{	
		var targetTable = $(trObj).parent().parent();
		var trLen =  targetTable.find("tr").length;
		targetTable.find("tr:eq("+(trLen-2)+")").after("<tr><td width='120px' style='text-align:center;'>"+
																"<select name='principal_type' style='width: 120px;border:0;' onchange='calculateSum()'>"+
								                                "<option value='1'>本金收益全打</option>     	"+
								                                "<option value='2'>只打收益不打本金</option> 		"+
																"</select></td>"+
															"<td width='120px' style='text-align:center;'>"+
																"<input type='text' name='sub_redeem_amount' style='width:120px; border:0px;color:#FF0000;text-align:center' onchange='calculateIncomeManageFee(this)'/></td>"+
																"<td width='120px' style='text-align:center;'>"+
																"<input type='text' name='sub_due_basic_income' style='width:120px; border:0px;color:#FF0000;text-align:center'onchange='calculateSum(3)'/></td>"+
															"<td width='120px' style='text-align:center;'>"+
																"<input type='text' name='sub_due_reward_income' style='width:120px; border:0px;color:#FF0000;text-align:center'onchange='calculateSum(3)'/></td>"+
															"<td width='120px' style='text-align:center;'>"+
																"<input type='text' name='sub_paid_income' style='width:120px; border:0px;color:#FF0000;text-align:center' onchange='calculateSum(3)'/></td>"+
															"<td name='is_over_date' width='120px' style='text-align:center;'>"+
																"<input type='text' name='sub_public_income' style='width:120px; border:0px;color:#FF0000;text-align:center' onchange='calculateSum(3)'/></td>"+
															"<td name='is_current' width='120px' style='text-align:center;'>"+
																"<input type='text' name='sub_current_income' style='width:120px; border:0px;color:#FF0000;text-align:center' onchange='calculateSum(3)'/></td>"+
															"<td name='isn_over_date' width='120px' style='text-align:center;'>"+
																"<input type='text' name='sub_management_fee' style='width:120px; border:0px;color:#FF0000;text-align:center' onchange='calculateSum(4)'/></td>"+
															"<td width='80px' style='text-align:center;' onclick='onDelTR(this);'>"+
																"<a href='javascript:void(0)' style='color:#FF0000; font-size:12px;'>删除</a>"+
															"</td></tr>");	
		init_redeem_div();
	}
	
	//删除产品限制信息行
	function onDelTR(trObj){	
		var targetTable = $(trObj).parent().parent().get(0);
	    $(trObj).parent().remove();
	    calculateSum(1);
	}
</script>
</head>
<body>
<div class="pop-center" id="bill_info">
		<div class="pop-center overflow-au">
			<div class="center-content" style="min-width: 550px;">
				<div class="warningDiv" align="left">
					友情告知：赎回单据流程需在本月<font id="prompt_date" color='blue'></font>日前完成，否则该赎回单据将作废
				</div>
				
				<div class="clearboth">
					<h2><span id="title_tip"></span></h2>
				</div>
				<div class="float-l">
					<div class="pop-form-title2" >单据编号：</div>
					<div class="l-panel-search-item">
						<a id="prot_code" target="_Blank"></a>
					</div>
				</div>
				<div style="margin-left:330px">
					<div class="pop-form-title2" >合同编号：</div>
					<div class="l-panel-search-item">
						<span id="financial_bill_code"></span>
					</div>
				</div>  
				<div class="float-r">
					<div class="pop-form-title2" ><span style="color: #FF0000;">*</span>赎回申请时间：</div>
					<div class="l-panel-search-item">
						<input type="text" class="Wdate" name="redeem_date"
					onclick="WdatePicker({dateFmt:'yyyy-MM-dd',isShowClear:true})"
					onchange="calculateIncomeManageFee()"
					style="width: 133px; vertical-align: top;"  class="input-H4" />
					</div>
				</div>
				
				<div class="clearboth"></div>
						
				<div id="redeem_info" class="class_redeem">
					<div class="center-title">
					<!--  
						协议编号：--><input name="prot_code" type="hidden" disabled="disabled"
							style="border-style: none;"/>
					
					</div>
					<div class="center-txt clearfix"
						style="margin-bottom: 5px; padding: 5px; border: 1px solid #BFBFBF; height: auto;">
						<div class="float-l">
							<div class="pop-form-title2">客户姓名：</div>
							<div class="l-panel-search-item">
								<input type="text" name="b_name" readonly="readonly"
									class="input-H4 input-read" />
							</div>
						</div>
						<div class="float-l">
							<div class="pop-form-title2">证件类型：</div>
							<div class="l-panel-search-item">
								<input type="text" readonly="readonly"
									class="input-H4 input-read" value="身份证"/>
							</div>
						</div>
						<div class="float-l">
							<div class="pop-form-title2">身份证号：</div>
							<div class="l-panel-search-item">
								<input type="text" name="b_id_card" readonly="readonly"
									class="input-H4 input-read" />
								<input type="hidden" name="bonus_rate" readonly="readonly"
									class="input-H4 input-read" />
							</div>
						</div>
						
						<div class="float-l">
							<div class="pop-form-title2">产品名称：</div>
							<div class="l-panel-search-item">
								<input type="text" name="category_name" readonly="readonly"
									class="input-H4 input-read" />
							</div>
						</div>
						
						
						<div class="float-l">
							<div class="pop-form-title2">理财期限：</div>
							<div class="l-panel-search-item">
								<input type="text" name="product_deadline_name"
									readonly="readonly" class="input-H4 input-read" />
							</div>
						</div>
						<div class="float-l">
							<div class="pop-form-title2">年化利率：</div>
							<div class="l-panel-search-item">
								<input type="text" name="product_interest" readonly="readonly"
									class="input-H4 input-read" /> %
							</div>
						</div>
						
						<div class="float-l">
							<div class="pop-form-title2">投资金额：</div>
							<div class="l-panel-search-item">
								<input type="text" name="product_account" readonly="readonly" style="width:105px" 
									class="input-H4 input-read" /> 万元
							</div>
						</div>
						
						<div class="float-l">
							<div class="pop-form-title2">购买时间：</div>
							<div class="l-panel-search-item">
								<input type="text" name="create_timestamp_str"
									readonly="readonly" class="input-H4 input-read" />
								<input type="hidden" name="protocol_create_timestamp" />
							</div>
						</div>
						<div class="float-l">
							<div class="pop-form-title2">到期时间：</div>
							<div class="l-panel-search-item">
								<input type="text" name="end_of_date" readonly="readonly"
									class="input-H4 input-read" />
							</div>
						</div>
						
						<div class="float-l">
							<div class="pop-form-title2">银行账号：</div>
							<div class="l-panel-search-item">
								<input type="text" name="card_no"
									readonly="readonly" class="input-H4 input-read" />
							</div>
						</div>
						<div class="float-l">
							<div class="pop-form-title2">开户银行：</div>
							<div class="l-panel-search-item">
								<input type="text" name="bank_of_deposit" readonly="readonly" style="width:250px" 
									class="input-H4 input-read" />
							</div>
						</div>
						
				
						<div class="clearboth" style="text-align: center;font-size:15px">
							<h4>出借资金回收申请</h4>
						</div>
						<div class="clearboth" style="text-align: right;font-size:10px">
							<span id="current_notice"></span>
						</div>							
					 	<div class="center-content" style="text-align:center;algin:center">
							<table id="redeem_table" style="border-collapse: collapse;margin:auto" borderColor=#BFBFBF height=25 cellPadding=1 border=1>
								<tr>
									<td class="input-H4 input-read" width="120px" style="text-align:center;" >赎回类型</td>
									<td class="input-H4 input-read" width="120px" style="text-align:center;">赎回本金(A)万元</td>
								    <td class="input-H4 input-read" width="120px" style="text-align:center;">应付基本收益(B1)元</td>
								    <td class="input-H4 input-read" width="120px" style="text-align:center;">应付奖励收益(B2)元</td>
								    <td class="input-H4 input-read" width="120px" style="text-align:center;">已付收益(C)元</td>
								    <td class="input-H4 input-read" name="is_over_date" width="120px" style="text-align:center;">公益产品收益(E)元</td>								    
									<td class="input-H4 input-read" name="is_current" width="120px" style="text-align:center;">应付活期收益(I)元</td>								    																		
									<td class="input-H4 input-read" name="isn_over_date" width="120px" style="text-align:center;">转让服务费(D)元</td>								    																		
									<td class="input-H4 input-read" width="80px" style="text-align:center;" onclick="onAddTR(this);">
						    			操作
						    		</td>
							    </tr>
							 
							    <tr>
									<td width="120px" style="text-align:center;" >
										合计						
									</td>
									<td width="120px" style="text-align:center;" >
										<input type="text" name="sum_redeem_amount" style="width:120px; border:0px;color:#FF0000;text-align:center" readonly="readonly"/>
									</td>
								<!-- 	<td width="120px" style="text-align:center;" >
										<input type="text" name="sum_due_income" style="width:120px; border:0px;color:#FF0000;text-align:center" readonly="readonly"/>
									</td> 
								-->
									<td width="120px" style="text-align:center;" >
										<input type="text" name="sum_due_basic_income" style="width:120px; border:0px;color:#FF0000;text-align:center" readonly="readonly"/>
									</td>
									<td width="120px" style="text-align:center;" >
										<input type="text" name="sum_due_reward_income" style="width:120px; border:0px;color:#FF0000;text-align:center" readonly="readonly"/>
									</td>
									<td width="120px" style="text-align:center;" >
										<input type="text" name="sum_paid_income" style="width:120px; border:0px;color:#FF0000;text-align:center" readonly="readonly"/>
									</td>
									<td name="is_over_date" width="120px" style="text-align:center;" >
										<input type="text" name="sum_public_income" style="width:120px; border:0px;color:#FF0000;text-align:center" readonly="readonly"/>
									</td>
									<td name="is_current" width="120px" style="text-align:center;" >
										<input type="text" name="sum_current_income" style="width:120px; border:0px;color:#FF0000;text-align:center" readonly="readonly"/>
									</td>
									<td name="isn_over_date" width="120px" style="text-align:center;" >
										<input type="text" name="sum_management_fee" style="width:120px; border:0px;color:#FF0000;text-align:center" readonly="readonly"/>
									</td>
									<td width="80" style="text-align:center;">
						    			
						    		</td>
							    </tr>
							</table>
						</div> 
						
						<div class="clearboth" style="text-align: center;font-size:15px"></div>
						
						<div class="float-l">						
							<div class="pop-form-title2" ><span style="color: #FF0000;">*</span>赎回事由：</div>
							<div class="l-panel-search-item">
								<select name="redeem_company_reason" style="width: 135px;" onchange="calculateIncomeManageFee('changeReason')">
									<option value="0">请选择</option>								
	                                <option value="1">公司原因</option>
	                                <option value="2">个人原因</option>
	                                <option value="3">协议到期</option>
                            	</select>
							</div>
						</div>
						<!-- 1.95版本去掉	
						<div class="float-l" id="damages_tip">
							<div class="pop-form-title2" >服务费：</div>
							<div class="l-panel-search-item">
								<input type="radio" style="width:30px;height:18px;vertical-align: middle;" name="is_take_off_damages" id="is_take_off_damages_1" value="1" onclick="changeFeeDefault();"/>收取
								<input type="radio" style="width:30px;height:18px;vertical-align: middle;" name="is_take_off_damages" id="is_take_off_damages_0" value="0" onclick="changeFee();"/>不收
							</div>
						</div> -->
						<div class="float-l" id="management_fee_tip">
							<div class="pop-form-title2" style="margin-left: 25px">转让服务费(D)：</div>
							<div class="l-panel-search-item">
								<input type="text" name="management_fee" class="input-H4" onchange='calculateSum()'/> 元
							</div>
						</div>
						
						<div class="float-l" style="padding:5px">
							<div class="pop-form-title2"><span style="color: #FF0000;">*</span>事由补充：</div>
								<div id="shsy" class="pop-form-item clearfix" style="height: auto">
									<textarea name="redeem_reason" class="bz_remark" 
										style="resize: none; width: 700px; height: 60px;" maxlength="400">补录</textarea>
								</div>
						</div>
						
						<!--  其他扣款取消
						<div class="float-l">
							<div class="pop-form-title2"><span id="deduct_money_tip"></span></div>
							<div class="l-panel-search-item">
								<input type="text"  name="deduct_money"  value="0" onchange='calculateSum()'/> 元
							</div>
						</div>
						 -->
						<div class="float-l">
							<div class="pop-form-title2"><span id="tax_point_tip"></span></div>
							<div class="l-panel-search-item">
								<input type="text"  name="deduct_tax_point"  value="0" onchange='calculateSum()'/> 元
							</div>
						</div>
						<div class="float-l">
							<div class="pop-form-title2" style="margin-left: -12px"><span id="income_tip"></span></div>
							<div class="l-panel-search-item">
								<input type="text"  name="due_income"  value="0" readonly="readonly"/> 元
							</div>
						</div>
						<div class="clearboth" style="text-align: center;font-size:15px"></div>						
						<br/>
						<div class="float-l">
							<div class="pop-form-title2"><span id="real_income_tip"></span></div>
							<div class="l-panel-search-item">
								<input type="text"  name="redeem_reality_total_amount"  value="0" readonly="readonly"/> 元
							</div>
						</div>
						
						<div class="float-l">
							<div class="pop-form-title2" style="margin-left: -12px">大写：</div>
							<div class="l-panel-search-item">
								<input type="text"  name="redeem_reality_total_amount_upper"  value="" style="width:220px"  readonly="readonly"/>
							</div>
						</div>
						
						<div class="clearboth float-l" style="height:26px"></div>
						<!-- 
						<div class="float-r" style="padding-right:60px">
							<div class="pop-form-title"></div>
							<div class="l-panel-search-item">
								客户确认：<input type="radio" style="width:30px;height:18px;vertical-align: middle;" name="is_handle_self"  value="1" disabled="disabled"/>客户亲自办理
								<input type="radio" style="width:30px;height:18px;vertical-align: middle;" name="is_handle_self" value="0" disabled="disabled"/>客户经理代办							
							</div>
						</div>
						 -->					
					</div>
				</div>
			</div>
		</div>
	</div>
	
	<div class="pop-footer5 clearboth" style="bottom: 1px;">
		<input id="tjbtn" class="btn-saveT"
			onmouseover="this.className='btn-saveT-over'"
			onmouseout="this.className='btn-saveT'"
			onmousedown="this.className='btn-saveT-down'" type="button"
			style="margin-right: 7px;" onclick="save()" /> <input
			id="cancelBtnId" class="btn-cancel"
			onmouseover="this.className='btn-cancel-over'"
			onmouseout="this.className='btn-cancel'"
			onmousedown="this.className='btn-cancel-down'" type="button"
			onclick="closeDialog()" />
	</div>
</body>
</html>