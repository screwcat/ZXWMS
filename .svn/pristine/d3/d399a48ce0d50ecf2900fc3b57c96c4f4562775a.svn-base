
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>逾期还款确认-催缴驳回</title>
<link href="../../css/zx-all.css" rel="stylesheet" type="text/css" />
<link href="../../css/app.css" rel="stylesheet" type="text/css" />
<link href="../../css/ligerui-main.css" rel="stylesheet" type="text/css" />
<script src="../../js/zx-all.js" type="text/javascript"></script>
<style type="text/css">
.td_title {
	background: none repeat scroll 0 0 #f4f5f7;
}

.tb_input TD {
	background: none repeat scroll 0 0 #FFFFFF;
	padding: 3px 1px 1px 4px;
}
.textright {
	text-align: right;
}
.textleft {
	text-align: left;
}

.title_tb {
	background-color: #f5f8ff;
	padding-left: 16px;
	font-weight: bold;
	height: 30px;
	line-height: 30px;
	/*border:1px solid #dfdfdf;*/
	border-bottom:0;
}
.title_tb .title_txt{
float:left;
}
.title_tb .title_btn{
float:right;
margin-top:2px;
font-weight:normal;
}
.input_tb_new td {
    /*border-bottom: 1px dashed #D5D5D5;*/
	height: 35px;
	line-height: 25px;
	padding-top: 3px;
}
.data_tb td {
	height: 30px;
	line-height: 24px;
	padding-left: 10px;
	border-bottom: 1px dashed #e3e4e6;
	text-align: left;
}
#huankuan {
	text-align: left;
}
.text0{
	   border-bottom:#666 0px solid;
	   border-left-width:0px;
	   border-right-width:0px;
	   border-top-width:0px;
}
</style>
</head>
<body>
		<!--查询条件  begin-->
		<table width="100%" border="0" cellspacing="0" cellpadding="0">
			<tr valign="bottom" id='trtab1'>
				<td class="tabbody1" id="tabbody1"
					 tabname='mytab'
					style="width: 100%"><div align="center">催缴信息</div></td>
			</tr>
		</table>
		<!--------------------------------------------------------------------催缴单 begin----------------------------------------------------------------  -->
		<div id="reminder" class="pop-formDiv clearfix" style="margin: 5px; margin-top: 5px;">
				<div class="float-l">
					<div class="pop-form-title">客户名称:</div>
					<div class="pop-form-item">
						<input type="text" id="dunning_name" readonly="readonly"class="text0" />
					</div>
				</div>
				<div class="float-l" style="left: 50px;">
					<div class="pop-form-title">联系电话:</div>
					<div class="pop-form-item">
						<input type="text" id="dunning_tel"  readonly="readonly"class="text0" />
					</div>
				</div>
				<div class="float-l">
					<div class="pop-form-title">贷款种类:</div>
					<div class="pop-form-item">
						<input type="text" id="cre_loan_type" readonly="readonly" class="text0"/>
					</div>
				</div>
				<div class="float-l clearboth">
					<div class="pop-form-title">合同编号:</div>
					<div class="pop-form-item">
						<input type="text" id="protocol_code" readonly="readonly"class="text0" />
					</div>
				</div>
				<div class="float-l">
					<div class="pop-form-title">签约日期:</div>
					<div class="pop-form-item">
						<input type="text" id="protocol_creat_date" readonly="readonly" class="text0"/>
					</div>
				</div>
				<div class="float-l">
					<div class="pop-form-title">合同金额:</div>
					<div class="pop-form-item">
						<input type="text" id="protocol_amount" readonly="readonly" style="width: 120px;"class="text0"/>元
					</div>
				</div>
				<div class="float-l">
					<div class="pop-form-title">违约日期:</div>
					<div class="pop-form-item">
						<input type="text" id="default_date" 
							maxlength="50" readonly="readonly" class="text0"/>
					</div>
				</div>
				<div class="float-l">
					<div class="pop-form-title">已还期数:</div>
					<div class="pop-form-item">
						<input type="text" id="repay_period" 
							maxlength="50" readonly="readonly" class="text0"/>
					</div>
				</div>
				<div class="float-l">
					<div class="pop-form-title">期数:</div>
					<div class="pop-form-item">
						<input type="text" id="deadline" 
							maxlength="50" readonly="readonly" class="text0"/>
					</div>
				</div>
				<div class="float-l clearboth">
					<div class="pop-form-title">剩余债权:</div>
					<div class="pop-form-item">
						<input type="text" id="un_matching_creditor"  readonly="readonly" class="text0"/>
					</div>
				</div>
				<div class="float-l">
					<div class="pop-form-title">逾期天数:</div>
					<div class="pop-form-item">
						<input type="text" id="overdue_day"class="text0" readonly="readonly" style="width: 120px;" onblur="add_default_amount(this);"/>天
					</div>
				</div>
				<div class="float-l">
					<div class="pop-form-title">每日滞纳金额:</div>
					<div class="pop-form-item">
						<input type="text" id="liquidated_damages" readonly="readonly" style="width: 120px;"class="text0"/>元
					</div>
				</div>
				<div class="float-l">
					<div class="pop-form-title">违约金额:</div>
					<div class="pop-form-item">
						<input type="text" id="default_amount" 
							maxlength="50" readonly="readonly" style="width: 120px;" class="text0"/>元
					</div>
				</div>
				<div class="float-l">
					<div class="pop-form-title">客户经理:</div>
					<div class="pop-form-item">
						<input type="text" id="salesman_name" 
							maxlength="50" readonly="readonly" class="text0"/>
					</div>
				</div>
				<div class="float-l">
					<div class="pop-form-title">团队经理:</div>
					<div class="pop-form-item">
						<input type="text" id="team_manager_name" 
							maxlength="50" readonly="readonly"class="text0" />
					</div>
				</div>
				<div class="float-l clearboth">
					<div class="pop-form-title">还款银行:</div>
					<div class="pop-form-item">
						<input type="text" id="refund_bank" 
							maxlength="50" readonly="readonly" class="text0"/>
					</div>
				</div>
				<div class="float-l">
					<div class="pop-form-title">还款账号:</div>
					<div class="pop-form-item">
						<input type="text" id="refund_number" 
							maxlength="70" readonly="readonly" style="width: 150px;" class="text0"/>
					</div>
				</div>
				<div class="float-l">
					<div class="pop-form-title">抵押情况:</div>
					<div class="pop-form-item">
						<input type="text" id="mortgrage"  readonly="readonly"class="text0" />
					</div>
				</div>
				<div class="float-l clearboth">
					<div class="pop-form-title"><span style="color: red;">*</span>预期催缴回金额:</div>
					<div class="pop-form-item">
						<input type="text" id="expectPaymentAmount" name="expect_payment_amount"
							maxlength="50" style="width: 120px;"  readonly="readonly" class="text0"/>元
					</div>
				</div>
				<div class="float-l clearboth">
					<div class="pop-form-title">缴回违约金金额:</div>
					<div class="pop-form-item">
						<input type="text" id="return_amount" name="return_amount"
							maxlength="50" style="width: 120px;"  readonly="readonly" class="text0"/>元
					</div>
				</div>
				<div class="float-l ">
					<div class="pop-form-title">缴回比例:</div>
					<div class="pop-form-item">
						<input type="text" id="return_ratio" name="return_ratio"
							maxlength="50" style="width: 120px;" readonly="readonly" class="text0"/>%
					</div>
				</div>
				<div class="float-l ">
					<div class="pop-form-title">提成:</div>
					<div class="pop-form-item">
						<input type="text" id="return_ommission" name="return_ommission"
							maxlength="50"  readonly="readonly"class="text0" />
					</div>
				</div>
				<div class="float-l clearboth">
					<div class="pop-form-title">备注:</div>
					<textarea id="dunning_remark" name="dunning_remark" rows="" cols="" style="width: 700px;height: 80px;resize:none;"  readonly="readonly"class="text0" ></textarea>
				</div>
				
		</div>
		<div class="center-content clearboth" style="min-width: 400px;">
		<div class="center-title">驳回</div>
		<div id="grid_idea" class="center-txt clearfix"
			style="margin-bottom: 20px;">
			<table align="center" border="0" cellpadding="0" cellspacing="0"
				width="100%">
				<tr>
					<td id="apprpve" class="td_title" width="14%" rowspan="2"
						align="center">驳回意见</td>
				</tr>
				<tr>
					<td><textarea id="advice" name="advice" rows="50"
							style="width: 96%; height: 80px; margin: 5px 10px; resize: none;"
							maxlength="250"></textarea></td>
				</tr>
			</table>
		</div>
		</div>

		<!-- -----------------------------------------------------------------催缴单 end------------------------------------------------------------------ -->
	<!-- 提交功能按钮区 -->
	<div class="pop-footer5 clearboth" style="bottom: 1px;">
	 <input id="tjbtn"
			class="btn-saveT" onmouseover="this.className='btn-saveT-over'"
			onmouseout="this.className='btn-saveT'"
			onmousedown="this.className='btn-saveT-down'" type="button"
			style="margin-right: 7px;" onclick="save()" /> <input
			id="cancelBtnId" class="btn-cancel"
			onmouseover="this.className='btn-cancel-over'"
			onmouseout="this.className='btn-cancel'"
			onmousedown="this.className='btn-cancel-down'" type="button"
			onclick="closePage();" />
	</div>
	<script type="text/javascript">
	var wms_post_dunning_head_id=$.query.get('wms_post_dunning_head_id');
	//判断来源:催缴贷后主管审核=1并且上门催缴状态为空 为电话催缴
	//催缴贷后主管审核=2代表为转为上门催缴 为 上门催缴
	var loansupervisor_result=$.query.get('loansupervisor_result');
	var home_dunning_status=$.query.get('home_dunning_status');
	var homekey=$.query.get('homekey');//判断是催缴审核还是上门催缴
	var grid_top;
	var flag=1;//仅作是否增加跟踪记录标识
	$(function(){
			if(home_dunning_status=="undefined"){
				home_dunning_status="";
			}
		    //催缴单据ID获取审核信息
			$.getJSON(globalUtil.getTimestampUrl('/loanpost/wmspostdunningheadbyHk.do'),
			{
				"wms_post_dunning_head_id" : wms_post_dunning_head_id,
			},
			function(json) {
				//加载催缴单信息
				globalUtil.setFormVal("reminder", json);
				//加载贷后专员和结果信息
				globalUtil.setFormVal("processingoftracking", json);
				init_cre_loan_type(json);
				init_mortgrage(json);
				if(homekey==1)//说明催缴确认
				{
					setPage();
					setCheckBoxValues("home_dunning_status",json.home_dunning_status);
				}else{
					$('#overdue_day').removeAttr('onblur');
				}
				});
	});
	//信用贷款产品类型
	function init_cre_loan_type(json){ 
		if(json.cre_type==1){
			var cre_loan_type_params ={
					dest_url:'/sysmanage/wmssysdictdatabydictidempty.do?isEmpty=true&wms_sys_dict_id=26',
					t_col_name:'cre_loan_type',
					valueField:'wms_sys_dict_data_id',   //下拉框value对应的值，默认为id
					textField:'value_meaning',    //下拉框text对应的值，默认为text
					def_val:'first'
					};
		}else if(json.cre_type==2){
			var cre_loan_type_params ={
					dest_url:'/sysmanage/wmssysdictdatabydictidempty.do?isEmpty=true&wms_sys_dict_id=27',
					t_col_name:'cre_loan_type',
					valueField:'wms_sys_dict_data_id',   //下拉框value对应的值，默认为id
					textField:'value_meaning',    //下拉框text对应的值，默认为text
					def_val:'first'
					};
		}
		global_ligerui_extend.initCombox("cre_loan_type",null,cre_loan_type_params);
		if(json){
			//把值装载设定
			global_ligerui_extend.syncRequestInitComboxData(json,"cre_loan_type");
			//让其不可编辑
			global_ligerui_extend.disabledCombox("cre_loan_type");
		}else{			
		    global_ligerui_extend.initComboxDefVal("cre_loan_type");
		}
	}
	//抵押情况初始化
	function init_mortgrage(json){
		var mortgrage_params ={
				dest_url:'/sysmanage/wmssysdictdatabydictidempty.do?isEmpty=true&wms_sys_dict_id=65',
				t_col_name:'mortgrage',
				valueField:'value_code',   //下拉框value对应的值，默认为id
				textField:'value_meaning',    //下拉框text对应的值，默认为text
				def_val:'first'
				};
		global_ligerui_extend.initCombox("mortgrage",function (val){
			return value;
		},mortgrage_params);
		if(json){
			//把值装载设定
			global_ligerui_extend.syncRequestInitComboxData(json,"mortgrage");
			//让其不可编辑
			global_ligerui_extend.disabledCombox("mortgrage");
			if(json.mortgrage=="-1"){
				$("#mortgrage").val("未选择");
			}
		}else{			
		    global_ligerui_extend.initComboxDefVal("mortgrage");
		}
	}
	/*if((value==""||value==null) && rowdata.loansupervisor_result==1){
		value="电话催缴";
	}else if(rowdata.loansupervisor_result==2||(value!=null&&value!="")){
		value="上门催缴";
	}*/
	//进行信息存储
	function save(){
			jsonParm={};
			jsonParm.wms_post_dunning_head_id=wms_post_dunning_head_id;//催缴主表主键
			jsonParm.reject_advice=$("#advice").val();//意见
			if(jsonParm.reject_advice==""||jsonParm.reject_advice==null){
				globalUtil.warnMsg("请填写驳回意见");
				return;
			}
			if((home_dunning_status==""||home_dunning_status==null) && loansupervisor_result==1){
				jsonParm.reject_status="1";//电话催缴
			}else if(loansupervisor_result==2||(home_dunning_status!=null&&home_dunning_status!="")){
				jsonParm.reject_status="2";//"上门催缴"
			}
			$.post(globalUtil.getTimestampUrl("/loanpost/wmspostdunningheaddoUpdateForReject.do"),jsonParm,function(data){
				if(data==="success")
				{
					globalUtil.successMsg("驳回成功!");
					closePage();
				}
				else if(data==="error")
				{
					globalUtil.errorMsg("驳回失败!");
				}
			});
	}
	 //设置text文本 radio 为不可编辑模式
	function lookpage() {			
		$("input[type=text]").attr({
			"disabled" : "disabled"
		});
		$("input[type=radio]").attr({
			"disabled" : "disabled"
		});
		//设置文本域不可编辑
		$("textarea[name='overdue_status']").attr({
			"disabled" : "disabled"
		});
		//设置文本域不可编辑
		$("textarea[name='info_update']").attr({
			"disabled" : "disabled"
		});
		//设置多选择框不可编辑
		$("input[type=checkbox]").attr({
			"disabled" : "disabled"
		});
	}
 	//关闭页面
    function closePage(){
    	window.parent.search();
    	window.parent.dialog.hide();
    }
		
</script>
</body>
</html>