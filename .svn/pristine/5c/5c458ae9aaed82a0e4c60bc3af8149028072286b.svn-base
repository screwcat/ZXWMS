<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>退单申请</title>
<link href="../../css/zx-all.css" rel="stylesheet" type="text/css" />
<script src="../../js/zx-all.js" type="text/javascript"></script>
<style type="text/css">
.float-l{
    height: 40px;
}
input{
    width: 150px;
}
.readonly{
    background-color: rgb(235, 235, 228);
    border: 1px solid red;
    width: 150px;
}
</style>
</head>
<body>
	<div class="pop-center overflow-au" style="margin: 5px; margin-top: 5px;">
	    <div class="center-content clearboth" style="min-width: 700px;">
	        <div class="center-title" style="margin-top: 0px;">基本信息</div>
		    <div class="center-content2 clearboth" style="min-width: 500px;" id="customerInfo">
		        <div class="l-panel-search-cond clearfix" style="padding-top: 10px; height: 120px;">
			        <div class="float-l" style="margin-left: 80px">
		                <div class="l-panel-search-title">单据编号：</div>
		                <div class="l-panel-search-item">
		                    <input type="text" id="bill_code" maxlength="50" readonly="readonly" class="readonly" />
		                </div>
		            </div>
		            <div class="float-l">
		                <div class="l-panel-search-title">客户姓名：</div>
		                <div class="l-panel-search-item">
		                    <input type="text" id="cus_name" maxlength="50" readonly="readonly" class="readonly" />
		                </div>
		            </div>
		            <div class="float-l">
		                <div class="l-panel-search-title">身份证号：</div>
		                <div class="l-panel-search-item">
		                    <input type="text" id="id_card_show" maxlength="50" readonly="readonly" class="readonly" />
		                    <input type="hidden" id="id_card" maxlength="50" readonly="readonly" />
		                </div>
		            </div>
		            <div class="float-l clearboth" style="margin-left: 80px">
		                <div class="l-panel-search-title">联系电话：</div>
		                <div class="l-panel-search-item">
		                    <input type="text" id="mobile_phone" maxlength="50" readonly="readonly" class="readonly" />
		                </div>
		            </div>
		            <div class="float-l">
		                <div class="l-panel-search-title">投资产品：</div>
		                <div class="l-panel-search-item">
		                    <input type="text" id="category_name" maxlength="50" readonly="readonly" class="readonly" />
		                </div>
		            </div>
		            <div class="float-l">
		                <div class="l-panel-search-title">投资金额：</div>
		                <div class="l-panel-search-item">
		                    <input type="text" id="product_account_show" maxlength="50" readonly="readonly" class="readonly" />&nbsp;&nbsp;万
		                </div>
		            </div>
		            <div class="float-l clearboth" style="margin-left: 68px">
		                <div class="l-panel-search-title">业务员姓名：</div>
		                <div class="l-panel-search-item">
		                    <input type="text" id="salesman_name" maxlength="50" readonly="readonly" class="readonly" />
		                </div>
		            </div>
		            <div class="float-l">
		                <div class="l-panel-search-title">部门经理：</div>
		                <div class="l-panel-search-item">
		                    <input type="text" id="department_manager_name" maxlength="50" readonly="readonly" class="readonly" />
		                </div>
		            </div>
		            <div class="float-l">
		                <div class="l-panel-search-title">副总经理：</div>
		                <div class="l-panel-search-item">
		                    <input type="text" id="vice_general_manager_name" maxlength="50" readonly="readonly" class="readonly" />
		                </div>
		            </div>
			    </div>
		    </div>
	        <div class="center-title" style="margin-top: 0px;">退款卡信息</div>
	        <div class="center-content2 clearboth" style="min-width: 500px;" id="card">
			    <div class="l-panel-search-cond clearfix" style="padding-top: 10px; height: 120px;">
			        <div class="float-l" style="margin-left: 68px">
			            <div class="l-panel-search-title" style="margin-top: 2px">退款方式：</div>
		                <div class="l-panel-search-item">
		                    <input type="radio" name="card_info" value="1" style="vertical-align:middle; margin-top:0px; margin-bottom:1px; width:13px;" />支付卡
		                    <input type="radio" name="card_info" value="2" style="vertical-align:middle; margin-top:0px; margin-bottom:1px; width:13px;" />收益卡
		                    <input type="radio" name="card_info" value="3" style="vertical-align:middle; margin-top:0px; margin-bottom:1px; width:13px;" class="radio3" />其他
		                </div>
		            </div>
		            <div class="float-l clearboth" style="margin-left: 80px">
		                <div class="l-panel-search-title">用户名：</div>
		                <div class="l-panel-search-item">
		                    <input type="text" id="card_owner_name" readonly="readonly" class="readonly" maxlength="50" />
		                </div>
		            </div>
		            <div class="float-l">
		                <div class="l-panel-search-title">银行卡号：</div>
		                <div class="l-panel-search-item">
		                    <input type="text" id="card_no" maxlength="50" class="readonly" readonly="readonly" />
		                    <input type="hidden" id="card_no_copy" />
		                </div>
		            </div>
		            <div class="float-l">
		                <div class="l-panel-search-title">开户行：</div>
		                <div class="l-panel-search-item">
		                    <input type="text" id="bank_of_deposit" maxlength="50" class="readonly" readonly="readonly" />
		                </div>
		            </div>
		            <div class="float-l clearboth" style="margin-left: 104px">
		                <div class="l-panel-search-title">省：</div>
		                <div class="l-panel-search-item">
		                    <select id="bank_of_deposit_pro" disabled="disabled" class="readonly" style="width: 152px;"></select>
		                </div>
		            </div>
		            <div class="float-l" style="margin-left: 36px">
		                <div class="l-panel-search-title">市：</div>
		                <div class="l-panel-search-item">
		                    <select id="bank_of_deposit_city" disabled="disabled" class="readonly" style="width: 152px;"></select>
		                </div>
		            </div>
		            <div class="float-l" style="margin-left: 12px">
		                <div class="l-panel-search-title">支行：</div>
		                <div class="l-panel-search-item">
		                    <input type="text" id="bank_branch" maxlength="50" class="readonly" readonly="readonly" />
		                </div>
		            </div>
			    </div>
		    </div>
		    <div class="center-title" style="margin-top: 0px;">退单原因</div>
	        <div class="center-content2 clearboth" style="min-width: 500px;">
	            <div class="l-panel-search-cond clearfix" style="padding-top: 10px; height: 195px;">
	                <div class="float-l">
	                    <div class="l-panel-search-title">
	                        <font color="red">*</font>客户退单原因：
	                    </div>
	                    <div class="l-panel-search-item">
	                        <textarea id="back_apply_advice" style="width: 727px; height: 180px;"></textarea>
	                    </div>
	                </div>
	            </div>
	        </div>
		</div>
	</div>
    <!-- 提交功能按钮区 -->
    <div class="pop-footer5 clearboth" style="bottom: 1px; height: 35px" id="tb_btn">
        <!-- 提交 -->
        <input id="save" class="btn-saveT"
            onmouseover="this.className='btn-saveT-over'"
            onmouseout="this.className='btn-saveT'"
            onmousedown="this.className='btn-saveT-down'" type="button"
            style="margin-right: 7px;" />
        <!-- 退单确认第一步展示 -->
        <input id="confirmShow" class="btn-saveT"
            onmouseover="this.className='btn-saveT-over'"
            onmouseout="this.className='btn-saveT'"
            onmousedown="this.className='btn-saveT-down'" type="button"
            style="margin-right: 7px;display: none;" />     
        <!-- 取消-->  
        <input id="cancel"
            class="btn-cancel" onmouseover="this.className='btn-cancel-over'"
            onmouseout="this.className='btn-cancel'"
            onmousedown="this.className='btn-cancel-down'" type="button" />
    </div>
<script type="text/javascript">
var wms_inve_transa_id = $.query.get("wms_inve_transa_id");
var wms_inve_transa_prod_id = $.query.get("wms_inve_transa_prod_id");
var wms_inve_pruduct_category_id = $.query.get("wms_inve_pruduct_category_id");
var wms_inve_customer_id = $.query.get("wms_inve_customer_id");
var taskId = $.query.get('taskId');
var type = $.query.get('type');

var bean = {};
var transaAndProdBean = {};
var wmsInveTransaCardBean = {};
bean.wms_inve_transa_id = wms_inve_transa_id;
bean.wms_inve_transa_prod_id = wms_inve_transa_prod_id;

var wmsInveTransaBackApplyBean = {};

jQuery(function($){ 
    
	//获取省
	var proJson = globalUtil.syncGetJson('/sysmanage/wmssysdictdatabydictidempty.do',
            {'isEmpty': true, 'wms_sys_dict_id': '72'}, 'GET');
	$(proJson).each(function(i, o){
		$('#bank_of_deposit_pro').append("<option value='" + o.value_code + "'>" + o.value_meaning + "</option>");
	});
	
	//获取市
	var cityJson = globalUtil.syncGetJson('/sysmanage/wmssysdictdatabydictidempty.do',
            {'isEmpty': true, 'wms_sys_dict_id': '73'}, 'GET');
    
	if(type == 1){//退单申请页面跳转
        //初始化表单数据
        $.ajax({ 
            type: "POST", 
            url: global_param.context_name + "/inve/singleApplicationDisp.do",
            async: true,
            dataType: "json",
            data: { 
                wms_inve_transa_id : wms_inve_transa_id,
                wms_inve_transa_prod_id : wms_inve_transa_prod_id,
                wms_inve_pruduct_category_id : wms_inve_pruduct_category_id,
                wms_inve_customer_id : wms_inve_customer_id,
            }, 
            success: function(data){
                transaAndProdBean = data.transaAndProdBean;
                wmsInveTransaCardBean = data.wmsInveTransaCardBean;
                $('#customerInfo input').each(function(i, o){
                	$(o).val(transaAndProdBean[$(o).attr('id')]);
                });
                $('#bank_of_deposit_city').append("<option value='-1'>请选择</option>");
            }
        });
    }else if(type == 2){//退单确认页面跳转(仅展示):数据来源于退单申请表
        $('input[name=card_info]').attr("disabled", "disabled");//单选按钮组设置只读
        $('#save').hide();//退单申请按钮隐藏
        $('#confirmShow').show();//退单确认(第一步)按钮展示
        //初始化表单数据
        $.ajax({ 
            type: "POST", 
            url: global_param.context_name + "/inve/getBackApplyDataForConfirm.do",
            async: true,
            dataType: "json",
            data: { 
                wms_inve_transa_id : wms_inve_transa_id,
                wms_inve_transa_prod_id : wms_inve_transa_prod_id,
                wms_inve_pruduct_category_id : wms_inve_pruduct_category_id,
                wms_inve_customer_id : wms_inve_customer_id,
            }, 
            success: function(data){
            	wmsInveTransaBackApplyBean = data.wmsInveTransaBackApplyBean;
                $('#customerInfo input').each(function(i, o){
                    $(o).val(wmsInveTransaBackApplyBean[$(o).attr('id')]);
                });
                $("input[name='card_info'][value=" + wmsInveTransaBackApplyBean.card_info + "]").attr("checked", true);                                
                $('#card_owner_name').val(wmsInveTransaBackApplyBean.card_owner_name);
                $('#card_no').val(wmsInveTransaBackApplyBean.card_no);
                $('#bank_of_deposit').val(wmsInveTransaBackApplyBean.bank_of_deposit);
                $('#bank_of_deposit_pro').val(wmsInveTransaBackApplyBean.bank_of_deposit_pro);
                
                $('#bank_of_deposit_city').append("<option value='-1'>请选择</option>");
                $(cityJson).each(function(i, o){
                    if(o.p_wms_sys_dict_data_id == wmsInveTransaBackApplyBean.bank_of_deposit_pro){
                        $('#bank_of_deposit_city').append("<option value='" + o.value_code + "'>" + o.value_meaning + "</option>");
                    }
                });
                $('#bank_of_deposit_city').val(wmsInveTransaBackApplyBean.bank_of_deposit_city);
                
                $('#card_owner_name').val(wmsInveTransaBackApplyBean.card_owner_name);
                $('#bank_branch').val(wmsInveTransaBackApplyBean.bank_branch);
                $('#back_apply_advice').val(wmsInveTransaBackApplyBean.back_apply_advice).attr('readonly', 'readonly').addClass('readonly');
            }
        });
    }else if(type == 3){//退单退回再次申请(所有数据来自于上次修改的信息 并且退款卡信息 退单原因可修改)
    	$.ajax({ 
            type: "POST", 
            url: global_param.context_name + "/inve/singleApplicationDisp.do",
            async: true,
            dataType: "json",
            data: { 
                wms_inve_transa_id : wms_inve_transa_id,
                wms_inve_transa_prod_id : wms_inve_transa_prod_id,
                wms_inve_pruduct_category_id : wms_inve_pruduct_category_id,
                wms_inve_customer_id : wms_inve_customer_id,
            }, 
            success: function(data){
                transaAndProdBean = data.transaAndProdBean;
                wmsInveTransaCardBean = data.wmsInveTransaCardBean;
            }
        });
    	//初始化表单数据
        $.ajax({ 
            type: "POST", 
            url: global_param.context_name + "/inve/getBackApplyDataForConfirm.do",
            async: true,
            dataType: "json",
            data: { 
                wms_inve_transa_id : wms_inve_transa_id,
                wms_inve_transa_prod_id : wms_inve_transa_prod_id,
                wms_inve_pruduct_category_id : wms_inve_pruduct_category_id,
                wms_inve_customer_id : wms_inve_customer_id,
            }, 
            success: function(data){
                wmsInveTransaBackApplyBean = data.wmsInveTransaBackApplyBean;
                $('#customerInfo input').each(function(i, o){
                    $(o).val(wmsInveTransaBackApplyBean[$(o).attr('id')]);
                });
                $("input[name='card_info'][value=" + wmsInveTransaBackApplyBean.card_info + "]").attr("checked", true);
                
                $('#card_owner_name').val(wmsInveTransaBackApplyBean.card_owner_name);
                $('#card_no').val(wmsInveTransaBackApplyBean.card_no);
                $('#bank_of_deposit').val(wmsInveTransaBackApplyBean.bank_of_deposit);
                $('#bank_of_deposit_pro').val(wmsInveTransaBackApplyBean.bank_of_deposit_pro);
                
                $('#bank_of_deposit_city').append("<option value='-1'>请选择</option>");
                $(cityJson).each(function(i, o){
                    if(o.p_wms_sys_dict_data_id == wmsInveTransaBackApplyBean.bank_of_deposit_pro){
                        $('#bank_of_deposit_city').append("<option value='" + o.value_code + "'>" + o.value_meaning + "</option>");
                    }
                });
                $('#bank_of_deposit_city').val(wmsInveTransaBackApplyBean.bank_of_deposit_city);
                
                $('#card_owner_name').val(wmsInveTransaBackApplyBean.card_owner_name);
                $('#bank_branch').val(wmsInveTransaBackApplyBean.bank_branch);
                $('#back_apply_advice').val(wmsInveTransaBackApplyBean.back_apply_advice);
                
                if(wmsInveTransaBackApplyBean.card_info != 3){//退款卡方式不为"其他"时设置退款卡信息只读
                    //支付卡的某项信息不为空时才为只读,为空时可编辑
                    $('#card input').each(function(i, o){
                        if($(o).val() != ''){
                            $(o).attr("readonly", "readonly").addClass('readonly');
                        }else{
                        	
                            $(o).removeAttr("readonly").removeClass('readonly');
                        }
                    });
                    $('#card select').each(function(i, o){
                        if($(o).val() != '-1'){
                            $(o).attr("disabled", "disabled").addClass('readonly');
                        }else{
                            $(o).removeAttr("disabled").removeClass('readonly');
                        }
                    });
                }else{
                    $('#card input').removeAttr("readonly").removeClass('readonly');
                    $('#card select').removeAttr("disabled").removeClass('readonly');
                }
                
            }
        });
        
    }
	
    //修改省时加载市
    $('#bank_of_deposit_pro').change(function(){
    	var p_wms_sys_dict_data_id = $(this).val();
    	$('#bank_of_deposit_city').empty();
    	$('#bank_of_deposit_city').append("<option value='-1'>请选择</option>");
    	$(cityJson).each(function(i, o){
    		if(o.p_wms_sys_dict_data_id == p_wms_sys_dict_data_id){
    			$('#bank_of_deposit_city').append("<option value='" + o.value_code + "'>" + o.value_meaning + "</option>");
    		}
    	});
    });
	
    //银行卡号限制格式
    $('#card_no').keyup(function(){
    	var val = $('#card_no').val();//获取用户输入
        val = val.replace(/\D/g, '');
        $("#card_no_copy").val(val);       
        var ncard = '';
        for(var n = 0;n < val.length; n = n + 4){
            ncard += val.substring(n, n + 4) + " ";
        }
        $('#card_no').val(ncard.replace(/(\s*$)/g, ""));
    });
    
    //改变单选按钮组触发联动事件
    $('input[name=card_info]').click(function(){
    	var card_info = $(this).val();
    	if(card_info == 1){//支付卡(来自于card表)
            if(type == 1){//签署协议页面退单申请
            	 $('#card_owner_name').val(wmsInveTransaCardBean.card_owner_name);
                 $('#card_no').val(wmsInveTransaCardBean.card_no);
                 $('#bank_of_deposit').val(wmsInveTransaCardBean.bank_of_deposit_name);
                 $('#bank_of_deposit_pro').val(wmsInveTransaCardBean.bank_of_deposit_pro);
                 
                 $('#bank_of_deposit_city').empty();
                 if($('#bank_of_deposit_pro').val() != -1){
	                 $('#bank_of_deposit_city').append("<option value='-1'>请选择</option>");
                 }
                 $(cityJson).each(function(i, o){
                     if(o.p_wms_sys_dict_data_id == wmsInveTransaCardBean.bank_of_deposit_pro){
                         $('#bank_of_deposit_city').append("<option value='" + o.value_code + "'>" + o.value_meaning + "</option>");
                     }
                 });
                 
                 $('#bank_branch').val(wmsInveTransaCardBean.bank_branch);
            	
            	//支付卡的某项信息不为空时才为只读,为空时可编辑
                $('#card input').each(function(i, o){
                    if($(o).val() != ''){
                        $(o).attr("readonly", "readonly").addClass('readonly');
                    }else{
                        $(o).removeAttr("readonly").removeClass('readonly');
                    }
                });
                $('#card select').each(function(i, o){
                    if($(o).val() != '-1'){
                        $(o).attr("disabled", "disabled").addClass('readonly');
                    }else{
                        $(o).removeAttr("disabled").removeClass('readonly');
                    }
                });
            }
            if(type == 3){//退单退回再次申请
            	if(wmsInveTransaBackApplyBean.card_info == 1){//退单申请时选择的为支付卡(退款卡信息来自于退单申请表)
            		$('#card_owner_name').val(wmsInveTransaBackApplyBean.card_owner_name);
                    $('#card_no').val(wmsInveTransaBackApplyBean.card_no);
                    $('#bank_of_deposit').val(wmsInveTransaBackApplyBean.bank_of_deposit);
                    $('#bank_of_deposit_pro').val(wmsInveTransaBackApplyBean.bank_of_deposit_pro);
                    
                    $('#bank_of_deposit_city').append("<option value='-1'>请选择</option>");
                    $(cityJson).each(function(i, o){
                        if(o.p_wms_sys_dict_data_id == wmsInveTransaBackApplyBean.bank_of_deposit_pro){
                            $('#bank_of_deposit_city').append("<option value='" + o.value_code + "'>" + o.value_meaning + "</option>");
                        }
                    });
                    $('#bank_of_deposit_city').val(wmsInveTransaBackApplyBean.bank_of_deposit_city);
                    
                    $('#card_owner_name').val(wmsInveTransaBackApplyBean.card_owner_name);
                    $('#bank_branch').val(wmsInveTransaBackApplyBean.bank_branch);
                    $('#back_apply_advice').val(wmsInveTransaBackApplyBean.back_apply_advice);
                    
                    //支付卡的某项信息不为空时才为只读,为空时可编辑
                    $('#card input').each(function(i, o){
                        if($(o).val() != ''){
                            $(o).attr("readonly", "readonly").addClass('readonly');
                        }else{
                            
                            $(o).removeAttr("readonly").removeClass('readonly');
                        }
                    });
                    $('#card select').each(function(i, o){
                        if($(o).val() != '-1'){
                            $(o).attr("disabled", "disabled").addClass('readonly');
                        }else{
                            $(o).removeAttr("disabled").removeClass('readonly');
                        }
                    });
            	}else{//退单申请时选择的不是支付卡(退款卡信息来自于card表)
            		$('#card_owner_name').val(wmsInveTransaCardBean.card_owner_name);
                    $('#card_no').val(wmsInveTransaCardBean.card_no);
                    $('#bank_of_deposit').val(wmsInveTransaCardBean.bank_of_deposit_name);
                    $('#bank_of_deposit_pro').val(wmsInveTransaCardBean.bank_of_deposit_pro);
                    
                    $('#bank_of_deposit_city').empty();
                    if($('#bank_of_deposit_pro').val() != -1){
                        $('#bank_of_deposit_city').append("<option value='-1'>请选择</option>");
                    }
                    $(cityJson).each(function(i, o){
                        if(o.p_wms_sys_dict_data_id == wmsInveTransaCardBean.bank_of_deposit_pro){
                            $('#bank_of_deposit_city').append("<option value='" + o.value_code + "'>" + o.value_meaning + "</option>");
                        }
                    });
                    
                    $('#bank_branch').val(wmsInveTransaCardBean.bank_branch);
                   
                   //支付卡的某项信息不为空时才为只读,为空时可编辑
                   $('#card input').each(function(i, o){
                       if($(o).val() != ''){
                           $(o).attr("readonly", "readonly").addClass('readonly');
                       }else{
                           $(o).removeAttr("readonly").removeClass('readonly');
                       }
                   });
                   $('#card select').each(function(i, o){
                       if($(o).val() != '-1'){
                           $(o).attr("disabled", "disabled").addClass('readonly');
                       }else{
                           $(o).removeAttr("disabled").removeClass('readonly');
                       }
                   });
            	}
            }
 
    	}else if(card_info == 2){//收益卡(来自于上单产品表)
    		$('#card input').attr("readonly", "readonly").addClass('readonly');
            $('#card select').attr("disabled", "disabled").addClass('readonly');

            $('#card_owner_name').val(transaAndProdBean.card_owner_name);
            $('#card_no').val(transaAndProdBean.card_no);
            $('#bank_of_deposit').val(transaAndProdBean.bank_of_deposit);
            $('#bank_of_deposit_pro').val(transaAndProdBean.bank_of_deposit_pro);
            
            $('#bank_of_deposit_city').empty();
            $('#bank_of_deposit_city').append("<option value='-1'>请选择</option>");
            $(cityJson).each(function(i, o){
                if(o.p_wms_sys_dict_data_id == transaAndProdBean.bank_of_deposit_pro){
                    $('#bank_of_deposit_city').append("<option value='" + o.value_code + "'>" + o.value_meaning + "</option>");
                }
            });
            $('#bank_of_deposit_city').val(transaAndProdBean.bank_of_deposit_city);
            
            $('#bank_branch').val(transaAndProdBean.bank_branch);
            
    	}else if(card_info == 3){//其他(用户编辑)
            if(wmsInveTransaBackApplyBean.card_info == 3){//退单申请时选择的为其他(退款卡信息来自于退单申请表)
                $('#card_owner_name').val(wmsInveTransaBackApplyBean.card_owner_name);
                $('#card_no').val(wmsInveTransaBackApplyBean.card_no);
                $('#bank_of_deposit').val(wmsInveTransaBackApplyBean.bank_of_deposit);
                $('#bank_of_deposit_pro').val(wmsInveTransaBackApplyBean.bank_of_deposit_pro);
                
                $('#bank_of_deposit_city').append("<option value='-1'>请选择</option>");
                $(cityJson).each(function(i, o){
                    if(o.p_wms_sys_dict_data_id == wmsInveTransaBackApplyBean.bank_of_deposit_pro){
                        $('#bank_of_deposit_city').append("<option value='" + o.value_code + "'>" + o.value_meaning + "</option>");
                    }
                });
                $('#bank_of_deposit_city').val(wmsInveTransaBackApplyBean.bank_of_deposit_city);
                
                $('#card_owner_name').val(wmsInveTransaBackApplyBean.card_owner_name);
                $('#bank_branch').val(wmsInveTransaBackApplyBean.bank_branch);
                $('#back_apply_advice').val(wmsInveTransaBackApplyBean.back_apply_advice);
                
                $('#card input').each(function(i, o){
                    $(o).removeAttr("readonly").removeClass('readonly');
                });
                $('#card select').each(function(i, o){
                    $(o).removeAttr("disabled").removeClass('readonly');
                });
                
            }else{
            	$('#card input').removeAttr("readonly").removeClass('readonly');
                $('#card select').removeAttr("disabled").removeClass('readonly');
                
                $('#card_owner_name').val('');
                $('#card_no').val('');
                $('#bank_of_deposit').val('');
                $('#bank_of_deposit_pro').val(-1);
                $('#bank_of_deposit_city').empty().append("<option value='-1'>请选择</option>");
                $('#bank_branch').val('');
            }
    	}
    });
    
	//提交
	$('#save').click(function(){
		var card_info = $('input[name=card_info]:checked').val();
		var card_no = $('#card_no').val();
		var card_owner_name = $('#card_owner_name').val();
		var bank_of_deposit = $('#bank_of_deposit').val();
		var bank_of_deposit_pro = $('#bank_of_deposit_pro').val();
		var bank_of_deposit_city = $('#bank_of_deposit_city').val();
		var bank_branch = $('#bank_branch').val();
		var back_apply_advice = $('#back_apply_advice').val();
		
		bean.card_info = card_info;
		bean.card_no = card_no;
		bean.card_owner_name = card_owner_name;
		bean.bank_of_deposit = bank_of_deposit;
		bean.bank_of_deposit_pro = bank_of_deposit_pro;
		bean.bank_of_deposit_city = bank_of_deposit_city;
		bean.bank_branch = bank_branch;
		bean.back_apply_advice = back_apply_advice;
		if(bean.back_apply_advice == null || bean.back_apply_advice == '' || bean.back_apply_advice.trim() == ''){
			globalUtil.warnMsg(globalErrorMsg['800705']);
			return false;
		}
		$.ajax({ 
	        type: "POST", 
	        url: global_param.context_name + "/inve/singleApplicationSave.do?taskId=" + taskId,
	        async: false,
	        dataType: "json",
	        data: bean, 
	        success: function(data){
	        	if(data == "success"){
	        		globalUtil.successMsg(globalErrorMsg['100002'], function(){                            
	        		    refreshAndClosePage();
	                });
	        	}else{
	        		globalUtil.warnMsg(globalErrorMsg['100012']);
	        	}
	        }
	    });
    });
	
	//退单确认查看后调整审核页
	$('#confirmShow').click(function(){
		dialog = $.ligerDialog.open({
            url: globalUtil.getHtml("approvalTransaBackApply.html?wms_inve_transa_id=" + wms_inve_transa_id +
                    "&wms_inve_transa_prod_id=" + wms_inve_transa_prod_id + 
                    "&taskId=" + taskId),
            title: '确认结果',
            width: 600,
            height: globalUtil.setDialogHeight(300),
            onHiddenOrClose: function(){
            },
            isResize: false
        });
	});
	
	//取消
	$('#cancel').click(function(){
		try{
            window.parent.dialog.hide();
        }catch(e){
            globalUtil.closeCurrentTab();
        }
	});
	
});

function closePage(){
    try{
        window.parent.dialog.hide();
    }catch(e){
        globalUtil.closeCurrentTab();
    }
 }

//关闭本页并刷新查询页面
function refreshAndClosePage(){     
    window.parent.search();
    closePage();    
}

</script>
</body>
</html>
