<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link href="../../css/zx-all.css" rel="stylesheet" type="text/css" />
<link href="../../css/app.css" rel="stylesheet" type="text/css" />
<script src="../../js/zx-all.js" type="text/javascript"></script>
<script src="../../js/exportxls.js?v=2"></script>
<script type="text/javascript" charset="utf-8" src="../../js/media/js/ZeroClipboard.js"></script>
<title>贷款数据查询</title>
</head>
<body style="overflow-y: hidden;">
	<div class="l-panel-search clearfix centertoolbar-w">
		<div id="searchbar" class="l-searchbar clearfix">
			<!--查询条件-->
				<div class="float-l">
					<div class="l-panel-search-title" style="margin-left: 16px">单据编号：</div>
					<div class="l-panel-search-item">
						<input type="text" id="bill_code" />
					</div>
				</div>
				<div class="float-l">
					<div class="l-panel-search-title" style="margin-left: 16px">还款状态：</div>
					<div class="l-panel-search-item">
					<!-- 	<select id="repay_status">
						</select> -->
						<input type="text" id="repay_status_id"onchange='initVal(this)'/>
		                <input type="hidden" id="repay_status"/>
					</div>
				</div>
				<div class="float-l">
					<div class="l-panel-search-title" style="margin-left: 16px">客户姓名：</div>
					<div class="l-panel-search-item">
						<input type="text" id="customer_name_all" />
					</div>
				</div>
				<div class="float-l">
					<div class="l-panel-search-title" style="margin-left: 16px">申请时间：</div>
					<div class="l-panel-search-item">
						<input id="appl_date_begin" class="Wdate" type="text"
							onclick="WdatePicker({dateFmt:'yyyy-MM-dd',isShowClear:true})"
							style="width: 133px; vertical-align: top;" /> --
						<input id="appl_date_end" class="Wdate" type="text"
							onclick="WdatePicker({dateFmt:'yyyy-MM-dd',isShowClear:true})"
							style="width: 133px; vertical-align: top;" />
					</div>
				</div>
				<div class="float-l">
					<div class="l-panel-search-title" style="margin-left: 16px">合同时间：</div>
					<div class="l-panel-search-item">
						<input id="protocol_date_begin" class="Wdate" type="text"
							onclick="WdatePicker({dateFmt:'yyyy-MM-dd',isShowClear:true})"
							style="width: 133px; vertical-align: top;" /> --
						<input id="protocol_date_end" class="Wdate" type="text"
							onclick="WdatePicker({dateFmt:'yyyy-MM-dd',isShowClear:true})"
							style="width: 133px; vertical-align: top;" />
					</div>
				</div>
				<div class="float-l">
					<div class="l-panel-search-title" style="margin-left: 16px">合同号：</div>
					<div class="l-panel-search-item">
						<input type="text" id="protocol_id_year_num" />
					</div>
				</div>
				<div class="float-l clearboth">
					<div class="l-panel-search-title" style="margin-left: 16px">身份证号：</div>
					<div class="l-panel-search-item">
						<input type="text" id="id_card_all" />
					</div>
				</div>
				
				<div class="float-l">
					<div class="l-panel-search-title" style="margin-left: 16px">联系电话：</div>
					<div class="l-panel-search-item">
						<input type="text" id="mobile_telephone" />
					</div>
				</div>
				<div class="float-l" style="margin-left: 12px;">
					<div class="l-panel-search-title" style="margin-left: 16px">业务员：</div>
					<div class="l-panel-search-item">
						<input type="text" id="salesman_name_str" />
					</div>
				</div>
				<div class="float-l" style="margin-left: 0px;">
					<div class="l-panel-search-title" style="margin-left: 16px">借款金额：</div>
					<div class="l-panel-search-item">
						<input type="text" id="appro_limit_str"/> -- <input type="text" id="appro_limit_end" />元
					</div>
					
				</div>
				<div class="float-l" style="margin-left: 0px;">
					<div class="l-panel-search-title" style="margin-left: 4px">打卡金额：</div>
					<div class="l-panel-search-item">
						<input type="text" id="loan_amount_str" /> -- <input type="text" id="loan_amount_end" />元
					</div>
				</div>
				<div class="float-l" style="margin-left: 0px;">
					<div class="l-panel-search-title" style="margin-left: 16px">期数：</div>
					<div class="l-panel-search-item">
						<input type="text" id="borrow_deadline" />
					</div>

				</div>
				<div class="float-l clearboth">
					<div class="l-panel-search-title" style="margin-left: 16px">团队经理：</div>
					<div class="l-panel-search-item">
						<input type="text" id="team_manager_name"  style ="width:109px"/><a href="#" onclick="showProducts(this)" class="selectObj">选择</a>
						<input type="hidden" id="team_manager_name_val" />
					</div>
				</div>
				
				<div class="float-l" style="margin-left: 35px">
					<div class="l-panel-search-title">产品：</div>
					<div class="l-panel-search-item">
						<!-- <select id="category_id">
		                </select> -->
		                <input type="text" id="category_id_id" onchange='initVal(this)'/>
		                <input type="hidden" id="category_id"/>
					</div>
				</div>
				<div class="float-l" style="margin-left: -1px">
					<div class="l-panel-search-title">所属营业部：</div>
					<div class="l-panel-search-item">
					<!-- 	<select id="sales_epartment_name_id">
		                </select> -->
		                <input type="text" id="sales_epartment_name_id" onchange='initVal(this)'/>
		                <input type="hidden" id="sales_epartment_name"/>
					</div>
				</div>
				<div class="float-l" style="margin-left: 0px;">
					<div class="l-panel-search-title" style="margin-left: 4px">月还款金额：</div>
					<div class="l-panel-search-item">
						<input type="text" id="refund_limit_month_str"/> -- <input type="text" id="refund_limit_month_end" />元
					</div>
					
				</div>
				<div class="float-l">
					<div class="l-panel-search-title" style="margin-left: 0px">终止还款日期：</div>
					<div class="l-panel-search-item">
						<input id="borrow_end_date_begin" class="Wdate" type="text"
							onclick="WdatePicker({dateFmt:'yyyy-MM-dd',isShowClear:true})"
							style="width: 115px; vertical-align: top;" /> --
						<input id="borrow_end_date_end" class="Wdate" type="text"
							onclick="WdatePicker({dateFmt:'yyyy-MM-dd',isShowClear:true})"
							style="width: 133px; vertical-align: top;" />
					</div>
				</div>
				<div class="float-l ">
					<div class="l-panel-search-title" style="margin-left: 3px">业务状态：</div>
					<div class="l-panel-search-item">
						<input type="text" id="bill_type_id" onchange='initVal(this)'/>
		                <input type="hidden" id="bill_type"/>
					</div>
				</div>
				<div class="float-l clearboth">
					<div class="l-panel-search-title" style="margin-left: 40px">次数：</div>
					<div class="l-panel-search-item">
						<input type="text" id="the_number"/>
					</div>
				</div>
				<div class="float-l" style="margin-left: 0px;">
					<div class="l-panel-search-title" style="margin-left: 16px">合同金额：</div>
					<div class="l-panel-search-item">
						<input type="text" id="principal_lower_str"/> -- <input type="text" id="principal_lower_end" />元
					</div>
				</div>
				<div class="float-l "style="margin-left: 95px;">
					<div class="l-panel-search-title">产品种类:</div>
					<div class="l-panel-search-item">
						<input type="text" id="mort_flag" />
					</div>
				</div>
		</div>
	</div>
	<div id="centertoolbar" class="minwidth400"></div>
	<div id="grid"></div>
	<!-- 工具条初始化 -->
	<script type="text/javascript">
		var grid;
		var toolbar;
		var params;
		var dialog;
		var columns;
		var selectrow;
		var checkedIds = [];//保存自选行id(id可替换为任意字段值，但字段值需唯一)
        var checkedIdsAll = [];//保存rowdata
	/* 	//产品下拉框
		globalUtil.init_select_value("category_id", "wms_sys_dict_data_id", "value_meaning", "true", "26,27");
		//还款状态下拉框
		globalUtil.init_select_value("repay_status", "value_code", "value_meaning", "true", "122");
		 */
		$(function() {
			initGrid();
			var toolbarItemData = [];
			toolbarItemData.push({
				text : '查询',
				click : search,
				icon : 'search'
			});
			toolbarItemData.push({
				line : true
			});
			 toolbarItemData.push({
                 text: '组合贷',
                 click : combinedLoan,
                 icon: 'copy'
             });
             toolbarItemData.push({
                 line: true
             });
			toolbarItemData.push({
				text : '清空',
				click : clear,
				icon : 'empty'
			});
			toolbarItemData.push({
				line : true
			});
			toolbarItemData.push({
				text : '导出Excel',
				icon : 'export',
				id : 'ToolTables_XLS_2'
			});
			toolbarItemData.push({
				line : true
			});
			$("#centertoolbar").ligerToolBar({
				items : toolbarItemData
			});
			search();
			registerCsv();
			//初始化营业部下拉列表
			init_dept_name_sel();
			//产品下拉框
			init_category_id_sel();
			//还款下拉框
			init_repay_status_sel();
			//业务状态
			init_bill_type_sel();
			//产品种类
			init_mort_flag();
		});
		
		function initParams() {
            params = globalUtil.getFormParam("searchbar");
            //产品
            if($('#category_id').val() != -1  && $('#category_id').val()!='undefined') {
				params.category_id = $('#category_id').val();
			}
            //还款状态
			if($('#repay_status').val() != -1 && $('#repay_status').val()!='undefined') {
				params.repay_status = $('#repay_status').val();
			}
            //营业部
			if($('#sales_epartment_name').val() != -1 && $('#sales_epartment_name').val()!='undefined') {
				params.sales_epartment_name = $('#sales_epartment_name').val();
			}
			//还款状态
			if($('#repay_status').val() != -1 && $('#repay_status').val()!='undefined') {
				params.repay_status = $('#repay_status').val();
			}

			//业务状态
			if($('#bill_type').val() != -1 && $('#bill_type').val()!='undefined') {
				params.bill_type = $('#bill_type').val();
			}
			if(params.mort_flag == '-1'){
            	params.mort_flag = '';
            }	
        }
		
		//实现数据导出功能
		function registerCsv() {
			var moviePath = "../../js/media/swf/copy_csv_xls_pdf.swf";
			var fileName = '贷款数据查询.xls';
			var titleJson = '';
			var dataJson = '';
			var obj = $("div[toolbarid='ToolTables_XLS_2']")[0];//获取菜单对象
			var getDataFun = function() {
				var text = {};
				text.title = {
					'bill_code' : '单据编号',
					'repay_status_name' : '还款状态',
					'appl_date' : '申请日期',
					'mort_flag_name':'产品种类',	
					'bill_type_name':'业务状态',
					'the_number':'次数',
					'customer_name' : '客户姓名',
					'id_card' : '身份证',
					'mobile_telephone' : '联系电话',
					'com_debtor_name' : '共贷人姓名',
					'com_debtor_identity_id' : '共贷人身份证号',
					'com_debtor_tel' : '共贷人联系电话',
					'current_address_more' : '通讯地址',
					'debtor_fixed_line' : '固话',
					'protocol_date' : '合同签订日期',
					'borrow_end_date' : '终止还款日期',
					'protocol_id_year_num' : '合同号',
					'category_name' : '产品',
					'principal_lower' : '合同金额(元)',
					'borrow_interest' : '利息',
					'appro_limit' : '借款金额(元)',
					'borrow_deadline' : '借款期限',
					'loan_amount' : '打卡金额(元)',
					'platform_fee' : '平台费(元)',
					'notarial_fee' : '公证费(元)',
					'refund_limit_month' : '月还款金额(元)',
					'salesman_name_str' : '业务员/工号',
					'team_manager_name' : '团队经理',
					'sales_epartment_name' : '所属营业部',
					'warn_remak' : '备注',
					'bill_code_group' : '组合贷编号'
				};
				
				//定义需要导出的列名以及列名与数据的对应关系
				initParams();
				var json = globalUtil.syncPostJson("/remind/searchloansSearchList.do?sortname=cast(principal_lower as decimal)&sortorder=desc&need_paging_flag=0", params);//同步获取需要导出的数据内容
				text.data = json.Rows;
				return text;
			};
			registerXlsFlashBtn(moviePath, fileName, titleJson, dataJson, obj, getDataFun);
		}
		
		//清空所填写内容
		function clear() {
			$("#searchbar input").each(function () {
				$(this).val('');
			});
			//部门
			sales_epartment_name.setValue("-1");
			//状态
			bill_type.setValue("-1");
			//产品
			category_id.setValue("-1");
			//状态
			repay_status.setValue("-1");
			//产品种类
			global_ligerui_extend.setComboxVal("mort_flag","-1");
			search();
		}
		
		//表格初始化
		function initGrid() {
			columns = [{
				display : '单据编号',
				name : 'bill_code',
				minWidth : 130,
				//添加超链接的东西
                render: function (rowdata, rowindex, value) { 
                	var wms_cre_credit_head_id = rowdata.wms_cre_credit_head_id;
                	if(rowdata.old_wms_cre_credit_head_id != null && rowdata.old_wms_cre_credit_head_id != undefined) {
                		wms_cre_credit_head_id = rowdata.old_wms_cre_credit_head_id;
                	}
                	if(wms_cre_credit_head_id == null || wms_cre_credit_head_id == "" || wms_cre_credit_head_id == undefined) {
                		return value;   
                	}
                	return '<a href="javascript:inveInfo(' + rowdata.wms_cre_credit_head_id + ');" style="color:#056AFF;text-decoration: none;">' + value + '</a>';
                },
			}, {
				display : '还款状态',
				name : 'repay_status_name',
				minWidth : 70,
			}, {
				display : '申请日期',
				name : 'appl_date',
				minWidth : 130,
			}, {
                display: '产品种类',
                name: 'mort_flag_name',
                width: 100,
                minWidth: 100,
            }, {
				display : '业务状态',
				name : 'bill_type_name',
				minWidth : 60,
			}, {
				display : '次数',
				name : 'the_number',
				minWidth : 40,
			}, {
				display : '客户姓名',
				name : 'customer_name',
				minWidth : 100,
			}, {
				display : '身份证',
				name : 'id_card',
				minWidth : 150,
			}, {
				display : '联系电话',
				name : 'mobile_telephone',
				minWidth : 100,
			}, {
				display : '共贷人姓名',
				name : 'com_debtor_name',
				minWidth : 100,
			}, {
				display : '共贷人身份证号',
				name : 'com_debtor_identity_id',
				minWidth : 150,
			}, {
				display : '共贷人联系电话',
				name : 'com_debtor_tel',
				minWidth : 100,
			}, {
				display : '通讯地址',
				name : 'current_address_more',
				minWidth : 200,
			}, {
				display : '固话',
				name : 'debtor_fixed_line',
				minWidth : 100,
			}, {
				display : '合同签订日期',
				name : 'protocol_date',
				minWidth : 130,
			}, {
				display : '终止还款日期',
				name : 'borrow_end_date',
				minWidth : 130,
			}, {
				display : '合同号',
				name : 'protocol_id_year_num',
				minWidth : 100,
			}, {
				display : '产品',
				name : 'category_name',
				minWidth : 100,
			}, {
				display : '合同金额(元)',
				name : 'principal_lower',
				minWidth : 80,
			}, {
				display : '利息',
				name : 'borrow_interest',
				minWidth : 100,
			}, {
				display : '借款金额(元)',
				name : 'appro_limit',
				minWidth : 100,
			}, {
				display : '借款期限',
				name : 'borrow_deadline',
				minWidth : 80,
			}, {
				display : '打卡金额(元)',
				name : 'loan_amount',
				minWidth : 100,
			}, {
				display : '平台费(元)',
				name : 'platform_fee',
				minWidth : 100,
			}, {
				display : '公证费(元)',
				name : 'notarial_fee',
				minWidth : 100,
			}, {
				display : '月还款金额(元)',
				name : 'refund_limit_month',
				minWidth : 100,
			}, {
				display : '联系人信息',
				name : 'phone_handle_result',
				width : 160,
				//添加超链接
                render: function (rowdata, rowindex, value) { 
                	var wms_cre_credit_head_id = rowdata.wms_cre_credit_head_id;
                	if(rowdata.old_wms_cre_credit_head_id != null && rowdata.old_wms_cre_credit_head_id != undefined) {
                		wms_cre_credit_head_id = rowdata.old_wms_cre_credit_head_id;
                	}
                	if(wms_cre_credit_head_id == null || wms_cre_credit_head_id == "" || wms_cre_credit_head_id == undefined) {
                		return "----";   
                	}
        			return '<a href="javascript:contactsInfo(' + wms_cre_credit_head_id + ');" style="color:#056AFF;text-decoration: none;">' + "查看" + '</a>';
                }
			}, {
				display : '业务员/工号',
				name : 'salesman_name_str',
				minWidth : 100,
			}, {
				display : '团队经理',
				name : 'team_manager_name',
				minWidth : 100,
			}, {
				display : '所属营业部',
				name : 'sales_epartment_name',
				minWidth : 120,
			}, {
				display : '备注',
				name : 'warn_remak',
				minWidth : 300,
			}, {
				display : '组合贷编号',
				name : 'bill_code_group',
				minWidth : 150,
			}];
			
			grid = $("#grid").ligerGrid({
				columns : columns,
				url : global_param.context_name + '/remind/searchloansSearchList.do',
				sortName : 'cast(principal_lower as decimal)', // 排序列名
				sortOrder : 'desc', // 排序方式
				rownumbers : true,
				allowUnSelectRow : true,
				checkbox: true,
        		onCheckRow: onCheckRowFunc,
				usePager : true,
				enabledSort: true,
				width : '100%',
				height : '95%',
				heightDiff : -4,
				parms : {
					_filterParms : -1
				}
			});
		}
		//初始化产品种类
    	function init_mort_flag(json){
    		var cre_type_params ={
    				dest_url:'/sysmanage/wmssysdictdatabydictidempty.do?isEmpty=true&wms_sys_dict_id=146',
    				t_col_name:'mort_flag',
    				valueField:'value_code',   //下拉框value对应的值，默认为id
    				textField:'value_meaning',    //下拉框text对应的值，默认为text
    				input_width:133,
    				def_val:'first'
    				};
    		global_ligerui_extend.initCombox("mort_flag",null,cre_type_params);
    		if(json){
    			//把值装载设定
    			global_ligerui_extend.syncRequestInitComboxData(json,"mort_flag");
    			//让其不可编辑
    			global_ligerui_extend.disabledCombox("mort_flag");
    		}else{			
    		    global_ligerui_extend.initComboxDefVal("mort_flag");
    		}
    	}
		//选中、取消复选框事件方法
        function onCheckRowFunc(checked, data) {
        	if (checked) {
        		addCheckedId(data.wms_cre_credit_notary_warn_id, data);
        	} else {
        		removeCheckedId(data.wms_cre_credit_notary_warn_id);
        	}
        }
     	
     	//选中、取消全部选项事件方法
        function onCheckAllRowFunc(checked, data) {
        	for (var rowid in this.records) {
        		if (checked) {
        			addCheckedId(this.records[rowid]['wms_cre_credit_notary_warn_id'], this.records[rowid]);
        		} else {
        			removeCheckedId(this.records[rowid]['wms_cre_credit_notary_warn_id']);
        		}
        	}
        }
        
        //向checkedCustomer中添加id的方法
        function addCheckedId(id, data) {
        	//判断是否重复
        	if(findCheckedIndex(id) == -1) {
	       		checkedIds.push(id);
	       		checkedIdsAll.push(data);
        	}
        }
        
        //从checkedCustomer中移除id的方法
        function removeCheckedId(id, data) {
        	checkedIds.splice(findCheckedIndex(id), 1);
        	checkedIdsAll.splice(findCheckedIndex(id), 1);
        }
        
        //在已选id中查找是否已存在指定id
        function findCheckedIndex(id) {
        	var return_index = -1;
        	$(checkedIds).each(function(i, o) {
        		if(o == id) {
        			return_index = i;
        			return;
        		}
        	}); 
        	return return_index;
        };
		//查询
		function search() {
			checkedIdsAll=[];
			checkedIds=[];
			initParams();
            global_ligerui_extend.search(grid, params);
		}
		
		//查询：当前页
		function research() {
			checkedIdsAll=[];
			checkedIds=[];
			initParams();
            global_ligerui_extend.research(grid, params);
		}
		
		function closeDialog() {
    	    dialog.hide();
    	    search();
        }
		//获取营业部
		var sales_epartment_name;
		function init_dept_name_sel(){
			$.ajax({ 
		        type: "GET", 
		        url: global_param.context_name + "/sysmanage/getCityCodeWithList.do?isEmpty=true",
		        async: false,
		        dataType: "json",
		        data: { 
		        }, 
		        success: function(data) {
		        	sales_epartment_name= $("#sales_epartment_name_id").ligerComboBox({ 
			    		    data:data,
			    		    valueField:"storesId",
			    		    textField:"storesName",
			    	        isShowCheckBox: true,   
			    	        isMultiSelect: true,  
			    	        valueFieldID: 'sales_epartment_name',  
			    	   }); 
			    	 sales_epartment_name.setValue("-1");
		        }
		    });
		}
		
		//还款状态
		var repay_status;
		function init_repay_status_sel(){
			$.ajax({ 
		        type: "GET", 
		        url: global_param.context_name + '/sysmanage/wmssysdictdatabydictidemptyall.do?isEmpty=true&wms_sys_dict_id=122',
		        async: false,
		        dataType: "json",
		        data: { 
		        }, 
		        success: function(data) {
		        	repay_status= $("#repay_status_id").ligerComboBox({ 
			    		    data:data,
			    		    valueField:"value_code",
			    		    textField:"value_meaning",
			    	        isShowCheckBox: true,   
			    	        isMultiSelect: true,  
			    	        valueFieldID: 'repay_status',  
			    	   }); 
		        	repay_status.setValue("-1");
		        }
		    });
		}
		//产品
		var category_id;
		function init_category_id_sel(){
			$.ajax({ 
		        type: "GET", 
		        url: global_param.context_name + '/sysmanage/wmssysdictdatabydictidemptyall.do?isEmpty=true&wms_sys_dict_id=26,27',
		        async: false,
		        dataType: "json",
		        data: { 
		        }, 
		        success: function(data) {
		        	category_id= $("#category_id_id").ligerComboBox({ 
			    		    data:data,
			    		    valueField:"wms_sys_dict_data_id",
			    		    textField:"value_meaning",
			    	        isShowCheckBox: true,   
			    	        isMultiSelect: true,  
			    	        valueFieldID: 'category_id',  
			    	   }); 
		        	category_id.setValue("-1");
		        }
		    });
		}
		//业务状态
		var bill_type;
		function init_bill_type_sel(){
			$.ajax({ 
		        type: "GET", 
		        url: global_param.context_name + '/sysmanage/wmssysdictdatabydictidemptyall.do?isEmpty=true&wms_sys_dict_id=124',
		        async: false,
		        dataType: "json",
		        data: { 
		        }, 
		        success: function(data) {
		        	bill_type= $("#bill_type_id").ligerComboBox({ 
			    		    data:data,
			    		    valueField:"value_code",
			    		    textField:"value_meaning",
			    	        isShowCheckBox: true,   
			    	        isMultiSelect: true,  
			    	        valueFieldID: 'bill_type',  
			    	   }); 
		        	bill_type.setValue("-1");
		        }
		    });
		}
		//显示所有团队经理
		function showProducts(obj) {
		    var vals = $("#team_manager_name_val").val();
		    var url = globalUtil.getHtml("financingProduct.html?sigleSign=1&vals=" + vals );
		    dialog = $.ligerDialog.open({
		        url: url,
		        title: '团队经理',
		        width: 700,
		        height: globalUtil.setDialogHeight(500),
		        onHiddenOrClose: function(){
		        },
		        isResize: false
		    });
		}//产品选择返回给产品赋值
		function setCategory(vals, names) {
		      $("#team_manager_name_val").val(vals);
		      $("#team_manager_name").val(names);
		}
		//初始化下拉框
		function initVal(obj){
			var objval=	$(obj).val();
			objval=objval.replace("---请选择---;","");
			if(objval==""){
				objval="---请选择---";
			}
			$(obj).val(objval);
		}
	$(document).on('click', '.l-box-select-absolute', function() {
		 $(this).css('display', 'block');
	 });
		//组合贷
		function combinedLoan(){
	    	//判断选择单据情况
	     	if(checkedIds.length<2){
		           globalUtil.warnMsg(globalErrorMsg['1701001']);//请选择至少俩条进行组合贷
		           return ; 
		    }
			globalUtil.confirmMsg((globalErrorMsg['1701002']), //是否将选择的单据进行组合贷！
				function(yes) {
		            if(yes) {
		            	$.ajax({ 
		        	        type: "POST", 
		        	        url: global_param.context_name + "/remind/combinedLoan.do",
		        	        async: false,
		        	        dataType: "json",
		        	        data : {
		        	        	checkedIds : JSON.stringify(checkedIds)
		        	        }, 
		        	        success: function(json) {
		        	        	if (json.result === 'success') {
					        		globalUtil.successMsg(globalErrorMsg['100002'],
					        			function(){
					        			//清空checkedIds
					        			research();
					        			
					        		});//保存成功 
					        	}else if (json.result === 'iderror'){//组合贷参数错误！
					        		globalUtil.successMsg(globalErrorMsg['1701003']);
					        	}else if (json.result === 'codeerror'){//存在已组合贷单据！
					        		globalUtil.warnMsg(globalErrorMsg['1701004']);
					        	}else if (json.result === 'idcarderror'){//身份证号码不同
					        		globalUtil.warnMsg(globalErrorMsg['1701005']);
					        	}else if (json.result === 'categorynameerror'){//姓名不同
					        		globalUtil.warnMsg(globalErrorMsg['1701006']);
					        	}else if (json.result === 'categorynamenull'){//姓名为空
					        		globalUtil.warnMsg(globalErrorMsg['1701007']);
					        	}else if (json.result === 'creloantypeerror'){//缺少组合贷 等额本息产品
					        		globalUtil.warnMsg(globalErrorMsg['1701008']);
					        	}else if (json.result === 'billcodegrouperror'){//组合贷编号错误
					        		globalUtil.warnMsg(globalErrorMsg['1701009']);
					        	}else{
					        		globalUtil.errorMsg(globalErrorMsg['100012']);
					        	}
		        	        }
		        	    });
		            }
	        	}
			);
		}
		//翻页清空当前页选择的数据
		$(document).on('click', '.l-bar-button', function() {
			checkedIdsAll=[];
			checkedIds=[];
		}).on('blur', '.pcontrol input', function() {
			checkedIdsAll=[];
			checkedIds=[];
		})
		
		//联系人信息
        function contactsInfo(wms_cre_credit_head_id) {
          	var url = globalUtil.getHtml("../loanappro/contactsInfo.html?wms_cre_credit_head_id=" + wms_cre_credit_head_id);
       		dialog = $.ligerDialog.open({
       			url: url,
       			title: '联系人信息',
		        width: 1000,
		        height: globalUtil.setDialogHeight(550),
		        onHiddenOrClose: function() {
		    	},
		        isResize: false
       		});
        }
		
		function inveInfo(wms_cre_credit_head_id) {
		    var url = globalUtil.getHtml("../creditManage/houseLoanAtt.html?wms_cre_credit_head_id=" + wms_cre_credit_head_id);
		    dialog = $.ligerDialog.open({
                url: url,
                title: '图片信息',
                width: 1500,
                height: globalUtil.setDialogHeight(1000),
                onHiddenOrClose: function() {
                    
                },
                isResize: false
            }); 
	    }

		
	</script>
</body>
</html>